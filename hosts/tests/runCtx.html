<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="/plugins/loader/jb-loader.js"></script>
    <link rel="stylesheet" type="text/css" href="/bin/studio/css/studio-all.css" />
    <style>
        .test-button {
            opacity: 0
        }

        .test-button:hover {
            opacity: 1
        }
    </style>
</head>

<body>
    <div id="remoteTests"> </div>

    <div id="mem"> </div>
    <div id="sourceCodeEl"> </div>
    <br></br>
    <div id="runCtxEl"> </div>
    <br></br>
    <div id="resultEl"> </div>
    <script>
        (async function () {
            const urlQuery = prop => (location.href.match(new RegExp(prop + '=([^&]*)')) || [])[1]
            const sourceCode = JSON.parse(decodeURIComponent(urlQuery('sourceCode')))
            const runCtx = JSON.parse(decodeURIComponent(urlQuery('runCtx')))
            globalThis.jb = await jbInit('runCtx', sourceCode)
            jb.spy.initSpyByUrl && jb.spy.initSpyByUrl()
            // loading remote-context.js & pretty print
            const remoteFileSymbols = jb.plugins.remote.files.find(x => x.path.match(/remote-context/))
            await jb.loadjbFile(remoteFileSymbols.path, jb, { fileSymbols: remoteFileSymbols, plugin: jb.plugins.remote })
            await jb.initializeLibs(remoteFileSymbols.libs)
            const ppFileSymbols = jb.plugins['pretty-print'].files[0]
            await jb.loadjbFile(ppFileSymbols.path, jb, { fileSymbols: ppFileSymbols, plugin: jb.plugins['pretty-print'] })
            await jb.initializeLibs(ppFileSymbols.libs)

            sourceCodeEl.innerText = jb.utils.prettyPrint(sourceCode)
            runCtxEl.innerText = JSON.stringify(runCtx)
            const res = await jb.remoteCtx.deStrip(runCtx)()
            resultEl.innerText = JSON.stringify(res)
            console.log(res)
        })()
    </script>
</body>

</html>