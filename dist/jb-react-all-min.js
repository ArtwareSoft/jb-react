!function(e){var t={};function a(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(n,i,function(t){return e[t]}.bind(null,i));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(module,exports,__webpack_require__){(function(global){const frame="object"==typeof self?self:"object"==typeof global?global:{},jb=function(){function e(n,i,l){if(g("req",[n,i,l]),n.probe&&n.probe.outOfTime)return;jb.ctxByPath&&(jb.ctxByPath[n.path]=n);const c=function(n,i,l){try{const l=n.profile;if(null==l||"object"==typeof l&&l.$disabled)return s(null,i);if(l.$debugger,l.$asIs)return l.$asIs;if(i&&(i.type||"").indexOf("[]")>-1&&!i.as&&(i.as="array"),"object"==typeof l&&0==Object.getOwnPropertyNames(l).length)return;const c=function(e,t){if(!t)return e;let a=e;for(let e in t||{})a=new y(a,{vars:{[e]:a.runInner(t[e]||"%%",null,"$vars~"+e)}});return a}(n,l.$vars),d=function(n,i){const r=n.profile,o=typeof r,s=i&&i.type,l=i&&i.as,c=Array.isArray(r);if("string"===o&&"boolean"===s)return{type:"booleanExp"};if("boolean"===o||"number"===o||"asIs"==s)return{type:"asIs"};if("object"===o&&"object"===l)return{type:"object"};if("string"===o)return{type:"expression"};if("function"===o)return{type:"function"};if("object"===o&&r instanceof RegExp)return{type:"asIs"};if(null==r)return{type:"asIs"};if(c){if(!r.length)return{type:"null"};if(!i||!i.type||"data"===i.type)return{type:"list"};if("action"===s||"action[]"===s&&r.isArray)return r.sugar=!0,{type:"runActions"}}else if(r.$if)return{type:"if",ifContext:new y(n,{profile:r.$if||r.condition,path:"$if"}),IfParentParam:{type:"boolean",as:"boolean"},thenContext:new y(n,{profile:r.then||0,path:"~then"}),thenParentParam:{type:s,as:l},elseContext:new y(n,{profile:r.else||0,path:"~else"}),elseParentParam:{type:s,as:l}};const d=b(r,i);if(!d)return{type:"asIs"};const p=jb.comps[d];if(!p&&d)return x("component "+d+" is not defined",n),{type:"null"};if(!p.impl)return x("component "+d+" has no implementation",n),{type:"null"};a(r,p);const u=Object.assign(new y(n,{}),{parentParam:i,params:{}}),f=function(a,n,i,r){return t(n).filter(e=>!e.ignore).map((o,s)=>{const l=o.id,c=m(i);let d=i[l],p=l;!d&&0==s&&c&&(p=c[0],d=c[1]);const u=void 0!==d?d:void 0!==o.defaultValue?o.defaultValue:null,b=void 0===d&&void 0!==o.defaultValue&&[a,"params",t(n).indexOf(o),"defaultValue"].join("~");b&&(p="");const f=u||[],y=o.type&&o.type.indexOf("[]")>-1&&Array.isArray(f);if(o.dynamic){return{name:l,type:"function",outerFunc:t=>{let a;return a=y?(e,a)=>jb.flattenArray(f.map((n,i)=>t.extendVars(e,a).runInner(n,o,p+"~"+i))):(a,n)=>e(new jb.jbCtx(t.extendVars(a,n),{profile:u,forcePath:b,path:p}),o),Object.defineProperty(a,"name",{value:l}),a.profile=void 0!==d?d:void 0!==o.defaultValue?o.defaultValue:null,a.srcPath=r.path,a},path:p,param:o,forcePath:b}}return y?{name:l,type:"array",array:f,param:Object.assign({},o,{type:o.type.split("[")[0],as:null}),forcePath:b,path:p}:{name:l,type:"run",prof:u,param:o,forcePath:b,path:p}})}(d,p,r,u);return"function"==typeof p.impl?(Object.defineProperty(p.impl,"name",{value:d}),{type:"profile",impl:p.impl,ctx:u,preparedParams:f}):{type:"profile",ctx:new y(u,{profile:p.impl,comp:d,path:""}),preparedParams:f}}(c,i);switch(n.parentParam=i,d.type){case"booleanExp":return s(o(l,n,i),i);case"expression":return s(r(l,n,i),i);case"asIs":return l;case"function":return s(l(n,n.vars,n.componentContext&&n.componentContext.params),i);case"null":return s(null,i);case"ignore":return n.data;case"list":return l.map((e,t)=>c.runInner(e,null,t));case"runActions":return jb.comps.runActions.impl(new y(c,{profile:{actions:l},path:""}));case"if":{const t=e(d.ifContext,d.IfParentParam);return t&&t.then?t.then(t=>t?e(d.thenContext,d.thenParentParam):e(d.elseContext,d.elseParentParam)):t?e(d.thenContext,d.thenParentParam):e(d.elseContext,d.elseParentParam)}case"profile":let t;if(d.impl||(d.ctx.callerPath=n.path),d.preparedParams.forEach(t=>{switch(t.type){case"function":d.ctx.params[t.name]=t.outerFunc(d.ctx);break;case"array":d.ctx.params[t.name]=t.array.map((a,i)=>e(new y(d.ctx,{profile:a,forcePath:t.forcePath||n.path+"~"+t.path+"~"+i,path:""}),t.param));break;default:d.ctx.params[t.name]=e(new y(d.ctx,{profile:t.prof,forcePath:t.forcePath||n.path+"~"+t.path,path:""}),t.param)}}),d.impl){const e=function(e,t){if(0==t.filter(t=>{const a=e.params[t.name]||{};return jb.isDelayed(a)&&"observable"!=t.param.as}).length)return[e,...t.map(t=>e.params[t.name])];const{pipe:a,concatMap:n,fromIter:i,toPromiseArray:r}=jb.callbag;return a(i(t),n(t=>e.params[t.name]),r).then(t=>[e,...t])}(d.ctx,d.preparedParams);if(l.$debugger,e.then)return e.then(e=>s(d.impl.apply(null,e),i));t=d.impl.apply(null,e)}else t=e(new y(d.ctx,{componentContext:d.ctx}),i);return l.$log&&console.log(!0===l.$log?t:c.run(l.$log)),l.$trace&&console.log("trace: "+n.path,n,t,d),s(t,i)}}catch(e){v(e,"exception while running run",n,i,l)}}(...arguments);return n.probe&&0==n.probe.pathToTrace.indexOf(n.path)&&n.probe.record(n,c),g("res",[n,c,i,l]),c}function t(e){return e&&e.params?Array.isArray(e.params)?e.params:$(e.params).map(e=>Object.assign(e[1],{id:e[0]})):[]}function a(e,a){if(e&&e.$byValue){const n=t(a);e.$byValue.forEach((t,a)=>Object.assign(e,{[n[a].id]:t})),delete e.$byValue}}function n(e){return e?(e.$jb_parent&&(e.$jb_parent=n(e.$jb_parent)),e&&"object"==typeof e&&1==e._state?e._result:e):e}function i(e){return"ref"===e||"ref[]"===e}function r(e,t,a){let s=""+e;if("boolean"==(a&&(a.ref?"ref":a.as)))return o(s,t);if(0==s.indexOf("$debugger:")&&(s=s.split("$debugger:")[1]),0==s.indexOf("$log:")){const e=r(s.split("$log:")[1],t,a);return jb.comps.log.impl(t,e),e}return-1==s.indexOf("%")&&-1==s.indexOf("{")?s:"{%%}"==s||"%%"==s?d(""):0==s.lastIndexOf("{%")&&s.indexOf("%}")==s.length-2?d(s.substring(2,s.length-2)):(s=(s=s.replace(/{%(.*?)%}/g,(e,t)=>c(d(t,{as:"string"})))).replace(/{\?(.*?)\?}/g,(e,a)=>c(function(e){const a=e.match(/%([^%;{}\s><"']*)%/);return a&&c(d(a[1]))?r(e,t,{as:"string"}):""}(a)))).match(/^%[^%;{}\s><"']*%$/)?d(s.substring(1,s.length-1),a):s=s.replace(/%([^%;{}\s><"']*)%/g,(e,t)=>c(d(t,{as:"string"})));function d(e,r){return n(function(e,t,a){const r=a&&(a.ref?"ref":a.as),o=e.split(/[./[]/);return o.reduce((e,s,c)=>(function e(o,s,c,d){if(""==s)return o;s.match(/]$/)&&(s=s.slice(0,-1));const m=jb.objHandler(o);const u=s.match(/=([a-zA-Z]*)\(?([^)]*)\)?/);if(u&&jb.functions[u[1]])return l(jb.functions[u[1]](t,u[2]),r);if(s.match(/\(\)$/)){const a=e(o,s.slice(0,-2),c,d);return"function"==typeof a?a(t):a}if(d&&"$"==s.charAt(0)&&s.length>1)return function(e,t,a){let r;return e.componentContext&&void 0!==e.componentContext.params[t]?r=e.componentContext.params[t]:void 0!==e.vars[t]?r=e.vars[t]:e.vars.scope&&void 0!==e.vars.scope[t]?r=e.vars.scope[t]:jb.resources&&void 0!==jb.resources[t]?r=i(a)?jb.mainWatchableHandler.refOfPath([t]):jb.resource(t):jb.consts&&void 0!==jb.consts[t]&&(r=i(a)?jb.simpleValueByRefHandler.objectProperty(jb.consts,t):r=jb.consts[t]),n(r)}(t,s.substr(1),c?r:null);const b=w(o);if("length"==s&&b&&void 0!==b.length)return b.length;if(Array.isArray(b)&&isNaN(Number(s)))return[].concat.apply([],b.map(t=>e(t,s,c,!1,m)).filter(e=>null!=e));if(null!=o&&"object"==typeof o){if(null==b)return;if("function"==typeof b[s]&&(a&&a.dynamic||b[s].profile))return b[s](t);if(i(r)){if(c)return m.objectProperty(b,s,t);void 0===b[s]&&(b[s]=function(e,t,a){return jb.log("implicitlyCreateInnerObject",[...arguments]),e[t]={},a.refreshMapDown&&a.refreshMapDown(e),e[t]}(b,s,m))}return c&&r?p[r](b[s]):b[s]}})(e,s,c==o.length-1,0==c),t.data)}(e,t,r||a))}}function o(e,t,a){if(0==e.indexOf("$debugger:")&&(e=e.split("$debugger:")[1]),0==e.indexOf("$log:")){const n=r(e.split("$log:")[1],t,{as:"boolean"}),i=o(e.split("$log:")[1],t,a);return jb.comps.log.impl(t,n+":"+i),i}if(0==e.indexOf("!"))return!o(e.substring(1),t);const n=e.match(/(.+)(==|!=|<|>|>=|<=|\^=|\$=)(.+)/);if(!n){const n=r(e,t,a);if(jb.isRef(n))return n;const i=jb.tostring(n);if("boolean"==typeof i)return i;const o=c(i);return!!o&&"false"!=o}if(4!=n.length)return x("invalid boolean expression: "+e,t);const i=n[2].trim();if("=="==i||"!="==i||"$="==i||"^="==i){const e=c(r(p(n[1]),t,{as:"string"}));let a=c(r(p(n[3]),t,{as:"string"}));if(a=(a.match(/^["'](.*)["']/)||["",a])[1],"=="==i)return e==a;if("!="==i)return e!=a;if("^="==i)return 0==e.lastIndexOf(a,0);if("$="==i)return-1!==e.indexOf(a,e.length-a.length)}const s=d(r(n[1].trim(),t)),l=d(r(n[3].trim(),t));if(">"==i)return s>l;if("<"==i)return s<l;if(">="==i)return s>=l;if("<="==i)return s<=l;function p(e){return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}}function s(e,t){return l(e,t?t.as:null)}function l(e,t){return t?(p[t],p[t](e)):e}const c=e=>l(e,"string"),d=e=>l(e,"number"),p={asIs:e=>e,object:e=>(Array.isArray(e)&&(e=e[0]),e&&"object"==typeof e?w(e):{}),string:e=>(Array.isArray(e)&&(e=e[0]),null==e?"":void 0===(e=w(e))?"":""+e),number(e){if(Array.isArray(e)&&(e=e[0]),null==e||null==e)return null;const t=Number(w(e),!0);return isNaN(t)?null:t},array:e=>("function"==typeof e&&e.profile&&(e=e()),e=w(e),Array.isArray(e)?e:null==e?[]:[e]),boolean:e=>(Array.isArray(e)&&(e=e[0]),!!w(e)),single:e=>(Array.isArray(e)&&(e=e[0]),w(e)),ref:e=>(Array.isArray(e)&&(e=e[0]),jb.asRef(e)),"ref[]":function(e){return jb.asRef(e)},value:e=>w(e)};function m(e){return $(e).filter(e=>0==e[0].indexOf("$")&&e[0].length>1).filter(e=>0!=e[0].indexOf("$jb_")).filter(e=>-1==["$vars","$debugger","$log"].indexOf(e[0]))[0]}function u(e,t){const a=t&&t.type&&t.type.split("[")[0];return a&&jb.comps[a]&&jb.comps[a].singleInType&&a}function b(e,t){if(!e||Array.isArray(e))return;if(e.$)return e.$;const a=m(e);return a&&a[0].slice(1)||u(0,t)}let f=0;class y{constructor(e,t){this.id=f++,this._parent=e,void 0===e?(this.vars={},this.params={}):(t.profile&&null==t.path&&(t.path="?"),this.profile=void 0!==t.profile?t.profile:e.profile,this.path=(e.path||"")+(t.path?"~"+t.path:""),t.forcePath&&(this.path=this.forcePath=t.forcePath),t.comp&&(this.path=t.comp+"~impl"),this.data=void 0!==t.data?t.data:e.data,this.vars=t.vars?Object.assign({},e.vars,t.vars):e.vars,this.params=t.params||e.params,this.componentContext=void 0!==t.componentContext?t.componentContext:e.componentContext,this.probe=e.probe)}run(t,a){return e(new y(this,{profile:t,comp:t.$,path:""}),a)}exp(e,t){return r(e,this,{as:t})}setVars(e){return new y(this,{vars:e})}setVar(e,t){return e?new y(this,{vars:{[e]:t}}):this}setData(e){return new y(this,{data:e})}runInner(t,a,n){return e(new y(this,{profile:t,path:n}),a)}bool(e){return this.run(e,{as:"boolean"})}ctx(e){return new y(this,e)}frame(){return frame}extendVars(e,t){return null==e&&null==t?this:new y(this,{vars:e?e.vars:null,data:null==t?e.data:t,forcePath:e&&e.forcePath?e.forcePath:null})}runItself(t,a){return e(this,t,a)}callStack(){const e=[];for(let t=this;t;t=t.componentContext)e.push(t);return e.map(e=>e.callerPath)}}const h=e=>e.reduce((e,t)=>e&&e[t],jb.comps)||{},g=(e,t,a)=>jb.spy&&jb.spy.log(e,t,{modifier:e=>{e[1]instanceof y&&e.splice(1,0,j(e[1].path)),e[0]instanceof y&&e.splice(0,0,j(e[0].path))},...a});function j(e){if(!e)return"";const t=e.split("~");for(;!jb.compName(h(t))&&t.length>0;)t.pop();return jb.compName(h(t))+": "+e}function x(){frame.console&&frame.console.log("%c Error: ","color: red",...arguments),g("error",[...arguments])}function v(e,t,a,...n){frame.console&&frame.console.log("%c Exception: ","color: red",...arguments),g("exception",[e.stack||"",a,t&&j(a&&a.path),e,...n])}function w(e){if(null==e||"object"!=typeof e)return e;const t=jb.refHandler(e);return t?t.val(e):e}function $(e){if(!e||"object"!=typeof e)return[];let t=[];for(let a in e)e.hasOwnProperty(a)&&0!=a.indexOf("$jb_")&&t.push([a,e[a]]);return t}return{run:e,jbCtx:y,expression:r,bool_expression:o,profileType:function(e){if(!e)return"";if("string"==typeof e)return"data";const t=b(e);return jb.comps[t]&&jb.comps[t].type||""},compName:b,pathSummary:j,logs:{},logError:x,log:g,logException:v,tojstype:l,jstypes:p,tostring:c,toarray:e=>l(e,"array"),toboolean:e=>l(e,"boolean"),tosingle:e=>l(e,"single"),tonumber:d,types:{},ui:{},rx:{},ctxDictionary:{},testers:{},compParams:t,singleInType:u,val:w,entries:$,objFromEntries:function(e){const t={};return e.forEach(e=>t[e[0]]=e[1]),t},frame:frame,fixByValue:a,ctxCounter:e=>f,simpleValueByRefHandler:{val:e=>e&&e.$jb_val?e.$jb_val():e&&e.$jb_parent?e.$jb_parent[e.$jb_property]:e,writeValue(e,t,a){if(jb.log("writeValue",["valueByRefWithjbParent",t,e,a]),e)return e.$jb_val?e.$jb_val(this.val(t)):e.$jb_parent&&(e.$jb_parent[e.$jb_property]=this.val(t)),e},push(e,t){const a=jb.asArray(jb.val(e));jb.toarray(t).forEach(e=>a.push(e))},asRef:e=>e,isRef:e=>e&&(e.$jb_parent||e.$jb_val||e.$jb_obj),objectProperty(e,t){return this.isRef(e[t])?e[t]:{$jb_parent:e,$jb_property:t}}}}}();Object.assign(jb,{comps:{},resources:{},consts:{},location:Symbol.for("location"),studio:{previewjb:jb},removeDataResourcePrefix:e=>0==e.indexOf("data-resource.")?e.slice("data-resource.".length):e,addDataResourcePrefix:e=>0==e.indexOf("data-resource.")?e:"data-resource."+e,component:(e,t)=>{try{const a=(new Error).stack.split(/\r|\n/).filter(e=>e&&!e.match(/\)<anonymous>|about:blank|tgp-pretty.js|internal\/modules\/cjs/)).pop();if(t[jb.location]=(a.match(/\\?([^:]+):([^:]+):[^:]+$/)||["","","",""]).slice(1,3),void 0!==t.watchableData)return jb.comps[jb.addDataResourcePrefix(e)]=t,jb.resource(jb.removeDataResourcePrefix(e),t.watchableData);if(void 0!==t.passiveData)return jb.comps[jb.addDataResourcePrefix(e)]=t,jb.const(jb.removeDataResourcePrefix(e),t.passiveData)}catch(e){console.log(e)}jb.comps[e]=t,(t.params||[]).forEach(e=>{"boolean"==e.as&&-1==["boolean","ref"].indexOf(e.type)&&(e.type="boolean")}),jb.registerMacro&&jb.registerMacro(e,t)},type:(e,t)=>jb.types[e]=t||{},resource:(e,t)=>(void 0!==t&&(jb.resources[e]=t),jb.mainWatchableHandler&&jb.mainWatchableHandler.resourceReferred(e),jb.resources[e]),const:(e,t)=>void 0===t?jb.consts[e]:jb.consts[e]=t||{},functionDef:(e,t)=>jb.functions[e]=t,path:(e,t,a)=>{let n=e;if("string"==typeof t&&(t=t.split(".")),t=jb.asArray(t),void 0===a)return t.reduce((e,t)=>e&&e[t],e);for(let e=0;e<t.length;e++)e==t.length-1?n[t[e]]=a:n=n[t[e]]=n[t[e]]||{};return a},compareArrays:(e,t)=>{if(e===t)return!0;if(!Array.isArray(e)&&!Array.isArray(t))return e===t;if(!e||!t||e.length!=t.length)return!1;for(let a=0;a<e.length;a++){const n=(e[a]||{}).key,i=(t[a]||{}).key;if((!n||!i||n!==i||e[a].val!==t[a].val)&&e[a]!==t[a])return!1}return!0},range:(e,t)=>Array.apply(0,Array(t)).map((t,a)=>a+e),flattenArray:e=>{let t=[];return e.filter(e=>e).forEach((function(e){Array.isArray(e)?t=t.concat(e):t.push(e)})),t},isDelayed:e=>e&&("[object Promise]"===Object.prototype.toString.call(e)||jb.callbag.isCallbag(e)),toSynchArray:e=>{const t=jb.asArray(e);if(0==t.filter(e=>jb.isDelayed(e)).length)return t;const{pipe:a,fromIter:n,toPromiseArray:i,concatMap:r,flatMap:o}=jb.callbag;return a(n(t),r(e=>e),o(e=>Array.isArray(e)?e:[e]),i)},subscribe:(e,t)=>jb.callbag.subscribe(t)(e),unique:(e,t)=>{t=t||(e=>e);let a={},n=[];return e.forEach(e=>{a[t(e)]||(a[t(e)]=!0,n.push(e))}),n},isEmpty:e=>0===Object.keys(e).length,isObject:e=>null!=e&&"object"==typeof e,asArray:e=>null==e?[]:Array.isArray(e)?e:[e],filterEmpty:e=>Object.entries(e).reduce((e,[t,a])=>null==a?e:{...e,[t]:a},{}),equals:(e,t)=>e==t||jb.val(e)==jb.val(t),delay:e=>new Promise(t=>{setTimeout(t,e)}),extraWatchableHandlers:[],extraWatchableHandler:(e,t)=>{jb.extraWatchableHandlers.push(e);const a=jb.extraWatchableHandlers.indexOf(t);return-1!=a&&jb.extraWatchableHandlers.splice(a,1),jb.watchableHandlers=[jb.mainWatchableHandler,...jb.extraWatchableHandlers].map(e=>e),e},setMainWatchableHandler:e=>{jb.mainWatchableHandler=e,jb.watchableHandlers=[jb.mainWatchableHandler,...jb.extraWatchableHandlers].map(e=>e)},watchableHandlers:[],safeRefCall:(e,t)=>{const a=jb.refHandler(e);return a&&a.isRef(e)?t(a):jb.logError("invalid ref",e)},refHandler:e=>e&&e.handler?e.handler:jb.simpleValueByRefHandler.isRef(e)?jb.simpleValueByRefHandler:jb.watchableHandlers.find(t=>t.isRef(e)),objHandler:e=>e&&jb.refHandler(e)||jb.watchableHandlers.find(t=>t.watchable(e))||jb.simpleValueByRefHandler,asRef:e=>{const t=jb.watchableHandlers.find(t=>t.watchable(e)||t.isRef(e));return t?t.asRef(e):jb.simpleValueByRefHandler.asRef(e)},writeValue:(e,t,a)=>!a.probe&&jb.safeRefCall(e,n=>n.writeValue(e,t,a)),objectProperty:(e,t,a)=>jb.objHandler(e).objectProperty(e,t,a),splice:(e,t,a)=>!a.probe&&jb.safeRefCall(e,n=>n.splice(e,t,a)),move:(e,t,a)=>!a.probe&&jb.safeRefCall(e,n=>n.move(e,t,a)),push:(e,t,a)=>!a.probe&&jb.safeRefCall(e,n=>n.push(e,t,a)),isRef:e=>jb.refHandler(e),isWatchable:e=>!1,isValid:e=>jb.safeRefCall(e,t=>t.isValid(e)),refreshRef:e=>jb.safeRefCall(e,t=>t.refresh(e))}),"undefined"!=typeof self&&(self.jb=jb),module.exports=jb,Object.assign(jb,{macroDef:Symbol("macroDef"),macroNs:{},macroName:e=>e.replace(/[_-]([a-zA-Z])/g,(e,t)=>t.toUpperCase()),ns:e=>e.split(",").forEach(e=>jb.registerMacro(e+".$dummyComp",{})),registerMacro:(e,t)=>{const a=jb.macroName(e).replace(/\./g,"_"),n=-1!=e.indexOf(".")&&jb.macroName(e.split(".")[0]);function i(a){jb.frame[a]=new Proxy(()=>0,{get:(e,t)=>"symbol"==typeof t||(jb.frame[a+"_"+t]||function(e,t){return(...a)=>{const{args:n,system:i}=r(a),o={$:s(e)+"."+s(t)};return 1!=n.length||"object"!=typeof n[0]||jb.compName(n[0])?Object.assign(o,{$byValue:n}):Object.assign(o,n[0]),Object.assign(o,i)}}(a,t)),apply:function(a,n,i){const{args:o,system:s}=r(i);return Object.assign(function(a){if(0==a.length)return{$:e};const n=t.params||[],i=-1!=(n[0]&&n[0].type||"").indexOf("[]");if(1==n.length&&i)return{$:e,[n[0].id]:a};const r=1==a.length&&"object"==typeof a[0]&&(n[0]&&a[0][n[0].id]||n[1]&&a[0][n[1].id]);if((t.macroByValue||n.length<3)&&!1!==t.macroByValue&&!r)return{$:e,...jb.objFromEntries(a.filter((e,t)=>n[t]).map((e,t)=>[n[t].id,e]))};if(1==a.length&&!Array.isArray(a[0])&&"object"==typeof a[0]&&!a[0].$)return{$:e,...a[0]};if(1==a.length&&n.length)return{$:e,[n[0].id]:a[0]};if(2==a.length&&n.length>1)return{$:e,[n[0].id]:a[0],[n[1].id]:a[1]}}(o),s)}})}function r(e){const t=[],a={};return e.forEach(e=>{e&&"object"==typeof e&&(jb.comps[e.$]||{}).isSystem?jb.comps[e.$].macro(a,e):t.push(e)}),1==t.length&&"object"==typeof t[0]&&(jb.asArray(t[0].vars).forEach(e=>jb.comps[e.$].macro(a,e)),t[0].remark&&jb.comps.remark.macro(a,t[0])),{args:t,system:a}}function o(t,a){return jb.frame[t]&&!jb.frame[t][jb.macroDef]?(jb.logError(t+" is reserved by system or libs. please use a different name"),!1):(void 0===jb.frame[t]||a||jb.macroNs[t]||t.match(/_\$dummyComp$/)||jb.logError(t+" is defined more than once, using last definition "+e),!0)}o(a)&&i(a),n&&o(n,!0)&&!jb.frame[n]&&(i(n),jb.macroNs[n]=!0);const s=e=>e.replace(/([A-Z])/g,(e,t)=>"-"+t.toLowerCase())}}),jb.component("call",{type:"any",params:[{id:"param",as:"string"}],impl:function(e,t){const a=e.componentContext&&e.componentContext.params[t];return"function"==typeof a?a(new jb.jbCtx(e,{data:e.data,vars:e.vars,componentContext:e.componentContext.componentContext,forcePath:a.srcPath})):a}}),jb.pipe=function(e,t){const a=[jb.toarray(e.data)[0]];if("string"==typeof e.profile.items)return e.runInner(e.profile.items,null,"items");const n=jb.asArray(e.profile.items||e.profile[t]),i=e.profile.items&&e.profile.items.sugar?"":e.profile[t]?t+"~":"items~";return"$pipe"==t?n.reduce((e,t,a)=>e.then(e=>jb.toSynchArray(e)).then(e=>r(t,a,e)),Promise.resolve(a)).then(e=>jb.toSynchArray(e)):n.reduce((e,t,a)=>r(t,a,e),a);function r(t,a,r){if(!t||t.$disabled)return r;const o=a<n.length-1?{as:"array"}:e.parentParam||{};return"aggregator"==jb.profileType(t)?jb.run(new jb.jbCtx(e,{data:r,profile:t,path:i+a}),o):[].concat.apply([],r.map(n=>jb.run(new jb.jbCtx(e,{data:n,profile:t,path:i+a}),o)).filter(e=>null!=e).map(e=>Array.isArray(jb.val(e))?jb.val(e):e))}},jb.component("pipeline",{type:"data",description:"map data arrays one after the other",params:[{id:"items",type:"data,aggregator[]",ignore:!0,mandatory:!0,composite:!0}],impl:e=>jb.pipe(e,"$pipeline")}),jb.component("pipe",{type:"data",description:"map asynch data arrays",params:[{id:"items",type:"data,aggregator[]",ignore:!0,mandatory:!0,composite:!0}],impl:e=>jb.pipe(e,"$pipe")}),jb.component("data.if",{type:"data",macroByValue:!0,params:[{id:"condition",as:"boolean",mandatory:!0,dynamic:!0},{id:"then",mandatory:!0,dynamic:!0},{id:"else",dynamic:!0,defaultValue:"%%"}],impl:(e,t,a,n)=>t()?a():n()}),jb.component("action.if",{type:"action",description:"if then else",macroByValue:!0,params:[{id:"condition",type:"boolean",as:"boolean",mandatory:!0},{id:"then",type:"action",mandatory:!0,dynamic:!0},{id:"else",type:"action",dynamic:!0}],impl:(e,t,a,n)=>t?a():n()}),jb.component("jb-run",{type:"action",params:[{id:"profile",as:"string",mandatory:!0,description:"profile name"},{id:"params",as:"single"}],impl:(e,t,a)=>e.run(Object.assign({$:t},a||{}))}),jb.component("list",{type:"data",description:"also flatten arrays",params:[{id:"items",type:"data[]",as:"array",composite:!0}],impl:function(e,t){let a=[];return t.forEach(e=>{Array.isArray(e)?a=a.concat(e):a.push(e)}),a}}),jb.component("first-succeeding",{type:"data",params:[{id:"items",type:"data[]",as:"array",composite:!0}],impl:function(e,t,a){for(let e=0;e<t.length;e++){const n=jb.val(t[e]),i="number"==typeof n;if((a||""!==n)&&null!=n&&(!i||!isNaN(n)&&n!==1/0&&n!==-1/0))return t[e]}const n=t.slice(-1)[0];return null!=n&&jb.val(n)}}),jb.component("keys",{type:"data",description:"Object.keys",params:[{id:"obj",defaultValue:"%%",as:"single"}],impl:(e,t)=>Object.keys(t&&"object"==typeof t?t:{})}),jb.component("properties",{description:"object entries as id,val",type:"data",params:[{id:"obj",defaultValue:"%%",as:"single"}],impl:(e,t)=>Object.keys(t).filter(e=>0!=e.indexOf("$jb_")).map((e,a)=>({id:e,val:t[e],index:a}))}),jb.component("entries",{description:"object entries as array 0/1",type:"data",params:[{id:"obj",defaultValue:"%%",as:"single"}],impl:(e,t)=>jb.entries(t)}),jb.component("aggregate",{type:"aggregator",description:"calc function on all items, rather then one by one",params:[{id:"aggregator",type:"aggregator",mandatory:!0,dynamic:!0}],impl:(e,t)=>t()}),jb.ns("math"),jb.component("math.max",{type:"aggregator",impl:e=>Math.max.apply(0,e.data)}),jb.component("math.min",{type:"aggregator",impl:e=>Math.max.apply(0,e.data)}),jb.component("math.sum",{type:"aggregator",impl:e=>e.data.reduce((e,t)=>+t+e,0)}),"abs,acos,acosh,asin,asinh,atan,atan2,atanh,cbrt,ceil,clz32,cos,cosh,exp,expm1,floor,fround,hypot,log2,random,round,sign,sin,sinh,sqrt,tan,tanh,trunc".split(",").forEach(e=>jb.component(`math.${e}`,{impl:t=>Math[e](t.data)})),jb.component("obj-from-entries",{description:"object from entries",type:"aggregator",params:[{id:"entries",defaultValue:"%%",as:"array"}],impl:(e,t)=>jb.objFromEntries(t)}),jb.component("eval-expression",{description:"evaluate javascript expression",type:"data",params:[{id:"expression",as:"string",defaultValue:"%%",expression:"e.g. 1+2"}],impl:(ctx,expression)=>{try{return eval("("+expression+")")}catch(e){}}}),jb.component("prefix",{type:"data",params:[{id:"separator",as:"string",mandatory:!0},{id:"text",as:"string",defaultValue:"%%"}],impl:(e,t,a)=>(a||"").substring(0,a.indexOf(t))}),jb.component("suffix",{type:"data",params:[{id:"separator",as:"string",mandatory:!0},{id:"text",as:"string",defaultValue:"%%"}],impl:(e,t,a)=>(a||"").substring(a.lastIndexOf(t)+t.length)}),jb.component("remove-prefix",{type:"data",params:[{id:"separator",as:"string",mandatory:!0},{id:"text",as:"string",defaultValue:"%%"}],impl:(e,t,a)=>-1==a.indexOf(t)?a:a.substring(a.indexOf(t)+t.length)}),jb.component("remove-suffix",{type:"data",params:[{id:"separator",as:"string",mandatory:!0},{id:"text",as:"string",defaultValue:"%%"}],impl:(e,t,a)=>-1==a.lastIndexOf(t)?a:a.substring(0,a.lastIndexOf(t))}),jb.component("remove-suffix-regex",{type:"data",params:[{id:"suffix",as:"string",mandatory:!0,description:"regular expression. e.g [0-9]*"},{id:"text",as:"string",defaultValue:"%%"}],impl:function(e,t,a){e.profile.prefixRegexp=e.profile.prefixRegexp||new RegExp(t+"$");const n=(a||"").match(e.profile.prefixRegexp);return n&&(a||"").substring(n.index+1)||a}}),jb.component("write-value",{type:"action",params:[{id:"to",as:"ref",mandatory:!0},{id:"value",mandatory:!0}],impl:(e,t,a)=>{const n=jb.val(a);if(jb.isDelayed(n))return Promise.resolve().then(a=>jb.writeValue(t,a,e));jb.writeValue(t,n,e)}}),jb.component("property",{description:"navigate/select/path property of object",params:[{id:"prop",as:"string",mandatory:!0},{id:"obj",defaultValue:"%%"}],impl:(e,t,a)=>jb.objectProperty(a,t,e)}),jb.component("index-of",{params:[{id:"array",as:"array",mandatory:!0},{id:"item",as:"single",mandatory:!0}],impl:(e,t,a)=>t.indexOf(a)}),jb.component("add-to-array",{type:"action",params:[{id:"array",as:"ref",mandatory:!0},{id:"toAdd",as:"array",mandatory:!0}],impl:(e,t,a)=>jb.push(t,JSON.parse(JSON.stringify(a)),e)}),jb.component("splice",{type:"action",params:[{id:"array",as:"ref",mandatory:!0},{id:"fromIndex",as:"number",mandatory:!0},{id:"noOfItemsToRemove",as:"number",defaultValue:0},{id:"itemsToAdd",as:"array",defaultValue:[]}],impl:(e,t,a,n,i)=>jb.splice(t,[[a,n,...i]],e)}),jb.component("remove-from-array",{type:"action",params:[{id:"array",as:"ref",mandatory:!0},{id:"itemToRemove",as:"single",description:"choose item or index"},{id:"index",as:"number",description:"choose item or index"}],impl:(e,t,a,n)=>{const i=a?jb.toarray(t).indexOf(a):n;-1!=i&&jb.splice(t,[[i,1]],e)}}),jb.component("toggle-boolean-value",{type:"action",params:[{id:"of",as:"ref"}],impl:(e,t)=>jb.writeValue(t,!jb.val(t),e)}),jb.component("slice",{type:"aggregator",params:[{id:"start",as:"number",defaultValue:0,description:"0-based index",mandatory:!0},{id:"end",as:"number",mandatory:!0,description:"0-based index of where to end the selection (not including itself)"}],impl:function({data:e},t,a){return e&&e.slice?a?e.slice(t,a):e.slice(t):null}}),jb.component("sort",{type:"aggregator",params:[{id:"propertyName",as:"string",description:"sort by property inside object"},{id:"lexical",as:"boolean",type:"boolean"},{id:"ascending",as:"boolean",type:"boolean"}],impl:({data:e},t,a,n)=>{if(!e||!Array.isArray(e))return null;let i;const r=jb.entries(e[0]||{})[0][1];return i=a||isNaN(r)?t?(e,a)=>e[t]==a[t]?0:e[t]<a[t]?-1:1:(e,t)=>e==t?0:e<t?-1:1:t?(e,a)=>e[t]-a[t]:(e,t)=>e-t,n?e.slice(0).sort((e,t)=>i(e,t)):e.slice(0).sort((e,t)=>i(t,e))}}),jb.component("first",{type:"aggregator",impl:({data:e})=>e[0]}),jb.component("last",{type:"aggregator",impl:({data:e})=>e.slice(-1)[0]}),jb.component("count",{type:"aggregator",description:"length, size of array",params:[{id:"items",as:"array",defaultValue:"%%"}],impl:(e,t)=>t.length}),jb.component("reverse",{type:"aggregator",params:[{id:"items",as:"array",defaultValue:"%%"}],impl:(e,t)=>t.reverse()}),jb.component("sample",{type:"aggregator",params:[{id:"size",as:"number",defaultValue:300},{id:"items",as:"array",defaultValue:"%%"}],impl:(e,t,a)=>a.filter((e,n)=>n%(Math.floor(a.length/t)||1)==0)}),jb.component("obj",{description:"build object (dictionary) from props",params:[{id:"props",type:"prop[]",mandatory:!0,sugar:!0}],impl:(e,t)=>jb.objFromEntries(t.map(t=>[t.title,jb.tojstype(t.val(e),t.type)]))}),jb.component("extend",{description:"assign and extend with calculated properties",params:[{id:"props",type:"prop[]",mandatory:!0,defaultValue:[]}],impl:(e,t)=>Object.assign({},e.data,jb.objFromEntries(t.map(t=>[t.title,jb.tojstype(t.val(e),t.type)])))}),jb.component("assign",jb.comps.extend),jb.component("extend-with-index",{type:"aggregator",description:"extend with calculated properties. %$index% is available ",params:[{id:"props",type:"prop[]",mandatory:!0,defaultValue:[]}],impl:(e,t)=>jb.toarray(e.data).map((a,n)=>Object.assign({},a,jb.objFromEntries(t.map(t=>[t.title,jb.tojstype(t.val(e.setData(a).setVars({index:n})),t.type)]))))}),jb.component("prop",{type:"prop",macroByValue:!0,params:[{id:"title",as:"string",mandatory:!0},{id:"val",dynamic:!0,type:"data",mandatory:!0,defaultValue:""},{id:"type",as:"string",options:"string,number,boolean,object,array",defaultValue:"string"}],impl:e=>e.params}),jb.component("ref-prop",{type:"prop",description:"value by reference allows to change or watch the value",params:[{id:"title",as:"string",mandatory:!0},{id:"val",dynamic:!0,as:"ref",mandatory:!0}],impl:e=>({...e.params,type:"ref"})}),jb.component("pipeline.var",{type:"aggregator",params:[{id:"name",as:"string",mandatory:!0},{id:"val",mandatory:!0,dynamic:!0,defaultValue:"%%"}],impl:e=>({[Symbol.for("Var")]:!0,...e.params})}),jb.component("Var",{type:"var,system",isSystem:!0,params:[{id:"name",as:"string",mandatory:!0},{id:"val",dynamic:!0,type:"data",mandatory:!0,defaultValue:"%%"}],macro:(e,t)=>Object.assign(e,{$vars:Object.assign(e.$vars||{},{[t.name]:t.val})})}),jb.component("remark",{type:"system",isSystem:!0,params:[{id:"remark",as:"string",mandatory:!0}],macro:(e,t)=>Object.assign(e,{remark:t.remark})}),jb.component("If",{macroByValue:!0,params:[{id:"condition",as:"boolean",mandatory:!0,dynamic:!0},{id:"then",dynamic:!0},{id:"Else",dynamic:!0}],impl:(e,t,a,n)=>t()?a():n()}),jb.component("not",{type:"boolean",params:[{id:"of",type:"boolean",as:"boolean",mandatory:!0,composite:!0}],impl:(e,t)=>!t}),jb.component("and",{description:"logical and",type:"boolean",params:[{id:"items",type:"boolean[]",ignore:!0,mandatory:!0,composite:!0}],impl:function(e){const t=e.profile.$and||e.profile.items||[],a=e.profile.$and?"$and~":"items~";for(let n=0;n<t.length;n++)if(!e.runInner(t[n],{type:"boolean"},a+n))return!1;return!0}}),jb.component("or",{description:"logical or",type:"boolean",params:[{id:"items",type:"boolean[]",ignore:!0,mandatory:!0,composite:!0}],impl:function(e){const t=e.profile.$or||e.profile.items||[],a=e.profile.$or?"$or~":"items~";for(let n=0;n<t.length;n++)if(e.runInner(t[n],{type:"boolean"},a+n))return!0;return!1}}),jb.component("between",{description:"checks if number is in range",type:"boolean",params:[{id:"from",as:"number",mandatory:!0},{id:"to",as:"number",mandatory:!0},{id:"val",as:"number",defaultValue:"%%"}],impl:(e,t,a,n)=>n>=t&&n<=a}),jb.component("contains",{type:"boolean",params:[{id:"text",type:"data[]",as:"array",mandatory:!0},{id:"allText",defaultValue:"%%",as:"string"},{id:"inOrder",defaultValue:!0,as:"boolean",type:"boolean"}],impl:function(e,t,a,n){let i=-1;for(let e=0;e<t.length;e++){const r=a.indexOf(jb.tostring(t[e]),i+1);if(-1==r)return!1;i=n?r:-1}return!0}}),jb.component("not-contains",{type:"boolean",params:[{id:"text",type:"data[]",as:"array",mandatory:!0},{id:"allText",defaultValue:"%%",as:"array"}],impl:not(contains({text:"%$text%",allText:"%$allText%"}))}),jb.component("starts-with",{description:"begins with, includes, contains",type:"boolean",params:[{id:"startsWith",as:"string",mandatory:!0},{id:"text",defaultValue:"%%",as:"string"}],impl:(e,t,a)=>0==a.indexOf(t)}),jb.component("ends-with",{description:"includes, contains",type:"boolean",params:[{id:"endsWith",as:"string",mandatory:!0},{id:"text",defaultValue:"%%",as:"string"}],impl:(e,t,a)=>-1!==a.indexOf(t,a.length-t.length)}),jb.component("filter",{type:"aggregator",params:[{id:"filter",type:"boolean",as:"boolean",dynamic:!0,mandatory:!0}],impl:(e,t)=>jb.toarray(e.data).filter(a=>t(e,a))}),jb.component("match-regex",{description:"validation with regular expression",type:"boolean",params:[{id:"regex",as:"string",mandatory:!0,description:"e.g: [a-zA-Z]*"},{id:"text",as:"string",defaultValue:"%%"}],impl:(e,t,a)=>a.match(new RegExp(t))}),jb.component("to-uppercase",{params:[{id:"text",as:"string",defaultValue:"%%"}],impl:(e,t)=>t.toUpperCase()}),jb.component("to-lowercase",{params:[{id:"text",as:"string",defaultValue:"%%"}],impl:(e,t)=>t.toLowerCase()}),jb.component("capitalize",{params:[{id:"text",as:"string",defaultValue:"%%"}],impl:(e,t)=>t.charAt(0).toUpperCase()+t.slice(1)}),jb.component("join",{params:[{id:"separator",as:"string",defaultValue:",",mandatory:!0},{id:"prefix",as:"string"},{id:"suffix",as:"string"},{id:"items",as:"array",defaultValue:"%%"},{id:"itemName",as:"string",defaultValue:"item"},{id:"itemText",as:"string",dynamic:!0,defaultValue:"%%"}],type:"aggregator",impl:function(e,t,a,n,i,r,o){const s=e.profile.itemText?t=>o(r?new jb.jbCtx(e,{data:t,vars:{[r]:t}}):e.setData(t)):e=>jb.tostring(e);return a+i.map(s).join(t)+n}}),jb.component("unique",{params:[{id:"id",as:"string",dynamic:!0,defaultValue:"%%"},{id:"items",as:"array",defaultValue:"%%"}],type:"aggregator",impl:(e,t,a)=>{const n="%%"==t.profile?e=>e:a=>t(e.setData(a));return jb.unique(a,n)}}),jb.component("log",{params:[{id:"obj",as:"single",defaultValue:"%%"}],impl:function(e,t){let a=t;return"undefined"!=typeof GLOBAL&&"object"==typeof t&&(a=JSON.stringify(t,null," ")),"undefined"!=typeof window?(window.parent||window).console.log(a):console.log(a),a}}),jb.component("asIs",{params:[{id:"$asIs",ignore:!0}],impl:e=>context.profile.$asIs}),jb.component("object",{impl:function(e){let t={};const a=e.profile.$object||e.profile;if(Array.isArray(a))return a;for(let n in a)"$"==n&&"object"==a[n]||null==a[n]||(t[n]=e.runInner(a[n],null,n));return t}}),jb.component("json.stringify",{params:[{id:"value",defaultValue:"%%"},{id:"space",as:"string",description:"use space or tab to make pretty output"}],impl:(e,t,a)=>JSON.stringify(jb.val(t),null,a)}),jb.component("json.parse",{params:[{id:"text",as:"string"}],impl:(e,t)=>{try{return JSON.parse(t)}catch(t){jb.logException(t,"json parse",e)}}}),jb.component("split",{description:"breaks string using separator",type:"data",params:[{id:"separator",as:"string",defaultValue:",",description:'E.g., "," or "<a>"'},{id:"text",as:"string",defaultValue:"%%"},{id:"part",options:",first,second,last,but first,but last"}],impl:function(e,t,a,n){const i=a.split(t.replace(/\\r\\n/g,"\n").replace(/\\n/g,"\n"));switch(n){case"first":return i[0];case"second":return i[1];case"last":return i.pop();case"but first":return i.slice(1);case"but last":return i.slice(0,-1);default:return i}}}),jb.component("replace",{type:"data",params:[{id:"find",as:"string",mandatory:!0},{id:"replace",as:"string",mandatory:!0},{id:"text",as:"string",defaultValue:"%%"},{id:"useRegex",type:"boolean",as:"boolean",defaultValue:!0},{id:"regexFlags",as:"string",defaultValue:"g",description:"g,i,m"}],impl:function(e,t,a,n,i,r){return i?n.replace(new RegExp(t,r),a):n.replace(t,a)}}),jb.component("touch",{description:"change the value of a watchable variable to acticate its watchers",type:"action",params:[{id:"data",as:"ref"}],impl:function(e,t){const a=Number(jb.val(t));jb.writeValue(t,a?a+1:1,ctx)}}),jb.component("isNull",{description:"is null or undefined",type:"boolean",params:[{id:"obj",defaultValue:"%%"}],impl:(e,t)=>null==jb.val(t)}),jb.component("isEmpty",{type:"boolean",params:[{id:"item",as:"single",defaultValue:"%%"}],impl:(e,t)=>!t||Array.isArray(t)&&0==t.length}),jb.component("notEmpty",{type:"boolean",params:[{id:"item",as:"single",defaultValue:"%%"}],impl:(e,t)=>t&&!(Array.isArray(t)&&0==t.length)}),jb.component("equals",{type:"boolean",params:[{id:"item1",as:"single",mandatory:!0},{id:"item2",defaultValue:"%%",as:"single"}],impl:(e,t,a)=>t==a}),jb.component("not-equals",{type:"boolean",params:[{id:"item1",as:"single",mandatory:!0},{id:"item2",defaultValue:"%%",as:"single"}],impl:(e,t,a)=>t!=a}),jb.component("runActions",{type:"action",params:[{id:"actions",type:"action[]",ignore:!0,composite:!0,mandatory:!0}],impl:e=>{e.profile;const t=jb.asArray(e.profile.actions||e.profile.$runActions).filter(e=>e),a=e.profile.actions&&e.profile.actions.sugar?"":e.profile.$runActions?"$runActions~":"items~";return t.reduce((t,n,i)=>t.then(t=>e.runInner(n,{as:"single"},a+i)),Promise.resolve())}}),jb.component("run-action-on-items",{type:"action",macroByValue:!0,params:[{id:"items",as:"ref[]",mandatory:!0},{id:"action",type:"action",dynamic:!0,mandatory:!0},{id:"notifications",as:"string",options:"wait for all actions,no notifications",description:"notification for watch-ref, defualt behavior is after each action"}],impl:(e,t,a,n)=>(n&&jb.mainWatchableHandler&&jb.mainWatchableHandler.startTransaction(),jb.val(t).reduce((t,n)=>t.then(t=>a(e.setData(n))),Promise.resolve()).catch(t=>jb.logException(t,e)).then(()=>n&&jb.mainWatchableHandler&&jb.mainWatchableHandler.endTransaction("no notifications"===n)))}),jb.component("delay",{type:"action,data",params:[{id:"mSec",as:"number",defaultValue:1}],impl:(e,t)=>jb.delay(t).then(()=>e.data)}),jb.component("on-next-timer",{description:"run action after delay",type:"action",params:[{id:"action",type:"action",dynamic:!0,mandatory:!0},{id:"delay",type:"number",defaultValue:1}],impl:(e,t,a)=>jb.delay(a,e).then(()=>t())}),jb.component("extract-prefix",{type:"data",params:[{id:"separator",as:"string",description:"/w- alphnumberic, /s- whitespace, ^- beginline, $-endline"},{id:"text",as:"string",defaultValue:"%%"},{id:"regex",type:"boolean",as:"boolean",description:"separator is regex"},{id:"keepSeparator",type:"boolean",as:"boolean"}],impl:function(e,t,a,n,i){if(!n)return a.substring(0,a.indexOf(t))+(i?t:"");{const e=a.match(t);if(e)return a.substring(0,e.index)+(i?e[0]:"")}}}),jb.component("extract-suffix",{type:"data",params:[{id:"separator",as:"string",description:"/w- alphnumberic, /s- whitespace, ^- beginline, $-endline"},{id:"text",as:"string",defaultValue:"%%"},{id:"regex",type:"boolean",as:"boolean",description:"separator is regex"},{id:"keepSeparator",type:"boolean",as:"boolean"}],impl:function(e,t,a,n,i){if(!n)return a.substring(a.lastIndexOf(t)+(i?0:t.length));{const e=a.match(t+"(?![\\s\\S]*"+t+")");if(e)return a.substring(e.index+(i?0:e[0].length))}}}),jb.component("range",{description:"returns a range of number, generator, numerator, numbers, index",type:"data",params:[{id:"from",as:"number",defaultValue:1},{id:"to",as:"number",defaultValue:10}],impl:(e,t,a)=>Array.from(Array(a-t+1).keys()).map(e=>e+t)}),jb.component("type-of",{type:"data",params:[{id:"obj",defaultValue:"%%"}],impl:(e,t)=>{const a=jb.val(t);return Array.isArray(a)?"array":typeof a}}),jb.component("class-name",{type:"data",params:[{id:"obj",defaultValue:"%%"}],impl:(e,t)=>{const a=jb.val(t);return a&&a.constructor&&a.constructor.name}}),jb.component("is-of-type",{type:"boolean",params:[{id:"type",as:"string",mandatory:!0,description:"e.g., string,boolean,array"},{id:"obj",defaultValue:"%%"}],impl:(e,t,a)=>{const n=jb.val(a),i=Array.isArray(n)?"array":typeof n;return-1!=t.split(",").indexOf(i)}}),jb.component("in-group",{type:"boolean",params:[{id:"group",as:"array",mandatory:!0},{id:"item",as:"single",defaultValue:"%%"}],impl:(e,t,a)=>-1!=t.indexOf(a)}),jb.urlProxy=("undefined"!=typeof window&&location.href.match(/^[^:]*/)[0]||"http")+"://jbartdb.appspot.com/jbart_db.js?op=proxy&url=",jb.cacheKiller=0,jb.component("http.get",{type:"data,action",description:"fetch data from external url",params:[{id:"url",as:"string"},{id:"json",as:"boolean",description:"convert result to json",type:"boolean"},{id:"useProxy",as:"string",options:",localhost-server,cloud"}],impl:(e,t,a,n)=>{if(e.probe)return jb.http_get_cache[r];const i=a||r.match(/json$/);let r=t;return"localhost-server"==n?r=`//localhost:8082/?op=fetch&req={url:"${r}"}&cacheKiller=${jb.cacheKiller++}`:"cloud"==n&&(r=`//jbart5-server.appspot.com/?op=fetch&req={url:"${r}"}&cacheKiller=${jb.cacheKiller++}`),fetch(r,{mode:"cors"}).then(e=>i?e.json():e.text()).then(e=>jb.http_get_cache?jb.http_get_cache[r]=e:e).catch(t=>jb.logException(t,"http.get",e)||[])}}),jb.component("http.fetch",{type:"data,action",description:"fetch, get or post data from external url",params:[{id:"url",as:"string",mandatory:!0},{id:"method",as:"string",options:"GET,POST",defaultValue:"GET"},{id:"headers",as:"single",templateValue:obj(prop("Content-Type","application/json; charset=UTF-8"))},{id:"body",as:"single"},{id:"json",as:"boolean",description:"convert result to json",type:"boolean"},{id:"useProxy",as:"string",options:",localhost-server,cloud,cloud-test-local"}],impl:(e,t,a,n,i,r,o)=>{const s={url:t,method:a,headers:n||{},mode:"cors",body:"string"==typeof i||null==i?i:JSON.stringify(i)},l=encodeURIComponent(JSON.stringify(s));return e.probe?jb.http_get_cache[l]:("localhost-server"==o?s.url=`//localhost:8082/?op=fetch&req=${l}&cacheKiller=${jb.cacheKiller++}`:"cloud"==o?s.url=`//jbart5-server.appspot.com/fetch?req=${l}&cacheKiller=${jb.cacheKiller++}`:"cloud-test-local"==o&&(s.url=`http://localhost:8080/fetch?req=${l}&cacheKiller=${jb.cacheKiller++}`),fetch(s.url,o?{mode:"cors"}:s).then(e=>r?e.json():e.text()).then(e=>jb.http_get_cache?jb.http_get_cache[l]=e:e).catch(t=>jb.logException(t,"http.fetch",e)||[]))}}),jb.component("isRef",{params:[{id:"obj",mandatory:!0}],impl:(e,t)=>jb.isRef(t)}),jb.component("asRef",{params:[{id:"obj",mandatory:!0}],impl:(e,t)=>jb.asRef(t)}),jb.component("data.switch",{macroByValue:!1,params:[{id:"cases",type:"data.switch-case[]",as:"array",mandatory:!0,defaultValue:[]},{id:"default",dynamic:!0}],impl:(e,t,a)=>{for(let a=0;a<t.length;a++)if(t[a].condition(e))return t[a].value(e);return a(e)}}),jb.component("data.case",{type:"data.switch-case",singleInType:!0,params:[{id:"condition",type:"boolean",mandatory:!0,dynamic:!0},{id:"value",mandatory:!0,dynamic:!0}],impl:e=>e.params}),jb.component("action.switch",{type:"action",params:[{id:"cases",type:"action.switch-case[]",as:"array",mandatory:!0,defaultValue:[]},{id:"defaultAction",type:"action",dynamic:!0}],impl:(e,t,a)=>{for(let a=0;a<t.length;a++)if(t[a].condition(e))return t[a].action(e);return a(e)}}),jb.component("action.switch-case",{type:"action.switch-case",singleInType:!0,params:[{id:"condition",type:"boolean",as:"boolean",mandatory:!0,dynamic:!0},{id:"action",type:"action",mandatory:!0,dynamic:!0}],impl:e=>e.params}),jb.component("format-date",{description:"using toLocaleDateString",params:[{id:"date",defaultValue:"%%",description:"Date value"},{id:"dateStyle",as:"string",options:"full,long,medium,short"},{id:"timeStyle",as:"string",options:"full,long,medium,short"},{id:"weekday",as:"string",options:"long,short,narrow"},{id:"year",as:"string",options:"numeric,2-digit"},{id:"month",as:"string",options:"numeric,2-digit,long,short,narrow"},{id:"day",as:"string",options:"numeric,2-digit"},{id:"hour",as:"string",options:"numeric,2-digit"},{id:"minute",as:"string",options:"numeric,2-digit"},{id:"second",as:"string",options:"numeric,2-digit"},{id:"timeZoneName",as:"string",options:"long,short"}],impl:(e,t)=>new Date(t).toLocaleDateString(void 0,jb.objFromEntries(jb.entries(e.params).filter(e=>e[1])))}),jb.exec=(...e)=>(new jb.jbCtx).run(...e),jb.execInStudio=(...e)=>jb.studio.studioWindow&&(new jb.studio.studioWindow.jb.jbCtx).run(...e),jb.exp=(...e)=>(new jb.jbCtx).exp(...e),function(){const e={moreLogs:"req,res,focus,apply,check,suggestions,writeValue,render,createReactClass,renderResult,probe,setState,immutable,pathOfObject,refObservable,scriptChange,resLog",groups:{watchable:"doOp,writeValue,removeCmpObservable,registerCmpObservable,notifyCmpObservable,notifyObservableElems,notifyObservableElem,scriptChange",react:"applyDeltaTop,applyDelta,unmount,render,initCmp,refreshReq,refreshElem,childDiffRes,htmlChange,appendChild,removeChild,replaceTop",dialog:"addDialog,closeDialog,refreshDialogs"},includeLogs:"exception,error",stackFilter:/spy|jb_spy|Object.log|node_modules/i,extraIgnoredEvents:[],MAX_LOG_SIZE:1e4},t=jb.frame;jb.initSpy=function({Error:a,settings:n,spyParam:i,memoryUsage:r,resetSpyToNull:o}){a=a||t.Error,r=r||(()=>t.performance&&performance.memory&&performance.memory.usedJSHeapSize),n=Object.assign(n||{},e);const s=["index","time","_time","mem","source"];if(o)return jb.spy=null;jb.spy={logs:{},spyParam:i,otherSpies:[],observable(){const e=jb.path(jb,"studio.studiojb")||jb;return this._obs=this._obs||e.callbag.subject(),this._obs},enabled:()=>!0,log(e,t,{takeFrom:a,funcTitle:i,modifier:o}={}){if((()=>{if(!this.initialized){const e=(this.spyParam||"").split(",").filter(e=>"-"!==e[0]).filter(e=>e).flatMap(e=>-1==Object.keys(n.groups).indexOf(e)?[e]:n.groups[e].split(",")),t=(this.spyParam||"").split(",").filter(e=>"-"===e[0]).map(e=>e.slice(1));this.includeLogs=n.includeLogs.split(",").concat(e).filter(e=>-1===t.indexOf(e)).reduce((e,t)=>(e[t]=!0,e),{})}this.initialized=!0})(),this.logs[e]=this.logs[e]||[],this.logs.$counters=this.logs.$counters||{},this.logs.$counters[e]=this.logs.$counters[e]||0,this.logs.$counters[e]++,!((e,t)=>"all"===this.spyParam||Array.isArray(t)&&this.includeLogs[e]&&!n.extraIgnoredEvents.includes(t[0]))(e,t))return;this.logs.$index=this.logs.$index||0,t.index=this.logs.$index++,t.source=this.source(a);const s=new Date;t._time=`${s.getSeconds()}:${s.getMilliseconds()}`,t.time=s.getTime(),t.mem=r()/1e6,this.logs[e].length>n.MAX_LOG_SIZE&&(this.logs[e]=this.logs[e].slice(-1*Math.floor(n.MAX_LOG_SIZE/2))),t[0]||"function"!=typeof i||(t[0]=i()),!t[0]&&t.source&&(t[0]=t.source[0]),"function"==typeof o&&o(t),this.logs[e].push(t),this._obs&&this._obs.next({logName:e,record:t})},source(e){a.stackTraceLimit=50;const i=[t];for(;i[0].parent&&i[0]!==i[0].parent;)i.unshift(i[0].parent);let r=i.reverse().map(e=>(new e.Error).stack).join("\n").split(/\r|\n/).map(e=>e.trim()).slice(4).filter(e=>"Error"!==e).filter(e=>!n.stackFilter.test(e));if(e){const t=r.findIndex(t=>-1!==t.indexOf(e));r=r.slice(t+1)}const o=r[0]||"";return[o.split(/at |as /).pop().split(/ |]/)[0],o.split("/").pop().slice(0,-1).trim(),...r]},resetParam:e=>{this.spyParam=e,this.includeLogs=null},setLogs(e){"all"===e&&(this.spyParam="all"),this.includeLogs=(e||"").split(",").reduce((e,t)=>(e[t]=!0,e),{})},clear(){Object.keys(this.logs).forEach(e=>delete this.logs[e])},search(e){return(e=>"[object RegExp]"===Object.prototype.toString.call(e))(e)?this.all(t=>e.test(t.join(" "))):(e=>"string"==typeof e||e instanceof String)(e)?this.all(t=>-1!==t.join(" ").indexOf(e)):Number.isInteger(e)?this.all().slice(-1*e):void 0},all(e){return[].concat.apply([],Object.keys(this.logs).filter(e=>Array.isArray(this.logs[e])).map(e=>this.logs[e].map(t=>{const a=[t.index,e,...t];return s.forEach(e=>{a[e]=t[e]}),a}))).filter((t,a,n)=>!e||e(t,a,n)).sort((e,t)=>e.index-t.index)}}},function(){const e=e=>(e.match("[?&]spy=([^&]+)")||["",""])[1],a=e((()=>{try{return t.parent&&t.parent.location.href}catch(e){}})()||"")||e((()=>{try{return t.location.href}catch(e){}})()||"");a&&jb.initSpy({spyParam:a}),jb.frame&&(jb.frame.spy=jb.spy)}()}(),function(e){var t={};function a(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(n,i,function(t){return e[t]}.bind(null,i));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s="./src/ui/pack-immutable.js")}({"./node_modules/immutability-helper/index.js":
/*!***************************************************!*\
  !*** ./node_modules/immutability-helper/index.js ***!
  \***************************************************/
/*! no static exports found */function(module,exports,__webpack_require__){eval("var invariant = __webpack_require__(/*! invariant */ \"./node_modules/invariant/browser.js\");\n\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar splice = Array.prototype.splice;\n\nvar toString = Object.prototype.toString\nvar type = function(obj) {\n  return toString.call(obj).slice(8, -1);\n}\n\nvar assign = Object.assign || /* istanbul ignore next */ function assign(target, source) {\n  getAllKeys(source).forEach(function(key) {\n    if (hasOwnProperty.call(source, key)) {\n      target[key] = source[key];\n    }\n  });\n  return target;\n};\n\nvar getAllKeys = typeof Object.getOwnPropertySymbols === 'function' ?\n  function(obj) { return Object.keys(obj).concat(Object.getOwnPropertySymbols(obj)) } :\n  /* istanbul ignore next */ function(obj) { return Object.keys(obj) };\n\n/* istanbul ignore next */\nfunction copy(object) {\n  if (Array.isArray(object)) {\n    return assign(object.constructor(object.length), object)\n  } else if (type(object) === 'Map') {\n    return new Map(object)\n  } else if (type(object) === 'Set') {\n    return new Set(object)\n  } else if (object && typeof object === 'object') {\n    var prototype = Object.getPrototypeOf(object);\n    return assign(Object.create(prototype), object);\n  } else {\n    return object;\n  }\n}\n\nfunction newContext() {\n  var commands = assign({}, defaultCommands);\n  update.extend = function(directive, fn) {\n    commands[directive] = fn;\n  };\n  update.isEquals = function(a, b) { return a === b; };\n\n  return update;\n\n  function update(object, spec) {\n    if (typeof spec === 'function') {\n      spec = { $apply: spec };\n    }\n\n    if (!(Array.isArray(object) && Array.isArray(spec))) {\n      invariant(\n        !Array.isArray(spec),\n        'update(): You provided an invalid spec to update(). The spec may ' +\n        'not contain an array except as the value of $set, $push, $unshift, ' +\n        '$splice or any custom command allowing an array value.'\n      );\n    }\n\n    invariant(\n      typeof spec === 'object' && spec !== null,\n      'update(): You provided an invalid spec to update(). The spec and ' +\n      'every included key path must be plain objects containing one of the ' +\n      'following commands: %s.',\n      Object.keys(commands).join(', ')\n    );\n\n    var nextObject = object;\n    var index, key;\n    getAllKeys(spec).forEach(function(key) {\n      if (hasOwnProperty.call(commands, key)) {\n        var objectWasNextObject = object === nextObject;\n        nextObject = commands[key](spec[key], nextObject, spec, object);\n        if (objectWasNextObject && update.isEquals(nextObject, object)) {\n          nextObject = object;\n        }\n      } else {\n        var nextValueForKey =\n          type(object) === 'Map'\n            ? update(object.get(key), spec[key])\n            : update(object[key], spec[key]);\n        var nextObjectValue =\n          type(nextObject) === 'Map'\n              ? nextObject.get(key)\n              : nextObject[key];\n        if (!update.isEquals(nextValueForKey, nextObjectValue) || typeof nextValueForKey === 'undefined' && !hasOwnProperty.call(object, key)) {\n          if (nextObject === object) {\n            nextObject = copy(object);\n          }\n          if (type(nextObject) === 'Map') {\n            nextObject.set(key, nextValueForKey);\n          } else {\n            nextObject[key] = nextValueForKey;\n          }\n        }\n      }\n    })\n    return nextObject;\n  }\n\n}\n\nvar defaultCommands = {\n  $push: function(value, nextObject, spec) {\n    invariantPushAndUnshift(nextObject, spec, '$push');\n    return value.length ? nextObject.concat(value) : nextObject;\n  },\n  $unshift: function(value, nextObject, spec) {\n    invariantPushAndUnshift(nextObject, spec, '$unshift');\n    return value.length ? value.concat(nextObject) : nextObject;\n  },\n  $splice: function(value, nextObject, spec, originalObject) {\n    invariantSplices(nextObject, spec);\n    value.forEach(function(args) {\n      invariantSplice(args);\n      if (nextObject === originalObject && args.length) nextObject = copy(originalObject);\n      splice.apply(nextObject, args);\n    });\n    return nextObject;\n  },\n  $set: function(value, nextObject, spec) {\n    invariantSet(spec);\n    return value;\n  },\n  $toggle: function(targets, nextObject) {\n    invariantSpecArray(targets, '$toggle');\n    var nextObjectCopy = targets.length ? copy(nextObject) : nextObject;\n\n    targets.forEach(function(target) {\n      nextObjectCopy[target] = !nextObject[target];\n    });\n\n    return nextObjectCopy;\n  },\n  $unset: function(value, nextObject, spec, originalObject) {\n    invariantSpecArray(value, '$unset');\n    value.forEach(function(key) {\n      if (Object.hasOwnProperty.call(nextObject, key)) {\n        if (nextObject === originalObject) nextObject = copy(originalObject);\n        delete nextObject[key];\n      }\n    });\n    return nextObject;\n  },\n  $add: function(value, nextObject, spec, originalObject) {\n    invariantMapOrSet(nextObject, '$add');\n    invariantSpecArray(value, '$add');\n    if (type(nextObject) === 'Map') {\n      value.forEach(function(pair) {\n        var key = pair[0];\n        var value = pair[1];\n        if (nextObject === originalObject && nextObject.get(key) !== value) nextObject = copy(originalObject);\n        nextObject.set(key, value);\n      });\n    } else {\n      value.forEach(function(value) {\n        if (nextObject === originalObject && !nextObject.has(value)) nextObject = copy(originalObject);\n        nextObject.add(value);\n      });\n    }\n    return nextObject;\n  },\n  $remove: function(value, nextObject, spec, originalObject) {\n    invariantMapOrSet(nextObject, '$remove');\n    invariantSpecArray(value, '$remove');\n    value.forEach(function(key) {\n      if (nextObject === originalObject && nextObject.has(key)) nextObject = copy(originalObject);\n      nextObject.delete(key);\n    });\n    return nextObject;\n  },\n  $merge: function(value, nextObject, spec, originalObject) {\n    invariantMerge(nextObject, value);\n    getAllKeys(value).forEach(function(key) {\n      if (value[key] !== nextObject[key]) {\n        if (nextObject === originalObject) nextObject = copy(originalObject);\n        nextObject[key] = value[key];\n      }\n    });\n    return nextObject;\n  },\n  $apply: function(value, original) {\n    invariantApply(value);\n    return value(original);\n  }\n};\n\nvar contextForExport = newContext();\n\nmodule.exports = contextForExport;\nmodule.exports.default = contextForExport;\nmodule.exports.newContext = newContext;\n\n// invariants\n\nfunction invariantPushAndUnshift(value, spec, command) {\n  invariant(\n    Array.isArray(value),\n    'update(): expected target of %s to be an array; got %s.',\n    command,\n    value\n  );\n  invariantSpecArray(spec[command], command)\n}\n\nfunction invariantSpecArray(spec, command) {\n  invariant(\n    Array.isArray(spec),\n    'update(): expected spec of %s to be an array; got %s. ' +\n    'Did you forget to wrap your parameter in an array?',\n    command,\n    spec\n  );\n}\n\nfunction invariantSplices(value, spec) {\n  invariant(\n    Array.isArray(value),\n    'Expected $splice target to be an array; got %s',\n    value\n  );\n  invariantSplice(spec['$splice']);\n}\n\nfunction invariantSplice(value) {\n  invariant(\n    Array.isArray(value),\n    'update(): expected spec of $splice to be an array of arrays; got %s. ' +\n    'Did you forget to wrap your parameters in an array?',\n    value\n  );\n}\n\nfunction invariantApply(fn) {\n  invariant(\n    typeof fn === 'function',\n    'update(): expected spec of $apply to be a function; got %s.',\n    fn\n  );\n}\n\nfunction invariantSet(spec) {\n  invariant(\n    Object.keys(spec).length === 1,\n    'Cannot have more than one key in an object with $set'\n  );\n}\n\nfunction invariantMerge(target, specValue) {\n  invariant(\n    specValue && typeof specValue === 'object',\n    'update(): $merge expects a spec of type \\'object\\'; got %s',\n    specValue\n  );\n  invariant(\n    target && typeof target === 'object',\n    'update(): $merge expects a target of type \\'object\\'; got %s',\n    target\n  );\n}\n\nfunction invariantMapOrSet(target, command) {\n  var typeOfTarget = type(target);\n  invariant(\n    typeOfTarget === 'Map' || typeOfTarget === 'Set',\n    'update(): %s expects a target of type Set or Map; got %s',\n    command,\n    typeOfTarget\n  );\n}\n\n\n//# sourceURL=webpack:///./node_modules/immutability-helper/index.js?")},"./node_modules/invariant/browser.js":
/*!*******************************************!*\
  !*** ./node_modules/invariant/browser.js ***!
  \*******************************************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval("/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n\n\n/**\n * Use invariant() to assert state which your program assumes to be true.\n *\n * Provide sprintf-style format (only %s is supported) and arguments\n * to provide information about what broke and what you were\n * expecting.\n *\n * The invariant message will be stripped in production, but the invariant\n * will remain to ensure logic does not differ in production.\n */\n\nvar invariant = function(condition, format, a, b, c, d, e, f) {\n  if (true) {\n    if (format === undefined) {\n      throw new Error('invariant requires an error message argument');\n    }\n  }\n\n  if (!condition) {\n    var error;\n    if (format === undefined) {\n      error = new Error(\n        'Minified exception occurred; use the non-minified dev environment ' +\n        'for the full error message and additional helpful warnings.'\n      );\n    } else {\n      var args = [a, b, c, d, e, f];\n      var argIndex = 0;\n      error = new Error(\n        format.replace(/%s/g, function() { return args[argIndex++]; })\n      );\n      error.name = 'Invariant Violation';\n    }\n\n    error.framesToPop = 1; // we don't care about invariant's own frame\n    throw error;\n  }\n};\n\nmodule.exports = invariant;\n\n\n//# sourceURL=webpack:///./node_modules/invariant/browser.js?")},"./src/ui/pack-immutable.js":
/*!**********************************!*\
  !*** ./src/ui/pack-immutable.js ***!
  \**********************************/
/*! no exports provided */function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var immutability_helper__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! immutability-helper */ "./node_modules/immutability-helper/index.js");\n/* harmony import */ var immutability_helper__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(immutability_helper__WEBPACK_IMPORTED_MODULE_0__);\n\r\n\r\njb.ui.update = immutability_helper__WEBPACK_IMPORTED_MODULE_0___default.a;\r\n\n\n//# sourceURL=webpack:///./src/ui/pack-immutable.js?')}}),function(){const e=(e,t)=>e===t,t={},a=()=>!0,n=e=>e;jb.callbag={forEach:e=>t=>{let a;t(0,(t,n)=>{0===t&&(a=n),1===t&&e(n),1!==t&&0!==t||a(1)})},fromIter:e=>(t,a)=>{if(0!==t)return;const n="undefined"!=typeof Symbol&&e[Symbol.iterator]?e[Symbol.iterator]():e;let i,r=!1,o=!1;a(0,(e,t)=>{1===e&&(o=!0,r||i&&i.done||function(){for(r=!0;o;)o=!1,(i=n.next()).done?a(2):a(1,i.value);r=!1}())})},Do:e=>t=>(a,n)=>{0===a&&t(0,(t,a)=>{1==t&&e(a),n(t,a)})},filter:e=>t=>(a,n)=>{if(0!==a)return;let i;t(0,(t,a)=>{0===t?(i=a,n(t,a)):1===t?e(a)?n(t,a):i(1):n(t,a)})},map:e=>t=>(a,n)=>{0===a&&t(0,(t,a)=>{n(t,1===t?e(a):a)})},pipe(...e){const t=e.filter(e=>e).filter(e=>jb.callbag.fromAny(e));if(!t[0])return;let a=t[0];for(let e=1,n=t.length;e<n;e++)a=t[e](a);return a},distinctUntilChanged:(t=e)=>e=>(a,n)=>{if(0!==a)return;let i,r,o=!1;e(0,(e,a)=>{0===e&&(r=a),1===e?o&&t(i,a)?r(1):(o=!0,i=a,n(1,a)):n(e,a)})},takeUntil:e=>("[object Promise]"===Object.prototype.toString.call(e)&&(e=jb.callbag.fromPromise(e)),a=>(n,i)=>{if(0!==n)return;let r,o,s=!1,l=t;a(0,(a,n)=>{if(0===a)return r=n,e(0,(e,t)=>{if(0!==e)return 1===e?(l=void 0,o(2),r(2),void(s&&i(2))):void(2===e&&(o=null,l=t,null!=t&&(r(2),s&&i(e,t))));(o=t)(1)}),s=!0,i(0,(e,a)=>{l===t&&(2===e&&o&&o(2),r(e,a))}),void(l!==t&&i(2,l));2===a&&o(2),l===t&&i(a,n)})}),flatMap:(e,t)=>a=>(n,i)=>{if(0!==n)return;t||(t=(e,t)=>t);let r=0,o={},s=!1,l=null,c=(e,t)=>{var a=Object.values(o).pop();1===e&&(a?a(1):s?i(2):l(1)),2===e&&(a&&a(2),l(2))},d=e=>{s&&0===Object.keys(o).length?i(2,e):l(1)};a(0,(a,n)=>{0===a&&(l=n,i(0,c)),1===a&&((...t)=>jb.callbag.fromAny(e(...t)))(n)(0,((e,a,n)=>(r,o)=>{0===r&&(n[e]=o,n[e](1)),1===r&&i(1,t(a,o)),2===r&&(delete n[e],d(o))})(r++,n,o)),2===a&&(s=!0,d(n))})},merge(...e){const t=e.filter(e=>e).filter(e=>jb.callbag.fromAny(e));return(e,a)=>{if(0!==e)return;const n=t.length,i=new Array(n);let r=0,o=0,s=!1;const l=(e,t)=>{2===e&&(s=!0);for(let a=0;a<n;a++)i[a]&&i[a](e,t)};for(let e=0;e<n;e++){if(s)return;t[e](0,(t,c)=>{if(0===t)i[e]=c,1==++r&&a(0,l);else if(2===t&&c){s=!0;for(let t=0;t<n;t++)t!==e&&i[t]&&i[t](2);a(2,c)}else 2===t?(i[e]=void 0,++o===n&&a(2)):a(t,c)})}}},fromEvent:(e,t,a)=>(n,i)=>{if(0!==n)return;let r=!1;const o=e=>i(1,e);if(i(0,(n,i)=>{if(2===n)if(r=!0,e.removeEventListener)e.removeEventListener(t,o,a);else{if(!e.removeListener)throw new Error("cannot remove listener from node. No method found.");e.removeListener(t,o)}}),!r)if(e.addEventListener)e.addEventListener(t,o,a);else{if(!e.addListener)throw new Error("cannot add listener to node. No method found.");e.addListener(t,o)}},fromPromise:e=>(t,a)=>{if(0!==t)return;let n=!1;e.then(e=>{n||(a(1,e),n||a(2))},(e=new Error)=>{n||a(2,e)}),a(0,(e,t)=>{2===e&&(n=!0)})},subject(){let e=[];const t=(t,a)=>{if(0===t){const t=a;e.push(t),t(0,a=>{if(2===a){const a=e.indexOf(t);a>-1&&e.splice(a,1)}})}else{const n=e.slice(0);for(let i,r=0,o=n.length;r<o;r++)i=n[r],e.indexOf(i)>-1&&i(t,a)}};return t.next=e=>t(1,e),t.complete=()=>t(2),t.error=e=>t(2,e),t},catchError:e=>t=>(a,n)=>{0===a&&t(0,(t,a)=>2===t&&void 0!==a?e(a):n(t,a))},concatMap(e){const t=(...t)=>jb.callbag.fromAny(e(...t));return e=>(a,n)=>{if(0!==a)return;const i=[];let r,o=null;const s=(e,a)=>{if(0===e)(o=a)(1);else if(1===e)n(1,a),o(1);else if(2===e){if(o=null,0===i.length)return;t(i.shift())(0,s)}},l=(e,t)=>{2===e&&null!==o&&o(2,t),r(e,t)};e(0,(e,a)=>{if(0===e)return r=a,void n(0,l);1===e?null!==o?i.push(a):t(a)(0,s):2===e&&(n(2,a),null!==o&&o(2,a))})}},create:e=>(t,a)=>{if(0!==t)return;if("function"!=typeof e)return a(0,()=>{}),void a(2);let n,i=!1;a(0,e=>{i||(i=2===e)&&"function"==typeof n&&n()}),i||(n=e(e=>{i||a(1,e)},e=>{i||void 0===e||(i=!0,a(2,e))},()=>{i||(i=!0,a(2))}))},debounceTime:e=>t=>(a,n)=>{if(0!==a)return;let i;t(0,(t,a)=>{i&&clearTimeout(i),1===t?i=setTimeout(()=>n(1,a),"function"==typeof e?e():e):n(t,a)})},take:e=>t=>(a,n)=>{if(0!==a)return;let i,r,o=0;function s(t,a){2===t?(r=!0,i(t,a)):o<e&&i(t,a)}t(0,(t,a)=>{0===t?(i=a,n(0,s)):1===t?o<e&&(o++,n(t,a),o!==e||r||(r=!0,i(2),n(2))):n(t,a)})},last:(e=a,t=n)=>a=>(n,i)=>{if(0!==n)return;let r,o,s=!1;a(0,(a,n)=>{0===a?(r=n,i(a,n)):1===a?(e(n)&&(o=n,s=!0),r(1)):2===a?(s&&i(1,t(o)),i(2)):i(a,n)})},subscribe:(e={})=>t=>{"function"==typeof e&&(e={next:e});let a,{next:n,error:i,complete:r}=e;return t(0,(e,t)=>{0===e&&(a=t),1===e&&n&&n(t),1!==e&&0!==e||a(1),2===e&&!t&&r&&r(),2===e&&t&&i&&i(t)}),()=>a&&a(2)},toPromise:e=>new Promise((t,a)=>{jb.callbag.subscribe({next:t,error:a,complete:()=>{const e=new Error("No elements in sequence.");e.code="NO_ELEMENTS",a(e)}})(jb.callbag.last(e))}),toPromiseArray(e){const t=[];let a;return new Promise((n,i)=>{e(0,(e,r)=>{0===e&&(a=r),1===e&&t.push(r),1!==e&&0!==e||a(1),2!==e||r||n(t),2===e&&r&&i(r)})})},startWith:(...e)=>t=>(a,n)=>{if(0!==a)return;let i,r,o=!1,s=!1;for(n(0,(t,a)=>{s&&1===t&&(r=[1,a]),2===t&&(o=!0,e.length=0),i&&i(t,a)});0!==e.length;)1===e.length&&(s=!0),n(1,e.shift());o||t(0,(e,t)=>{if(0===e)return i=t,s=!1,void(r&&(i(...r),r=null));n(e,t)})},delay:e=>t=>(a,n)=>{0===a&&t(0,(t,a)=>{if(1!==t)return n(t,a);let i=setTimeout(()=>{clearTimeout(i),n(1,a)},e)})},fromCallBag:e=>e,fromAny:(e,t,a)=>{const n=e&&"from"+("[object Promise]"===Object.prototype.toString.call(e)?"Promise":e.addEventListener?"Event":"function"==typeof e[Symbol.iterator]?"Iter":"");return jb.callbag[n]?jb.callbag[n](e,t,a):jb.callbag.isCallbag(e)?e:jb.callbag.fromIter([e])},isCallbag:e=>e.toString().split("=>")[0].replace(/\s/g,"").match(/start,sink|t,d/)}}(),function(){const e=Symbol.for("isProxy"),t=Symbol.for("originalVal"),a=Symbol.for("targetVal"),n=Symbol("jbId");class i{constructor(e){this.resources=e,this.objToPath=new Map,this.idCounter=1,this.allowedTypes=[Object.getPrototypeOf({}),Object.getPrototypeOf([])],this.resourceChange=jb.callbag.subject(),this.observables=[],this.primitiveArraysDeltas={},jb.ui.originalResources=jb.resources;const t=e();t[n]=this.idCounter++,this.objToPath.set(t[n],[]),this.propagateResourceChangeToObservables()}doOp(t,a,i){try{const r=a.$set||a.$merge||a.$push||a.$splice;this.isRef(t)||(t=this.asRef(t)),jb.log("doOp",[this.asStr(t),r,...arguments]);const o=this.removeLinksFromPath(this.pathOfRef(t)),s={},l=this.valOfPath(o);if(!o||t.$jb_val)return;if(void 0!==a.$set&&a.$set===l)return;a.$push&&(a.$push=jb.asArray(a.$push)),this.addJbId(o),jb.path(s,o,a);const c=jb.path(a.$splice,[0,2])&&jb.path(a.$splice,[0,0]),d=null!=c&&o.concat(c),p={op:a,path:[...o],insertedPath:d,ref:t,srcCtx:i,oldVal:l,opVal:r,timeStamp:(new Date).getTime()};this.resources(jb.ui.update(this.resources(),s),p);const m=null!=r&&r[e]?r:this.valOfPath(o);return a.$push?(a.$push.forEach((e,t)=>this.addObjToMap(e,[...o,l.length+t])),m[n]=l[n],p.path.push(l.length),p.ref=this.refOfPath(p.path)):null===a.$set&&"object"==typeof l?(this.removeObjFromMap(l),this.addObjToMap(m,o),p.ref.$jb_path=()=>o):a.$splice?(a.$splice.forEach(e=>{l.slice(e[0],e[0]+e[1]).forEach(e=>this.removeObjFromMap(e)),jb.asArray(e[2]).forEach(e=>this.addObjToMap(e,o.concat(m.indexOf(e))))}),this.fixSplicedPaths(o,a.$splice)):(this.removeObjFromMap(l),this.addObjToMap(m,o)),a.$splice&&(this.primitiveArraysDeltas[t.$jb_obj[n]]=this.primitiveArraysDeltas[t.$jb_obj[n]]||[],this.primitiveArraysDeltas[t.$jb_obj[n]].push(a.$splice)),p.newVal=m,this.transactionEventsLog?this.transactionEventsLog.push(p):this.resourceChange.next(p),p}catch(e){jb.logException(e,"doOp",i,...arguments)}}resourceReferred(e){const t=this.resources()[e];this.objToPath.has(t)||this.addObjToMap(t,[e])}addJbId(e){for(let t=0;t<e.length;t++){const a=e.slice(0,t+1),i=this.valOfPath(a,!0);i&&"object"==typeof i&&!i[n]&&(i[n]=this.idCounter++,this.addObjToMap(i,a))}}addObjToMap(t,a){!t||t[e]||t.$jb_val||"object"!=typeof t||-1==this.allowedTypes.indexOf(Object.getPrototypeOf(t))||(t[n]?(this.objToPath.set(t[n],a),this.objToPath.delete(t)):this.objToPath.set(t,a),Object.keys(t).filter(e=>"object"==typeof t[e]&&0!=e.indexOf("$jb_")).forEach(e=>this.addObjToMap(t[e],[...a,e])))}removeObjFromMap(e,t){e&&"object"==typeof e&&-1!=this.allowedTypes.indexOf(Object.getPrototypeOf(e))&&(this.objToPath.delete(e),e[n]&&t&&this.objToPath.delete(e[n]),Object.keys(e).filter(t=>t=>"object"==typeof e[t]&&0!=t.indexOf("$jb_")).forEach(t=>this.removeObjFromMap(e[t],!0)))}fixSplicedPaths(e,t){const a=e.length;Array.from(this.objToPath.keys()).filter(t=>(function(t){if(t.length<=a)return;for(let n=0;n<a;n++)if(t[n]!=e[n])return;return!0})(this.objToPath.get(t))).forEach(e=>{const n=this.objToPath.get(e);n[a]=function(e){return e+t.reduce((t,a)=>e<a[0]?0:jb.asArray(a[2]).length-a[1],0)}(+n[a]),n[a]>=0&&this.objToPath.set(e,n)})}pathOfRef(e){if(e.$jb_path)return e.$jb_path();const t=this.isRef(e)&&(this.objToPath.get(e.$jb_obj)||this.objToPath.get(e.$jb_obj[n]));return t&&void 0!==e.$jb_childProp?(this.refreshPrimitiveArrayRef(e),[...t,e.$jb_childProp]):t}urlOfRef(e){const t=this.pathOfRef(e);this.addJbId(t);const a=[e.$jb_obj[n],e.$jb_childProp].filter(e=>null!=e).map(e=>(""+e).replace(/~|;|,/g,"")).join("~"),i=t.map(e=>(""+e).replace(/~|;|,/g,"")).join("~");return`${this.resources.id}://${a};${i}`}refOfUrl(e){const t=e.split(";")[0].split("~");return{handler:this,$jb_obj:{[n]:+t[0]},...t[1]?{$jb_childProp:t[1]}:{}}}asRef(t,i){if(this.isRef(t))return t;if(!t||"object"!=typeof t)return t;const r=t[e]?t[a]:t,o=this.objToPath.get(r)||this.objToPath.get(r[n]);return o?{$jb_obj:this.valOfPath(o),handler:this,path:function(){return this.handler.pathOfRef(this)}}:(i||jb.logError("asRef can not make a watchable ref of obj",t),null)}valOfPath(e){return e.reduce((e,t)=>this.noProxy(e&&e[t]),this.resources())}noProxy(a){return a&&a[e]&&a[t]||a}hasLinksInPath(t){let a=this.resources();for(let n=0;n<t.length;n++){if(a&&a[e])return!0;a=a&&a[t[n]]}}removeLinksFromPath(a){if(Array.isArray(a))return this.hasLinksInPath(a)?a.reduce(({val:a,path:i},r)=>{const o=a&&a[e],s=o?a[t]:a,l=o?this.objToPath.get(s)||this.objToPath.get(s[n]):i;return{val:s&&s[r],path:[l,r].join("~")}},{val:this.resources(),path:""}).path:a}refOfPath(e){const t=this.valOfPath(e);if(!t||"object"!=typeof t&&e.length>0){const t=this.asRef(this.valOfPath(e.slice(0,-1)),!0);return 1==e.length?{$jb_obj:this.resources(),$jb_childProp:e[0],handler:this,$jb_path:()=>e}:this.objectProperty(t,e.slice(-1)[0])}return this.asRef(t)}asStr(e){return this.pathOfRef(e).join("~")}isValid(e){return this.isRef(e)&&this.pathOfRef(e)}val(e){if(null==e)return e;if(e.$jb_val)return e.$jb_val();if(!e.$jb_obj)return e;if(e.handler!=this)return e.handler.val,e.handler.val(e);this.refreshPrimitiveArrayRef(e);const t=this.pathOfRef(e);return t||this.pathOfRef(e),this.valOfPath(t)}watchable(e){return this.resources()===e||this.objToPath.get(e)||e&&this.objToPath.get(e[n])}isRef(e){return e&&e.$jb_obj&&this.watchable(e.$jb_obj)}objectProperty(e,t,a){if(jb.log("objectProperty",[...arguments]),!e)return jb.logError("objectProperty: null obj",a);var i=this.asRef(e);if(i&&i.$jb_obj){const e={$jb_obj:i.$jb_obj,$jb_childProp:t,handler:this,path:function(){return this.handler.pathOfRef(this)}};return this.isPrimitiveArray(i.$jb_obj)&&(e.$jb_delta_version=(this.primitiveArraysDeltas[i.$jb_obj[n]]||[]).length,e.$jb_childProp=+t),e}return e[t]}writeValue(e,t,a){return e&&this.isRef(e)&&this.pathOfRef(e)?(jb.log("writeValue",["watchable",this.asStr(e),t,e,a]),e.$jb_val?e.$jb_val(t):this.val(e)!==t?this.doOp(e,{$set:this.createSecondaryLink(t)},a):void 0):jb.logError("writeValue: err in ref",a,e,t)}createSecondaryLink(n){if(n&&"object"==typeof n&&!n[e]){const i=this.asRef(n,!0);if(i&&i.$jb_obj)return new Proxy(n,{get:(i,r)=>r===a?i:r===e||(r===t?n:jb.val(this.asRef(n))[r]),set:(e,t,a)=>e[t]=a})}return n}splice(e,t,a){return this.doOp(e,{$splice:t},a)}move(e,t,a){const n=this.pathOfRef(e),i=this.pathOfRef(t),r=n.slice(0,-1).join("~")==i.slice(0,-1).join("~"),o=Number(n.slice(-1));let s=Number(i.slice(-1));const l=this.refOfPath(n.slice(0,-1)),c=this.refOfPath(i.slice(0,-1));if(isNaN(o)||isNaN(s))return jb.logError("move: not array element",a,e,t);var d=jb.val(e);if(r){const e=[[o,1],[s,0,d]];return e.fromIndex=o,e.toIndex=s,this.doOp(l,{$splice:e},a)}this.startTransaction();const p=[[o,1]];p.fromIndex=o,p.toIndex=s,p.toArray=c,this.doOp(l,{$splice:p},a),this.doOp(c,{$splice:[[s,0,d]]},a),this.endTransaction()}isPrimitiveArray(e){return Array.isArray(e)&&e.some(e=>null!=e&&"object"!=typeof e)}refreshPrimitiveArrayRef(e){if(!this.isPrimitiveArray(e.$jb_obj))return;const t=e.$jb_obj[n],a=this.primitiveArraysDeltas[t]||[];a.slice(e.$jb_delta_version).forEach(t=>{if(null!=t.fromIndex&&t.fromIndex===e.$jb_childProp)return e.$jb_childProp=t.toIndex,void(t.toArray&&(e.$jb_obj=t.toArray.$jb_obj));t.forEach(([t,a,n])=>{-1!=e.$jb_childProp&&(e.$jb_childProp>=t&&e.$jb_childProp<t+a?e.$jb_childProp=-1:e.$jb_childProp>=t&&(e.$jb_childProp=e.$jb_childProp-a+(null!=n)?1:0))})}),e.$jb_delta_version=a.length}startTransaction(){this.transactionEventsLog=[]}endTransaction(e){e||(this.transactionEventsLog||[]).forEach(e=>this.resourceChange.next(e)),delete this.transactionEventsLog}push(e,t,a){return this.doOp(e,{$push:this.createSecondaryLink(t)},a)}merge(e,t,a){return this.doOp(e,{$merge:this.createSecondaryLink(t)},a)}getOrCreateObservable(e){const t=jb.callbag.subject();e.srcCtx=e.srcCtx||{path:""};const a=e.cmpOrElem.ctx||jb.ui.ctxOfElem(e.cmpOrElem),n=this.pathOfRef(e.ref).join("~")+" : "+a.path,i=e.cmpOrElem.getAttribute&&+(e.cmpOrElem.getAttribute("recycleCounter")||0),r={...e,subject:t,key:n,recycleCounter:i,ctx:a};return this.observables.push(r),this.observables.sort((e,t)=>jb.ui.comparePaths(e.ctx.path,t.ctx.path)),jb.log("registerCmpObservable",[r]),t}frame(){return this.resources.frame||jb.frame}propagateResourceChangeToObservables(){jb.subscribe(this.resourceChange,e=>{const t=this.observables.slice(0),a=this.removeLinksFromPath(this.pathOfRef(e.ref));a&&t.forEach(t=>{const n=t.cmpOrElem.NodeType&&+t.cmpOrElem.getAttribute("recycleCounter")>t.recycleCounter;t.cmpOrElem._destroyed||n?-1!=this.observables.indexOf(t)&&(jb.log("removeCmpObservable",[t]),this.observables.splice(this.observables.indexOf(t),1)):this.notifyOneObserver(e,t,a)})})}notifyOneObserver(e,t,a){let n=jb.refHandler(t.ref).pathOfRef(t.ref);if(!(n=n&&this.removeLinksFromPath(n)))return jb.logError("observer ref path is empty",t,e);const i=jb.ui.comparePaths(a,n),r=1==i,o=r&&("yes"===t.includeChildren||!0===t.includeChildren),s=r&&"structure"===t.includeChildren&&("object"==typeof e.oldVal||"object"==typeof e.newVal);(-1==i||0==i||o||s)&&(jb.log("notifyCmpObservable",["notify change",e.srcCtx,t,e]),t.subject.next(e))}dispose(){this.resourceChange.complete()}}function r(e){if(void 0===e)return jb.resources;jb.resources=e}jb.ui.comparePaths=function(e,t){e=e||"",t=t||"";let a=0;for(;e[a]===t[a]&&a<e.length;)a++;return a==e.length&&a==t.length?0:a==e.length&&a<t.length?-1:a==t.length&&a<e.length?1:e[a]<t[a]?-2:2},r.id="resources",jb.setMainWatchableHandler(new i(r)),jb.rebuildRefHandler=()=>{jb.mainWatchableHandler&&jb.mainWatchableHandler.dispose(),jb.setMainWatchableHandler(new i(r))},jb.isWatchable=e=>jb.refHandler(e)instanceof i||e&&e.$jb_observable,jb.ui.refObservable=(e,t,a={})=>e&&e.$jb_observable?e.$jb_observable(t):jb.isWatchable(e)?jb.refHandler(e).getOrCreateObservable({ref:e,cmpOrElem:t,...a}):(jb.logError("ref is not watchable",e),jb.callbag.fromIter([])),jb.ui.extraWatchableHandler=(e,t)=>{const a=jb.extraWatchableHandler(new i(e),t);return jb.ui.subscribeToRefChange(a),a},jb.ui.resourceChange=()=>jb.mainWatchableHandler.resourceChange,jb.component("run-transaction",{type:"action",params:[{id:"actions",type:"action[]",dynamic:!0,composite:!0,mandatory:!0,defaultValue:[]},{id:"disableNotifications",as:"boolean",type:"boolean"}],impl:(e,t,a)=>(jb.mainWatchableHandler.startTransaction(),t.reduce((t,a,n)=>t.then(t=>e.runInner(a,{as:"single"},innerPath+n)),Promise.resolve()).catch(t=>jb.logException(t,e)).then(()=>jb.mainWatchableHandler.endTransaction(a)))})}();class VNode{constructor(e,t,a){const n=jb.objFromEntries(jb.entries(t).map(e=>[e[0].toLowerCase(),e[1]]));let i=""===a?null:a;-1!==["string","boolean","number"].indexOf(typeof i)&&(n.$text=i,i=null),i&&"function"==typeof i.then&&(n.$text="...",i=null),null==i||Array.isArray(i)||(i=[i]),null!=i&&(i=i.filter(e=>e).map(e=>"string"==typeof e?jb.ui.h("span",{$text:e}):e)),Object.assign(this,{["string"==typeof e?"tag":"cmp"]:e,attributes:n,children:i})}getAttribute(e){return(this.attributes||{})[e]}setAttribute(e,t){this.attributes=this.attributes||{},this.attributes[e]=t}addClass(e){return this.attributes=this.attributes||{},void 0===this.attributes.class&&(this.attributes.class=""),e&&-1==this.attributes.class.split(" ").indexOf(e)&&(this.attributes.class=[this.attributes.class,e].filter(e=>e).join(" ")),this}hasClass(e){return-1!=(jb.path(this,"attributes.class")||"").split(" ").indexOf(e)}querySelectorAll(e,{includeSelf:t}={}){const a=e.match(/^\[([a-zA-Z0-9_\-]+)\]$/),n=e.match(/^\[([a-zA-Z0-9_\-]+)="([a-zA-Z0-9_\-]+)"\]$/),i=e.match(/^\.([a-zA-Z0-9_\-]+)$/),r=e.match(/^[a-zA-Z0-9_\-]+$/),o=a?e=>e.attributes&&e.attributes[a[1]]:i?e=>e.hasClass(i[1]):r?e=>e.tag===r[0]:n?e=>e.attributes&&e.attributes[n[1]]==n[2]:null;return o&&function e(t,a,n){return[...!n&&a(t)?[t]:[],...(t.children||[]).flatMap(t=>e(t,a))]}(this,o,!t)}}function toVdomOrStr(e){if(jb.isDelayed(e))return jb.toSynchArray(e).then(e=>jb.ui.toVdomOrStr(e[0]));const t=Array.isArray(e)?e.map(e=>jb.val(e)):e;let a=jb.val(Array.isArray(t)&&1==t.length?t[0]:t);return a&&a instanceof VNode||Array.isArray(a)?a:("boolean"==typeof a||"object"==typeof a?a=""+a:"string"==typeof a&&(a=a.slice(0,1e3)),a)}function groupOfOpt(e){return e.group||-1!=e.text.indexOf(".")?e.group||e.text.split(".").shift():"---"}Object.assign(jb.ui,{VNode:VNode,toVdomOrStr:toVdomOrStr}),function(){const e=jb.ui,t=(e,t)=>{try{return e()}catch(e){jb.logException(e,t,this.ctx)}};function a(t,a,n){return t instanceof e.VNode?t:t&&t.renderVdom?t.renderVdom():new jb.ui.VNode(t,a,n)}function n(e,t){const a=jb.objectDiff(t.attributes||{},e.attributes||{});null==a.style&&delete a.style;const r=function(e,t){if(0==e.length&&0==t.length)return;if(1==t.length&&1==e.length&&t[0].tag==e[0].tag)return{0:{...n(e[0],t[0]),__afterIndex:0},length:1};jb.log("childDiff",[...arguments]);const a=e.map((e,t)=>({i:t,...e}));let r=a.slice(0);const o=t.map(e=>(function(e,t){const a=t.findIndex(t=>i(t,e));if(-1!=a)return t.splice(a,1)[0]})(e,r));t.forEach((e,t)=>o[t]=o[t]||function(e,t,a){const n=a.findIndex(a=>a.tag&&a.i==t&&a.tag===e.tag);if(-1!=n){const t=a.splice(n,1)[0];return t.attributes.ctxId&&!i(t,e)&&(t.$remount=!0),t}}(e,t,r));const s=[],l={length:a.length};return a.forEach((e,a)=>{const i=o.indexOf(e);-1==i?l[a]={$:"delete",__afterIndex:i}:(s[i]=!0,l[a]={__afterIndex:i,...n(e,t[i]),...e.$remount?{remount:!0}:{}})}),l.toAppend=t.flatMap((e,t)=>s[t]?[]:[{...n({},e),__afterIndex:t}]),jb.log("childDiffRes",[l,...arguments]),l.length||l.toAppend.length?l:null}(e.children||[],t.children||[]);return{...Object.keys(a).length?{attributes:a}:{},...r?{children:r}:{},...t.tag!=e.tag?{tag:t.tag}:{}}}function i(e,t){if(e.cmp&&e.cmp===t.cmp)return!0;const a=e.attributes||{},n=t.attributes||{};return!!(a.cmpId&&a.cmpId===n.cmpId||a.ctxId&&a.ctxId===n.ctxId)||(!(!r("path",a,n)||!r("data",a,n))||(!!function(e,t,a){for(let n=0;n<e.length;n++)if(t[e[n]]&&t[e[n]]==a[e[n]])return!0}(["id","path","name"],a,n)||void 0))}function r(e,t,a){const n=t.ctxId&&jb.path(jb.ui.ctxDictionary[t.ctxId],e),i=a.ctxId&&jb.path(jb.ui.ctxDictionary[a.ctxId],e);return n&&i&&n==i}function o(t,a,{strongRefresh:i,ctx:r}={}){jb.log("applyDeltaTop",["start",...arguments]);const o=t instanceof e.VNode?t:s(t),c=n(o,a);if(t instanceof e.VNode){const e=t.getAttribute("cmp-id"),n=t.getAttribute("id");return t!=a&&(Object.keys(t).forEach(e=>delete t[e]),Object.assign(t,a)),jb.ui.updateRenderer(c,n,e,r&&r.vars.widgetId)}const u=jb.ui.activeElement()===t;if(jb.log("applyDeltaTop",["apply",o,a,c,u,...arguments],{modifier:e=>e.push(function(e){return(e=>({attributes:jb.objFromEntries(jb.entries(e.attributes).filter(e=>-1==["jb-ctx","cmp-id","originators","__afterIndex","mount-ctx","interactive"].indexOf(e[0]))),children:e.children}))(e)}(c))}),c.tag||i){d(t);const e=p(a,t.parentElement);t.parentElement.replaceChild(e,t),jb.log("replaceTop",[e,t,c]),t=e}else l(t,c);e.findIncludeSelf(t,"[interactive]").forEach(e=>e._component?e._component.recalcPropsFromElem():m(e)),u&&jb.ui.focus(t,"apply Vdom diff",r),e.garbageCollectCtxDictionary(t)}function s(e){return{tag:e.tagName.toLowerCase(),attributes:jb.objFromEntries([...Array.from(e.attributes).map(e=>[e.name,e.value]),..."#text"==jb.path(e,"firstChild.nodeName")?[["$text",e.firstChild.nodeValue]]:[]]),...e.childElementCount&&!e.getAttribute("jb_external")?{children:Array.from(e.children).map(e=>s(e))}:{}}}function l(e,t){jb.log("applyDelta",[...arguments]);const a=t.children;if(t.children){const n=t.children.length?Array.from(Array(t.children.length).keys()).map(e=>a[e]):[],i=Array.from(e.children),r=t.children.toAppend||[],o=n.reduce((e,t,a)=>e&&t.__afterIndex==a,!0)&&!r.length||!n.length&&r.reduce((e,t,a)=>e&&t.__afterIndex==a,!0);n.forEach((a,n)=>{"delete"==a.$?(d(i[n]),e.removeChild(i[n]),jb.log("removeChild",[i[n],a,e,t])):(l(i[n],a),!o&&i[n].setAttribute("__afterIndex",a.__afterIndex))}),r.forEach(a=>{const n=e.ownerDocument.createElement(a.tag);e.appendChild(n),l(n,a),jb.log("appendChild",[n,a,e,t]),!o&&n.setAttribute("__afterIndex",a.__afterIndex)}),o||Array.from(e.children).sort((e,t)=>Number(e.getAttribute("__afterIndex"))-Number(t.getAttribute("__afterIndex"))).forEach(t=>{const a=Number(t.getAttribute("__afterIndex"));e.children[a]!=t&&e.insertBefore(t,e.children[a]),t.removeAttribute("__afterIndex")}),e.childElementCount&&Array.from(e.childNodes).filter(e=>"#text"==e.nodeName).forEach(a=>{e.removeChild(a),jb.log("removeChild",["remove leftover",a,e,t])})}jb.entries(t.attributes).filter(t=>!("$text"===t[0]&&e.firstElementChild)).forEach(t=>c(e,t[0],t[1]))}function c(e,t,a){if("$"!==t[0]&&null==a)e.removeAttribute(t),jb.log("htmlChange",["remove",...arguments]);else if("checked"===t&&"input"===e.tagName.toLowerCase())!0===a&&(e.checked=!0),jb.log("htmlChange",["checked",...arguments]);else if("$text"===t)e.innerText=a||"",jb.log("htmlChange",["text",...arguments]);else if("$html"===t)e.innerHTML=a||"",jb.log("htmlChange",["html",...arguments]);else if("style"===t&&"object"==typeof a)e.setAttribute(t,jb.entries(a).map(e=>`${e[0]}:${e[1]}`).join(";")),jb.log("htmlChange",["setAtt",...arguments]);else if("value"==t&&e.tagName.match(/select|input|textarea/i)){const t=document.activeElement===e;if(e.value==a)return;e.value=a,t&&e.focus(),jb.log("htmlChange",["setAtt",...arguments])}else e.setAttribute(t,a),jb.log("htmlChange",["setAtt",...arguments])}function d(e){jb.log("unmount",[...arguments]),e&&e.setAttribute&&jb.ui.findIncludeSelf(e,"[interactive]").forEach(e=>e._component&&e._component.destroy())}function p(t,a){jb.log("render",[...arguments]);const n=function e(t,a){jb.log("htmlChange",["createElement",...arguments]);const n=a.ownerDocument.createElement(t.tag);return jb.entries(t.attributes).forEach(e=>c(n,e[0],e[1])),jb.asArray(t.children).map(t=>e(t,n)).forEach(e=>n.appendChild(e)),a.appendChild(n),n}(t,a);return e.findIncludeSelf(n,"[interactive]").forEach(e=>m(e)),e.garbageCollectCtxDictionary(a),n}function m(a,n){const i=jb.ui.ctxOfElem(a,"mount-ctx");if(!i)return jb.logError("no ctx for elem",[a]);const r="open-dialog"==i.profile.$?jb.ui.dialogs.buildComp(i):i.runItself(),o={state:{...n&&jb.path(a._component,"state")},base:a,refresh(n,i){jb.log("refreshReq",[...arguments]),this._deleted||(Object.assign(this.state,n),e.refreshElem(a,{...this.state,...n},i),(this.componentDidUpdateFuncs||[]).forEach(e=>t(()=>e(this),"componentDidUpdate")))},destroy(){this._deleted=!0,this.resolveDestroyed(),(r.destroyFuncs||[]).forEach(e=>t(()=>e(this),"destroy"))},status:"initializing",recalcPropsFromElem(){a.getAttribute("worker")||(this.ctx=jb.ui.ctxOfElem(a,"mount-ctx").setVar("cmp",this),this.cmpId=a.getAttribute("cmp-id"),(a.getAttribute("interactive")||"").split(",").filter(e=>e).forEach(e=>{[id,ctxId]=e.split("-");const t=jb.ui.ctxDictOfElem(a)[ctxId];this[id]=jb.val(t.setVar("state",this.state).runInner(t.profile.value,"value","value"))}),this.doRefresh&&this.doRefresh())},componentDidUpdateFuncs:r.componentDidUpdateFuncs};o.destroyed=new Promise(e=>o.resolveDestroyed=e),a._component=o,o.recalcPropsFromElem(),jb.unique(r.eventObservables).forEach(e=>o[e]=jb.ui.fromEvent(o,e.slice(2),a)),(r.componentDidMountFuncs||[]).forEach(e=>t(()=>e(o),"componentDidMount")),o.status="ready"}Object.assign(jb.ui,{h:a,render:p,unmount:d,applyVdomDiff:o,applyDeltaToDom:l,elemToVdom:s,mountInteractive:m,compareVdom:n,appendItems:function(t,a,n){if(t instanceof e.VNode){const e=t.getAttribute("cmp-id"),i=t.getAttribute("id");return jb.ui.updateRenderer(a,i,e,n&&n.vars.widgetId)}(a.children||[]).forEach(e=>p(e,t))},handleCmpEvent(t,a){a="undefined"!=typeof event?event:a;const n=jb.ui.parents(a.currentTarget,{includeSelf:!0}).find(e=>e.getAttribute&&null!=e.getAttribute("jb-ctx"));if(!n)return;if("scroll"==a.type&&(a.scrollPercentFromTop=a.scrollPercentFromTop||(n.scrollTop+jb.ui.offset(n).height)/n.scrollHeight),n.getAttribute("worker"))return jb.ui.workers[n.getAttribute("worker")].handleBrowserEvent(n,a,t);const i=n._component,r=t||`on${a.type}Handler`;return i&&i[r]?i[r](a):e.runActionOfElem(n,r,a)},runActionOfElem(e,t,a){if(e.getAttribute("contenteditable"))return;a="undefined"!=typeof event?event:a;const n=(e.getAttribute("handlers")||"").split(",").filter(e=>0==e.indexOf(t+"-")).map(t=>jb.ui.ctxDictOfElem(e)[t.split("-")[1]]).filter(e=>e).map(t=>t.setVar("cmp",e._component).setVars({ev:a}))[0];return n&&n.runInner(n.profile.action,"action","action")},ctrl(t,a){const n=t.vars.$refreshElemCall?t.vars.$state:{},i=t.setVars({$model:{ctx:t,...t.params},$state:n,$refreshElemCall:void 0}),r=function(e){const a=t.profile,n="$theme."+(a.$||"");return!a.style&&t.vars[n]?e.run({$:t.vars[n]}):t.params.style?t.params.style(e):{}}(i)||{};return r instanceof e.JbComponent?r.orig(i).jbExtend(a,i).applyParamFeatures(i):new e.JbComponent(i).jbExtend(a,i).jbExtend(r,i).applyParamFeatures(i)},garbageCollectCtxDictionary(t,a){if(!t.ownerDocument.contains(t))return;const n=(new Date).getTime();e.ctxDictionaryLastCleanUp=e.ctxDictionaryLastCleanUp||n;const i=n-e.ctxDictionaryLastCleanUp;if(!a&&i<1e4)return;e.ctxDictionaryLastCleanUp=n;const r="jb-ctx,mount-ctx,pick-ctx,props-ctx,handlers,interactive,originators".split(",").flatMap(e=>Array.from(document.querySelectorAll(`[${e}]`)).flatMap(t=>t.getAttribute(e).split(",").map(e=>Number(e.split("-").pop())))).sort((e,t)=>e-t),o=Object.keys(jb.ctxDictionary).map(e=>Number(e)).sort((e,t)=>e-t);let s=0;const l=[],c=[];for(let e=0;e<o.length;e++){for(;r[s]<o[e];)s++;r[s]!=o[e]&&(l.push(e),delete jb.ctxDictionary[""+o[e]])}const d=jb.unique(r.map(e=>jb.ctxDictionary[""+e]).filter(e=>e).map(e=>(e=>Object.values(e.vars).filter(e=>jb.isWatchable(e)).map(e=>jb.asRef(e)).map(e=>jb.refHandler(e).pathOfRef(e)).flat())(e)).flat());Object.keys(jb.resources).filter(e=>-1!=e.indexOf(":")).filter(e=>-1==d.indexOf(e)).forEach(e=>{c.push(e),delete jb.resources[e]}),jb.log("garbageCollect",[l,c])},refreshElem(t,n,i){if("initializing"==jb.path(t,"_component.status"))return jb.logError("circular refresh",[...arguments]);jb.log("refreshElem",[...arguments]);const r=e.ctxOfElem(t);if(!r)return jb.logError("refreshElem - no ctx for elem",t);const s=jb.path(i,"strongRefresh");let l=r.setVar("$state",s?{}:n||{});i&&i.extendCtx&&(l=i.extendCtx(l));const c="open-dialog"==(l=l.setVar("$refreshElemCall",!0)).profile.$?jb.ui.dialogs.buildComp(l):l.runItself(),d=c.init();if(null!=d&&d==t.getAttribute("cmpHash"))return jb.log("refreshElem",["stopped by hash",d,...arguments]);c&&o(t,a(c),{strongRefresh:s,ctx:l}),jb.execInStudio({$:"animate.refresh-elem",elem:()=>t})},subscribeToRefChange:t=>jb.subscribe(t.resourceChange,a=>{const n=t.removeLinksFromPath(t.pathOfRef(a.ref)),i=jb.ui.find(a.srcCtx,"[observe]"),r=i.map(e=>e.getAttribute("jb-ctx"));jb.log("notifyObservableElems",["elemsToCheck",i,a]),i.forEach((i,o)=>{if(r[o]!=i.getAttribute("jb-ctx"))return;let s=!1,l=!1;i.getAttribute("observe").split(",").map(e=>(function(e){const a=e.split("://"),n=a[1].split(";"),i=(n[2].match(/includeChildren=([a-z]+)/)||["",""])[1],r="strongRefresh"===n[3];return a[0]==t.resources.id&&{ref:t.refOfUrl(n[0]),includeChildren:i,strongRefresh:r}})(e)).filter(e=>e).forEach(r=>{jb.path(i,"_component.ctx.componentContext.callerPath");const o=t.removeLinksFromPath(t.pathOfRef(r.ref));if(!o)return jb.logError("observer ref path is empty",r,a);l=l||r.strongRefresh;const c=e.comparePaths(n,o),d=1==c,p=d&&("yes"===r.includeChildren||!0===r.includeChildren),m=d&&"structure"===r.includeChildren&&("object"==typeof a.oldVal||"object"==typeof a.newVal);(-1==c||0==c||p||m)&&(jb.log("notifyObservableElem",["notify refresh",i,a.srcCtx,r,a]),s=!0)}),s&&e.refreshElem(i,null,{srcCtx:a.srcCtx,strongRefresh:l})})})}),e.subscribeToRefChange(jb.mainWatchableHandler)}(),function(){const e=jb.ui;let t=0,a=0;e.propCounter=0;const n=e.cssSelectors_hash={},i=(e,t)=>{try{return e()}catch(e){jb.logException(e,t,this.ctx)}},r=new Set("init,componentDidMount,componentWillUpdate,componentDidUpdate,destroy,extendCtx,templateModifier,extendItem".split(",")),o=new Set("enrichField,dynamicCss,watchAndCalcModelProp,staticCssLines,defHandler,interactiveProp,calcProp".split(",")),s=new Set("template,calcRenderProps,toolbar,styleCtx,calcHash,ctxForPick".split(","));class l{constructor(e){this.ctx=e,this.cmpId=a++,this.eventObservables=[],this.staticCssLines=[],this.contexts=[],this.originators=[e]}init(){return jb.log("initCmp",[this]),this.ctx=(this.extendCtxFuncs||[]).reduce((e,t)=>i(()=>t(e,this),"extendCtx"),this.ctx.setVar("cmpId",this.cmpId)),this.renderProps={},this.state=this.ctx.vars.$state,this.calcCtx=this.ctx.setVar("$props",this.renderProps).setVar("cmp",this),this.renderProps.cmpHash=this.calcHash&&i(()=>this.calcHash(this.calcCtx)),this.initialized=!0,this.renderProps.cmpHash}renderVdom(){if(jb.log("renderVdom",[this]),this.initialized||this.init(),(this.initFuncs||[]).sort((e,t)=>e.phase-t.phase).forEach(e=>i(()=>e.action(this.calcCtx),"init")),this.toObserve=this.watchRef?this.watchRef.map(e=>({...e,ref:e.refF(this.ctx)})).filter(e=>jb.isWatchable(e.ref)):[],this.watchAndCalcModelProp&&this.watchAndCalcModelProp.forEach(e=>{const t=this.ctx.vars.$model[e.prop](this.ctx);jb.isWatchable(t)&&this.toObserve.push({id:e.prop,cmp:this,ref:t,...e});const a=jb.val(t);this.renderProps[e.prop]=e.transformValue(this.ctx.setData(null==a?"":a))}),Object.assign(this.renderProps,(this.styleCtx||{}).params,this.state),(this.calcProp||[]).filter(e=>0==this.calcProp.filter(t=>t.id==e.id&&t.priority>e.priority).length).sort((e,t)=>e.phase-t.phase||e.index-t.index).forEach(e=>{const t=jb.val(i(()=>e.value(this.calcCtx),`renderProp:${e.id}`));Object.assign(this.renderProps,{..."$props"==e.id?t:{[e.id]:t}})}),jb.log("renderProps",[this.renderProps,this]),this.ctx.probe&&this.ctx.probe.outOfTime)return;this.template=this.template||(()=>"");const t=i(()=>this.template(this,this.renderProps,e.h),"template")||{},a=(this.templateModifierFuncs||[]).reduce((t,a)=>t&&"object"==typeof t?i(()=>a(t,this,this.renderProps,e.h)||t,"templateModifier"):t,t),n=this.toObserve.map(e=>[e.ref.handler.urlOfRef(e.ref),e.includeChildren?`includeChildren=${e.includeChildren}`:"",e.strongRefresh?"strongRefresh":""].join(";")).join(","),r=(this.defHandler||[]).map(t=>`${t.id}-${e.preserveCtx(t.ctx)}`).join(","),o=(this.interactiveProp||[]).map(t=>`${t.id}-${e.preserveCtx(t.ctx)}`).join(","),s=this.originators.map(t=>e.preserveCtx(t)).join(",");jb.frame.workerId?(jb.frame.workerId,this.cmpId):Object.assign(a.attributes||{},{"jb-ctx":e.preserveCtx(this.originatingCtx()),"cmp-id":this.cmpId,"mount-ctx":e.preserveCtx(this.ctx)},n&&{observe:n},r&&{handlers:r},s&&{originators:s},this.ctxForPick&&{"pick-ctx":e.preserveCtx(this.ctxForPick)},(this.componentDidMountFuncs||o)&&{interactive:o},null!=this.renderProps.cmpHash&&{cmpHash:this.renderProps.cmpHash});return a instanceof jb.ui.VNode&&(a.addClass(this.jbCssClass()),a.attributes=Object.assign(a.attributes||{},{"jb-ctx":e.preserveCtx(this.originatingCtx()),"cmp-id":this.cmpId,"mount-ctx":e.preserveCtx(this.ctx)},n&&{observe:n},r&&{handlers:r},s&&{originators:s},this.ctxForPick&&{"pick-ctx":e.preserveCtx(this.ctxForPick)},jb.frame.workerId&&{worker:jb.frame.workerId},(this.componentDidMountFuncs||o)&&{interactive:o},null!=this.renderProps.cmpHash&&{cmpHash:this.renderProps.cmpHash})),function e(t){jb.entries(t.attributes).forEach(([e,a])=>0==e.indexOf("on")&&0!=(""+a).indexOf("jb.ui")&&(t.attributes[e]=`jb.ui.handleCmpEvent(${"string"==typeof a&&a?"'"+a+"'":""})`));(t.children||[]).forEach(t=>e(t))}(a),jb.log("renRes",[this.ctx,a,this]),a}jbCssClass(){if(this.cachedClass)return this.cachedClass;const a=this.ctx,i=(this.staticCssLines||[]).concat((this.dynamicCss||[]).map(e=>e(this.calcCtx))).filter(e=>e),r=i.join("\n"),o=jb.frame.isWorker?"w"+frame.workerId:"jb-";if(!r)return"";if(!n[r]){t++,n[r]=t;const s=i.map(e=>{return e.split("{")[0].split(",").map(e=>e.trim().replace("|>"," ")).map(e=>-1==e.indexOf("~")?`.${o}${t}${e}`:e.replace("~",`.${o}${t}`))+" { "+e.split("{")[1]}).join("\n"),l=`/*style: ${a.profile.style&&a.profile.style.$}, path: ${a.path}*/\n`;e.addStyleElem(l+s)}const s=`${o}${n[r]}`;return this.dynamicCss||(this.cachedClass=s),s}originatingCtx(){return this.originators[this.originators.length-1]}field(){if(this._field)return this._field;const t=this.originatingCtx();this._field={class:"",ctxId:e.preserveCtx(t),control:(e,a,n)=>this.getOrCreateItemField(e,()=>t.setData(e).setVars({index:(a||0)+1}).runItself(),n)},this.enrichField&&this.enrichField.forEach(e=>e(this._field));let a=jb.tosingle(jb.val(t.params.title))||(()=>"");return void 0!==this._field.title&&(a=this._field.title),this._field.title="function"==typeof a?a:()=>""+a,this.itemfieldCache=new Map,this._field}getOrCreateItemField(e,t,a){return a?t():(this.itemfieldCache.get(e)||this.itemfieldCache.set(e,t()),this.itemfieldCache.get(e))}orig(e){return jb.comps[e.profile&&e.profile.$].type.split(/,|-/).indexOf("control"),this.originators.push(e),this}applyParamFeatures(e){return(e.params.features&&e.params.features(e)||[]).forEach(t=>this.jbExtend(t,e)),this}jbExtend(t,a){if(!t)return this;(a=a||this.ctx)||console.log("no ctx provided for jbExtend");const n=t.$?a.run(t):t;return Array.isArray(n)?(n.forEach(e=>this.jbExtend(e,a)),this):(n.afterViewInit&&(n.componentDidMount=n.afterViewInit),"string"==typeof n.class&&(n.templateModifier=e=>e.addClass(n.class)),Object.keys(n).forEach(e=>{r.has(e)&&(this[e+"Funcs"]=this[e+"Funcs"]||[],this[e+"Funcs"].push(n[e])),o.has(e)&&(this[e]=this[e]||[],this[e].push(n[e])),s.has(e)&&(this[e]=this[e]||n[e])}),n.watchRef&&(this.watchRef=this.watchRef||[],this.watchRef.push(Object.assign({cmp:this},n.watchRef))),this.eventObservables=this.eventObservables.concat(Object.keys(n).filter(e=>0==e.indexOf("on"))),n.css&&(this.staticCssLines=(this.staticCssLines||[]).concat(n.css.split(/}\s*/m).map(e=>e.trim()).filter(e=>e).map(e=>e+"}").map(e=>e.replace(/^!/," ")))),jb.asArray(n.featuresOptions||[]).forEach(e=>this.jbExtend(e.$?a.run(e):e,a)),jb.asArray(e.inStudio()&&n.studioFeatures).forEach(e=>this.jbExtend(a.run(e),a)),this)}}e.JbComponent=l,jb.jstypes.renderable=t=>null==t?"":t instanceof e.VNode?t:t instanceof l?e.h(t):Array.isArray(t)?e.h("div",{},t.map(e=>jb.jstypes.renderable(e))):""+jb.val(t,!0)}(),function(){const e=jb.ui;Object.assign(jb.ui,{focus(e,t,a){const n=(new Date).getTime(),i=jb.studio.lastStudioActivity||jb.path(jb,["studio","studioWindow","jb","studio","lastStudioActivity"]);jb.log("focus",["request",a,t,n-i,e,a]),jb.studio.previewjb==jb&&i&&n-i<1e3||jb.delay(1).then(n=>{jb.log("focus",["apply",a,t,e,a]),e.focus()})},wrapWithLauchingElement:(e,t,a,n={})=>i=>e(t.extendVars(i).setVars({$launchingElement:{el:a,...n}})),withUnits:e=>""===e||void 0===e?"":(""+e||"").match(/[^0-9]$/)?e:`${e}px`,propWithUnits:(e,t)=>""===t||void 0===t?"":`${e}: `+((""+t||"").match(/[^0-9]$/)?t:`${t}px`)+";",fixCssLine:e=>-1!=e.indexOf("/n")||e.match(/}\s*/)?e:`{ ${e} }`,ctxDictOfElem:e=>(!jb.frame.isWorker&&e.getAttribute("worker")?jb.ui.workers[e.getAttribute("worker")]:jb).ctxDictionary,ctxOfElem:(e,t)=>e&&e.getAttribute&&jb.ui.ctxDictOfElem(e)[e.getAttribute(t||"jb-ctx")],preserveCtx:e=>(jb.ctxDictionary[e.id]=e,e.id),inStudio:()=>jb.studio&&jb.studio.studioWindow,inPreview(){try{return!e.inStudio()&&jb.frame.parent.jb.studio.initPreview}catch(e){}},parentCmps(e){if(!e)return[];const t=jb.ui.parents(e),a=t[t.length-5];return(jb.ui.hasClass(a,"jb-dialog")?t.slice(0,-4).concat(jb.ui.ctxOfElem(a).exp("%$$launchingElement.el._component.base%")||[]):t).map(e=>e._component).filter(e=>e)},closestCmp(e){return e._component||this.parentCmps(e)[0]},document:e=>jb.frame.isWorker?jb.ui.widgets[e.vars.widgetId].top:e.vars.elemToTest||e.frame().document,item:(e,t,a)=>(e.extendItemFuncs&&e.extendItemFuncs.forEach(n=>n(e,t,a)),t),fromEvent:(e,t,a)=>jb.callbag.pipe(jb.callbag.fromEvent(a||e.base,t),jb.callbag.takeUntil(jb.callbag.fromPromise(e.destroyed))),upDownEnterEscObs(e){const{pipe:t,takeUntil:a,fromPromise:n,subject:i}=jb.callbag,r=i();return e.base.onkeydown=e=>-1==[38,40,13,27].indexOf(e.keyCode)||(r.next(e),!1),t(r,a(n(e.destroyed)))}}),Object.assign(jb.ui,{outerWidth(e){const t=getComputedStyle(e);return e.offsetWidth+parseInt(t.marginLeft)+parseInt(t.marginRight)},outerHeight(e){const t=getComputedStyle(e);return e.offsetHeight+parseInt(t.marginTop)+parseInt(t.marginBottom)},offset:e=>e.getBoundingClientRect(),parents(e,{includeSelf:t}={}){const a=[];for(e=t?e:e&&e.parentNode;e;)a.push(e),e=e.parentNode;return a},closest(t,a){for(;t;){if(e.matches(t,a))return t;t=t.parentNode}},activeElement:()=>document.activeElement,find(t,a,n){return"jbCtx"==jb.path(t,"constructor.name")&&(t=this.document(t)),t instanceof jb.ui.VNode?t.querySelectorAll(a,n):[...n&&n.includeSelf&&e.matches(t,a)?[t]:[],...Array.from(t.querySelectorAll(a))]},findIncludeSelf:(e,t)=>jb.ui.find(e,t,{includeSelf:!0}),addClass:(e,t)=>e.classList.add(t),removeClass:(e,t)=>e.classList.remove(t),hasClass:(e,t)=>e&&e.classList.contains(t),matches:(e,t)=>e&&e.matches&&e.matches(t),index:e=>Array.from(e.parentNode.children).indexOf(e),limitStringLength:(e,t)=>"string"==typeof e&&e.length>t-3?e.substring(0,t)+"...":e,addHTML(e,t){const a=document.createElement("div");a.innerHTML=t,e.appendChild(a.firstChild)},addStyleElem(e){const t=document.createElement("style");t.innerHTML=e,document.head.appendChild(t)}}),e.renderWidget=function(t,a){let n=!1;try{"undefined"!=typeof window&&window.parent.jb}catch(e){n=!0}try{!n&&"undefined"!=typeof window&&window.parent!=window&&window.parent.jb&&window.parent.jb.studio.initPreview(window,[Object.getPrototypeOf({}),Object.getPrototypeOf([])])}catch(e){return jb.logException(e)}let i=t,r=0;if(jb.studio.studioWindow){const e=jb.studio.studioWindow,t=e.jb.studio,a=e.jb.resources.studio.project,n=e.jb.resources.studio.page;a&&n&&(i={$:`${a}.${n}`});const{pipe:o,debounceTime:l,filter:c,subscribe:d}=jb.callbag;o(t.pageChange,c(({page:e})=>e!=i.$),d(({page:e})=>s(e))),o(t.scriptChange,c(e=>0!=(jb.path(e,"path.0")||"").indexOf("data-resource.")),l(()=>Math.min(2e3,3*r+500)),d(()=>{s(),jb.ui.dialogs.reRenderAll()}))}const o=a.ownerDocument.createElement("div");function s(t){t&&(i={$:t});const n=(new jb.jbCtx).run(i),o=(new Date).getTime();jb.ui.unmount(a),a.innerHTML="",jb.ui.render(e.h(n),a),r=(new Date).getTime()-o}a.appendChild(o),s()},jb.objectDiff=function(e,t){if(t===e)return{};if(!jb.isObject(t)||!jb.isObject(e))return e;const a=Object.keys(t).reduce((t,a)=>e.hasOwnProperty(a)?t:{...t,[a]:jb.frame.isWorker?"__undefined":void 0},{});return Object.keys(e).reduce((a,n)=>{if(!t.hasOwnProperty(n))return{...a,[n]:e[n]};const i=jb.objectDiff(e[n],t[n]);return jb.isObject(i)&&jb.isEmpty(i)?a:{...a,[n]:i}},a)},jb.component("custom-style",{typePattern:e=>/\.style$/.test(e),category:"advanced:10,all:10",params:[{id:"template",as:"single",mandatory:!0,dynamic:!0,ignore:!0},{id:"css",as:"string"},{id:"features",type:"feature[]",dynamic:!0}],impl:(e,t,a)=>({template:e.profile.template,css:t,featuresOptions:a(),styleCtx:e._parent})}),jb.component("style-by-control",{typePattern:e=>/\.style$/.test(e),category:"advanced:10,all:20",params:[{id:"control",type:"control",mandatory:!0,dynamic:!0},{id:"modelVar",as:"string",mandatory:!0}],impl:(e,t,a)=>t(e.setVar(a,e.vars.$model))}),jb.component("style-with-features",{typePattern:e=>/\.style$/.test(e),description:"customize, add more features to style",category:"advanced:10,all:20",params:[{id:"style",type:"$asParent",mandatory:!0,composite:!0},{id:"features",type:"feature[]",templateValue:[],dynamic:!0,mandatory:!0}],impl:(e,t,a)=>t&&{...t,featuresOptions:(t.featuresOptions||[]).concat(a())}}),jb.component("control-with-features",{type:"control",description:"customize, add more features to control",category:"advanced:10,all:20",params:[{id:"control",type:"control",mandatory:!0},{id:"features",type:"feature[]",templateValue:[],mandatory:!0}],impl:(e,t,a)=>t.jbExtend(a,e).orig(e)})}(),jb.component("def-handler",{type:"feature",description:"define custom event handler",params:[{id:"id",as:"string",mandatory:!0,description:'to be used in html, e.g. onclick="clicked" '},{id:"action",type:"action[]",mandatory:!0,dynamic:!0}],impl:(e,t)=>({defHandler:{id:t,ctx:e}})}),jb.component("watch-and-calc-model-prop",{type:"feature",description:"Use a model property in the rendering and watch its changes (refresh on change)",params:[{id:"prop",as:"string",mandatory:!0},{id:"transformValue",dynamic:!0,defaultValue:"%%"}],impl:(e,t,a)=>({watchAndCalcModelProp:{prop:t,transformValue:a}})}),jb.component("calc-prop",{type:"feature",description:"define a variable to be used in the rendering calculation process",params:[{id:"id",as:"string",mandatory:!0},{id:"value",mandatory:!0,dynamic:!0},{id:"priority",as:"number",defaultValue:1,description:"if same prop was defined elsewhere who will win. range 1-1000"},{id:"phase",as:"number",defaultValue:10,description:"props from different features can use each other, phase defines the calculation order"}],impl:e=>({calcProp:{...e.params,index:jb.ui.propCounter++}})}),jb.component("interactive-prop",{type:"feature",description:"define a variable for the interactive comp",params:[{id:"id",as:"string",mandatory:!0},{id:"value",mandatory:!0,dynamic:!0}],impl:(e,t)=>({interactiveProp:{id:t,ctx:e}})}),jb.component("calc-props",{type:"feature",description:"define variables to be used in the rendering calculation process",params:[{id:"props",as:"object",mandatory:!0,description:"props as object",dynamic:!0},{id:"phase",as:"number",defaultValue:10,description:"props from different features can use each other, phase defines the calculation order"}],impl:(e,t,a)=>({calcProp:{id:"$props",value:e=>t(e),phase:a,index:jb.ui.propCounter++}})}),jb.component("feature.init",{type:"feature",category:"lifecycle",params:[{id:"action",type:"action[]",mandatory:!0,dynamic:!0},{id:"phase",as:"number",defaultValue:10,description:"init funcs from different features can use each other, phase defines the calculation order"}],impl:(e,t,a)=>({init:{action:t,phase:a}})}),jb.component("feature.beforeInit",{type:"feature",category:"lifecycle",params:[{id:"action",type:"action[]",mandatory:!0,dynamic:!0}],impl:feature.init("%$action%",5)}),jb.component("feature.after-load",{type:"feature",description:"init, onload, defines the interactive part of the component",category:"lifecycle",params:[{id:"action",type:"action[]",mandatory:!0,dynamic:!0}],impl:e=>({afterViewInit:t=>e.params.action(t.ctx)})}),jb.component("interactive",jb.comps["feature.after-load"]),jb.component("template-modifier",{type:"feature",description:"change the html template",params:[{id:"value",mandatory:!0,dynamic:!0}],impl:(e,t)=>({templateModifier:(a,n)=>t(e.setVars({cmp:n,vdom:a,...n.renderProps}))})}),jb.component("features",{type:"feature",description:"list of features, auto flattens",params:[{id:"features",type:"feature[]",as:"array",composite:!0}],impl:(e,t)=>t.flatMap(e=>Array.isArray(e)?e:[e])}),jb.component("watch-ref",{type:"feature",category:"watch:100",description:"subscribes to data changes to refresh component",params:[{id:"ref",mandatory:!0,as:"ref",dynamic:!0,description:"reference to data"},{id:"includeChildren",as:"string",options:"yes,no,structure",defaultValue:"no",description:"watch childern change as well"},{id:"allowSelfRefresh",as:"boolean",description:"allow refresh originated from the components or its children",type:"boolean"},{id:"strongRefresh",as:"boolean",description:"rebuild the component and reinit wait for data",type:"boolean"}],impl:e=>({watchRef:{refF:e.params.ref,...e.params}})}),jb.component("watch-observable",{type:"feature",category:"watch",description:"subscribes to a custom rx.observable to refresh component",params:[{id:"toWatch",mandatory:!0},{id:"debounceTime",as:"number",description:"in mSec"}],impl:interactive((e,{cmp:t},{toWatch:a,debounceTime:n})=>jb.callbag.pipe(a,jb.callbag.takeUntil(t.destroyed),n&&jb.callbag.debounceTime(n),jb.callbag.subscribe(()=>t.refresh(null,{srcCtx:e.componentContext}))))}),jb.component("group.data",{type:"feature",category:"general:100,watch:80",params:[{id:"data",mandatory:!0,dynamic:!0,as:"ref"},{id:"itemVariable",as:"string",description:"optional. define data as a local variable"},{id:"watch",as:"boolean",type:"boolean"},{id:"includeChildren",as:"string",options:"yes,no,structure",defaultValue:"no",description:"watch childern change as well"}],impl:(e,t,a,n,i)=>({...n?{watchRef:{refF:t,includeChildren:i}}:{},extendCtx:e=>{const n=t();return e.setData(n).setVar(a,n)}})}),jb.component("html-attribute",{type:"feature",description:"set attribute to html element and give it value",params:[{id:"attribute",mandatory:!0,as:"string"},{id:"value",mandatory:!0,as:"string",dynamic:!0}],impl:(e,t,a)=>({templateModifier:(e,n)=>(e.attributes=e.attributes||{},e.attributes[t]=a(n.ctx),e)})}),jb.component("id",{type:"feature",description:"adds id to html element",params:[{id:"id",mandatory:!0,as:"string",dynamic:!0}],impl:htmlAttribute("id",(e,{},{id:t})=>t(e))}),jb.component("feature.hover-title",{type:"feature",description:"set element title, usually shown by browser on hover",params:[{id:"title",as:"string",mandatory:!0}],impl:htmlAttribute("title","%$title%")}),jb.component("variable",{type:"feature",category:"general:90",description:"define a variable. watchable or passive, local or global",params:[{id:"name",as:"string",mandatory:!0},{id:"value",dynamic:!0,defaultValue:"",mandatory:!0},{id:"watchable",as:"boolean",type:"boolean",description:"E.g., selected item variable"}],impl:({},e,t,a)=>({destroy:t=>{const a=e+":"+t.cmpId;t.ctx.run(writeValue(`%$${a}%`,null))},extendCtx:(n,i)=>{if(!a)return n.setVar(e,jb.val(t(n)));const r=e+":"+i.cmpId;jb.log("var",["new-watchable",n,r]);const o=jb.mainWatchableHandler.refOfPath([r]);return jb.writeValue(o,t(n),n),n.setVar(e,o)}})}),jb.component("calculated-var",{type:"feature",category:"general:60",description:"defines a local variable that watches other variables with auto recalc",params:[{id:"name",as:"string",mandatory:!0},{id:"value",dynamic:!0,defaultValue:"",mandatory:!0},{id:"watchRefs",as:"array",dynamic:!0,mandatory:!0,defaultValue:[],description:"variable to watch. needs to be in array"}],impl:(e,t,a,n)=>({destroy:e=>{const a=t+":"+e.cmpId;e.ctx.run(writeValue(`%$${a}%`,null))},extendCtx:(n,i)=>{const r=t+":"+i.cmpId;jb.log("calculated var",["new-resource",e,r]),jb.resource(r,jb.val(a(n)));const o=n.exp(`%$${r}%`,"ref");return n.setVar(t,o)},afterViewInit:i=>{const r=t+":"+i.cmpId,o=i.ctx.exp(`%$${r}%`,"ref");(n(i.ctx)||[]).map(e=>jb.asRef(e)).filter(e=>e).forEach(t=>jb.subscribe(jb.ui.refObservable(t,i,{srcCtx:e}),t=>jb.writeValue(o,a(i.ctx),e)))}})}),jb.component("feature.if",{type:"feature",category:"feature:85",description:"adds/remove element to dom by condition. keywords: hidden/show",params:[{id:"showCondition",as:"boolean",mandatory:!0,dynamic:!0,type:"boolean"}],impl:(e,t)=>({templateModifier:(e,a)=>jb.toboolean(t(a.ctx))?e:jb.ui.h("span",{style:{display:"none"}})})}),jb.component("hidden",{type:"feature",category:"feature:85",description:"display:none on element. keywords: show",params:[{id:"showCondition",type:"boolean",mandatory:!0,dynamic:!0}],impl:(e,t)=>({templateModifier:(e,a)=>(jb.toboolean(t(a.ctx))||jb.path(e,["attributes","style","display"],"none"),e)})}),jb.component("conditional-class",{type:"feature",description:"toggle class by condition",params:[{id:"cssClass",as:"string",mandatory:!0,dynamic:!0},{id:"condition",type:"boolean",mandatory:!0,dynamic:!0}],impl:(e,t,a)=>({templateModifier:(e,n)=>(jb.toboolean(a(n.ctx))&&e.addClass(t()),e)})}),jb.component("feature.keyboard-shortcut",{type:"feature",category:"events",description:"listen to events at the document level even when the component is not active",params:[{id:"key",as:"string",description:"e.g. Alt+C"},{id:"action",type:"action",dynamic:!0}],impl:(e,t,a)=>({afterViewInit:e=>{jb.callbag.forEach(jb.ui.fromEvent(e,"keydown",e.base.ownerDocument))(e=>{const n=t.split("+").slice(1).join("+"),i=n.charCodeAt(0);"Delete"==t&&(i=46);const r=(t.match("([A-Za-z]*)+")||["",""])[1];("Ctrl"!=r||e.ctrlKey)&&("Alt"!=r||e.altKey)&&(e.keyCode==i||e.key&&e.key==n)&&a()})}})}),jb.component("feature.onEvent",{type:"feature",category:"events",params:[{id:"event",as:"string",mandatory:!0,options:"load,blur,change,focus,keydown,keypress,keyup,click,dblclick,mousedown,mousemove,mouseup,mouseout,mouseover,scroll"},{id:"action",type:"action[]",mandatory:!0,dynamic:!0},{id:"debounceTime",as:"number",defaultValue:0,description:"used for mouse events such as mousemove"}],impl:(e,t,a,n)=>({[`on${t}`]:!0,afterViewInit:e=>{"load"==t?jb.delay(1).then(()=>jb.ui.wrapWithLauchingElement(a,e.ctx,e.base)()):jb.subscribe(n?e[`on${t}`].debounceTime(n):e[`on${t}`],t=>jb.ui.wrapWithLauchingElement(a,e.ctx.setVars({event:t}),e.base)())}})}),jb.component("feature.onHover",{type:"feature",description:"on mouse enter",category:"events",params:[{id:"action",type:"action[]",mandatory:!0,dynamic:!0},{id:"onLeave",type:"action[]",mandatory:!0,dynamic:!0},{id:"debounceTime",as:"number",defaultValue:0}],impl:(e,t,a,n)=>({onmouseenter:!0,onmouseleave:!0,afterViewInit:e=>{const{pipe:i,debounceTime:r,subscribe:o}=jb.callbag;i(e.onmouseenter,r(n),o(()=>jb.ui.wrapWithLauchingElement(t,e.ctx,e.base)())),i(e.onmouseleave,r(n),o(()=>jb.ui.wrapWithLauchingElement(a,e.ctx,e.base)()))}})}),jb.component("feature.class-on-hover",{type:"feature",description:"set css class on mouse enter",category:"events",params:[{id:"class",type:"string",defaultValue:"item-hover",description:"css class to add/remove on hover"}],impl:(e,t)=>({onmouseenter:!0,onmouseleave:!0,afterViewInit:e=>{jb.subscribe(e.onmouseenter,()=>jb.ui.addClass(e.base,t)),jb.subscribe(e.onmouseleave,()=>jb.ui.removeClass(e.base,t))}})}),jb.ui.checkKey=function(e,t){if(!t)return;const a=(t=t.replace(/-/,"+")).split("+").pop();let n={tab:9,delete:46,tab:9,esc:27,enter:13,right:39,left:37,up:38,down:40}[a.toLowerCase()];return+a&&(n=+a),1==a.length&&(n=a.charCodeAt(0)),t.match(/^[Cc]trl/)&&!e.ctrlKey||t.match(/^[Aa]lt/)&&!e.altKey?void 0:e.keyCode==n},jb.component("feature.onKey",{type:"feature",category:"events",macroByValue:!0,params:[{id:"key",as:"string",description:"E.g., a,27,Enter,Esc,Ctrl+C or Alt+V"},{id:"action",type:"action",mandatory:!0,dynamic:!0},{id:"doNotWrapWithLauchingElement",as:"boolean",type:"boolean"}],impl:(e,t,a)=>({onkeydown:!0,afterViewInit:n=>jb.subscribe(n.onkeydown,i=>{jb.ui.checkKey(i,t)&&(e.params.doNotWrapWithLauchingElement?a(n.ctx):jb.ui.wrapWithLauchingElement(a,n.ctx,n.base)())})})}),jb.component("feature.onEnter",{type:"feature",category:"events",params:[{id:"action",type:"action[]",mandatory:!0,dynamic:!0}],impl:feature.onKey("Enter",call("action"))}),jb.component("feature.onEsc",{type:"feature",category:"events",params:[{id:"action",type:"action[]",mandatory:!0,dynamic:!0}],impl:feature.onKey("Esc",call("action"))}),jb.component("refresh-control-by-id",{type:"action",params:[{id:"id",as:"string",mandatory:!0},{id:"strongRefresh",as:"boolean",description:"rebuild the component and promises",type:"boolean"}],impl:(e,t)=>{const a=jb.ui.document(e).querySelector("#"+t);if(!a)return jb.logError("refresh-control-by-id can not find elem for #"+t,e);jb.ui.refreshElem(a,null,{srcCtx:e})}}),jb.component("group.auto-focus-on-first-input",{type:"feature",impl:e=>({afterViewInit:t=>{const a=Array.from(t.base.querySelectorAll("input,textarea,select")).filter(e=>"checkbox"!=e.getAttribute("type"))[0];a&&jb.ui.focus(a,"group.auto-focus-on-first-input",e)}})}),jb.component("focus-on-first-element",{type:"action",params:[{id:"selector",as:"string",defaultValue:"input"}],impl:(e,t)=>jb.delay(50).then(()=>{const a=document.querySelector(t);a&&jb.ui.focus(a,"focus-on-first-element",e)})}),jb.component("feature.byCondition",{type:"feature",description:"conditional feature, define feature if then else condition",macroByValue:!0,params:[{id:"condition",type:"boolean",as:"boolean",mandatory:!0},{id:"then",type:"feature",mandatory:!0,dynamic:!0,composite:!0},{id:"else",type:"feature",dynamic:!0}],impl:(e,t,a,n)=>t?a():n()}),function(){const e=jb.ui.withUnits,t=jb.ui.fixCssLine;jb.component("css",{description:"e.g. {color: red; width: 20px} or div>.myClas {color: red} ",type:"feature,dialog-feature",params:[{id:"css",mandatory:!0,as:"string"}],impl:(e,a)=>({css:t(a)})}),jb.component("css.dynamic",{description:"recalc the css on refresh/watchRef. e.g. {color: %$color%}",type:"feature,dialog-feature",params:[{id:"css",mandatory:!0,as:"string",dynamic:!0}],impl:(e,t)=>({dynamicCss:e=>t(e)})}),jb.component("css.with-condition",{description:"css with dynamic condition. e.g. .myclz {color: red}",type:"feature,dialog-feature",params:[{id:"condition",as:"boolean",mandatory:!0,dynamic:!0,type:"boolean"},{id:"css",mandatory:!0,as:"string",dynamic:!0}],impl:(e,a,n)=>({dynamicCss:e=>a(e)?t(n(e)):""})}),jb.component("css.class",{type:"feature,dialog-feature",params:[{id:"class",mandatory:!0,as:"string"}],impl:(e,t)=>({class:t})}),jb.component("css.width",{type:"feature,dialog-feature",params:[{id:"width",mandatory:!0,as:"string",description:"e.g. 200, 100%, calc(100% - 100px)"},{id:"overflow",as:"string",options:",auto,hidden,scroll"},{id:"minMax",as:"string",options:",min,max"},{id:"selector",as:"string"}],impl:(t,a,n,i)=>({css:`${t.params.selector} { ${i?i+"-":""}width: ${e(a)} ${n?"; overflow-x:"+n+";":""} }`})}),jb.component("css.height",{type:"feature,dialog-feature",params:[{id:"height",mandatory:!0,as:"string",description:"e.g. 200, 100%, calc(100% - 100px)"},{id:"overflow",as:"string",options:",auto,hidden,scroll"},{id:"minMax",as:"string",options:",min,max"},{id:"selector",as:"string"}],impl:(t,a,n,i)=>({css:`${t.params.selector} { ${i?i+"-":""}height: ${e(a)} ${n?"; overflow-y:"+n:""} }`})}),jb.component("css.opacity",{type:"feature",params:[{id:"opacity",mandatory:!0,as:"string",description:"0-1"},{id:"selector",as:"string"}],impl:(e,t)=>({css:`${e.params.selector} { opacity: ${t} }`})}),jb.component("css.padding",{type:"feature,dialog-feature",params:[{id:"top",as:"string",description:"e.g. 20, 20%, 0.4em"},{id:"left",as:"string"},{id:"right",as:"string"},{id:"bottom",as:"string"},{id:"selector",as:"string"}],impl:t=>{const a=["top","left","right","bottom"].filter(e=>null!=t.params[e]).map(a=>`padding-${a}: ${e(t.params[a])}`).join("; ");return{css:`${t.params.selector} {${a}}`}}}),jb.component("css.margin",{type:"feature,dialog-feature",params:[{id:"top",as:"string",description:"e.g. 20, 20%, 0.4em, -20"},{id:"right",as:"string"},{id:"bottom",as:"string"},{id:"left",as:"string"},{id:"selector",as:"string"}],impl:t=>{const a=["top","left","right","bottom"].filter(e=>null!=t.params[e]).map(a=>`margin-${a}: ${e(t.params[a])}`).join("; ");return{css:`${t.params.selector} {${a}}`}}}),jb.component("css.margin-all-sides",{type:"feature,dialog-feature",params:[{id:"value",as:"string",mandatory:!0,description:"e.g. 20, 20%, 0.4em"},{id:"selector",as:"string"}],impl:(t,a,n)=>({css:`${n} margin: ${e(a)}`})}),jb.component("css.margin-vertical-horizontal",{type:"feature,dialog-feature",params:[{id:"vertical",as:"string",mandatory:!0},{id:"horizontal",as:"string",mandatory:!0},{id:"selector",as:"string"}],impl:(t,a,n,i)=>({css:`${i} margin: ${e(a)+" "+e(n)}`})}),jb.component("css.transform-rotate",{type:"feature",params:[{id:"angle",as:"string",description:"0-360"},{id:"selector",as:"string"}],impl:(e,t,a)=>({css:`${a} {transform:rotate(${t}deg)}`})}),jb.component("css.color",{type:"feature",params:[{id:"color",as:"string"},{id:"background",as:"string"},{id:"selector",as:"string"}],impl:(e,t)=>{const a=["color","background"].filter(t=>e.params[t]).map(t=>`${t}: ${e.params[t]}`).join("; ");return a&&{css:`${e.params.selector} {${a}}`}}}),jb.component("css.transform-scale",{type:"feature",params:[{id:"x",as:"string",description:"0-1"},{id:"y",as:"string",description:"0-1"},{id:"selector",as:"string"}],impl:e=>({css:`${e.params.selector} {transform:scale(${e.params.x},${e.params.y})}`})}),jb.component("css.bold",{type:"feature",impl:e=>({css:"{font-weight: bold}"})}),jb.component("css.underline",{type:"feature",impl:e=>({css:"{text-decoration: underline}"})}),jb.component("css.box-shadow",{type:"feature,dialog-feature",params:[{id:"blurRadius",as:"string",templateValue:"5"},{id:"spreadRadius",as:"string",templateValue:"0"},{id:"shadowColor",as:"string",templateValue:"#000000"},{id:"opacity",as:"string",templateValue:.5,description:"0-1"},{id:"horizontal",as:"string",templateValue:"10"},{id:"vertical",as:"string",templateValue:"10"},{id:"selector",as:"string"}],impl:(t,a,n,i,r,o,s,l)=>{const c=[parseInt(i.slice(1,3),16)||0,parseInt(i.slice(3,5),16)||0,parseInt(i.slice(5,7),16)||0].join(",");return{css:`${l} { box-shadow: ${e(o)} ${e(s)} ${e(a)} ${e(n)} rgba(${c},${r}) }`}}}),jb.component("css.border",{type:"feature,dialog-feature",params:[{id:"width",as:"string",defaultValue:"1"},{id:"side",as:"string",options:"top,left,bottom,right"},{id:"style",as:"string",options:"solid,dotted,dashed,double,groove,ridge,inset,outset",defaultValue:"solid"},{id:"color",as:"string",defaultValue:"black"},{id:"selector",as:"string"}],impl:(t,a,n,i,r,o)=>({css:`${o} { border${n?"-"+n:""}: ${e(a)} ${i} ${r} }`})}),jb.component("css.line-clamp",{type:"feature",description:"ellipsis after X lines",params:[{id:"lines",mandatory:!0,as:"string",templateValue:3,description:"no of lines to clump"},{id:"selector",as:"string"}],impl:css("%$selector% { overflow: hidden; text-overflow: ellipsis; -webkit-box-orient: vertical; display: -webkit-box; -webkit-line-clamp: %$lines% }")}),jb.component("css.layout",{type:"feature:0",params:[{id:"css",mandatory:!0,as:"string"}],impl:(e,a)=>({css:t(a)})}),jb.component("css.typography",{type:"feature:0",params:[{id:"css",mandatory:!0,as:"string"}],impl:(e,a)=>({css:t(a)})})}(),jb.ns("text"),jb.component("text",{type:"control",category:"control:100,common:100",params:[{id:"text",as:"ref",mandatory:!0,templateValue:"my text",dynamic:!0},{id:"title",as:"ref",mandatory:!0,templateValue:"my title",dynamic:!0},{id:"style",type:"text.style",defaultValue:text.span(),dynamic:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e)}),jb.component("label",{...jb.comps.text,type:"depricated-control"}),jb.component("text.bind-text",{type:"feature",category:"text:0",impl:features(watchAndCalcModelProp("text",({data:e})=>jb.ui.toVdomOrStr(e)),()=>({studioFeatures:{$:"feature.content-editable",param:"text"}}))}),jb.component("text.allow-asynch-value",{type:"feature",impl:features(calcProp({id:"text",value:(e,{cmp:t})=>t.text||e.vars.$props.text}),interactive((e,{cmp:t})=>{if(t.text)return;const a=jb.ui.toVdomOrStr(e.vars.$model.text(t.ctx));a&&"function"==typeof a.then&&a.then(a=>t.refresh({text:jb.ui.toVdomOrStr(a)},{srcCtx:e.componentContext}))}))}),jb.component("text.htmlTag",{type:"text.style",params:[{id:"htmlTag",as:"string",defaultValue:"p",options:"span,p,h1,h2,h3,h4,h5,div,li,article,aside,details,figcaption,figure,footer,header,main,mark,nav,section,summary,label"},{id:"cssClass",as:"string"}],impl:customStyle({template:(e,{text:t,htmlTag:a,cssClass:n},i)=>i(a,{class:n},t),features:text.bindText()})}),jb.component("text.no-wrapping-tag",{type:"text.style",category:"text:0",impl:customStyle({template:(e,{text:t},a)=>t,features:text.bindText()})}),jb.component("text.span",{type:"text.style",impl:customStyle({template:(e,{text:t},a)=>a("span",{},t),features:text.bindText()})}),[1,2,3,4,5,6].map(e=>jb.component(`header.h${e}`,{type:"text.style",impl:customStyle({template:(t,{text:a},n)=>n(`h${e}`,{},a),features:text.bindText()})})),[1,2,3,4,5,6].map(e=>jb.component(`header.mdc-headline${e}`,{type:"text.style",impl:customStyle({template:(t,{text:a},n)=>n("h2",{class:`mdc-typography mdc-typography--headline${e}`},a),features:text.bindText()})})),[1,2].map(e=>jb.component(`header.mdc-subtitle${e}`,{type:"text.style",impl:customStyle({template:(t,{text:a},n)=>n("h2",{class:`mdc-typography mdc-typography--subtitle${e}`},a),features:text.bindText()})})),[1,2].map(e=>jb.component(`text.mdc-body${e}`,{type:"text.style",impl:customStyle({template:(t,{text:a},n)=>n("h2",{class:`mdc-typography mdc-typography--body${e}`},a),features:text.bindText()})})),jb.component("text.highlight",{type:"data",macroByValue:!0,params:[{id:"base",as:"string",dynamic:!0},{id:"highlight",as:"string",dynamic:!0},{id:"cssClass",as:"string",defaultValue:"mdl-color-text--deep-purple-A700"}],impl:(e,t,a,n)=>{const i=a(),r=t();if(!i||!r)return r;const o=(r.match(new RegExp(i,"i"))||[])[0];return o?jb.ui.h("div",{},[r.split(o)[0],jb.ui.h("span",{class:n},o),r.split(o).slice(1).join(o)]):r}}),jb.ns("group,layout,tabs"),jb.component("group",{type:"control",category:"group:100,common:90",params:[{id:"title",as:"string",dynamic:!0},{id:"layout",type:"layout"},{id:"style",type:"group.style",defaultValue:group.div(),mandatory:!0,dynamic:!0},{id:"controls",type:"control[]",mandatory:!0,flattenArray:!0,dynamic:!0,composite:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e,e.params.layout)}),jb.component("group.init-group",{type:"feature",category:"group:0",impl:calcProp({id:"ctrls",value:"%$$model.controls%"})}),jb.component("inline-controls",{type:"control",description:"controls without a wrapping group",params:[{id:"controls",type:"control[]",mandatory:!0,flattenArray:!0,dynamic:!0,composite:!0}],impl:e=>e.params.controls().filter(e=>e)}),jb.component("dynamic-controls",{type:"control",description:"calculated controls by data items without a wrapping group",params:[{id:"controlItems",type:"data",as:"array",mandatory:!0,dynamic:!0},{id:"genericControl",type:"control",mandatory:!0,dynamic:!0},{id:"itemVariable",as:"string",defaultValue:"controlItem"},{id:"indexVariable",as:"string"}],impl:(e,t,a,n,i)=>(t()||[]).map((t,r)=>jb.tosingle(a(e.setVar(n,t).setVar(i,r).setData(t))))}),jb.component("group.first-succeeding",{type:"feature",category:"group:70",description:"Used with controlWithCondition. Takes the fhe first succeeding control",impl:features(()=>({calcHash:e=>jb.asArray(e.vars.$model.controls.profile).reduce((t,a,n)=>{if(t)return t;return null==a.condition||e.vars.$model.ctx.setVars(e.vars).runInner(a.condition,{as:"boolean"},`controls.${n}.condition`)?n+1:void 0},null)}),calcProp({id:"ctrls",value:e=>{const t=e.vars.$props.cmpHash-1;if(isNaN(t))return[];const a=jb.asArray(e.vars.$model.controls.profile)[t];return[e.vars.$model.ctx.setVars(e.vars).runInner(a,{type:"control"},`controls.${t}`)]},priority:5}))}),jb.component("control-with-condition",{type:"control",description:"Used with group.firstSucceeding",category:"group:10",macroByValue:!0,params:[{id:"condition",type:"boolean",dynamic:!0,mandatory:!0,as:"boolean"},{id:"control",type:"control",mandatory:!0,dynamic:!0},{id:"title",as:"string"}],impl:(e,t,a)=>t(e)&&a(e)}),jb.component("group.wait",{type:"feature",category:"group:70",description:"wait for asynch data before showing the control",params:[{id:"for",mandatory:!0,dynamic:!0},{id:"loadingControl",type:"control",defaultValue:text("loading ..."),dynamic:!0},{id:"error",type:"control",defaultValue:text("error: %$error%"),dynamic:!0},{id:"varName",as:"string"}],impl:features(calcProp({id:"ctrls",value:(e,{cmp:t},{loadingControl:a,error:n})=>{const i=t.state.error?n():a(e);return"itemlist"==t.ctx.profile.$?[[i]]:[i]},priority:e=>jb.path(e.vars.$state,"dataArrived")?0:10}),interactive((e,{cmp:t},{varName:a})=>!t.state.dataArrived&&!t.state.error&&Promise.resolve(e.componentContext.params.for()).then(n=>t.refresh({dataArrived:!0},{srcCtx:e.componentContext,extendCtx:e=>e.setVar(a,n).setData(n)})).catch(e=>t.refresh({error:JSON.stringify(e)}))))}),jb.ns("html"),jb.component("html",{type:"control",description:"rich text",category:"control:100,common:80",params:[{id:"title",as:"string",mandatory:!0,templateValue:"html",dynamic:!0},{id:"html",as:"ref",mandatory:!0,templateValue:"<p>html here</p>",dynamic:!0},{id:"style",type:"html.style",defaultValue:html.plain(),dynamic:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e)}),jb.component("html.plain",{type:"html.style",impl:customStyle({template:(e,{html:t},a)=>a("html",{$html:t,jb_external:!0}),features:[watchAndCalcModelProp("html"),()=>({studioFeatures:{$:"feature.content-editable",param:"html"}})]})}),jb.component("html.in-iframe",{type:"html.style",params:[{id:"width",as:"string",defaultValue:"100%"},{id:"height",as:"string",defaultValue:"100%"}],impl:customStyle({template:(e,{width:t,height:a},n)=>n("iframe",{sandbox:"allow-same-origin allow-forms allow-scripts",frameborder:0,width:t,height:a,src:"javascript: document.write(parent.contentForIframe)"}),features:[interactiveProp("html","%$$model/html%"),interactive(({},{cmp:e})=>window.contentForIframe=e.html)]})}),jb.ns("image,css"),jb.component("image",{type:"control,image",category:"control:50,common:70",params:[{id:"url",as:"string",mandatory:!0,templateValue:"https://freesvg.org/img/UN-CONSTRUCTION-2.png"},{id:"width",as:"string",mandatory:!0,templateValue:"100",description:"e.g: 100, 20%"},{id:"height",as:"string",mandatory:!0,description:"e.g: 100, 20%"},{id:"resize",type:"image.resize",description:"background-size, resize the image",defaultValue:image.fullyVisible()},{id:"position",type:"image.position",description:"move/shift image"},{id:"style",type:"image.style",dynamic:!0,defaultValue:image.background()},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e,{studioFeatures:{$:"feature.content-editable"}})}),jb.component("image.width-height",{type:"image.resize",description:"fixed size or precentage of the original",params:[{id:"width",as:"string",description:"e.g: 100, 20%"},{id:"height",as:"string",description:"e.g: 100, 20%"}],impl:(e,t,a)=>[jb.ui.withUnits(t)||"auto",jb.ui.withUnits(a)||"auto"].join(" ")}),jb.component("image.cover",{description:"auto resize or crop to cover all area",type:"image.resize",impl:"cover"}),jb.component("image.fully-visible",{description:"contain, auto resize to ensure the image is fully visible",type:"image.resize",impl:"contain"}),jb.component("image.position",{description:"offset move shift original image",type:"image.position",params:[{id:"x",as:"string",description:"e.g. 7, 50%, right"},{id:"y",as:"string",description:"e.g. 10, 50%, bottom"}],impl:(e,t,a)=>[t&&`x: ${jb.ui.withUnits(t)}`,a&&`y: ${jb.ui.withUnits(a)}`].filter(e=>e).map(e=>`background-position-${e}`).join(";")}),jb.component("image.background",{type:"image.style",impl:customStyle({template:(e,t,a)=>a("div"),css:pipeline(Var("url",(e,{$model:t})=>t.url.replace(/__WIDTH__/,t.width).replace(/__HEIGHT__/,t.height)),Var("width",(e,{$model:t})=>jb.ui.withUnits(t.width)),Var("height",(e,{$model:t})=>jb.ui.withUnits(t.height)),"\n      { \n          background-image: url('%$url%');\n          {? background-size: %$$model/resize%; ?}\n          {? %$$model/position%; ?}\n          background-repeat: no-repeat;\n          {?width: %$width%; ?}\n          {?height: %$height%; ?}\n      }")})}),jb.component("image.img",{type:"image.style",impl:customStyle({features:calcProp("url","%$$model/url%"),template:({},{url:e},t)=>t("img",{src:e}),css:pipeline(Var("width",(e,{$model:t})=>jb.ui.withUnits(t.width)),Var("height",(e,{$model:t})=>jb.ui.withUnits(t.height)),"\n      { \n          {?width: %$width%; ?}\n          {?height: %$height%; ?}\n      }")})}),jb.ns("button"),jb.component("button",{type:"control,clickable",category:"control:100,common:100",params:[{id:"title",as:"ref",mandatory:!0,templateValue:"click me",dynamic:!0},{id:"action",type:"action",mandatory:!0,dynamic:!0},{id:"style",type:"button.style",defaultValue:button.mdc(),dynamic:!0},{id:"raised",as:"boolean",dynamic:!0,type:"boolean"},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e,e.run(features(watchAndCalcModelProp("title"),watchAndCalcModelProp("raised"),defHandler("onclickHandler",(e,{cmp:t,ev:a})=>{a&&a.ctrlKey&&t.ctrlAction?t.ctrlAction(t.ctx.setVar("event",a)):a&&a.altKey&&t.altAction?t.altAction(t.ctx.setVar("event",a)):t.action&&t.action(t.ctx.setVar("event",a))}),interactive(({},{cmp:t})=>t.action=jb.ui.wrapWithLauchingElement(e.params.action,t.ctx,t.base)),e=>({studioFeatures:{$:"feature.content-editable",param:"title"}}))))}),jb.component("ctrl-action",{type:"feature",category:"button:70",description:"action to perform on control+click",params:[{id:"action",type:"action",mandatory:!0,dynamic:!0}],impl:interactive((e,{cmp:t},{action:a})=>t.ctrlAction=jb.ui.wrapWithLauchingElement(a,e,t.base))}),jb.component("alt-action",{type:"feature",category:"button:70",description:"action to perform on alt+click",params:[{id:"action",type:"action",mandatory:!0,dynamic:!0}],impl:interactive((e,{cmp:t},{action:a})=>t.altAction=jb.ui.wrapWithLauchingElement(a,e,t.base))}),jb.component("button-disabled",{type:"feature",category:"button:70",description:"define condition when button is enabled",params:[{id:"enabledCondition",type:"boolean",mandatory:!0,dynamic:!0}],impl:interactive((e,{cmp:t},{enabledCondition:a})=>t.isEnabled=t=>a(e.extendVars(t)))}),function(){function e(e,t,a,n){jb.ui.checkValidationError(t,a),jb.writeValue(e.vars.$model.databind(t.ctx),a,e),!n&&jb.ui.refreshElem(t.base,null,{srcCtx:e.componentContext})}jb.ui.field_id_counter=jb.ui.field_id_counter||0,jb.component("field.databind",{type:"feature",category:"field:0",params:[{id:"debounceTime",as:"number",defaultValue:0},{id:"oneWay",type:"boolean",as:"boolean"}],impl:features(If("%$oneWay%",calcProp({id:"databind",value:"%$$model/databind%"}),watchAndCalcModelProp("databind")),calcProp({id:"title",value:"%$$model/title%"}),calcProp({id:"fieldId",value:()=>jb.ui.field_id_counter++}),defHandler("onblurHandler",(t,{cmp:a,ev:n},{oneWay:i})=>e(t,a,n.target.value,i)),defHandler("onchangeHandler",(t,{$model:a,cmp:n,ev:i},{oneWay:r})=>!a.updateOnBlur&&e(t,n,i.target.value,r)),defHandler("onkeyupHandler",(t,{$model:a,cmp:n,ev:i},{oneWay:r})=>!a.updateOnBlur&&e(t,n,i.target.value,r)),defHandler("onkeydownHandler",(t,{$model:a,cmp:n,ev:i},{oneWay:r})=>!a.updateOnBlur&&e(t,n,i.target.value,r)),interactiveProp("jbModel",(t,{cmp:a})=>n=>null==n?t.exp("%$$mode/databind","number"):e(t,a,{target:{value:n}},!0)))}),jb.ui.checkValidationError=(e,t)=>{const a=function(){if(!e.validations)return;const a=e.ctx.setData(t),n=(e.validations||[]).filter(e=>!e.validCondition(a)).map(e=>e.errorMessage(a))[0];a.exp("formContainer")&&a.run(writeValue("%$formContainer/err%",n));return n}();e.state.error!=a&&(jb.log("field",["setErrState",e,a]),e.refresh({valid:!a,error:a}))},jb.ui.fieldTitle=function(e,t,a){let n=t.field&&t.field()||t;if((n="function"==typeof n?n():n).titleCtrl){const t=e.ctx.setData(n).setVars({input:e.ctx.data}),i=n.titleCtrl(t);return i&&a(i,{"jb-ctx":jb.ui.preserveCtx(t)})}return n.title(e.ctx)},jb.ui.preserveFieldCtxWithItem=(e,t)=>{const a=jb.ctxDictionary[e.ctxId];return a&&jb.ui.preserveCtx(a.setData(t))},jb.component("field.databind-text",{type:"feature",category:"field:0",params:[{id:"debounceTime",as:"number",defaultValue:0},{id:"oneWay",type:"boolean",as:"boolean",defaultValue:!0}],impl:field.databind("%$debounceTime%","%$oneWay%")}),jb.component("field.keyboard-shortcut",{type:"feature",category:"events",description:"listen to events at the document level even when the component is not active",params:[{id:"key",as:"string",description:"e.g. Alt+C"},{id:"action",type:"action",dynamic:!0}],impl:interactive((e,{cmp:t},{key:a,action:n})=>{const i=t.base.querySelector("input")||t.base;void 0===i.tabIndex&&(i.tabIndex=-1),jb.callbag.forEach(jb.ui.fromEvent(t,"keydown",i))(e=>{const t=a.split("+").slice(1).join("+"),i=t.charCodeAt(0);"Delete"==a&&(i=46);const r=(a.match("([A-Za-z]*)+")||["",""])[1];("Ctrl"!=r||e.ctrlKey)&&("Alt"!=r||e.altKey)&&(e.keyCode==i||e.key&&e.key==t)&&n()})})}),jb.component("field.toolbar",{type:"feature",params:[{id:"toolbar",type:"control",mandatory:!0,dynamic:!0}],impl:(e,t)=>({toolbar:t()})}),jb.component("validation",{type:"feature",category:"validation:100",params:[{id:"validCondition",mandatory:!0,as:"boolean",dynamic:!0,type:"boolean"},{id:"errorMessage",mandatory:!0,as:"string",dynamic:!0}],impl:interactive((e,{cmp:t},{validCondition:a,errorMessage:n})=>{if(t.validations=(t.validations||[]).concat([{validCondition:a,errorMessage:n}]),jb.ui.inPreview()){const i=e.setData(t.state.model);a(i),n(i)}})}),jb.component("field.title",{description:"used to set table title in button and label",type:"feature",category:"table:80",params:[{id:"title",as:"string",dynamic:!0,mandatory:!0}],impl:(e,t)=>({enrichField:e=>e.title=e=>t(e)})}),jb.component("field.title-ctrl",{description:"title as control, buttons are usefull",type:"feature",category:"table:80",params:[{id:"titleCtrl",type:"control",mandatory:!0,dynamic:!0,templateValue:button({title:"%title%",style:button.href()})}],impl:(e,t)=>({enrichField:e=>e.titleCtrl=e=>t(e)})}),jb.component("field.column-width",{description:"used in itemlist fields",type:"feature",category:"table:80",params:[{id:"width",as:"number",mandatory:!0}],impl:(e,t)=>({enrichField:e=>e.width=t})})}(),jb.ns("editableText"),jb.ns("dialog"),jb.component("editable-text",{type:"control",category:"input:100,common:80",params:[{id:"title",as:"string",dynamic:!0},{id:"databind",as:"ref",mandaroy:!0,dynamic:!0},{id:"updateOnBlur",as:"boolean",type:"boolean"},{id:"style",type:"editable-text.style",defaultValue:editableText.mdcInput(),dynamic:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e)}),jb.component("editable-text.x-button",{type:"feature",impl:features(defHandler("cleanValue",writeValue("%$$model/databind%","")),templateModifier(({},{vdom:e,databind:t})=>jb.ui.h("div",{},[e,...t?[jb.ui.h("button",{class:"delete",onclick:"cleanValue"},"")]:[]])),css(">.delete {\n          margin-left: -16px;\n          float: right;\n          cursor: pointer; font: 20px sans-serif;\n          border: none; background: transparent; color: #000;\n          text-shadow: 0 1px 0 #fff; opacity: .1;\n      }\n      { display : flex }\n      >.delete:hover { opacity: .5 }"))}),jb.component("editable-text.helper-popup",{type:"feature",params:[{id:"control",type:"control",dynamic:!0,mandatory:!0},{id:"popupId",as:"string",mandatory:!0},{id:"popupStyle",type:"dialog.style",dynamic:!0,defaultValue:dialog.popup()},{id:"showHelper",as:"boolean",dynamic:!0,defaultValue:notEmpty("%value%"),description:"show/hide helper according to input content",type:"boolean"},{id:"autoOpen",as:"boolean",type:"boolean"},{id:"onEnter",type:"action",dynamic:!0},{id:"onEsc",type:"action",dynamic:!0}],impl:e=>({onkeyup:!0,afterViewInit:t=>{const a=jb.ui.findIncludeSelf(t.base,"input")[0];if(!a)return;const{pipe:n,filter:i,subscribe:r,delay:o}=jb.callbag;t.openPopup=jb.ui.wrapWithLauchingElement(t=>t.run(openDialog({id:e.params.popupId,style:t=>e.params.popupStyle(t),content:t=>e.params.control(t),features:[dialogFeature.maxZIndexOnClick(),dialogFeature.uniqueDialog(e.params.popupId)]})),t.ctx,t.base),t.popup=t=>jb.ui.dialogs.dialogs.filter(t=>t.id==e.params.popupId)[0],t.closePopup=e=>t.popup()&&t.popup().close(),t.refreshSuggestionPopupOpenClose=n=>{const i=e.params.showHelper(t.ctx.setData(a));jb.log("helper-popup",["refreshSuggestionPopupOpenClose",i,a.value,t.ctx,t,e]),i?t.popup()||(jb.log("helper-popup",["open popup",i,a.value,t.ctx,t,e]),t.openPopup(t.ctx)):(jb.log("helper-popup",["close popup",i,a.value,t.ctx,t,e]),t.closePopup())},t.selectionKeySource=!0,t.input=a;const s=t.keyup=n(t.onkeyup,o(1));t.onkeydown=jb.ui.upDownEnterEscObs(t),n(t.onkeydown,i(e=>13==e.keyCode),r(n=>{const i=e.params.showHelper(t.ctx.setData(a));jb.log("helper-popup",["onEnter",i,a.value,t.ctx,t,e]),i||e.params.onEnter(t.ctx)})),jb.subscribe(s,a=>27==a.keyCode&&e.params.onEsc(t.ctx)),jb.subscribe(s,e=>-1==[13,27,37,38,40].indexOf(e.keyCode)&&t.refreshSuggestionPopupOpenClose()),jb.subscribe(s,e=>27==e.keyCode&&t.closePopup()),e.params.autoOpen&&t.refreshSuggestionPopupOpenClose()},destroy:e=>e.closePopup()})}),jb.ns("editableBoolean"),jb.component("editable-boolean",{type:"control",category:"input:20",params:[{id:"databind",as:"ref",type:"boolean",mandaroy:!0,dynamic:!0,aa:5},{id:"style",type:"editable-boolean.style",defaultValue:editableBoolean.checkbox(),dynamic:!0},{id:"title",as:"string",dynamic:!0},{id:"textForTrue",as:"string",defaultValue:"yes",dynamic:!0},{id:"textForFalse",as:"string",defaultValue:"no",dynamic:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e,features(calcProp("text",data.if("%$$model/databind%","%$$model/textForTrue%","%$$model/textForFalse%")),defHandler("toggle",writeValue("%$$model/databind%",not("%$$model/databind%"))),defHandler("setChecked",writeValue("%$$model/databind%","true"))))}),jb.component("editable-boolean.keyboard-support",{type:"feature",impl:feature.onEvent({event:"click",action:action.if(()=>37==event.keyCode||39==event.keyCode,writeValue("%$$model/databind%",not("%$$model/databind%")))})}),jb.ns("editableNumber"),jb.component("editable-number",{type:"control",category:"input:30",params:[{id:"databind",as:"ref",mandaroy:!0,dynamic:!0},{id:"title",as:"string",dynamic:!0},{id:"style",type:"editable-number.style",defaultValue:editableText.mdcInput(),dynamic:!0},{id:"symbol",as:"string",description:"leave empty to parse symbol from value"},{id:"min",as:"number",defaultValue:0},{id:"max",as:"number",defaultValue:100},{id:"displayString",as:"string",dynamic:!0,defaultValue:"%$Value%%$Symbol%"},{id:"dataString",as:"string",dynamic:!0,defaultValue:"%$Value%%$Symbol%"},{id:"autoScale",as:"boolean",defaultValue:!0,description:"adjust its scale if at edges",type:"boolean"},{id:"step",as:"number",defaultValue:1,description:"used by slider"},{id:"initialPixelsPerUnit",as:"number",description:"used by slider"},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>{return jb.ui.ctrl(e.setVars({editableNumber:new class{constructor(e){Object.assign(this,e),null==this.min&&(this.min=NaN),null==this.max&&(this.max=NaN)}numericPart(e){if(!e)return NaN;var t=(""+e).match(/([^0-9\.\-]*)([0-9\.\-]+)([^0-9\.\-]*)/);return!this.symbol&&t&&(this.symbol=t[1]||t[3]||this.symbol),t&&t[2]||""}calcDisplayString(e,t){return isNaN(e)?this.placeholder||"":this.displayString(t.setVars({Value:""+e,Symbol:this.symbol}))}calcDataString(e,t){return isNaN(e)?"":this.dataString(t.setVars({Value:""+e,Symbol:this.symbol}))}}(e.params)}))}}),jb.component("open-dialog",{type:"action",params:[{id:"id",as:"string"},{id:"style",type:"dialog.style",dynamic:!0,defaultValue:dialog.default()},{id:"content",type:"control",dynamic:!0,templateValue:group({})},{id:"menu",type:"control",dynamic:!0},{id:"title",as:"renderable",dynamic:!0},{id:"onOK",type:"action",dynamic:!0},{id:"modal",type:"boolean",as:"boolean"},{id:"features",type:"dialog-feature[]",dynamic:!0}],impl:function(e,t){const a={id:t,modal:e.params.modal,em:jb.callbag.subject()},n=e.setVars({$dialog:a,dialogData:{},formContainer:{err:""}});return a.content=()=>jb.ui.dialogs.buildComp(n).renderVdom(),e.probe||jb.ui.dialogs.addDialog(a,n),a}}),jb.component("dialog.close-containing-popup",{description:"close parent dialog",type:"action",params:[{id:"OK",type:"boolean",as:"boolean",defaultValue:!0}],impl:(e,t)=>e.vars.$dialog&&e.vars.$dialog.close({OK:t})}),jb.component("dialog-feature.unique-dialog",{description:"automatic close dialogs of the same id",type:"dialog-feature",params:[{id:"id",as:"string"},{id:"remeberLastLocation",type:"boolean",as:"boolean"}],impl:function(e,t,a){if(!t)return;const n=e.vars.$dialog;n.id=t,jb.subscribe(n.em,e=>"new-dialog"==e.type&&e.dialog!=n&&e.dialog.id==t&&n.close())}}),jb.component("dialog-feature.drag-title",{type:"dialog-feature",params:[{id:"id",as:"string"}],impl:function(e,t){const a=e.vars.$dialog,{pipe:n,fromEvent:i,takeUntil:r,merge:o,Do:s,map:l,flatMap:c,distinctUntilChanged:d,fromPromise:p,forEach:m}=jb.callbag;return{css:">.dialog-title { cursor: pointer }",afterViewInit:function(e){const d=e.base.querySelector(".dialog-title"),u=p(e.destroyed);if(e.mousedownEm=n(i(d,"mousedown"),r(u)),t&&sessionStorage.getItem(t)){const e=JSON.parse(sessionStorage.getItem(t));a.el.style.top=e.top+"px",a.el.style.left=e.left+"px"}let b=n(i(document,"mouseup"),r(u)),f=n(i(document,"mousemove"),r(u));jb.studio.previewWindow&&(b=o(b,n(i(jb.studio.previewWindow.document,"mouseup")),r(u)),f=o(f,n(i(jb.studio.previewWindow.document,"mousemove")),r(u))),n(e.mousedownEm,s(e=>e.preventDefault()),l(e=>({left:e.clientX-a.el.getBoundingClientRect().left,top:e.clientY-a.el.getBoundingClientRect().top})),c(e=>n(f,r(b),l(t=>({top:Math.max(0,t.clientY-e.top),left:Math.max(0,t.clientX-e.left)})))),m(e=>{a.el.style.top=e.top+"px",a.el.style.left=e.left+"px",t&&sessionStorage.setItem(t,JSON.stringify(e))}))}}}}),jb.component("dialog.default",{type:"dialog.style",impl:customStyle({template:(e,{title:t,contentComp:a},n)=>n("div",{class:"jb-dialog jb-default-dialog"},[n("div",{class:"dialog-title"},t),n("button",{class:"dialog-close",onclick:"dialogClose"},""),n(a)]),features:dialogFeature.dragTitle()})}),jb.component("dialog-feature.near-launcher-position",{type:"dialog-feature",params:[{id:"offsetLeft",as:"number",dynamic:!0,defaultValue:0},{id:"offsetTop",as:"number",dynamic:!0,defaultValue:0},{id:"rightSide",as:"boolean",type:"boolean"}],impl:function(e,t,a,n){return{afterViewInit:function(i){let r=t()||0,o=a()||0;if(!e.vars.$launchingElement)return console.log("no launcher for dialog");const s=e.vars.$launchingElement.el,l=e.vars.$launchingElement.launcherHeightFix||jb.ui.outerHeight(s),c=jb.ui.offset(s),d=jb.ui.findIncludeSelf(i.base,".jb-dialog")[0],p=function(e,t,a,n){let i,r;const o=jb.ui.offset(e),s=jb.ui.outerHeight(t),l=jb.ui.outerWidth(t);o.top>s&&o.top+s+2+(n||0)>window.innerHeight+window.pageYOffset&&(i=o.top-s);o.left>l&&o.left+l+2+(a||0)>window.innerWidth+window.pageXOffset&&(r=o.left-l);if(i||r)return{top:i||o.top,left:r||o.left}}(s,d,r+=n?jb.ui.outerWidth(s):0,o);d.style.display="block",d.style.left=(p?p.left:c.left+r)+"px",d.style.top=(p?p.top:c.top+l+o)+"px"}}}}),jb.component("dialog-feature.onClose",{type:"dialog-feature",params:[{id:"action",type:"action",dynamic:!0}],impl:(e,t)=>{const{pipe:a,filter:n,subscribe:i,take:r}=jb.callbag;return a(e.vars.$dialog.em,n(e=>"close"==e.type),r(1),i(a=>t(e.setData(a.OK))))}}),jb.component("dialog-feature.close-when-clicking-outside",{type:"dialog-feature",params:[{id:"delay",as:"number",defaultValue:100}],impl:function(e,t){const a=e.vars.$dialog;a.isPopup=!0,jb.delay(10).then(()=>{const{pipe:e,fromEvent:n,takeUntil:i,subscribe:r,merge:o,filter:s,take:l,delay:c}=jb.callbag;let d=n(document,"mousedown");jb.studio.previewWindow&&(d=o(d,n((jb.studio.previewWindow||{}).document,"mousedown"))),e(d,s(e=>null==jb.ui.closest(e.target,".jb-dialog")),i(e(a.em,s(e=>"close"==e.type))),l(1),c(t),r(()=>a.close()))})}}),jb.component("dialog.close-dialog",{type:"action",params:[{id:"id",as:"string"},{id:"delay",as:"number",defaultValue:200}],impl:(e,t,a)=>jb.ui.dialogs.closeDialogs(jb.ui.dialogs.dialogs.filter(e=>e.id==t))}),jb.component("dialog.close-all",{type:"action",impl:e=>jb.ui.dialogs.closeAll()}),jb.component("dialog-feature.auto-focus-on-first-input",{type:"dialog-feature",params:[{id:"selectText",as:"boolean",type:"boolean"}],impl:(e,t)=>({afterViewInit:a=>{jb.delay(1).then(a=>{const n=e.vars.$dialog.el.querySelector("input,textarea,select");n&&jb.ui.focus(n,"dialog-feature.auto-focus-on-first-input",e),t&&n.select()})}})}),jb.component("dialog-feature.css-class-on-launching-element",{type:"dialog-feature",impl:e=>({afterViewInit:t=>{const{pipe:a,filter:n,subscribe:i,take:r}=jb.callbag,o=e.vars.$dialog,s=e.vars.$launchingElement.el;jb.ui.addClass(s,"dialog-open"),a(o.em,n(e=>"close"==e.type),r(1),i(()=>jb.ui.removeClass(s,"dialog-open")))}})}),jb.component("dialog-feature.max-zIndex-on-click",{type:"dialog-feature",params:[{id:"minZIndex",as:"number"}],impl:function(e,t){const a=e.vars.$dialog;return{afterViewInit:e=>{n(),a.el.onmousedown=n}};function n(){const e=jb.ui.dialogs.dialogs.reduce((e,t)=>Math.max(e,t.el&&parseInt(t.el.style.zIndex||100)+1||100),t||100);a.el.style.zIndex=e}}}),jb.component("dialog.dialog-ok-cancel",{type:"dialog.style",params:[{id:"okLabel",as:"string",defaultValue:"OK"},{id:"cancelLabel",as:"string",defaultValue:"Cancel"}],impl:customStyle({template:(e,{title:t,contentComp:a,cancelLabel:n,okLabel:i},r)=>r("div",{class:"jb-dialog jb-default-dialog"},[r("div",{class:"dialog-title"},t),r("button",{class:"dialog-close",onclick:"dialogClose"},""),r(a),r("div",{class:"dialog-buttons"},[r("button",{class:"mdc-button",onclick:"dialogClose"},n),r("button",{class:"mdc-button",onclick:"dialogCloseOK"},i)])]),css:">.dialog-buttons { display: flex; justify-content: flex-end; margin: 5px }"})}),jb.component("dialog-feature.resizer",{type:"dialog-feature",params:[{id:"resizeInnerCodemirror",as:"boolean",description:"effective only for dialog with a single codemirror element",type:"boolean"}],impl:(e,t)=>({templateModifier:(e,t,a)=>e&&"div"!=e.tag?e:(e.children.push(jb.ui.h("img",{class:"jb-resizer"})),e),css:">.jb-resizer { cursor: pointer; position: absolute; right: 1px; bottom: 1px }",afterViewInit:function(e){const a=e.base.querySelector(".jb-resizer"),{pipe:n,map:i,flatMap:r,takeUntil:o,merge:s,subscribe:l,Do:c}=jb.callbag;e.mousedownEm=jb.ui.fromEvent(e,"mousedown",a);let d,p,m=jb.ui.fromEvent(e,"mouseup",document),u=jb.ui.fromEvent(e,"mousemove",document);jb.studio.previewWindow&&(m=s(m,jb.ui.fromEvent(e,"mouseup",jb.studio.previewWindow.document)),u=s(u,jb.ui.fromEvent(e,"mousemove",jb.studio.previewWindow.document))),n(e.mousedownEm,c(a=>{t&&(d=e.base.querySelector(".CodeMirror,.jb-textarea-alternative-for-codemirror"))&&(p=d.getBoundingClientRect().top-e.base.getBoundingClientRect().top+(e.base.getBoundingClientRect().bottom-d.getBoundingClientRect().bottom))}),i(t=>({left:e.base.getBoundingClientRect().left,top:e.base.getBoundingClientRect().top})),r(e=>n(u,o(m),i(t=>({top:t.clientY-e.top,left:t.clientX-e.left})))),l(t=>{e.base.style.height=t.top+"px",e.base.style.width=t.left+"px",d&&(d.style.height=t.top-p+"px")}))}})}),jb.component("dialog.popup",{type:"dialog.style",impl:customStyle({template:(e,t,a)=>a("div",{class:"jb-dialog jb-popup"},a(t.contentComp)),css:"{ position: absolute; background: white; box-shadow: 2px 2px 3px #d5d5d5; padding: 3px 0; border: 1px solid rgb(213, 213, 213) }",features:[dialogFeature.maxZIndexOnClick(),dialogFeature.closeWhenClickingOutside(),dialogFeature.cssClassOnLaunchingElement(),dialogFeature.nearLauncherPosition({})]})}),jb.component("dialog.div",{type:"dialog.style",impl:customStyle({template:(e,t,a)=>a("div",{class:"jb-dialog jb-popup"},a(t.contentComp)),css:"{ position: absolute }"})}),jb.ui.dialogs={dialogs:[],buildComp(e){const t=e.vars.$dialog;return jb.ui.ctrl(e,features(calcProp("title",e=>e.vars.$model.title(e)),calcProp("contentComp","%$$model.content%"),calcProp("hasMenu","%$$model/menu/profile%"),calcProp("menuComp","%$$model/menu%"),feature.init(({},{cmp:e})=>e.dialog=t),interactive(({},{cmp:a})=>{t.cmp=a,a.dialog=t,t.onOK=t=>e.params.onOK(a.ctx.extendVars(t)),a.dialogCloseOK=()=>t.close({OK:!0}),a.dialogClose=e=>t.close(e),t.el=a.base,a.base.style.zIndex||(a.base.style.zIndex=100)})))},addDialog(e,t){const a=this;jb.log("addDialog",[e]),this.dialogs.push(e),e.modal&&!document.querySelector(".modal-overlay")&&jb.ui.addHTML(document.body,'<div class="modal-overlay"></div>'),jb.ui.render(jb.ui.h(this.buildComp(t)),this.dialogsTopElem(t)),this.dialogs.forEach(t=>t.em.next({type:"new-dialog",dialog:e})),e.close=function(n){if(jb.log("closeDialog",[e]),!(t.vars.formContainer.err&&n&&n.OK))return Promise.resolve().then(a=>{if(!e.closing)return e.closing=!0,e.onOK&&n&&n.OK?e.onOK(t):void 0}).then(i=>{e.em.next({type:"close",OK:n&&n.OK}),e.em.complete();const r=a.dialogs.indexOf(e);-1!=r&&a.dialogs.splice(r,1),e.modal&&document.querySelector(".modal-overlay")&&document.body.removeChild(document.querySelector(".modal-overlay")),jb.ui.unmount(e.el),e.el.parentElement===a.dialogsTopElem(t)&&a.dialogsTopElem(t).removeChild(e.el)})},e.closed=()=>-1==a.dialogs.indexOf(e)},closeDialogs:e=>e.slice(0).reduce((e,t)=>e.then(()=>t.close()),Promise.resolve()),closeAll(){return this.closeDialogs(this.dialogs)},closePopups:()=>jb.ui.dialogs.closeDialogs(jb.ui.dialogs.dialogs.filter(e=>e.isPopup)),dialogsTopElem(e){return this._dialogsTopElem||(this._dialogsTopElem=(e.vars.elemToTest||document.body).ownerDocument.createElement("div"),this._dialogsTopElem.className="jb-dialogs",(e.vars.elemToTest||document.body).appendChild(this._dialogsTopElem)),this._dialogsTopElem},reRenderAll(e){this._dialogsTopElem&&Array.from(this._dialogsTopElem.children).filter(e=>e).forEach(t=>jb.ui.refreshElem(t,null,{srcCtx:e}))}},jb.ns("itemlist,itemlistContainer"),jb.component("itemlist",{description:"list, dynamic group, collection, repeat",type:"control",category:"group:80,common:80",params:[{id:"title",as:"string"},{id:"items",as:"array",dynamic:!0,mandatory:!0},{id:"controls",type:"control[]",mandatory:!0,dynamic:!0},{id:"style",type:"itemlist.style",dynamic:!0,defaultValue:itemlist.ulLi()},{id:"itemVariable",as:"string",defaultValue:"item"},{id:"visualSizeLimit",as:"number",defaultValue:100,description:"by default itemlist is limmited to 100 shown items"},{id:"features",type:"feature[]",dynamic:!0,flattenArray:!0}],impl:e=>jb.ui.ctrl(e)}),jb.component("itemlist.no-container",{type:"feature",category:"group:20",impl:e=>({extendCtx:(e,t)=>e.setVars({itemlistCntr:null})})}),jb.component("itemlist.init-container-with-items",{type:"feature",category:"itemlist:20",impl:calcProp({id:"updateItemlistCntr",value:action.if("%$itemlistCntr%",writeValue("%$itemlistCntr.items%","%$$props.items%")),phase:100})}),jb.component("itemlist.init",{type:"feature",impl:features(calcProp({id:"items",value:"%$$model.items%"}),calcProp({id:"ctrls",value:(e,{cmp:t})=>{return jb.ui.addSlicedState(t,e.vars.$props.items,e.vars.$model.visualSizeLimit).map(t=>Object.assign((t=>e.vars.$model.controls(e.setVar(e.vars.$model.itemVariable,t).setData(t)).filter(e=>e))(t),{item:t})).filter(e=>e.length>0)}}),itemlist.initContainerWithItems())}),jb.component("itemlist.infinite-scroll",{type:"feature",params:[{id:"pageSize",as:"number",defaultValue:2}],impl:features(defHandler("onscrollHandler",(e,{ev:t,$state:a},{pageSize:n})=>{const i=t.target;if(!t.scrollPercentFromTop||t.scrollPercentFromTop<.9)return;const r=e.vars.$model.items();if(!(a.visualLimit.shownItems&&a.visualLimit.shownItems<r.length))return;const o=jb.ui.ctxOfElem(i);if(!o)return;const s=r.slice(a.visualLimit.shownItems,a.visualLimit.shownItems+n),l=o.ctx({profile:Object.assign({},o.profile,{items:()=>s}),path:""}).runItself().renderVdom(),c=jb.ui.findIncludeSelf(l,".jb-itemlist")[0];c&&(console.log(s,t),jb.ui.appendItems(i,c,e),a.visualLimit.shownItems+=s.length)}),templateModifier(({},{vdom:e})=>e.setAttribute("onscroll",!0)))}),jb.component("itemlist.init-table",{type:"feature",impl:features(calcProp({id:"items",value:pipeline("%$$model.items%",slice(0,firstSucceeding("%$$model.visualSizeLimit%",100)))}),calcProp({id:"fields",value:"%$$model/controls/field%"}),itemlist.initContainerWithItems())}),jb.component("itemlist.fast-filter",{type:"feature",description:"use display:hide to filter itemlist elements",params:[{id:"showCondition",mandatory:!0,dynamic:!0,defaultValue:itemlistContainer.conditionFilter()},{id:"filtersRef",mandatory:!0,as:"ref",dynamic:!0,defaultValue:"%$itemlistCntrData/search_pattern%"}],impl:interactive((e,{cmp:t},{showCondition:a,filtersRef:n})=>jb.subscribe(jb.ui.refObservable(n(t.ctx),t,{srcCtx:e}),()=>Array.from(t.base.querySelectorAll(".jb-item,*>.jb-item,*>*>.jb-item")).forEach(e=>e.style.display=a(jb.ctxDictionary[e.getAttribute("jb-ctx")])?"block":"none")))}),jb.component("itemlist.ul-li",{type:"itemlist.style",impl:customStyle({template:(e,{ctrls:t},a)=>a("ul",{class:"jb-itemlist"},t.map(e=>a("li",{class:"jb-item","jb-ctx":jb.ui.preserveCtx(e[0]&&e[0].ctx)},e.map(e=>a(e))))),css:"{ list-style: none; padding: 0; margin: 0;}\n    >li { list-style: none; padding: 0; margin: 0;}",features:itemlist.init()})}),jb.component("itemlist.horizontal",{type:"itemlist.style",params:[{id:"spacing",as:"number",defaultValue:0}],impl:customStyle({template:(e,{ctrls:t},a)=>a("div",{class:"jb-drag-parent"},t.map(e=>a("div",{class:"jb-item","jb-ctx":jb.ui.preserveCtx(e[0]&&e[0].ctx)},e.map(e=>a(e))))),css:"{display: flex}\n        >* { margin-right: %$spacing%px }\n        >*:last-child { margin-right:0 }",features:itemlist.init()})}),jb.ui.itemlistInitCalcItems=e=>e.calcItems=e.calcItems||(()=>Array.from(e.base.querySelectorAll(".jb-item,*>.jb-item,*>*>.jb-item")).map(e=>(jb.ctxDictionary[e.getAttribute("jb-ctx")]||{}).data).filter(e=>e)),jb.ui.addSlicedState=(e,t,a)=>(t.length>a&&(e.state.visualLimit={totalItems:t.length,shownItems:a}),t.slice(0,a)),jb.component("itemlist.selection",{type:"feature",params:[{id:"databind",as:"ref",defaultValue:"%$itemlistCntrData/selected%",dynamic:!0},{id:"selectedToDatabind",dynamic:!0,defaultValue:"%%"},{id:"databindToSelected",dynamic:!0,defaultValue:"%%"},{id:"onSelection",type:"action",dynamic:!0},{id:"onDoubleClick",type:"action",dynamic:!0},{id:"autoSelectFirst",type:"boolean"},{id:"cssForSelected",as:"string",description:"e.g. background: #bbb",defaultValue:"background: #bbb !important; color: #fff !important"}],impl:(e,t)=>({onclick:!0,ondblclick:!0,afterViewInit:a=>{const{pipe:n,map:i,filter:r,subscribe:o,merge:s,subject:l,distinctUntilChanged:c,catchError:d}=jb.callbag;a.selectionEmitter=l(),a.clickEmitter=n(s(a.onclick,a.ondblclick),i(e=>u(e.target)),r(e=>e)),n(a.ondblclick,i(e=>u(e.target)),r(e=>e),o(t=>e.params.onDoubleClick(a.ctx.setData(t)))),jb.ui.itemlistInitCalcItems(a),a.items=a.calcItems(),a.setSelected=e=>{a.state.selected=e,a.base&&(Array.from(a.base.querySelectorAll(".jb-item.selected,*>.jb-item.selected,*>*>.jb-item.selected")).forEach(e=>e.classList.remove("selected")),Array.from(a.base.querySelectorAll(".jb-item,*>.jb-item,*>*>.jb-item")).filter(t=>(jb.ctxDictionary[t.getAttribute("jb-ctx")]||{}).data===e).forEach(e=>{e.classList.add("selected"),e.scrollIntoViewIfNeeded()}))},n(s(a.selectionEmitter,a.clickEmitter),c(),r(e=>e),o(t=>{!function(t){p&&jb.writeValue(p,e.params.selectedToDatabind(e.setData(t)),e)}(t),a.setSelected(t),e.params.onSelection(a.ctx.setData(t))}));const p=t();function m(){return p&&jb.val(e.params.databindToSelected(e.setVars({items:a.calcItems()}).setData(jb.val(p))))}function u(e){const t=jb.ui.closest(e,".jb-item"),a=t&&t.getAttribute("jb-ctx");return(a&&jb.ctxDictionary[a]||{}).data}jb.isWatchable(p)&&n(jb.ui.refObservable(p,a,{throw:!0,srcCtx:e}),d(()=>a.setSelected(null)||[]),o(()=>a.setSelected(m()))),a.state.selected&&-1==a.items.indexOf(a.state.selected)&&(a.state.selected=null),m()&&a.setSelected(m()),a.state.selected||e.params.autoSelectFirst&&a.items[0]&&!jb.val(p)&&jb.delay(1).then(()=>a.selectionEmitter.next(a.items[0]))},css:[">.selected",">*>.selected",">*>*>.selected"].map(t=>t+" "+jb.ui.fixCssLine(e.params.cssForSelected)).join("\n")})}),jb.component("itemlist.keyboard-selection",{type:"feature",macroByValue:!1,params:[{id:"autoFocus",type:"boolean"},{id:"onEnter",type:"action",dynamic:!0}],impl:e=>({templateModifier:e=>{e.attributes=e.attributes||{},e.attributes.tabIndex=0},afterViewInit:t=>{const{pipe:a,map:n,filter:i,subscribe:r,merge:o}=jb.callbag,s=jb.ui.parentCmps(t.base).find(e=>e.selectionKeySource);let l=jb.path(t.ctx.vars,"itemlistCntr.keydown")||jb.path(s,"onkeydown");l?l=o(l,jb.ui.fromEvent(t,"keydown")):(l=jb.ui.fromEvent(t,"keydown"),e.params.autoFocus&&jb.ui.focus(t.base,"itemlist.keyboard-selection init autoFocus",e)),t.onkeydown=l,jb.ui.itemlistInitCalcItems(t),a(t.onkeydown,i(e=>13==e.keyCode&&t.state.selected),r(()=>e.params.onEnter(t.ctx.setData(t.state.selected)))),a(t.onkeydown,i(e=>!e.ctrlKey&&(38==e.keyCode||40==e.keyCode)),n(e=>{e.stopPropagation();const a=40==e.keyCode?1:-1;t.items=t.calcItems();const n=t.items.indexOf(t.state.selected)+a;return t.items[Math.min(t.items.length-1,Math.max(0,n))]}),r(e=>t.selectionEmitter&&t.selectionEmitter.next(e)))}})}),jb.component("itemlist.drag-and-drop",{type:"feature",impl:e=>({afterViewInit:function(t){jb.ui.itemlistInitCalcItems(t);const a=dragula([t.base.querySelector(".jb-drag-parent")||t.base],{moves:(e,t,a)=>jb.ui.hasClass(a,"drag-handle")});a.on("drag",(function(e,a){t.items=t.calcItems();let n=e.getAttribute("jb-ctx")&&jb.ctxDictionary[e.getAttribute("jb-ctx")].data;if(!n){const t=e._component||e.firstElementChild&&e.firstElementChild._component;n=t&&t.ctx.data}e.dragged={item:n,remove:e=>t.items.splice(t.items.indexOf(e),1)},t.selectionEmitter&&t.selectionEmitter.next(e.dragged.item)})),a.on("drop",(a,n,i,r)=>{const o=t.items.indexOf(a.dragged.item),s=r?jb.ui.index(r):t.items.length;jb.splice(jb.asRef(t.items),[[o,1],[s-1,0,a.dragged.item]],e),a.dragged=null}),t.dragAndDropActive=!0,t.onkeydown&&jb.subscribe(t.onkeydown,a=>{if(a.ctrlKey&&(38==a.keyCode||40==a.keyCode)){t.items=t.calcItems();const n=40==a.keyCode?1:-1,i=t.items.indexOf(t.state.selected);if(-1==i)return;const r=(i+n+t.items.length)%t.items.length,o=jb.path(jb.ctxDictionary,`${t.base.getAttribute("jb-ctx")}.params.items`);o&&jb.splice(jb.asRef(o()),[[i,1],[r,0,t.state.selected]],e)}})}})}),jb.component("itemlist.drag-handle",{description:"put on the control inside the item which is used to drag the whole line",type:"feature",impl:list(css.class("drag-handle"),css("{cursor: pointer}"))}),jb.component("itemlist.shown-only-on-item-hover",{type:"feature",category:"itemlist:75",description:"put on the control inside the item which is shown when the mouse enters the line",impl:(e,t,a)=>({class:"jb-shown-on-item-hover"})}),jb.component("itemlist.divider",{type:"feature",params:[{id:"space",as:"number",defaultValue:5}],impl:(e,t)=>({css:`>.jb-item:not(:first-of-type) { border-top: 1px solid rgba(0,0,0,0.12); padding-top: ${t}px }`})}),function(){const e=(e,t)=>({id:t.id,defaultItem:t.defaultItem,filter_data:{},filters:[],selectedRef:e.exp("%$itemlistCntrData/selected%","ref"),selected:function(t){if(jb.isValid(this.selectedRef))return void 0!==t?jb.writeValue(this.selectedRef,t,e):jb.val(this.selectedRef)},reSelectAfterFilter:function(e){-1==e.indexOf(this.selected())&&this.selected(e[0])},changeSelectionBeforeDelete:function(){if(this.items&&this.selected){const e=this.items.indexOf(this.selected);-1==e?this.selected=null:0==e&&this.items.length>0?this.selected=this.items[1]:this.items.length>0?this.selected=this.items[e-1]:this.selected=null}}});jb.component("group.itemlist-container",{description:"itemlist writable container to support addition, deletion and selection",type:"feature",category:"itemlist:80,group:70",params:[{id:"id",as:"string",mandatory:!0},{id:"defaultItem",as:"single"},{id:"initialSelection",as:"single"}],impl:features(variable({name:"itemlistCntrData",value:{$:"object",search_pattern:"",selected:"%$initialSelection%"},watchable:!0}),variable({name:"itemlistCntr",value:t=>e(t,t.componentContext.params)}))}),jb.component("itemlist.itemlist-selected",{type:"feature",category:"itemlist:20,group:0",impl:list(group.data("%$itemlistCntrData/selected%"),hidden(notEmpty("%$itemlistCntrData/selected%")))}),jb.component("itemlist-container.filter",{type:"aggregator",category:"itemlist-filter:100",requires:e=>e.vars.itemlistCntr,params:[{id:"updateCounters",as:"boolean",type:"boolean"}],impl:(e,t)=>{if(!e.vars.itemlistCntr)return;const a=e.vars.itemlistCntr.filters.reduce((e,t)=>t(e),e.data||[]);return e.vars.itemlistCntrData.countAfterFilter!=a.length&&jb.delay(1).then(t=>e.vars.itemlistCntr.reSelectAfterFilter(a)),t?jb.delay(1).then(t=>{jb.writeValue(e.exp("%$itemlistCntrData/countBeforeFilter%","ref"),(e.data||[]).length,e),jb.writeValue(e.exp("%$itemlistCntrData/countBeforeMaxFilter%","ref"),resBeforeMaxFilter.length,e),jb.writeValue(e.exp("%$itemlistCntrData/countAfterFilter%","ref"),a.length,e)}):e.vars.itemlistCntrData.countAfterFilter=a.length,a}}),jb.component("itemlist-container.condition-filter",{type:"boolean",category:"itemlist-filter:100",requires:e=>e.vars.itemlistCntr,impl:e=>e.vars.itemlistCntr&&e.vars.itemlistCntr.filters.reduce((t,a)=>t&&a([e.data]).length,!0)}),jb.component("itemlist-container.search",{type:"control",category:"itemlist-filter:100",requires:e=>e.vars.itemlistCntr,params:[{id:"title",as:"string",dynamic:!0,defaultValue:"Search"},{id:"searchIn",as:"string",dynamic:!0,defaultValue:itemlistContainer.searchInAllProperties()},{id:"databind",as:"ref",dynamic:!0,defaultValue:"%$itemlistCntrData/search_pattern%"},{id:"style",type:"editable-text.style",defaultValue:editableText.mdcSearch(),dynamic:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:(e,t,a,n)=>jb.ui.ctrl(e,{afterViewInit:t=>{if(!e.vars.itemlistCntr)return;const i=n();e.vars.itemlistCntr.filters.push(t=>{const n=jb.val(i)||"";return"function"==typeof a.profile?t.filter(e=>""==n||-1!=a.profile(e).toLowerCase().indexOf(n.toLowerCase())):t.filter(t=>""==n||-1!=a(e.setData(t)).toLowerCase().indexOf(n.toLowerCase()))}),e.vars.itemlistCntr.keydown=jb.ui.upDownEnterEscObs(t)}})}),jb.component("itemlist-container.more-items-button",{type:"control",category:"itemlist-filter:100",requires:e=>e.vars.itemlistCntr,params:[{id:"title",as:"string",dynamic:!0,defaultValue:"show %$delta% more ... (%$itemlistCntrData/countAfterFilter%/%$itemlistCntrData/countBeforeMaxFilter%)"},{id:"delta",as:"number",defaultValue:200},{id:"style",type:"button.style",defaultValue:button.href(),dynamic:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:controlWithFeatures(e=>jb.ui.ctrl(e),[watchRef("%$itemlistCntrData/maxItems%"),defHandler("onclickHandler",writeValue("%$itemlistCntrData/maxItems%",(e,{itemlistCntrData:t},{delta:a})=>a+t.maxItems)),calcProp({id:"title",value:(e,{},{title:t,delta:a})=>t(e.setVar("delta",a))}),e=>({templateModifier:(e,t,a)=>t.ctx.exp("%$itemlistCntrData/countBeforeMaxFilter%","number")==t.ctx.exp("%$itemlistCntrData/countAfterFilter%","number")?"":e})])}),jb.ui.extractPropFromExpression=e=>{if(e.match(/^%.*%$/)&&!e.match(/[./[]/))return e.match(/^%(.*)%$/)[1]},jb.component("itemlist-container.filter-field",{type:"feature",category:"itemlist:80",requires:e=>e.vars.itemlistCntr,params:[{id:"fieldData",dynamic:!0,mandatory:!0},{id:"filterType",type:"filter-type"}],impl:(e,t,a)=>({afterViewInit:n=>{const i=jb.ui.extractPropFromExpression(e.params.fieldData.profile);n.itemToFilterData=i?e=>e[i]:a=>t(e.setData(a)),e.vars.itemlistCntr&&e.vars.itemlistCntr.filters.push(t=>{const i=jb.val(e.vars.$model.databind());if(!i)return t;const r=t.filter(e=>a.filter(i,n.itemToFilterData(e)));return!a.sort||n.state.sortOptions&&0!=n.state.sortOptions.length||a.sort(r,n.itemToFilterData,i),r})}})}),jb.component("filter-type.text",{type:"filter-type",params:[{id:"ignoreCase",as:"boolean",defaultValue:!0,type:"boolean"}],impl:(e,t)=>t?{filter:(e,t)=>-1!=(t||"").toLowerCase().indexOf((e||"").toLowerCase()),sort:(e,t,a)=>{const n=new RegExp("\\b"+a+"\\b","i"),i=e=>(n.test(e)?5:0)+(0==e.toLowerCase().indexOf(a.toLowerCase())?3:0);e.sort((e,a)=>i(t(e)||"")-i(t(a)||""))}}:{filter:(e,t)=>-1!=(t||"").indexOf(e||""),sort:(e,t,a)=>{const n=new RegExp("\\b"+a+"\\b"),i=e=>(n.test(e)?5:0)+(0==e.indexOf(a)?3:0);e.sort((e,a)=>i(t(e)||"")-i(t(a)||""))}}}),jb.component("filter-type.exact-match",{type:"filter-type",impl:e=>({filter:(e,t)=>{const a=(e||"").trim(),n=(t||"").trim();return 0==n.indexOf(a)&&n.length==a.length}})}),jb.component("filter-type.numeric",{type:"filter-type",impl:e=>({filter:(e,t)=>Number(t)>=Number(e),sort:(e,t)=>e.sort((e,a)=>Number(t(e))-Number(t(a)))})}),jb.component("itemlist-container.search-in-all-properties",{type:"data",category:"itemlist:40",impl:e=>"string"==typeof e.data?e.data:"object"!=typeof e.data?"":jb.entries(e.data).map(e=>e[1]).filter(e=>"string"==typeof e).join("#")})}(),jb.ns("menuStyle"),jb.ns("menuSeparator"),jb.ns("mdc"),jb.component("menu.menu",{type:"menu.option",params:[{id:"title",as:"string",dynamic:!0,mandatory:!0},{id:"options",type:"menu.option[]",dynamic:!0,flattenArray:!0,mandatory:!0,defaultValue:[]},{id:"optionsFilter",type:"data",dynamic:!0,defaultValue:"%%"}],impl:e=>({options:t=>e.params.optionsFilter(e.setData(e.params.options(t))),title:e.params.title(),applyShortcut:function(e){return this.options().reduce((t,a)=>t||a.applyShortcut&&a.applyShortcut(e),!1)},ctx:e})}),jb.component("menu.options-group",{type:"menu.option",params:[{id:"options",type:"menu.option[]",dynamic:!0,flattenArray:!0,mandatory:!0}],impl:(e,t)=>t()}),jb.component("menu.dynamic-options",{type:"menu.option",params:[{id:"items",type:"data",as:"array",mandatory:!0,dynamic:!0},{id:"genericOption",type:"menu.option",mandatory:!0,dynamic:!0}],impl:(e,t,a)=>t().map(t=>a(e.setData(t)))}),jb.component("menu.end-with-separator",{type:"menu.option",params:[{id:"options",type:"menu.option[]",dynamic:!0,flattenArray:!0,mandatory:!0},{id:"separator",type:"menu.option",as:"array",defaultValue:menu.separator()},{id:"title",as:"string"}],impl:e=>{const t=e.params.options();return t.length>0?t.concat(e.params.separator):[]}}),jb.component("menu.separator",{type:"menu.option",impl:e=>({separator:!0})}),jb.component("menu.action",{type:"menu.option",params:[{id:"title",as:"string",dynamic:!0,mandatory:!0},{id:"action",type:"action",dynamic:!0,mandatory:!0},{id:"icon",as:"string"},{id:"shortcut",as:"string"},{id:"showCondition",type:"boolean",as:"boolean",defaultValue:!0}],impl:e=>e.params.showCondition&&{leaf:e.params,action:t=>e.params.action(e.setVars({topMenu:null})),title:e.params.title(e),applyShortcut:t=>{if(jb.ui.checkKey(t,e.params.shortcut))return t.stopPropagation(),e.params.action(),!0},ctx:e}}),jb.component("menu.control",{type:"control,clickable,menu",params:[{id:"menu",type:"menu.option",dynamic:!0,mandatory:!0},{id:"style",type:"menu.style",defaultValue:menuStyle.contextMenu(),dynamic:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>{const t=e.params.menu()||{options:[],ctx:e,title:""};return jb.ui.ctrl(e.setVars({topMenu:e.vars.topMenu||{popups:[]},menuModel:t}),features(()=>({ctxForPick:t.ctx}),calcProp("title","%$menuModel.title%")))}}),jb.component("menu.open-context-menu",{type:"action",params:[{id:"menu",type:"menu.option",dynamic:!0,mandatory:!0},{id:"popupStyle",type:"dialog.style",dynamic:!0,defaultValue:dialog.contextMenuPopup()},{id:"features",type:"dialog-feature[]",dynamic:!0}],impl:openDialog({style:call("popupStyle"),content:menu.control({menu:call("menu"),style:menuStyle.contextMenu()}),features:call("features")})}),jb.component("menu-style.pulldown",{type:"menu.style",params:[{id:"innerMenuStyle",type:"menu.style",dynamic:!0,defaultValue:menuStyle.popupAsOption()},{id:"leafOptionStyle",type:"menu-option.style",dynamic:!0,defaultValue:menuStyle.optionLine()},{id:"layout",type:"group.style",dynamic:!0,defaultValue:itemlist.horizontal()}],impl:styleByControl(Var("optionsParentId",e=>e.id),Var("innerMenuStyle",e=>e.componentContext.params.innerMenuStyle),Var("leafOptionStyle",e=>e.componentContext.params.leafOptionStyle),itemlist({vars:[Var("optionsParentId",e=>e.id),Var("innerMenuStyle",e=>e.componentContext.params.innerMenuStyle),Var("leafOptionStyle",e=>e.componentContext.params.leafOptionStyle)],items:e=>e.vars.menuModel.options&&e.vars.menuModel.options().filter(e=>e)||[],controls:menu.control({menu:"%$item%",style:menuStyle.popupThumb()}),style:call("layout"),features:menu.selection()}))}),jb.component("menu-style.context-menu",{type:"menu.style",params:[{id:"leafOptionStyle",type:"menu-option.style",dynamic:!0,defaultValue:menuStyle.optionLine()}],impl:styleByControl(Var("optionsParentId",e=>e.id),Var("leafOptionStyle",e=>e.componentContext.params.leafOptionStyle),itemlist({vars:[Var("optionsParentId",e=>e.id),Var("leafOptionStyle",e=>e.componentContext.params.leafOptionStyle)],items:e=>e.vars.menuModel.options&&e.vars.menuModel.options().filter(e=>e)||[],controls:menu.control({menu:"%$item%",style:menuStyle.applyMultiLevel({})}),features:menu.selection(!0)}))}),jb.component("menu.init-popup-menu",{type:"feature",params:[{id:"popupStyle",type:"dialog.style",dynamic:!0,defaultValue:dialog.contextMenuPopup()}],impl:features(()=>({destroy:e=>e.closePopup()}),calcProp({id:"title",value:"%$menuModel.title%"}),interactive((e,{cmp:t})=>{t.mouseEnter=a=>{jb.ui.find(e,".context-menu-popup")[0]&&t.openPopup()},t.openPopup=jb.ui.wrapWithLauchingElement(a=>{t.ctx.vars.topMenu.popups.push(e.vars.menuModel),a.run({$:"menu.open-context-menu",popupStyle:t=>e.componentContext.params.popupStyle(t),menu:t=>e.vars.$model.menu()})},t.ctx,t.base),t.closePopup=()=>jb.ui.dialogs.closeDialogs(jb.ui.dialogs.dialogs.filter(t=>t.id==e.vars.optionsParentId)).then(()=>t.ctx.vars.topMenu.popups.pop()),jb.delay(1).then(a=>{if(e.vars.topMenu&&e.vars.topMenu.keydown){const{pipe:a,takeUntil:n}=jb.callbag,i=a(e.vars.topMenu.keydown,n(t.destroyed));jb.subscribe(i,a=>39==a.keyCode&&e.vars.topMenu.selected==e.vars.menuModel&&t.openPopup&&t.openPopup()),jb.subscribe(i,a=>{37==a.keyCode&&t.ctx.vars.topMenu.popups.slice(-1)[0]==e.vars.menuModel&&(e.vars.topMenu.selected=e.vars.menuModel,t.closePopup())})}})}))}),jb.component("menu.init-menu-option",{type:"feature",impl:features(calcProp({id:"title",value:"%$menuModel.leaf.title%"}),calcProp({id:"icon",value:"%$menuModel.leaf.icon%"}),calcProp({id:"shortcut",value:"%$menuModel.leaf.shortcut%"}),interactive((e,{cmp:t})=>{const{pipe:a,filter:n,subscribe:i,takeUntil:r}=jb.callbag;t.action=jb.ui.wrapWithLauchingElement(()=>jb.ui.dialogs.closePopups().then(()=>e.vars.menuModel.action()),e,t.base),jb.delay(1).then(o=>{e.vars.topMenu&&e.vars.topMenu.keydown&&a(e.vars.topMenu.keydown,r(t.destroyed),n(t=>13==t.keyCode&&e.vars.topMenu.selected==e.vars.menuModel),i(e=>t.action()))})}))}),jb.component("menu-style.apply-multi-level",{type:"menu.style",params:[{id:"menuStyle",type:"menu.style",dynamic:!0,defaultValue:menuStyle.popupAsOption()},{id:"leafStyle",type:"menu.style",dynamic:!0,defaultValue:menuStyle.optionLine()},{id:"separatorStyle",type:"menu.style",dynamic:!0,defaultValue:menuSeparator.line()}],impl:e=>e.vars.menuModel.leaf?e.vars.leafOptionStyle?e.vars.leafOptionStyle(e):e.params.leafStyle():e.vars.menuModel.separator?e.params.separatorStyle():e.vars.innerMenuStyle?e.vars.innerMenuStyle(e):e.params.menuStyle()}),jb.component("menu.selection",{type:"feature",params:[{id:"autoSelectFirst",type:"boolean"}],impl:e=>({onkeydown:!0,onmousemove:!0,templateModifier:e=>{e.attributes=e.attributes||{},e.attributes.tabIndex=0},afterViewInit:t=>{e.vars.topMenu.keydown||(e.vars.topMenu.keydown=t.onkeydown,jb.ui.focus(t.base,"menu.keyboard init autoFocus",e)),t.items=Array.from(t.base.querySelectorAll(".jb-item,*>.jb-item,*>*>.jb-item")).map(e=>(jb.ctxDictionary[e.getAttribute("jb-ctx")]||{}).data);const{pipe:a,map:n,filter:i,subscribe:r,takeUntil:o}=jb.callbag,s=a(e.vars.topMenu.keydown,o(t.destroyed));a(t.onmousemove,n(e=>(function(e){const t=e.find(e=>e.classList&&e.classList.contains("jb-item")),a=t&&t.getAttribute("jb-ctx");return(a&&jb.ctxDictionary[a]||{}).data})(e.target.ownerDocument.elementsFromPoint(e.pageX,e.pageY))),i(t=>t&&t!=e.vars.topMenu.selected),r(e=>t.select(e))),a(s,i(e=>38==e.keyCode||40==e.keyCode),n(a=>{a.stopPropagation();const n=40==a.keyCode?1:-1,i=t.items.filter(e=>!e.separator),r=e.vars.topMenu.selected.separator?0:i.indexOf(e.vars.topMenu.selected);if(-1!=r)return i[(r+n+i.length)%i.length]}),i(e=>e),r(e=>t.select(e))),a(s,i(e=>27==e.keyCode),r(e=>jb.ui.dialogs.closePopups().then(()=>{t.ctx.vars.topMenu.popups=[],t.ctx.run({$:"tree.regain-focus"})}))),t.select=a=>{e.vars.topMenu.selected=a,t.base&&(Array.from(t.base.querySelectorAll(".jb-item.selected, *>.jb-item.selected")).forEach(e=>e.classList.remove("selected")),Array.from(t.base.querySelectorAll(".jb-item, *>.jb-item")).filter(e=>(jb.ctxDictionary[e.getAttribute("jb-ctx")]||{}).data===a).forEach(e=>e.classList.add("selected")))},t.state.selected=e.vars.topMenu.selected,e.params.autoSelectFirst&&t.items[0]&&t.select(t.items[0])},css:">.selected { background: #bbb !important; color: #fff !important }"})}),jb.component("menu-style.option-line",{type:"menu-option.style",impl:customStyle({template:(e,t,a)=>a("div",{class:"line noselect",onmousedown:"action"},[a("i",{class:"material-icons"},t.icon),a("span",{class:"title"},t.title),a("span",{class:"shortcut"},t.shortcut),a("div",{class:"mdc-line-ripple"})]),css:"{ display: flex; cursor: pointer; font: 13px Arial; height: 24px}\n\t\t\t\t.selected { background: #d8d8d8 }\n\t\t\t\t>i { width: 24px; padding-left: 3px; padding-top: 3px; font-size:16px; }\n\t\t\t\t>span { padding-top: 3px }\n\t\t\t\t\t\t>.title { display: block; text-align: left; white-space: nowrap; }\n\t\t\t\t>.shortcut { margin-left: auto; text-align: right; padding-right: 15px }",features:[menu.initMenuOption(),mdc.rippleEffect()]})}),jb.component("menu.option-as-icon24",{type:"menu-option.style",impl:customStyle({template:(e,t,a)=>a("div",{class:"line noselect",onclick:!0,title:t.title},[a("i",{class:"material-icons"},t.icon)]),css:"{ display: flex; cursor: pointer; height: 24px}\n\t\t\t\t>i { width: 24px; padding-left: 3px; padding-top: 3px; font-size:16px; }"})}),jb.component("menu-style.popup-as-option",{type:"menu.style",impl:customStyle({template:(e,t,a)=>a("div",{class:"line noselect",onmousedown:"action"},[a("span",{class:"title"},t.title),a("i",{class:"material-icons",onmouseenter:"openPopup"},"play_arrow")]),css:"{ display: flex; cursor: pointer; font: 13px Arial; height: 24px}\n\t\t\t\t>i { width: 100%; text-align: right; font-size:16px; padding-right: 3px; padding-top: 3px; }\n\t\t\t\t\t\t>.title { display: block; text-align: left; padding-top: 3px; padding-left: 26px; white-space: nowrap; }\n\t\t\t",features:menu.initPopupMenu(dialog.contextMenuPopup(-24,!0))})}),jb.component("menu-style.popup-thumb",{type:"menu.style",description:"used for pulldown",impl:customStyle({template:(e,t,a)=>a("div",{class:"pulldown-top-menu-item",onmouseenter:"mouseEnter",onclick:"openPopup"},t.title),features:[menu.initPopupMenu(),mdc.rippleEffect()]})}),jb.component("dialog.context-menu-popup",{type:"dialog.style",params:[{id:"offsetTop",as:"number"},{id:"rightSide",as:"boolean",type:"boolean"}],impl:customStyle({template:(e,t,a)=>a("div",{class:"jb-dialog jb-popup context-menu-popup pulldown-mainmenu-popup"},a(t.contentComp)),features:[dialogFeature.uniqueDialog("%$optionsParentId%",!1),dialogFeature.maxZIndexOnClick(),dialogFeature.closeWhenClickingOutside(),dialogFeature.cssClassOnLaunchingElement(),dialogFeature.nearLauncherPosition({offsetTop:"%$offsetTop%",rightSide:"%$rightSide%"})]})}),jb.component("menu-separator.line",{type:"menu-separator.style",impl:customStyle({template:(e,t,a)=>a("div"),css:"{ margin: 6px 0; border-bottom: 1px solid #EBEBEB;}"})}),jb.ns("picklist"),jb.component("picklist",{type:"control",category:"input:80",params:[{id:"title",as:"string",dynamic:!0},{id:"databind",as:"ref",mandaroy:!0,dynamic:!0},{id:"options",type:"picklist.options",dynamic:!0,mandatory:!0,defaultValue:{$:"picklist.options-by-comma",$byValue:[]}},{id:"promote",type:"picklist.promote",dynamic:!0},{id:"style",type:"picklist.style",defaultValue:picklist.native(),dynamic:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e,features(calcProps(()=>{var t=e.params.options(e),a={},n=(e.params.promote()||{}).groups||[],i=[];return t.filter(e=>e.text).forEach(e=>{var t=groupOfOpt(e),n=a[t]||{options:[],text:t};a[t]||(i.push(n),a[t]=n),n.options.push({text:(e.text||"").split(".").pop(),code:e.code})}),i.sort((e,t)=>n.indexOf(t.text)-n.indexOf(e.text)),{groups:i,options:t,hasEmptyOption:t.filter(e=>!e.text)[0]}})))}),jb.component("picklist.dynamic-options",{type:"feature",params:[{id:"recalcEm",as:"single"}],impl:interactive((e,{cmp:t},{recalcEm:a})=>{const{pipe:n,takeUntil:i,subscribe:r}=jb.callbag;a&&n(a,i(t.destroyed),r(()=>t.refresh()))})}),jb.component("picklist.onChange",{type:"feature",description:"action on picklist selection",params:[{id:"action",type:"action",dynamic:!0}],impl:interactive((e,{cmp:t},{action:a})=>t.onChange=a)}),jb.component("picklist.optionsByComma",{type:"picklist.options",params:[{id:"options",as:"string",mandatory:!0},{id:"allowEmptyValue",type:"boolean"}],impl:function(e,t,a){return(a?[{code:"",value:""}]:[]).concat((t||"").split(",").map(e=>({code:e,text:e})))}}),jb.component("picklist.options",{type:"picklist.options",params:[{id:"options",type:"data",as:"array",mandatory:!0},{id:"allowEmptyValue",type:"boolean"}],impl:function(e,t,a){return(a?[{code:"",value:""}]:[]).concat(t.map(e=>({code:e,text:e})))}}),jb.component("picklist.coded-options",{type:"picklist.options",params:[{id:"options",as:"array",mandatory:!0},{id:"code",as:"string",dynamic:!0,mandatory:!0},{id:"text",as:"string",dynamic:!0,mandatory:!0},{id:"allowEmptyValue",type:"boolean"}],impl:function(e,t,a,n,i){return(i?[{code:"",value:""}]:[]).concat(t.map(e=>({code:a(null,e),text:n(null,e)})))}}),jb.component("picklist.sorted-options",{type:"picklist.options",params:[{id:"options",type:"picklist.options",dynamic:!0,mandatory:!0,composite:!0},{id:"marks",as:"array",description:"e.g input:80,group:90. 0 mark means hidden. no mark means 50"}],impl:(e,t,a)=>{let n=t()||[];return a.forEach(e=>{const t=n.filter(t=>t.code==e.code)[0];t&&(t.mark=Number(e.mark||50))}),(n=n.filter(e=>0!=e.mark)).sort((e,t)=>(t.mark||50)-(e.mark||50)),n}}),jb.component("picklist.promote",{type:"picklist.promote",params:[{id:"groups",as:"array"},{id:"options",as:"array"}],impl:e=>e.params}),jb.type("theme"),jb.component("group.theme",{type:"feature",params:[{id:"theme",type:"theme"}],impl:(e,t)=>({extendCtx:(e,a)=>e.setVars(t)})}),jb.component("theme.material-design",{type:"theme",impl:()=>({"$theme.editable-text":"editable-text.mdc-input"})}),jb.ns("icon"),jb.component("material-icon",{type:"control",category:"control:50",params:[{id:"icon",as:"string",mandatory:!0},{id:"title",as:"string"},{id:"style",type:"icon.style",dynamic:!0,defaultValue:icon.material()},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e,calcProp("icon","%$$model/icon%"))}),jb.component("icon.material",{type:"icon-with-action.style",impl:customStyle((e,{icon:t},a)=>a("i",{class:"material-icons"},t))}),jb.ns("slider"),jb.component("editable-number.slider-no-text",{type:"editable-number.style",impl:customStyle({template:(e,t,a)=>a("input",{type:"range",min:t.min,max:t.max,step:t.step,value:t.databind,mouseup:"onblurHandler",tabindex:-1}),features:[field.databind(),slider.init()]})}),jb.component("editable-number.slider",{type:"editable-number.style",impl:styleByControl(group({title:"%$editableNumberModel/title%",controls:group({layout:layout.horizontal(20),controls:[editableText({databind:"%$editableNumberModel/databind%",style:editableText.mdcNoLabel(36),features:[slider.handleArrowKeys(),css.margin(-3)]}),editableNumber({databind:"%$editableNumberModel/databind%",style:editableNumber.sliderNoText(),features:css.width(80)})],features:variable({name:"sliderCtx",value:{$:"object"}})})}),"editableNumberModel")}),jb.component("slider.init",{type:"feature",impl:e=>({onkeyup:!0,onkeydown:!0,onmouseup:!0,onmousedown:!0,onmousemove:!0,afterViewInit:t=>{t.handleArrowKey=a=>{var n=Number(t.jbModel())||0;if(46==a.keyCode&&jb.writeValue(e.vars.$model.databind(),null,e),-1!=[37,39].indexOf(a.keyCode)){var i=a.shiftKey?9:1;null!=n&&39==a.keyCode&&t.jbModel(Math.min(t.max,n+i)),null!=n&&37==a.keyCode&&t.jbModel(Math.max(t.min,n-i))}},t.__refresh=a=>{var n=null!=t.jbModel()&&Number(t.jbModel());t.max=Math.max.apply(0,[e.vars.$model.max,n,t.max].filter(e=>null!=e)),t.min=Math.min.apply(0,[e.vars.$model.min,n,t.min].filter(e=>null!=e)),n==t.max&&e.vars.$model.autoScale&&(t.max+=t.max-t.min),n==t.min&&e.vars.$model.autoScale&&(t.min-=t.max-t.min),jb.ui.setState(t,{min:t.min,max:t.max,step:e.vars.$model.step,val:t.jbModel()},null,e)};const{pipe:a,subscribe:n,flatMap:i,takeUntil:r}=jb.callbag;a(t.onkeydown,n(e=>t.handleArrowKey(e))),a(t.onmousedown,i(e=>a(t.onmousemove,r(t.onmouseup))),n(e=>t.jbModel(t.base.value))),e.vars.sliderCtx&&(e.vars.sliderCtx.handleArrowKey=e=>t.handleArrowKey(e))}})}),jb.component("slider.handle-arrow-keys",{type:"feature",impl:features(htmlAttribute("onkeydown",!0),defHandler("onkeydownHandler",(e,{ev:t})=>e.vars.sliderCtx&&sliderCtx.handleArrowKey(t)))}),jb.component("slider.edit-as-text-popup",{type:"feature",impl:openDialog({style:dialog.popup(),content:group({title:"data-settings",layout:layout.vertical(3),controls:[editableText({title:"%title%",databind:"%databind%",style:editableText.mdcInput("270"),features:feature.onEnter(dialog.closeContainingPopup())})],features:[group.data("%$editableNumber%"),css.padding({left:"10",right:"10"})]}),features:[dialogFeature.uniqueDialog("slider",!1),dialogFeature.maxZIndexOnClick(),dialogFeature.closeWhenClickingOutside(),dialogFeature.cssClassOnLaunchingElement(),dialogFeature.nearLauncherPosition({}),dialogFeature.autoFocusOnFirstInput(!0)]})}),jb.ns("table"),jb.component("table",{type:"control,table",category:"group:80,common:70",params:[{id:"title",as:"string"},{id:"items",as:"array",dynamic:!0,mandatory:!0},{id:"fields",type:"table-field[]",mandatory:!0,dynamic:!0},{id:"style",type:"table.style",dynamic:!0,defaultValue:table.plain()},{id:"visualSizeLimit",as:"number",defaultValue:100,description:"by default table is limmited to 100 shown items"},{id:"features",type:"feature[]",dynamic:!0,flattenArray:!0}],impl:e=>jb.ui.ctrl(e)}),jb.component("field",{type:"table-field",params:[{id:"title",as:"string",mandatory:!0},{id:"data",as:"string",mandatory:!0,dynamic:!0},{id:"hoverTitle",as:"string",dynamic:!0},{id:"width",as:"number"},{id:"numeric",as:"boolean",type:"boolean"},{id:"extendItems",as:"boolean",type:"boolean",description:"extend the items with the calculated field using the title as field name"},{id:"class",as:"string"}],impl:(e,t,a,n,i,r,o,s)=>({title:()=>t,fieldData:n=>o?n[t]:a(e.setData(n)),calcFieldData:t=>a(e.setData(t)),hoverTitle:n.profile?t=>n(e.setData(t)):null,class:s,width:i,numeric:r,extendItems:o,ctxId:jb.ui.preserveCtx(e)})}),jb.component("field.index",{type:"table-field",params:[{id:"title",as:"string",defaultValue:"index"},{id:"width",as:"number",defaultValue:10},{id:"class",as:"string"}],impl:(e,t)=>({title:()=>t,fieldData:(e,t)=>t,class:_class,width:width,numeric:!0,ctxId:jb.ui.preserveCtx(e)})}),jb.component("field.control",{type:"table-field",params:[{id:"title",as:"string",mandatory:!0},{id:"control",type:"control",dynamic:!0,mandatory:!0,defaultValue:text("")},{id:"width",as:"number"},{id:"dataForSort",dynamic:!0},{id:"numeric",as:"boolean",type:"boolean"}],impl:(e,t,a,n,i,r)=>({title:()=>t,control:t=>a(e.setData(t)),width:n,fieldData:t=>i(e.setData(t)),numeric:r,ctxId:jb.ui.preserveCtx(e)})}),jb.component("button.table-cell-href",{type:"button.style",impl:customStyle({template:(e,t,a)=>a("a",{href:"javascript:;",onclick:!0},t.title),css:"{color: grey}"})}),jb.component("table.init-table-or-itemlist",{type:"feature",impl:e=>e.run(e.vars.$model.fields?table.init():itemlist.initTable())}),jb.component("table.init",{type:"feature",category:"table:10",impl:features(calcProp({id:"fields",value:"%$$model.fields%"}),calcProp({id:"updateItemlistCntr",value:writeValue("%$itemlistCntr.items%","%$$props.items%"),phase:100}),calcProp({id:"items",value:pipeline("%$$model.items%",slice(0,firstSucceeding("%$$model.visualSizeLimit%",100)))}),interactiveProp("items",pipeline("%$$model.items%",slice(0,firstSucceeding("%$$model.visualSizeLimit%",100)))))}),jb.component("table.init-sort",{type:"feature",impl:e=>({afterViewInit:e=>{e.toggleSort=t=>{const a=e.renderProps.fields[t.currentTarget.getAttribute("fieldIndex")],n=e.renderProps.sortOptions||[];var i=n.filter(e=>e.field==a)[0];i||(n=[{field:a,dir:"none"}].concat(n).slice(0,2));var r=["none","asc","des"];(i=n.filter(e=>e.field==a)[0]).dir=r[(r.indexOf(i.dir)+1)%r.length],"none"==i.dir&&n.splice(n.indexOf(i),1),e.refresh({sortOptions:n})},e.sortItems=()=>{if(e.items&&e.renderProps.sortOptions&&0!=e.renderProps.sortOptions.length){e.items.forEach((t,a)=>e.renderProps.sortOptions.forEach(e=>t["$jb_$sort_"+e.field.title]=e.field.fieldData(t,a)));var t=e.renderProps.sortOptions[0],a=e.renderProps.sortOptions[1];if(a){var n=o(t),i=o(a),r="$jb_$sort_"+t.field.title;e.items.sort((e,t)=>e[r]==t[r]?i(e,t):n(e,t))}else e.items.sort(o(t))}function o(e){var t="$jb_$sort_"+e.field.title;if(e.field.numeric)var a=(e,a)=>e[t]-a[t];else a=(e,a)=>e[t]==a[t]?0:e[t]<a[t]?-1:1;return"asc"==e.dir?a:(e,t)=>a(t,e)}}}})}),jb.component("goto-url",{type:"action",description:"navigate/open a new web page, change href location",params:[{id:"url",as:"string",mandatory:!0},{id:"target",type:"enum",values:["new tab","self"],defaultValue:"new tab",as:"string"}],impl:(e,t,a)=>{var n="new tab"==a?"_blank":"_self";e.probe||window.open(t,n)}}),jb.ns("mdc,mdc-style"),jb.component("mdc-style.init-dynamic",{type:"feature",params:[{id:"query",as:"string"}],impl:e=>({afterViewInit:e=>{if(!jb.ui.material)return jb.logError("please load mdc library");e.mdc_comps=e.mdc_comps||[],e.base.classList.contains("mdc-text-field")?e.mdc_comps.push(new jb.ui.material.MDCTextField(e.base)):e.base.classList.contains("mdc-button")||e.base.classList.contains("mdc-fab")?e.mdc_comps.push(new jb.ui.material.MDCRipple(e.base)):e.base.classList.contains("mdc-switch")?e.mdc_comps.push(new jb.ui.material.MDCSwitch(e.base)):e.base.classList.contains("mdc-chip-set")&&e.mdc_comps.push(new jb.ui.material.MDCChipSet(e.base))},destroy:e=>(e.mdc_comps||[]).forEach(e=>e.destroy())})}),jb.component("mdc.ripple-effect",{type:"feature",description:"add ripple effect",impl:e=>({templateModifier:e=>("mdc-ripple-surface mdc-ripple-radius-bounded mdc-states mdc-states-base-color(red)".split(" ").forEach(t=>e.addClass(t)),e)})}),jb.component("label.mdc-ripple-effect",{type:"text.style",impl:customStyle({template:(e,t,a)=>a("button",{class:"mdc-button"},[a("div",{class:"mdc-button__ripple"}),a("span",{class:"mdc-button__label"},t.text)]),css:">span { text-transform: none; }",features:[text.bindText(),mdcStyle.initDynamic()]})}),jb.component("button.href",{type:"button.style",impl:customStyle({template:(e,{title:t,raised:a},n)=>n("a",{class:a?"raised":"",href:"javascript:;",onclick:!0},t),css:"{color: grey} .raised { font-weight: bold }"})}),jb.component("button.x",{type:"button.style",params:[{id:"size",as:"number",defaultValue:"21"}],impl:customStyle({template:(e,t,a)=>a("button",{title:t.title,onclick:!0},""),css:"{\n            padding: 0;\n            cursor: pointer;\n            font: %$size%px sans-serif;\n            border: none;\n            background: transparent;\n            color: rgba(0,0,0,0.2);\n            text-shadow: 0 1px 0 #fff;\n            font-weight: 700;\n        }\n        :hover { color: rgba(0,0,0,0.5) }"})}),jb.component("button.native",{type:"button.style",impl:customStyle({template:(e,{title:t,raised:a},n)=>n("button",{class:a?"raised":"",title:t,onclick:!0},t),css:".raised {font-weight: bold}"})}),jb.component("button.mdc",{type:"button.style",params:[{id:"ripple",as:"boolean",defaultValue:!0,type:"boolean"}],impl:customStyle({template:(e,{title:t,raised:a},n)=>n("button",{class:["mdc-button",a&&"raised mdc-button--raised"].filter(e=>e).join(" "),onclick:!0},[n("div",{class:"mdc-button__ripple"}),n("span",{class:"mdc-button__label"},t)]),features:mdcStyle.initDynamic()})}),jb.component("button.mdc-icon",{type:"button.style,icon-with-action.style",params:[{id:"icon",as:"string",defaultValue:"bookmark_border"},{id:"raisedIcon",as:"string"}],impl:customStyle({template:(e,{title:t,icon:a,raised:n,raisedIcon:i},r)=>r("button",{class:["mdc-icon-button material-icons",n&&"raised mdc-icon-button--on"].filter(e=>e).join(" "),title:t,tabIndex:-1,onclick:!0},[r("i",{class:"material-icons mdc-icon-button__icon mdc-icon-button__icon--on"},i||a),r("i",{class:"material-icons mdc-icon-button__icon "},a)]),css:"{ border-radius: 2px; padding: 0; width: 24px; height: 24px;}",features:mdcStyle.initDynamic()})}),jb.component("button.mdc-chip-action",{type:"button.style",params:[],impl:customStyle({template:(e,{title:t,raised:a},n)=>n("div",{class:"mdc-chip-set mdc-chip-set--choice"},n("div",{class:["mdc-chip",a&&"mdc-chip--selected raised"].filter(e=>e).join(" ")},[n("div",{class:"mdc-chip__ripple"}),n("span",{role:"gridcell"},n("span",{role:"button",tabindex:-1,class:"mdc-chip__text"},t))])),features:mdcStyle.initDynamic()})}),jb.component("button.mdc-chip-with-icons",{type:"button.style,icon-with-action.style",params:[{id:"leadingIcon",as:"string",defaultValue:"code"},{id:"trailingIcon",as:"string",defaultValue:"code"}],impl:customStyle({template:(e,{title:t,raised:a,leadingIcon:n,trailingIcon:i},r)=>r("div",{class:"mdc-chip-set mdc-chip-set--choice"},r("div",{class:["mdc-chip",a&&"mdc-chip--selected raised"].filter(e=>e).join(" ")},[r("div",{class:"mdc-chip__ripple"}),...n?[r("i",{class:"material-icons mdc-chip__icon mdc-chip__icon--leading"},n)]:[],r("span",{role:"gridcell"},r("span",{role:"button",tabindex:-1,class:"mdc-chip__text"},t)),...i?[r("i",{class:"material-icons mdc-chip__icon mdc-chip__icon--trailing"},i)]:[]])),features:mdcStyle.initDynamic()})}),jb.component("button.mdc-floating-action",{type:"button.style,icon-with-action.style",description:"fab icon",params:[{id:"icon",as:"string",defaultValue:"code"},{id:"mini",as:"boolean",type:"boolean"}],impl:customStyle({template:(e,{title:t,icon:a,mini:n,raised:i},r)=>r("button",{class:["mdc-fab",i&&"raised mdc-icon-button--on",n&&"mdc-fab--mini"].filter(e=>e).join(" "),title:t,tabIndex:-1,onclick:!0},[r("div",{class:"mdc-fab__ripple"}),r("span",{class:"mdc-fab__icon material-icons"},a)]),features:mdcStyle.initDynamic()})}),jb.component("button.mdc-floating-with-title",{type:"button.style,icon-with-action.style",params:[{id:"icon",as:"string",defaultValue:"code"},{id:"mini",as:"boolean",type:"boolean"}],impl:customStyle({template:(e,{title:t,icon:a,mini:n,raised:i},r)=>r("button",{class:["mdc-fab mdc-fab--extended",i&&"mdc-icon-button--on",n&&"mdc-fab--mini"].filter(e=>e).join(" "),title:t,tabIndex:-1,onclick:!0},[r("div",{class:"mdc-fab__ripple"}),...a?[r("span",{class:"mdc-fab__icon material-icons"},a)]:[],r("span",{class:"mdc-fab__label"},t)]),features:mdcStyle.initDynamic()})}),jb.component("button.mdc-icon12",{type:"button.style,icon-with-action.style",params:[{id:"icon",as:"string",defaultValue:"code"}],impl:customStyle({template:(e,{icon:t,raised:a},n)=>n("i",{class:["material-icons",a&&"raised mdc-icon-button--on"].filter(e=>e).join(" "),onclick:!0},t),css:"{ font-size:12px; cursor: pointer }"})}),jb.ns("mdc,mdc-style"),jb.component("editable-text.input",{type:"editable-text.style",impl:customStyle({template:(e,{databind:t},a)=>a("input",{value:t,onchange:!0,onkeyup:!0,onblur:!0}),features:field.databindText()})}),jb.component("editable-text.textarea",{type:"editable-text.style",params:[{id:"rows",as:"number",defaultValue:4},{id:"cols",as:"number",defaultValue:120},{id:"oneWay",type:"boolean",as:"boolean",defaultValue:!0}],impl:customStyle({template:(e,{databind:t,rows:a,cols:n},i)=>i("textarea",{rows:a,cols:n,value:t,onchange:!0,onkeyup:!0,onblur:!0}),features:field.databindText(0,"%$oneWay%")})}),jb.component("editable-text.mdc-input",{type:"editable-text.style,editable-number.style",params:[{id:"width",as:"number"}],impl:customStyle({template:(e,t,a)=>a("div",{class:["mdc-text-field",t.error?"is-invalid":""].join(" ")},[a("input",{type:"text",class:"mdc-text-field__input",id:"input_"+t.fieldId,value:t.databind,onchange:!0,onkeyup:!0,onblur:!0}),a("label",{class:"mdc-floating-label",for:"input_"+t.fieldId},t.title),a("div",{class:"mdc-line-ripple"}),a("span",{class:"mdc-text-field-helper-text"},t.error||"")]),css:"{ {?width: %$width%px?} }",features:[field.databindText(),mdcStyle.initDynamic()]})}),jb.component("editable-text.mdc-no-label",{type:"editable-text.style",params:[{id:"width",as:"number"}],impl:customStyle({template:(e,t,a)=>a("div",{class:"mdc-text-field mdc-text-field--no-label"},a("input",{class:"mdc-text-field__input",type:"text",value:t.databind,onchange:!0,onkeyup:!0,onblur:!0}),a("div",{class:"mdc-line-ripple"})),css:"{ padding: 0 !important; {?width: %$width%px?} } :focus { border-color: #3F51B5; border-width: 2px}",features:[field.databindText(),mdcStyle.initDynamic()]})}),jb.component("editable-text.mdc-search",{description:"debounced and one way binding",type:"editable-text.style",impl:customStyle({template:(e,{databind:t,fieldId:a,title:n},i)=>i("div",{class:"mdc-text-field"},[i("input",{class:"mdc-text-field__input",id:"search_"+a,type:"text",value:t,onchange:!0,onkeyup:!0,onblur:!0}),i("label",{class:"mdc-floating-label mdc-floating-label--float-above",for:"search_"+a},t?"":n)]),features:[field.databindText(),mdcStyle.initDynamic()]})}),jb.component("editable-text.expandable",{description:"label that changes to editable class on double click",type:"editable-text.style",params:[{id:"buttonFeatures",type:"feature[]",flattenArray:!0,dynamic:!0},{id:"editableFeatures",type:"feature[]",flattenArray:!0,dynamic:!0},{id:"buttonStyle",type:"button.style",dynamic:!0,defaultValue:button.href()},{id:"editableStyle",type:"editable-text.style",dynamic:!0,defaultValue:editableText.input()},{id:"onToggle",type:"action",dynamic:!0}],impl:styleByControl(group({controls:[editableText({databind:"%$editableTextModel/databind%",updateOnBlur:!0,style:call("editableStyle"),features:[watchRef("%$editable%"),hidden("%$editable%"),(e,{expandableContext:t})=>({afterViewInit:a=>{const n=a.base.matches("input,textarea")?a.base:a.base.querySelector("input,textarea");n&&(n.onblur=()=>a.ctx.run(runActions(toggleBooleanValue("%$editable%"),(e,t,{onToggle:a})=>a(e)))),t.regainFocus=()=>jb.delay(1).then(()=>jb.ui.focus(n,"editable-text.expandable",e))}}),(e,t,{editableFeatures:a})=>a(e)]}),button({title:"%$editableTextModel/databind%",action:runActions(toggleBooleanValue("%$editable%"),(e,{expandableContext:t})=>t.regainFocus(),(e,t,{onToggle:a})=>a(e)),style:call("buttonStyle"),features:[watchRef("%$editable%"),hidden(not("%$editable%")),(e,t,{buttonFeatures:a})=>a(e)]})],features:[variable({name:"editable",watchable:!0}),variable({name:"expandableContext",value:obj()})]}),"editableTextModel")}),jb.component("layout.vertical",{type:"layout,feature",params:[{id:"spacing",as:"string",defaultValue:3}],impl:css(({},{},{spacing:e})=>`{display: flex; flex-direction: column}\n          >* { ${jb.ui.propWithUnits("margin-bottom",e)} }\n          >*:last-child { margin-bottom:0 }`)}),jb.component("layout.horizontal",{type:"layout,feature",params:[{id:"spacing",as:"string",defaultValue:3}],impl:css(({},{},{spacing:e})=>`{display: flex}\n        >* { ${jb.ui.propWithUnits("margin-right",e)} }\n        >*:last-child { margin-right:0 }`)}),jb.component("layout.horizontal-fixed-split",{type:"layout,feature",params:[{id:"leftWidth",as:"string",defaultValue:"200px",mandatory:!0},{id:"rightWidth",as:"string",defaultValue:"100%",mandatory:!0},{id:"spacing",as:"string",defaultValue:3}],impl:e=>({css:`{display: flex}\n        >*:first-child { ${jb.ui.propWithUnits("margin-right",e.params.spacing)}\n        ${jb.ui.propWithUnits("width",e.params.leftWidth)} }\n        >*:last-child { margin-right:0; ${jb.ui.propWithUnits("width",e.params.rightWidth)} }`})}),jb.component("layout.horizontal-wrapped",{type:"layout,feature",params:[{id:"spacing",as:"string",defaultValue:3}],impl:e=>({css:`{display: flex}\n        >* {${jb.ui.propWithUnits("margin-right",e.params.spacing)} }\n        >*:last-child { margin-right:0 }`})}),jb.component("layout.flex",{type:"layout,feature",params:[{id:"direction",as:"string",options:",row,row-reverse,column,column-reverse"},{id:"justifyContent",as:"string",options:",flex-start,flex-end,center,space-between,space-around"},{id:"alignItems",as:"string",options:",normal,stretch,center,start,end,flex-start,flex-end,baseline,first baseline,last baseline,safe center,unsafe center"},{id:"wrap",as:"string",options:",wrap,wrap-reverse,nowrap"},{id:"spacing",as:"string"}],impl:e=>({css:e.setVars({spacingWithUnits:jb.ui.withUnits(e.params.spacing),...e.params}).exp(`{ display: flex; {?align-items:%$alignItems%;?} {?justify-content:%$justifyContent%;?} {?flex-direction:%$direction%;?} {?flex-wrap:%$wrap%;?} }\n      {?>* { margin-right: %$spacingWithUnits% }?}\n    ${e.params.spacing?">*:last-child { margin-right:0 }":""}`)})}),jb.component("layout.grid",{type:"layout,feature",params:[{id:"columnSizes",as:"array",templateValue:list("auto","auto"),description:"grid-template-columns, list of lengths"},{id:"rowSizes",as:"array",description:"grid-template-rows, list of lengths"},{id:"columnGap",as:"string",description:"grid-column-gap"},{id:"rowGap",as:"string",description:"grid-row-gap"}],impl:e=>({css:e.setVars({...e.params,colSizes:e.params.columnSizes.map(e=>jb.ui.withUnits(e)).join(" "),rowSizes:e.params.rowSizes.map(e=>jb.ui.withUnits(e)).join(" ")}).exp("{ display: grid; {?grid-template-columns:%$colSizes%;?} {?grid-template-rows:%$rowSizes%;?}\n            {?grid-column-gap:%$columnGap%;?} {?grid-row-gap:%$rowGap%;?} }")})}),jb.component("flex-item.grow",{type:"feature",category:"flex-item",params:[{id:"factor",as:"string",defaultValue:"1"}],impl:{$:"feature.css",$byValue:["flex-grow: %$factor%"]}}),jb.component("flex-item.basis",{type:"feature",category:"flex-item",params:[{id:"factor",as:"string",defaultValue:"1"}],impl:{$:"feature.css",$byValue:["flex-basis: %$factor%"]}}),jb.component("flex-item.align-self",{type:"feature",category:"flex-item",params:[{id:"align",as:"string",options:"auto,flex-start,flex-end,center,baseline,stretch",defaultValue:"auto"}],impl:{$:"feature.css",$byValue:["align-self: %$align%"]}}),jb.ns("css"),jb.component("group.htmlTag",{type:"group.style",params:[{id:"htmlTag",as:"string",defaultValue:"section",options:"div,ul,article,aside,details,figcaption,figure,footer,header,main,mark,nav,section,summary,label,form"},{id:"groupClass",as:"string"},{id:"itemClass",as:"string"}],impl:customStyle({template:(e,{htmlTag:t,groupClass:a,itemClass:n,ctrls:i},r)=>r(t,{class:a},i.map(e=>r(e,{class:n}))),features:group.initGroup()})}),jb.component("group.div",{type:"group.style",impl:group.htmlTag("div")}),jb.component("group.section",{type:"group.style",impl:group.htmlTag("section")}),jb.component("group.ul-li",{type:"group.style",impl:customStyle({template:(e,{ctrls:t},a)=>a("ul",{class:"jb-itemlist"},t.map(e=>a("li",{class:"jb-item"},a(e)))),css:"{ list-style: none; padding: 0; margin: 0;}\n    >li { list-style: none; padding: 0; margin: 0;}",features:group.initGroup()})}),jb.component("group.card",{type:"feature",category:"card:100",params:[{id:"padding",as:"string",defaultValue:10},{id:"width",as:"string",defaultValue:320},{id:"outlined",as:"boolean",type:"boolean"}],impl:features(css.class(({},{},{outlined:e})=>["mdc-card",...e?["mdc-card--outlined"]:[]].join(" ")),css(({},{},{padding:e,width:t})=>[jb.ui.propWithUnits("padding",e),jb.ui.propWithUnits("width",t)].filter(e=>e).join(";")))}),jb.component("group.chip-set",{type:"feature",category:"chip:100",params:[{id:"spacing",as:"string",defaultValue:3}],impl:features(css.class("mdc-chip-set"),mdcStyle.initDynamic())}),jb.component("group.tabs",{type:"group.style",params:[{id:"width",as:"number"},{id:"tabStyle",type:"button.style",dynamic:!0,defaultValue:button.mdc()}],impl:styleByControl(group({controls:[group({title:"thumbs",layout:layout.horizontal(),controls:dynamicControls({controlItems:"%$tabsModel/controls%",genericControl:button({title:"%$tab/field/title%",action:writeValue("%$selectedTab%","%$tabIndex%"),style:call("tabStyle"),raised:"%$tabIndex% == %$selectedTab%",features:[css.width("%$width%"),css("{text-align: left}"),watchRef("%$selectedTab%")]}),itemVariable:"tab",indexVariable:"tabIndex"})}),controlWithFeatures("%$tabsModel/controls[{%$selectedTab%}]%",watchRef("%$selectedTab%"))],features:variable({name:"selectedTab",value:0,watchable:!0})}),"tabsModel")}),jb.component("group.accordion",{type:"group.style",params:[{id:"titleStyle",type:"button.style",dynamic:!0,defaultValue:button.mdc()},{id:"sectionStyle",type:"group.style",dynamic:!0,defaultValue:group.section()},{id:"innerGroupStyle",type:"group.style",dynamic:!0,defaultValue:group.div()}],impl:styleByControl(group({controls:dynamicControls({controlItems:"%$sectionsModel/controls%",genericControl:group({style:call("sectionStyle"),controls:[button({title:"%$section/field/title%",action:writeValue("%$selectedTab%","%$sectionIndex%"),style:call("titleStyle"),raised:"%$sectionIndex% == %$selectedTab%",features:[css.width("%$width%"),css("{justify-content: left}"),watchRef("%$selectedTab%")]}),group({style:call("innerGroupStyle"),controls:"%$sectionsModel/controls[{%$sectionIndex%}]%",features:[feature.if("%$sectionIndex% == %$selectedTab%"),watchRef("%$selectedTab%")]})]}),itemVariable:"section",indexVariable:"sectionIndex"}),features:variable({name:"selectedTab",value:0,watchable:!0})}),"sectionsModel")}),jb.component("group.sections",{type:"group.style",params:[{id:"titleStyle",type:"text.style",dynamic:!0,defaultValue:header.mdcHeadline5()},{id:"sectionStyle",type:"group.style",dynamic:!0,defaultValue:styleWithFeatures(group.div(),[group.card({}),css.padding({})])},{id:"innerGroupStyle",type:"group.style",dynamic:!0,defaultValue:group.div()}],impl:styleByControl(group({controls:dynamicControls({controlItems:"%$sectionsModel/controls%",genericControl:group({style:call("sectionStyle"),controls:[text({text:"%$section/field/title%",style:call("titleStyle")}),group({style:call("innerGroupStyle"),controls:"%$section%"})]}),itemVariable:"section"})}),"sectionsModel")}),jb.ns("mdc.style"),jb.component("table.plain",{params:[{id:"hideHeaders",as:"boolean",type:"boolean"}],type:"table.style,itemlist.style",impl:customStyle({template:(e,{items:t,fields:a,hideHeaders:n},i)=>i("div",{},i("table",{},[...n?[]:[i("thead",{},i("tr",{},a.map(t=>i("th",{"jb-ctx":t.ctxId,style:{width:t.width?t.width+"px":""}},jb.ui.fieldTitle(e,t,i)))))],i("tbody",{class:"jb-drag-parent"},t.map((t,n)=>jb.ui.item(e,i("tr",{class:"jb-item","jb-ctx":jb.ui.preserveCtx(e.ctx.setData(t))},a.map(e=>i("td",jb.filterEmpty({"jb-ctx":jb.ui.preserveFieldCtxWithItem(e,t),class:e.class,title:e.hoverTitle&&e.hoverTitle(t)}),e.control?i(e.control(t,n),{index:n,row:t}):e.fieldData(t,n)))),t))),0==t.length?"no items":""])),css:">table{border-spacing: 0; text-align: left; width: 100%}\n    >table>tbody>tr>td { padding-right: 5px }\n    ",features:table.initTableOrItemlist()})}),jb.component("table.mdc",{type:"table.style,itemlist.style",params:[{id:"hideHeaders",as:"boolean",type:"boolean"},{id:"classForTable",as:"string",defaultValue:"mdc-data-table__table mdc-data-table--selectable"}],impl:customStyle({template:(e,{items:t,fields:a,classForTable:n,classForTd:i,sortOptions:r,hideHeaders:o},s)=>s("div",{class:"mdc-data-table"},s("table",{class:n},[...o?[]:[s("thead",{},s("tr",{class:"mdc-data-table__header-row"},a.map((t,a)=>s("th",{"jb-ctx":t.ctxId,class:["mdc-data-table__header-cell"].concat(["asc"==(r&&r.filter(e=>e.field==t)[0]||{}).dir?"mdc-data-table__header--sorted-ascending":"","des"==(r&&r.filter(e=>e.field==t)[0]||{}).dir?"mdc-data-table__header--sorted-descending":""]).filter(e=>e).join(" "),style:{width:t.width?t.width+"px":""},onclick:"toggleSort",fieldIndex:a},jb.ui.fieldTitle(e,t,s)))))],s("tbody",{class:"jb-drag-parent mdc-data-table__content"},t.map((t,n)=>jb.ui.item(e,s("tr",{class:"jb-item mdc-data-table__row","jb-ctx":jb.ui.preserveCtx(e.ctx.setData(t))},a.map(e=>s("td",jb.filterEmpty({"jb-ctx":jb.ui.preserveFieldCtxWithItem(e,t),class:(e.class+" "+i+" mdc-data-table__cell").trim(),title:e.hoverTitle&&e.hoverTitle(t)}),e.control?s(e.control(t,n)):e.fieldData(t,n)))),t))),0==t.length?"no items":""])),css:"{width: 100%} \n    ~ .mdc-data-table__header-cell {font-weight: 700}",features:[table.initTableOrItemlist(),table.initSort(),mdcStyle.initDynamic()]})}),jb.component("picklist.native",{type:"picklist.style",impl:customStyle({template:(e,t,a)=>a("select",{value:t.databind,onchange:!0},t.options.map(e=>a("option",{value:e.code},e.text))),css:"\n{ display: block; width: 100%; height: 34px; padding: 6px 12px; font-size: 14px; line-height: 1.42857; color: #555555; background-color: #fff; background-image: none; border: 1px solid #ccc; border-radius: 4px; -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075); box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075); -webkit-transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s; -o-transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s; transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s; }\n:focus { border-color: #66afe9; outline: 0; -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(102, 175, 233, 0.6); box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(102, 175, 233, 0.6); }\n::-webkit-input-placeholder { color: #999; }",features:field.databind()})}),jb.component("picklist.radio",{type:"picklist.style",params:[{id:"radioCss",as:"string",defaultValue:"",description:"e.g. display: none"},{id:"text",defaultValue:"%text%",dynamic:!0}],impl:customStyle({template:(e,{databind:t,options:a,fieldId:n,text:i},r)=>r("div",{},a.flatMap((a,o)=>[r("input",{type:"radio",name:n,id:o,checked:t===a.code,value:a.code,onchange:!0}),r("label",{for:o},i(e.ctx.setData(a)))])),css:">input { %$radioCss% }",features:field.databind()})}),jb.component("picklist.radio-vertical",{type:"picklist.style",impl:styleWithFeatures(picklist.radio(),layout.grid({columnSizes:list("30px","auto")}))}),jb.component("picklist.native-md-look-open",{type:"picklist.style",impl:customStyle({template:(e,t,a)=>a("div",{},[a("input",{type:"text",value:t.databind,list:"list_"+e.ctx.id,onchange:!0}),a("datalist",{id:"list_"+e.ctx.id},t.options.map(e=>a("option",{},e.text)))]),css:">input {  appearance: none; -webkit-appearance: none; font-family: inherit;\n  background-color: transparent;\n  padding: 6px 0;\n  font-size: 14px;\n  width: 100%;\n  color: rgba(0,0,0, 0.82);\n  border: none;\n  border-bottom: 1px solid rgba(0,0,0, 0.12); }\n\n  {\n    font-family: 'Roboto','Helvetica','Arial',sans-serif;\n    position: relative;\n  }\n  >input:focus { border-color: #3F51B5; border-width: 2px}\n\n  :after { position: absolute;\n        top: 0.75em;\n        right: 0.5em;\n        /* Styling the down arrow */\n        width: 0;\n        height: 0;\n        padding: 0;\n        content: '';\n        border-left: .25em solid transparent;\n        border-right: .25em solid transparent;\n        border-top: .375em solid rgba(0,0,0, 0.12);\n        pointer-events: none; }",features:field.databind()})}),jb.component("picklist.native-md-look",{type:"picklist.style",impl:customStyle({template:(e,t,a)=>a("div",{},a("select",{value:t.databind,onchange:!0},t.options.map(e=>a("option",{value:e.code},e.text)))),css:">select {  appearance: none; -webkit-appearance: none; font-family: inherit;\n  background-color: transparent;\n  padding: 6px 0;\n  font-size: 14px;\n  width: 100%;\n  color: rgba(0,0,0, 0.82);\n  border: none;\n  border-bottom: 1px solid rgba(0,0,0, 0.12); }\n\n  {\n    font-family: 'Roboto','Helvetica','Arial',sans-serif;\n    position: relative;\n  }\n  >select:focus { border-color: #3F51B5; border-width: 2px}\n\n  :after { position: absolute;\n        top: 0.75em;\n        right: 0.5em;\n        /* Styling the down arrow */\n        width: 0;\n        height: 0;\n        padding: 0;\n        content: '';\n        border-left: .25em solid transparent;\n        border-right: .25em solid transparent;\n        border-top: .375em solid rgba(0,0,0, 0.12);\n        pointer-events: none; }",features:field.databind()})}),jb.component("picklist.label-list",{type:"picklist.style",params:[{id:"labelStyle",type:"text.style",dynamic:!0,defaultValue:text.span()},{id:"itemlistStyle",type:"itemlist.style",dynamic:!0,defaultValue:itemlist.ulLi()},{id:"cssForSelected",as:"string",description:"e.g. background: red OR >a { color: red }",defaultValue:"background: #bbb; color: #fff"}],impl:styleByControl(itemlist({items:"%$picklistModel/options%",controls:text({text:"%text%",style:call("labelStyle")}),style:call("itemlistStyle"),features:itemlist.selection({databind:"%$picklistModel/databind%",selectedToDatabind:"%code%",databindToSelected:e=>e.vars.items.filter(t=>t.code==e.data)[0],cssForSelected:"%$cssForSelected%"})}),"picklistModel")}),jb.component("picklist.button-list",{type:"picklist.style",params:[{id:"buttonStyle",type:"button.style",dynamic:!0,defaultValue:button.mdc()},{id:"itemlistStyle",type:"itemlist.style",dynamic:!0,defaultValue:itemlist.horizontal()},{id:"cssForSelected",as:"string",description:"e.g. background: red;color: blue;font-weight: bold;",defaultValue:"background: #bbb; color: #fff"}],impl:styleByControl(itemlist({items:"%$picklistModel/options%",controls:button({title:"%text%",style:call("buttonStyle")}),style:call("itemlistStyle"),features:itemlist.selection({databind:"%$picklistModel/databind%",selectedToDatabind:"%code%",databindToSelected:e=>e.vars.items.filter(t=>t.code==e.data)[0],cssForSelected:"%$cssForSelected%"})}),"picklistModel")}),jb.component("picklist.hyperlinks",{type:"picklist.style",impl:picklist.buttonList({buttonStyle:button.href(),itemlistStyle:itemlist.horizontal("10"),cssForSelected:">a { color: red }"})}),jb.component("picklist.groups",{type:"picklist.style",impl:customStyle({template:(e,t,a)=>a("select",{value:t.databind,onchange:!0},(t.hasEmptyOption?[a("option",{value:""},"")]:[]).concat(t.groups.map(e=>a("optgroup",{label:e.text},e.options.map(e=>a("option",{value:e.code},e.text)))))),css:"\n { display: block; width: 100%; height: 34px; padding: 6px 12px; font-size: 14px; line-height: 1.42857; color: #555555; background-color: #fff; background-image: none; border: 1px solid #ccc; border-radius: 4px; -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075); box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075); -webkit-transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s; -o-transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s; transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s; }\nselect:focus { border-color: #66afe9; outline: 0; -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(102, 175, 233, 0.6); box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(102, 175, 233, 0.6); }\nselect::-webkit-input-placeholder { color: #999; }",features:field.databind()})}),jb.component("property-sheet.titles-left",{type:"group.style",params:[{id:"titleStyle",type:"text.style",defaultValue:styleWithFeatures(text.span(),css.bold()),dynamic:!0},{id:"titleText",defaultValue:"%%:",dynamic:!0},{id:"spacing",as:"string",description:"grid-column-gap",defaultValue:"10px"}],impl:customStyle({template:(e,{ctrls:t,titleStyle:a,titleText:n},i)=>i("div",{},t.flatMap(t=>[i(e.ctx.run(text({text:e=>n(e.setData(t.field().title())),style:e=>a(e)}))),i(t)])),css:"{ display: grid; grid-template-columns: auto auto; grid-column-gap:%$spacing%}",features:group.initGroup()})}),jb.component("property-sheet.titles-above",{type:"group.style",params:[{id:"titleStyle",type:"text.style",defaultValue:styleWithFeatures(text.span(),css.bold()),dynamic:!0},{id:"titleText",defaultValue:"%%",dynamic:!0},{id:"spacing",as:"string",description:"grid-column-gap",defaultValue:"10px"}],impl:customStyle({template:(e,{ctrls:t,titleStyle:a,titleText:n},i)=>i("div",{style:{"grid-template-columns":t.map(()=>"auto").join(" ")}},[...t.map(t=>i(e.ctx.run(text({text:e=>n(e.setData(t.field().title())),style:e=>a(e)})))),...t.map(e=>i(e))]),css:"{ display: grid; grid-column-gap:%$spacing% }",features:group.initGroup()})}),jb.component("editable-boolean.checkbox",{type:"editable-boolean.style",impl:customStyle({template:(e,t,a)=>a("input",{type:"checkbox",checked:t.databind,onchange:"setChecked",onkeyup:"setChecked"}),features:field.databind()})}),jb.component("editable-boolean.checkbox-with-title",{type:"editable-boolean.style",impl:customStyle({template:(e,t,a)=>a("div",{},[a("input",{type:"checkbox",checked:t.databind,onchange:"setChecked",onkeyup:"setChecked"}),t.text]),features:field.databind()})}),jb.component("editable-boolean.expand-collapse",{type:"editable-boolean.style",impl:customStyle({template:(e,{databind:t},a)=>a("i",{class:"material-icons noselect",onclick:"toggle"},t?"keyboard_arrow_down":"keyboard_arrow_right"),css:"{ font-size:16px; cursor: pointer; }",features:field.databind()})}),jb.component("editable-boolean.mdc-x-v",{type:"editable-boolean.style",description:"two icons",params:[{id:"yesIcon",as:"string",mandatory:!0,defaultValue:"check"},{id:"noIcon",as:"string",mandatory:!0,defaultValue:"close"}],impl:customStyle({template:(e,{title:t,databind:a,yesIcon:n,noIcon:i},r)=>r("button",{class:["mdc-icon-button material-icons",a&&"raised mdc-icon-button--on"].filter(e=>e).join(" "),title:t,tabIndex:-1,onclick:"toggle"},[r("i",{class:"material-icons mdc-icon-button__icon mdc-icon-button__icon--on"},n),r("i",{class:"material-icons mdc-icon-button__icon "},i)]),css:"{ border-radius: 2px; padding: 0; width: 24px; height: 24px;}",features:[field.databind(),mdcStyle.initDynamic()]})}),jb.component("editable-boolean.mdc-slide-toggle",{type:"editable-boolean.style",params:[{id:"width",as:"string",defaultValue:80}],impl:customStyle({template:(e,t,a)=>a("div",{class:"mdc-switch"},[a("div",{class:"mdc-switch__track"}),a("div",{class:"mdc-switch__thumb-underlay"},[a("div",{class:"mdc-switch__thumb"},a("input",{type:"checkbox",role:"switch",class:"mdc-switch__native-control",id:"switch_"+t.fieldId,checked:t.databind,onchange:"setChecked"}))]),a("label",{for:"switch_"+t.fieldId},t.text)]),css:e=>jb.ui.propWithUnits("width",e.params.width),features:[field.databind(),editableBoolean.keyboardSupport(),mdcStyle.initDynamic()]})}),jb.component("editable-boolean.checkbox-with-label",{type:"editable-boolean.style",impl:customStyle({template:(e,t,a)=>a("div",{},[a("input",{type:"checkbox",id:"switch_"+t.fieldId,checked:t.databind,onchange:"setChecked",onkeyup:"setChecked"}),a("label",{for:"switch_"+t.fieldId},t.text)]),features:field.databind()})}),jb.component("pretty-print",{params:[{id:"profile",defaultValue:"%%"},{id:"forceFlat",as:"boolean",type:"boolean"}],impl:(e,t)=>jb.prettyPrint(jb.val(t),e.params)}),jb.prettyPrintComp=function(e,t,a={}){if(t){const n=` /* ${jb.macroName(e)} */`;return("jb.component('"+e+"', "+jb.prettyPrint(t,a)+")").replace(/\n/,n+"\n")}},jb.prettyPrint=function(e,t={}){return jb.prettyPrintWithPositions(e,t).text},jb.prettyPrint.advanceLineCol=function({line:e,col:t},a){const n=(a.match(/\n/g)||"").length;return{line:e+n,col:n?a.match(/\n(.*)$/)[1].length:t+a.length}},jb.prettyPrint.spaces=Array.from(new Array(200)).map(e=>" ").join(""),jb.prettyPrintWithPositions=function(e,{colWidth:t=80,tabSize:a=2,initialPath:n="",showNulls:i,comps:r,forceFlat:o}={}){if(r=r||jb.comps,!e||"object"!=typeof e)return{text:null!=e&&e.toString?e.toString():JSON.stringify(e),map:{}};const s=jb.prettyPrint.advanceLineCol;return d({path:n,line:0,col:0},e);function l(e,t){const a=t.reduce((t,{prop:a,item:n})=>{const i="function"==typeof n?n(t):n,r=i.text||i,o=i.map||{},l=i.path||e.path,c=s(t,""),d=s(t,r),p={...t.map,...o,[[l,a].join("~")]:[c.line,c.col,d.line,d.col]};return{text:t.text+r,map:p,unflat:t.unflat||i.unflat,...d}},{text:"",map:{},...e});return{...e,...a}}function c({path:e,line:n,col:i},r,s,p,m,u){const b={path:e,line:n,col:i},f=l(b,[..."string"==typeof s?[{prop:"!open",item:s}]:s,{prop:"!open-newline",item:()=>x()}]),y=u?"array":"obj",h=r.reduce((t,{innerPath:a,val:n},i)=>l(t,[{prop:`!${y}-prefix-${i}`,item:u?"":v(a)+": "},{prop:"!value",item:t=>{const i={...t,path:[e,a].join("~")};return{...i,...d(i,n,m)}}},{prop:`!${y}-separator-${i}`,item:()=>i===r.length-1?"":","+(m?" ":x())}]),{...f,unflat:!1}),g=l(h,[{prop:"!close-newline",item:()=>x(-1)},..."string"==typeof p?[{prop:"!close",item:p}]:p]),j=function(a){const n=jb.studio.valOfPath(e);if(e.match(/~params~[0-9]+$/))return!1;const i=e.match(/~controls$/)&&Array.isArray(n),r=jb.studio.compNameOfPath&&"customStyle"===jb.studio.compNameOfPath(e),o=(e.match(/~/g)||"").length<2,s=a.text.replace(/\n\s*/g,"").length>t;return a.unflat||r||o||i||s}(g);return!o&&j||m?Object.assign(g,{unflat:j}):c(b,r,s,p,!0,u);function x(t=0){return m?"":"\n"+jb.prettyPrint.spaces.slice(0,((e.match(/~/g)||"").length+t+1)*a)}function v(e){return e.match(/^[a-zA-Z_][a-zA-Z0-9_]*$/)?e:`'${e}'`}}function d({path:e,line:t,col:a},n,i){const o={path:e,line:t,col:a};let s=function(){if(Array.isArray(n))return function({path:e,line:t,col:a},n,i){const r={path:e,line:t,col:a},o=n.map((e,t)=>({innerPath:t,val:e}));return c(r,o,[{prop:"!open-array",item:"["}],[{prop:"!close-array",item:"]"}],i,!0)}(o,n,i);if(null===n)return"null";if(void 0===n)return"undefined";if("object"==typeof n)return function({path:e,line:t,col:a},n,i){const o={path:e,line:t,col:a},s=[jb.compName(n)].map(e=>"var"==e?"variable":e)[0],l=r[s];if(l&&jb.fixByValue(n,l),!s||!l||-1!=",object,var,".indexOf(`,${s},`)){const e=Object.keys(n);return e.indexOf("$")>0&&(e.splice(e.indexOf("$"),1),e.unshift("$")),c(o,e.map(e=>({innerPath:e,val:n[e]})),"{","}",i,!1)}const d=jb.macroName(s),p=l.params||[],m=-1!=(p[0]&&p[0].type||"").indexOf("[]"),u=Object.keys(n.$vars||{}).map(e=>({innerPath:`$vars~${e}`,val:{$:"Var",name:e,val:n.$vars[e]}})),b=n.remark?[{innerPath:"remark",val:{$remark:n.remark}}]:[],f=u.concat(b),y=[{prop:"!profile",item:d},{prop:"!open-by-value",item:"("}],h=[{prop:"!close-by-value",item:")"}],g=[{prop:"!profile",item:d},{prop:"!open-sugar",item:"("}],j=[{prop:"!close-sugar",item:")"}],x=[{prop:"!profile",item:d},{prop:"!open-profile",item:"({"}];if(1==p.length&&m){return c(o,f.concat(jb.asArray(n["$"+s]||n[p[0].id]).map((e,t)=>({innerPath:p[0].id+"~"+t,val:e}))),g,j,i,!0)}const v=Object.keys(n).filter(e=>"$"!=e),w=1===v.length&&p[0]&&p[0].id==v[0]&&("object"!=typeof $(v[0])||Array.isArray($(v[0])));if(p.length<3&&!1!==l.macroByValue||l.macroByValue||w){const e=f.concat(p.map(e=>({innerPath:e.id,val:$(e.id)})));for(let t=0;t<5;t++)!e.length||e[e.length-1]&&void 0!==e[e.length-1].val||e.pop();return c(o,e,y,h,i,!0)}return c(o,(n.remark?[{innerPath:"remark",val:n.remark}]:[]).concat(u.length?[{innerPath:"vars",val:u.map(e=>e.val)}]:[]).concat(p.filter(e=>void 0!==$(e.id)).map(e=>({innerPath:e.id,val:$(e.id)}))),x,[{prop:"!close-profile",item:"})"}],i,!1);function $(e){return p[0]&&p[0].id==e&&n["$"+s]||n[e]}}(o,n,i);if("function"==typeof n)return n.toString();return"string"==typeof n&&-1==n.indexOf("'")&&-1==n.indexOf("\n")?l(o,[{prop:"!value-text-start",item:"'"},{prop:"!value-text",item:JSON.stringify(n).slice(1,-1)},{prop:"!value-text-end",item:"'"}]):"string"==typeof n&&-1!=n.indexOf("\n")?l(o,[{prop:"!value-text-start",item:"`"},{prop:"!value-text",item:n.replace(/`/g,"\\`")},{prop:"!value-text-end",item:"`"}]):JSON.stringify(n)}();return"string"==typeof s&&(s={text:s,map:{}}),s}},function(){jb.ns("tree"),jb.component("tree",{type:"control",params:[{id:"nodeModel",type:"tree.node-model",dynamic:!0,mandatory:!0},{id:"style",type:"tree.style",defaultValue:tree.expandBox({}),dynamic:!0},{id:"features",type:"feature[]",dynamic:!0,as:"array"}],impl:e=>{const t={},a=e.setVars({$tree:t}),n=a.params.nodeModel();return n?jb.ui.ctrl(a,features(defHandler("flipExpandCollapse",(e,{cmp:t})=>{const a=t.elemToPath(event.target);t.state.expanded[a]=!t.state.expanded[a],t.refresh()}),interactiveProp("model","%$$model.nodeModel%"),interactive((e,{cmp:a})=>{a.state.expanded={[a.model.rootPath]:!0},t.cmp=a,a.selectionEmitter=jb.callbag.subject(),t.redraw=a.redraw=()=>a.refresh(),a.expandPath=e=>{const t=jb.ui.treeExpandPath(a.state.expanded,e);return t&&a.redraw(),t},a.elemToPath=e=>e&&(e.getAttribute("path")||jb.ui.closest(e,".treenode")&&jb.ui.closest(e,".treenode").getAttribute("path"))}),feature.init((e,{cmp:t})=>{t.model=n,t.state.expanded=t.state.expanded||{},jb.ui.treeExpandPath(t.state.expanded,n.rootPath)}),css("{user-select: none}"))):jb.logError("missing nodeModel in tree",a)}}),jb.ui.treeExpandPath=jb.ui.treeExpandPath||((e,t)=>{let a=!1;return t.split("~").reduce((t,n)=>{const i=t?t+"~"+n:n;return a=a||!e[i],e[i]=!0,i},""),a});class e{constructor(e){Object.assign(this,e),this.model=this.cmp.model}renderTree(){const{model:e,h:t}=this;return this.noHead?t("div",{},e.children(e.rootPath).map(e=>this.renderNode(e))):this.renderNode(e.rootPath)}renderNode(e){const{cmp:t,model:a,h:n}=this,i=a.disabled&&a.disabled(e)?"jb-disabled":"",r=["treenode",a.isArray(e)?"jb-array-node":"",i].filter(e=>e).join(" "),o=t.state.expanded[e]?[n("div",{class:"treenode-children"},a.children(e).map(e=>this.renderNode(e)))]:[];return n("div",{class:r,path:e},[this.renderLine(e),...o])}}jb.component("tree.plain",{type:"tree.style",params:[{id:"showIcon",as:"boolean",type:"boolean"},{id:"noHead",as:"boolean",type:"boolean"}],impl:(t,a,n)=>t.run(customStyle({template:(t,i,r)=>{return new e({cmp:t,h:r,showIcon:a,noHead:n,renderLine:function(e){const n=t.model,i=n.icon&&n.icon(e)||"radio_button_unchecked";return r("div",{class:"treenode-line"},[n.isArray(e)?r("i",{class:"material-icons noselect flip-icon",onclick:"flipExpandCollapse",path:e},t.state.expanded[e]?"keyboard_arrow_down":"keyboard_arrow_right"):r("span",{class:"no-children-holder"}),...a?[r("i",{class:"material-icons treenode-icon"},i)]:[],r("span",{class:"treenode-label"},n.title(e,!t.state.expanded[e]))])}}).renderTree(t.model.rootPath)},css:"|>.treenode-children { padding-left: 10px; min-height: 7px }\n\t|>.treenode-label { margin-top: -1px }\n\n\t|>.treenode-label .treenode-val { color: red; padding-left: 4px; }\n\t|>.treenode-line { display: flex; box-orient: horizontal; padding-bottom: 3px; align-items: center }\n\n\t|>.treenode { display: block }\n\t|>.flip-icon { font-size: 16px; margin-right: 2px;}\n\t|>.treenode-icon { font-size: 16px; margin-right: 2px; }\n\n\t|>.treenode.selected>*>.treenode-label,.treenode.selected>*>.treenode-label  { background: #D9E8FB;}\n\t"}))}),jb.component("tree.expand-box",{type:"tree.style",params:[{id:"showIcon",as:"boolean",type:"boolean"},{id:"noHead",as:"boolean",type:"boolean"},{id:"lineWidth",as:"string",defaultValue:"300px"}],impl:(t,a,n,i)=>t.run(customStyle({template:(t,i,r)=>{return new e({cmp:t,h:r,showIcon:a,noHead:n,renderLine:function(e){const n=t.model,i=n.icon&&n.icon(e)||"radio_button_unchecked",o=n.isArray(e)?"":" nochildren",s=t.state.expanded[e]?"":" collapsed";return r("div",{class:`treenode-line${s}`},[r("button",{class:`treenode-expandbox${o}${a?" showIcon":""}`,onclick:"flipExpandCollapse",path:e},[r("div",{class:"frame"}),r("div",{class:"line-lr"}),r("div",{class:"line-tb"})]),...a?[r("i",{class:"material-icons treenode-icon"},i)]:[],r("span",{class:"treenode-label"},n.title(e,!t.state.expanded[e]))])}}).renderTree(t.model.rootPath)},css:`|>.treenode-children { padding-left: 10px; min-height: 7px }\n\t|>.treenode-label { margin-top: -2px }\n\t|>.treenode-label .treenode-val { color: red; padding-left: 4px; }\n\t|>.treenode-line { display: flex; box-orient: horizontal; width: ${i}; padding-bottom: 3px;}\n\n\t|>.treenode { display: block }\n\t|>.treenode.selected>*>.treenode-label,.treenode.selected>*>.treenode-label  { background: #D9E8FB;}\n\n\t|>.treenode-icon { font-size: 16px; margin-right: 2px; }\n\t|>.treenode-expandbox { border: none; background: none; position: relative; width:9px; height:9px; padding: 0; vertical-align: top;\n\t\tmargin-top: 5px;  margin-right: 5px;  cursor: pointer;}\n\t|>.treenode-expandbox.showIcon { margin-top: 3px }\n\t|>.treenode-expandbox div { position: absolute; }\n\t|>.treenode-expandbox .frame { background: #F8FFF9; border-radius: 3px; border: 1px solid #91B193; top: 0; left: 0; right: 0; bottom: 0; }\n\t|>.treenode-expandbox .line-lr { background: #91B193; top: 4px; left: 2px; width: 5px; height: 1px; }\n\t|>.treenode-expandbox .line-tb { background: #91B193; left: 4px; top: 2px; height: 5px; width: 1px; display: none;}\n\t|>.treenode-line.collapsed .line-tb { display: block; }\n\t|>.treenode.collapsed .line-tb { display: block; }\n\t|>.treenode-expandbox.nochildren .frame { display: none; }\n\t|>.treenode-expandbox.nochildren .line-lr { display: none; }\n\t|>.treenode-expandbox.nochildren .line-tb { display: none;}`}))}),jb.component("tree.selection",{type:"feature",params:[{id:"databind",as:"ref",dynamic:!0},{id:"autoSelectFirst",as:"boolean",type:"boolean"},{id:"onSelection",type:"action",dynamic:!0},{id:"onRightClick",type:"action",dynamic:!0}],impl:features(e=>({onclick:!0,componentDidUpdate:e=>e.setSelected(e.state.selected)}),feature.init((e,{cmp:t},{databind:a})=>{t.state.expanded=t.state.expanded||{};const n=jb.val(a());n&&jb.ui.treeExpandPath(t.state.expanded,n.split("~").slice(0,-1).join("~"))},5),interactive((e,{cmp:t},{databind:a,autoSelectFirst:n,onSelection:i,onRightClick:r})=>{const o=a(),{pipe:s,map:l,filter:c,subscribe:d,merge:p,distinctUntilChanged:m}=jb.callbag,u=jb.isWatchable(o)&&s(jb.ui.refObservable(o,t,{srcCtx:e}),l(e=>jb.val(e.ref)));t.setSelected=e=>{t.state.selected=e,t.base&&(jb.ui.findIncludeSelf(t.base,".treenode.selected").forEach(e=>e.classList.remove("selected")),jb.ui.findIncludeSelf(t.base,".treenode").filter(t=>t.getAttribute("path")===e).forEach(e=>{e.classList.add("selected"),e.scrollIntoViewIfNeeded()}))},t.getSelected=()=>t.state.selected=t.elemToPath(jb.ui.findIncludeSelf(t.base,".treenode.selected")[0]),s(p(t.selectionEmitter,u,s(t.onclick,l(e=>t.elemToPath(e.target)))),m(),c(e=>e),l(e=>jb.val(e)),d(a=>{t.setSelected(a),o&&jb.writeValue(o,a,e),i(t.ctx.setData(a))})),d(t.onclick,()=>t.regainFocus&&t.regainFocus()),r.profile&&(t.base.oncontextmenu=a=>(jb.ui.wrapWithLauchingElement(r,e.setData(t.elemToPath(a.target)),a.target)(),!1));var b=jb.val(o);if(!b&&n){var f=jb.ui.find(t.base.parentNode,".treenode")[0];b=t.elemToPath(f)}b&&jb.delay(1).then(()=>t.selectionEmitter.next(b))}))}),jb.component("tree.keyboard-selection",{type:"feature",params:[{id:"onKeyboardSelection",type:"action",dynamic:!0},{id:"onEnter",type:"action",dynamic:!0},{id:"onRightClickOfExpanded",type:"action",dynamic:!0},{id:"autoFocus",type:"boolean"},{id:"applyMenuShortcuts",type:"menu.option",dynamic:!0}],impl:e=>({onkeydown:!0,templateModifier:e=>{e.attributes=e.attributes||{},e.attributes.tabIndex=0},afterViewInit:t=>{const{pipe:a,map:n,filter:i,subscribe:r}=jb.callbag,o=a(t.onkeydown,i(e=>!e.ctrlKey&&!e.altKey));function s(a){console.log(t.getSelected()),jb.ui.wrapWithLauchingElement(a,e.setData(t.getSelected()),jb.ui.findIncludeSelf(t.base,".treenode.selected>.treenode-line")[0])()}e.vars.$tree.regainFocus=t.regainFocus=t.getKeyboardFocus=t.getKeyboardFocus||(a=>(jb.ui.focus(t.base,"tree.keyboard-selection regain focus",e),!1)),e.params.autoFocus&&jb.ui.focus(t.base,"tree.keyboard-selection init autofocus",e),a(o,i(e=>13==e.keyCode),r(t=>s(e.params.onEnter))),a(o,i(e=>38==e.keyCode||40==e.keyCode),n(e=>{const a=40==e.keyCode?1:-1,n=jb.ui.findIncludeSelf(t.base,".treenode"),i=jb.ui.findIncludeSelf(t.base,".treenode.selected")[0];return t.elemToPath(n[n.indexOf(i)+a])||t.getSelected()}),r(e=>t.selectionEmitter.next(e))),a(o,i(e=>37==e.keyCode||39==e.keyCode),r(a=>{const n=t.getSelected(),i=t.model.isArray(n);if(!i||t.state.expanded[n]&&39==a.keyCode)return s(e.params.onRightClickOfExpanded);i&&n&&(t.state.expanded[n]=39==a.keyCode,t.redraw())})),jb.delay(1).then(a=>t.base&&(t.base.onkeydown=a=>{if((a.ctrlKey||a.altKey||46==a.keyCode)&&17!=a.keyCode&&18!=a.keyCode){var n=e.params.applyMenuShortcuts(e.setData(t.getSelected()));if(n&&n.applyShortcut&&n.applyShortcut(a))return!1}return!1}))}})}),jb.component("tree.regain-focus",{type:"action",impl:e=>e.vars.$tree&&e.vars.$tree.regainFocus&&e.vars.$tree.regainFocus()}),jb.component("tree.redraw",{type:"action",params:[{id:"strong",type:"boolean",as:"boolean"}],impl:(e,t)=>(jb.log("tree",["redraw",e.path,...arguments]),e.vars.$tree&&e.vars.$tree.redraw&&e.vars.$tree.redraw(t))}),jb.component("tree.expand-path",{type:"action",params:[{id:"paths",as:"array",descrition:"array of paths to be expanded"}],impl:(e,t)=>e.vars.cmp&&t.forEach(t=>jb.ui.treeExpandPath(e.vars.cmp.state.expanded,t))}),jb.component("tree.path-of-interactive-item",{descrition:"path of the clicked/dragged item using event.target",type:"data",impl:e=>{const{cmp:t,ev:a}=e.vars;return t&&t.elemToPath&&a&&a.target&&t.elemToPath(a.target)}}),jb.component("tree.drag-and-drop",{type:"feature",impl:e=>({onkeydown:!0,componentDidUpdate:e=>e.drake&&(e.drake.containers=jb.ui.find(e.base,".jb-array-node>.treenode-children")),afterViewInit:t=>{const a=t.drake=dragula([],{moves:e=>jb.ui.matches(e,".jb-array-node>.treenode-children>div")});a.containers=jb.ui.find(t.base,".jb-array-node>.treenode-children"),a.on("drag",(function(e,a){const n=t.elemToPath(e.firstElementChild);e.dragged={path:n,expanded:t.state.expanded[n]},delete t.state.expanded[n]})),a.on("drop",(a,n,i,r)=>{if(!a.dragged)return;a.parentNode.removeChild(a),t.state.expanded[a.dragged.path]=a.dragged.expanded;const o=treeStateAsRefs(t),s=r;let l=s?t.elemToPath(s):n.lastElementChild?addToIndex(t.elemToPath(n.lastElementChild),1):t.elemToPath(n);const c=Number(a.dragged.path.split("~").pop()),d=Number(l.split("~").pop())||0;n===i&&d>c&&(l=addToIndex(l,-1)),t.model.move(a.dragged.path,l,e),restoreTreeStateFromRefs(t,o),t.selectionEmitter.next(l),a.dragged=null,t.redraw(!0)});const{pipe:n,filter:i,subscribe:r}=jb.callbag;n(t.onkeydown,i(e=>e.ctrlKey&&(38==e.keyCode||40==e.keyCode)),r(a=>{const n=t.getSelected(),i=Number(n.split("~").pop());if(isNaN(i))return;const r=Array.from(t.base.querySelector(".treenode.selected").parentNode.children).length;let o=(i+(40==a.keyCode?1:-1)+r)%r;const s=treeStateAsRefs(tree);t.model.move(n,n.split("~").slice(0,-1).concat([o]).join("~"),e),restoreTreeStateFromRefs(t,s)}))}})}),treeStateAsRefs=e=>({selected:pathToRef(e.model,e.getSelected()),expanded:jb.entries(e.state.expanded).filter(e=>e[1]).map(t=>pathToRef(e.model,t[0]))}),restoreTreeStateFromRefs=(e,t)=>{e.model.refHandler&&(refToPath(t.selected)&&e.setSelected(refToPath(t.selected)),e.state.expanded={},t.expanded.forEach(t=>e.state.expanded[refToPath(t)]=!0))},pathToRef=(e,t)=>t&&e.refHandler&&e.refHandler.refOfPath(t.split("~")),refToPath=e=>e&&e.path?e.path().join("~"):"",addToIndex=(e,t)=>{if(isNaN(Number(e.slice(-1))))return e;const a=Number(e.slice(-1))+t;return e.split("~").slice(0,-1).concat([a]).join("~")}}(),jb.ns("table-tree,tree"),jb.ns("json"),jb.component("table-tree",{type:"control",params:[{id:"treeModel",type:"tree.node-model",dynamic:!0,mandatory:!0},{id:"leafFields",type:"control[]",dynamic:!0},{id:"commonFields",type:"control[]",dynamic:!0,as:"array"},{id:"chapterHeadline",type:"control",dynamic:!0,defaultValue:text(""),description:"$collapsed as parameter"},{id:"style",type:"table-tree.style",defaultValue:tableTree.plain({}),dynamic:!0},{id:"features",type:"feature[]",dynamic:!0,as:"array"}],impl:e=>jb.ui.ctrl(e)}),jb.component("tree.model-filter",{type:"tree.node-model",description:"filters a model by path filter predicate",params:[{id:"model",type:"tree.node-model",mandatory:!0},{id:"pathFilter",type:"boolean",dynamic:!0,mandatory:!0,description:"input is path. e.g a~b~c"}],impl:(e,t,a)=>Object.assign(Object.create(t),{children:n=>t.children(n).filter(t=>a(e.setData(t)))})}),jb.component("table-tree.init",{type:"feature",params:[{id:"autoOpenFirstLevel",as:"boolean",type:"boolean"}],impl:features(calcProp({id:"expanded",value:(e,{cmp:t,$props:a},{autoOpenFirstLevel:n})=>{const i=t.treeModel;t.state=t.state||{};const r=!t.state.expanded;if(t.state.expanded=t.state.expanded||{},r){[i.rootPath,...n&&i.children(i.rootPath)||[],...a.pathsToExtend||[]].forEach(e=>(function(e){e.split("~").reduce((e,a)=>{const n=null!=e?e+"~"+a:a;return t.state.expanded[n]=!0,n},null)})(e))}return t.state.expanded}}),calcProp({id:"items",value:(e,{cmp:t})=>{const a=t.treeModel;return e.vars.$model.includeRoot?n(a.rootPath,0):n(a.rootPath,-1).filter(e=>e.depth>-1);function n(e,i){const r=[{path:e,depth:i,val:a.val(e),expanded:t.state.expanded[e]}];return t.state.expanded[e]?a.children(e).reduce((e,t)=>i>=a.maxDepth?e:e=e.concat(n(t,i+1)),r):r}}}),interactiveProp("treeModel","%$$model.treeModel%"),interactive((e,{cmp:t})=>{t.state.expanded=jb.objFromEntries(Array.from(t.base.querySelectorAll("[expanded=true]")).map(e=>e.getAttribute("path")).concat([t.treeModel.rootPath]).map(e=>[e,!0])),t.flip=e=>{const a=function(e){return e&&(e.getAttribute("path")||jb.ui.closest(e,".jb-item")&&jb.ui.closest(e,".jb-item").getAttribute("path"))}(e.target);a.split("~").slice(0,-1).reduce((e,a)=>{const n=null!=e?e+"~"+a:a;return t.state.expanded[n]=!0,n},null),t.state.expanded[a]=!t.state.expanded[a],t.refresh()}}),feature.init((e,{cmp:t},{autoOpenFirstLevel:a})=>{const n=t.treeModel=e.vars.$model.treeModel();function i(t){return e.vars.$model[t]().map(e=>e.field())}t.renderProps.maxDepth=n.maxDepth=n.maxDepth||5,t.leafFields=i("leafFields"),t.commonFields=i("commonFields"),t.fieldsForPath=e=>n.isArray(e)?t.commonFields:t.leafFields.concat(t.commonFields),t.headline=a=>(function(a){return e.vars.$model.chapterHeadline(e.setData({path:a.path,val:n.val(a.path)}).setVars({item:a,collapsed:e=>!t.state.expanded[a.path]}))})(a),t.expandingFieldsOfItem=e=>{const a=Array.from(new Array(n.maxDepth)),i=(e.path.match(/~/g)||[]).length-(n.rootPath.match(/~/g)||[]).length-1;return a.filter((e,t)=>t<i+2).map((a,r)=>r<i||r==i&&!n.isArray(e.path)?{empty:!0}:r==i?{expanded:t.state.expanded[e.path],toggle:!0}:r==i+1?{headline:!0,colSpan:n.maxDepth-r+1}:void 0)}}))}),jb.component("table-tree.plain",{type:"table-tree.style",params:[{id:"hideHeaders",as:"boolean",type:"boolean"},{id:"autoOpenFirstLevel",as:"boolean",type:"boolean"},{id:"gapWidth",as:"number",defaultValue:30},{id:"expColWidth",as:"number",defaultValue:16},{id:"noItemsCtrl",type:"control",dynamic:!0,defaultValue:text("no items")}],impl:customStyle({template:(e,{expanded:t,items:a,maxDepth:n,hideHeaders:i,gapWidth:r,expColWidth:o,noItemsCtrl:s},l)=>l("table",{},[...Array.from(new Array(n)).map(e=>l("col",{width:o+"px"})),l("col",{width:r+"px"}),...e.leafFields.concat(e.commonFields).map(e=>l("col",{width:e.width||"200px"})),...i?[]:[l("thead",{},l("tr",{},Array.from(new Array(n+1)).map(e=>l("th",{class:"th-expand-collapse"})).concat([...e.leafFields,...e.commonFields].map(t=>l("th",{"jb-ctx":t.ctxId},jb.ui.fieldTitle(e,t,l))))))],l("tbody",{class:"jb-drag-parent"},a.map((a,n)=>l("tr",{class:"jb-item",path:a.path,expanded:t[a.path]},[...e.expandingFieldsOfItem(a).map(t=>l("td",t.empty?{class:"empty-expand-collapse"}:t.toggle?{class:"expandbox"}:{class:"headline",colSpan:t.colSpan,onclick:"flip"},t.empty?"":t.toggle?l("span",{},l("i",{class:"material-icons noselect",onclick:"flip"},t.expanded?"keyboard_arrow_down":"keyboard_arrow_right")):l(e.headline(a)))),...e.fieldsForPath(a.path).map(e=>l("td",{"jb-ctx":jb.ui.preserveFieldCtxWithItem(e,a),class:"tree-field"},l(e.control(a,n),{index:n})))]))),0==a.length?l(s()):""]),css:"{border-spacing: 0; text-align: left;width: 100%; table-layout:fixed;}\n      >tbody>tr>td { vertical-align: bottom; height: 30px; }\n      >tbody>tr>td>span { font-size:16px; cursor: pointer; border: 1px solid transparent }\n      >tbody>tr>td>span>i { font-size: 16px; vertical-align: middle;}\n      ",features:tableTree.init("%$autoOpenFirstLevel%")})}),jb.component("json.path-selector",{description:"select, query, goto path",params:[{id:"base",as:"single",description:"object to start with"},{id:"path",description:"string with ~ separator or array"}],impl:(e,t)=>{const a=jb.val(e.params.path);return("string"==typeof a?a.split("~").filter(e=>e):jb.asArray(a)).reduce((e,t)=>e&&e[t],t)}}),jb.component("table-tree.expand-path",{type:"table-tree.style",params:[{id:"path",as:"string"}],impl:calcProp({id:"pathsToExtend",value:({},{pathsToExtend:e},{path:t})=>[...t.split(","),...e||[]],phase:5})}),function(){jb.component("tree.json-read-only",{type:"tree.node-model",params:[{id:"object",as:"single"},{id:"rootPath",as:"string"}],impl:(t,a,n)=>new e(a,n)});class e{constructor(e,t){this.json=e,this.rootPath=t}children(e){var t=this.val(e);return("object"==typeof t?Object.keys(t||{}):[]).filter(e=>0!=e.indexOf("$jb_")).map(t=>e+"~"+t)}val(e){return-1==e.indexOf("~")?jb.val(this.json):jb.val(e.split("~").slice(1).reduce((e,t)=>e[t],this.json))}isArray(e){var t=this.val(e);return"object"==typeof t&&null!==t}icon(){return""}title(e,t){var a=this.val(e),n=e.split("~").pop(),i=jb.ui.h;return i("div",{},null==a?n+": null":t||"object"!=typeof a?"object"!=typeof a?[n+": ",i("span",{class:"treenode-val",title:""+a},jb.ui.limitStringLength(""+a,20))]:[i("span",{},n+": ")].concat(Object.keys(a).filter(e=>0!=e.indexOf("$jb_")).filter(e=>-1!=["string","boolean","number"].indexOf(typeof a[e])).map(e=>i("span",{class:"treenode-val",title:""+a[e]},jb.ui.limitStringLength(""+a[e],20)))):n)}}jb.component("tree.json",{type:"tree.node-model",params:[{id:"object",as:"ref"},{id:"rootPath",as:"string"}],impl:function(e,a,n){return new t(a,n)}});class t{constructor(e,t){this.json=e,this.rootPath=t,this.refHandler=jb.refHandler(e)}children(e){var t=this.val(e);return("object"==typeof t?Object.keys(t||{}):[]).filter(e=>0!=e.indexOf("$jb_")).map(t=>e+"~"+t)}val(e){return-1==e.indexOf("~")?jb.val(this.json):jb.val(e.split("~").slice(1).reduce((e,t)=>e[t],jb.val(this.json)))}isArray(e){var t=this.val(e);return"object"==typeof t&&null!==t}icon(){return""}title(e,t){var a=this.val(e),n=e.split("~").pop(),i=jb.ui.h;return null==a?n+": null":t||"object"!=typeof a?i("div",{},"object"!=typeof a?[n+": ",i("span",{class:"treenode-val",title:a},jb.ui.limitStringLength(a,20))]:[i("span",{},n+": ")].concat(Object.keys(a).filter(e=>"string"==typeof a[e]||"number"==typeof a[e]||"boolean"==typeof a[e]).map(e=>i("span",{class:"treenode-val",title:""+a[e]},jb.ui.limitStringLength(""+a[e],20))))):n}modify(e,t,a,n){e.call(this,t,a)}move(e,t,a){const n=this.val(e.split("~").slice(0,-1).join("~")),i=isNaN(Number(t.split("~").slice(-1)))?t+"~0":t,r=this.val(i.split("~").slice(0,-1).join("~"));Array.isArray(n)&&Array.isArray(r)&&jb.move(jb.asRef(this.val(e)),this.val(i)?jb.asRef(this.val(i)):this.extraArrayRef(i),a)}extraArrayRef(e){const t=this.val(e.split("~").slice(0,-1).join("~")),a=jb.asRef(t),n=a.handler;return n&&n.refOfPath(n.pathOfRef(a).concat(e.split("~").slice(-1)))}}}(),function(){const storeId=Symbol.for("storeId"),{pipe:pipe,map:map,filter:filter,subscribe:subscribe,take:take,toPromiseArray:toPromiseArray}=jb.callbag;jb.ui.serializeCtxOfVdom=function(e){const t={idCounter:1,ctx:{},data:{},strs:[]};return function e(t){return jb.unique([...[t["mount-ctx"]]||!1,...Object.keys(t).filter(e=>t[e]&&"object"==typeof t[e]).flatMap(a=>e(t[a]))]).filter(e=>e)}(e).forEach(e=>(function(e){if(null==e)return;t.ctx[e.id]=t.ctx[e.id]||{id:e.id,path:e.path};return{$ctx:e.id}})(jb.ctxDictionary[e])),JSON.stringify(t)},jb.ui.deserializeCtxStore=function(e){const t=JSON.parse(e),a={data:{},ctx:{}};return Object.keys(t.ctx).forEach(e=>(function e(n){if(n.$ctx)return e(n.$ctx);const i=t.ctx[n];if(a.ctx[n])return a.ctx[n];a.ctx[n]=new jb.jbCtx;Object.assign(a.ctx[n],{id:n,path:i.path,$inProcess:!0});Object.assign(a.ctx[n],{componentContext:i.componentContext&&e(i.componentContext),vars:r(i.vars)||{},data:r(i.data),profile:i.path.split("~").reduce((e,t)=>e&&e[t],jb.comps)});a.ctx[n].profile||i.path.split("~").reduce((e,t)=>e&&e[t],jb.comps);delete a.ctx[n].$inProcess;return a.ctx[n];function r(n){if(null!=n){if("string"==typeof n)return n.match(/^#[0-9]+$/)?+n.slice(1):n.match(/^##[0-9]+$/)?n.slice(1):n;if("object"==typeof n&&n.$ctx)return e(n.$ctx);if("object"==typeof n&&null!=n.$str)return t.strs[n.$str];if("object"==typeof n)return jb.objFromEntries(jb.entries(n).map(e=>[e[0],r(e[1])]));if("number"==typeof n){const e=n;return a.data[e]?a.data[e]:(a.data[e]={$inProcess:!0},Object.keys(t.data[e]).forEach(n=>a.data[e][n]=r(t.data[e][n])),delete a.data[e].$inProcess,a.data[e])}}}})(e)),a};let messageCounter=1;function createWorker(workerId){const workerReceive=({data:data})=>{const messageId=(data.match(/^([0-9]+)>/)||["",""])[1];messageId&&Promise.resolve(jb.exec(eval(data.slice(messageId.length+1)))).then(e=>postMessage(messageId+">"+JSON.stringify(e)))},workerCode=`\n    self.workerId = ${workerId}\n    self.isWorker = true\n    importScripts('http://${location.host}/dist/jb-react-all.js')\n    self.onmessage= ${workerReceive.toString()}`,worker=new Worker(URL.createObjectURL(new Blob([workerCode],{type:"application/javascript"})));return Object.assign(worker,{response:jb.callbag.subject(),onmessage(e){const t=e.data,a=(t.match(/^([^>]+)>/)||["",""])[1];jb.log("from-remote",t),worker.response.next({id:a,data:t.slice(a.length+1)})},handleBrowserEvent(e,t,a){const n=jb.ui.parents(e,{includeSelf:!0}).filter(e=>e.getAttribute&&e.getAttribute("widgetTop")).map(e=>e.getAttribute("id"))[0];return this.exec(pipeline({$asIs:{specificHandler:a,cmpId:e.getAttribute("cmp-id"),event:{type:t.type,target:{value:t.target.value},scrollPercentFromTop:t.scrollPercentFromTop},widgetId:n}},e=>jb.ui.handleBrowserEvent(e.data)))},loadSource(e){if(!e)return worker;const t=pipeline(e,e=>importScripts(e.data));return worker.exec(t).then(()=>worker)},exec(e){const t=messageCounter++,a=t+">"+jb.prettyPrint(e);return jb.log("to-remote",a),console.log("to-remote: "+a),worker.postMessage(a),pipe(worker.response,filter(({id:e})=>e==t),take(1),map(({data:e})=>e),toPromiseArray)}}),worker}jb.frame.isWorker&&Object.assign(jb.ui,{_stylesToAdd:[],widgets:{},activeElement(){},focus(){},updateRenderer(e,t,a,n){const i=this._stylesToAdd.join("\n");this._stylesToAdd=[];const r=jb.ui.serializeCtxOfVdom(e);postMessage(`delta-${n}>`+JSON.stringify({delta:e,elemId:t,cmpId:a,css:i,store:r}))},addStyleElem(e){this._stylesToAdd.push(e)},handleBrowserEvent({cmpId:e,event:t,specificHandler:a,widgetId:n}){const i=a||`on${t.type}Handler`,r=jb.ui.find(jb.ui.widgets[n].top,`[cmp-id="${e}"]`,{includeSelf:!0})[0];r&&null!=t.target.value&&(r.value=t.target.value),t.target=r,(r.attributes.handlers||"").split(",").filter(e=>0==e.indexOf(i+"-")).forEach(e=>{const a=jb.ctxDictionary[e.split("-")[1]];a&&a.setVars({ev:t,widgetId:n}).runInner(a.profile.action,"action","action")})}}),jb.ui.workers={},jb.component("worker.main",{type:"remote",impl:{getWorker:()=>jb.ui.mainWorker?Promise.resolve(jb.ui.mainWorker):(jb.ui.workers[1]=jb.ui.mainWorker=createWorker(1),jb.ui.mainWorker.exec('"init"').then(()=>jb.ui.mainWorker)),createWidget(e,t,a){const n=pipeline({$asIs:{widgetId:a,main:t}},e=>{const{main:t,widgetId:a}=e.data,n=e.setData(null).setVar("widgetId",a).run({$:t}),i=jb.ui.h(n);i.attributes=Object.assign(i.attributes||{},{worker:1,id:a}),jb.ui.widgets[a]={top:i},jb.ui.updateRenderer(jb.ui.compareVdom({},i),a,null,a)});return this.getWorker().then(t=>(pipe(t.response,filter(({id:e})=>e==`delta-${a}`),subscribe(({data:t})=>{const a=JSON.parse(t.replace(/"__undefined"/g,"null"));console.log("delta-from-remote",a);const{delta:n,elemId:i,cmpId:r,css:o,store:s}=a;jb.ui.mainWorker.ctxDictionary=jb.ui.mainWorker.ctxDictionary||{},Object.assign(jb.ui.mainWorker.ctxDictionary,jb.ui.deserializeCtxStore(s).ctx);const l=jb.ui.document(e).querySelector("#"+i)||jb.ui.document(e).querySelector(`[cmp-id="${r}"]`);l&&jb.ui.applyDeltaToDom(l,n),o&&jb.ui.addStyleElem(o),jb.ui.findIncludeSelf(l,"[interactive]").forEach(e=>e._component?e._component.recalcPropsFromElem():jb.ui.mountInteractive(e))})),t.exec(n)))}}}),jb.component("remote.init-main-worker",{type:"control",params:[{id:"sourceUrl",as:"string"},{id:"remote",type:"remote",mandatory:!0,defaultValue:worker.main()}],impl:(e,t,a)=>a.getWorker().then(e=>e.loadSource(t))}),jb.component("remote.widget",{type:"control",params:[{id:"main",as:"string",description:"main profile to run"},{id:"id",as:"string"},{id:"remote",type:"remote",mandatory:!0,defaultValue:worker.main()}],impl:(e,t,a,n)=>{const i=a||"widget"+e.id;return n.createWidget(e,t,i),jb.ui.h("div",{id:i,widgetTop:"true"})}})}()}).call(this,__webpack_require__(1))},function(e,t){var a;a=function(){return this}();try{a=a||new Function("return this")()}catch(e){"object"==typeof window&&(a=window)}e.exports=a}]);