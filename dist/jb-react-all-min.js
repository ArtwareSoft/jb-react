!function(e){var t={};function a(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(n,i,function(t){return e[t]}.bind(null,i));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(module,exports,__webpack_require__){(function(global){var jbFrame="object"==typeof frame?frame:"object"==typeof self?self:"object"==typeof global?global:{};function newJbm(){let e={};function t(n,i,r){if(n.probe&&n.probe.outOfTime)return;e.ctxByPath&&(e.ctxByPath[n.path]=n);let s=function(n,i,r){try{const r=n.profile;if(null==r||"object"==typeof r&&r.$disabled)return a(null,i);if(r.$debugger,r.$asIs)return r.$asIs;if(i&&(i.type||"").indexOf("[]")>-1&&!i.as&&(i.as="array"),"object"==typeof r&&0==Object.getOwnPropertyNames(r).length)return;const s=function(t,a){if(Array.isArray(a))return a.reduce((e,{name:t,val:a},n)=>e.setVar(t,e.runInner(a||"%%",null,`$vars~${n}~val`)),t);a&&e.logError("$vars should be array",{ctx:t,vars:a});return t}(n,r.$vars),l=function(a,n){const i=a.profile,r=typeof i,s=n&&n.type,l=n&&n.as,c=Array.isArray(i);if("string"===r&&"boolean"===s)return{type:"booleanExp"};if("boolean"===r||"number"===r||"asIs"==s)return{type:"asIs"};if("object"===r&&"object"===l)return{type:"object"};if("string"===r)return{type:"expression"};if("function"===r)return{type:"function"};if("object"===r&&i instanceof RegExp)return{type:"asIs"};if(null==i)return{type:"asIs"};if(c){if(!i.length)return{type:"null"};if(!n||!n.type||"data"===n.type)return{type:"list"};if("action"===s||"action[]"===s&&i.isArray)return i.sugar=!0,{type:"runActions"}}const d=e.compName(i,n);if(!d)return{type:"asIs"};const p=e.comps[d];if(!p&&d)return e.logError("component "+d+" is not defined",{ctx:a}),{type:"null"};if(null==p.impl)return e.logError("component "+d+" has no implementation",{ctx:a}),{type:"null"};e.fixMacroByValue&&e.fixMacroByValue(i,p);const m=Object.assign(new o(a,{}),{parentParam:n,params:{}}),u=function(a,n,i,r){return e.compParams(n).filter(e=>!e.ignore).map(o=>{const s=o.id;let l=i[s],c=s;const d=void 0!==l?l:void 0!==o.defaultValue?o.defaultValue:null,p=void 0===l&&void 0!==o.defaultValue&&[a,"params",e.compParams(n).indexOf(o),"defaultValue"].join("~");p&&(c="");const m=d||[],u=o.type&&o.type.indexOf("[]")>-1&&Array.isArray(m);if(o.dynamic){return{name:s,type:"function",outerFunc:a=>{let n;n=u?(t,n)=>e.flattenArray(m.map((e,i)=>a.extendVars(t,n).runInner(e,{...o,as:"asIs"},c+"~"+i))):(n,i)=>t(new e.jbCtx(a.extendVars(n,i),{profile:d,forcePath:p,path:c}),o);const i=d&&d.$||"string"==typeof d&&d.slice(0,10)||"";return Object.defineProperty(n,"name",{value:s+": "+i}),Object.assign(n,{profile:d,runCtx:a,path:c,srcPath:r.path,forcePath:p,param:o}),n},path:c,param:o,forcePath:p}}return u?{name:s,type:"array",array:m,param:Object.assign({},o,{type:o.type.split("[")[0],as:null}),forcePath:p,path:c}:{name:s,type:"run",prof:d,param:o,forcePath:p,path:c}})}(d,p,i,m);return"function"==typeof p.impl?(Object.defineProperty(p.impl,"name",{value:d}),{type:"profile",impl:p.impl,ctx:m,preparedParams:u}):{type:"profile",ctx:new o(m,{profile:p.impl,comp:d,path:""}),preparedParams:u}}(s,i);switch(n.parentParam=i,l.type){case"booleanExp":return a(e.bool_expression(r,n,i),i);case"expression":return a(e.expression(r,n,i),i);case"asIs":return r;case"function":return a(r(n,n.vars,n.cmpCtx&&n.cmpCtx.params),i);case"null":return a(null,i);case"ignore":return n.data;case"list":return r.map((e,t)=>s.runInner(e,null,t));case"runActions":return e.comps.runActions.impl(new o(s,{profile:{actions:r},path:""}));case"profile":return l.impl||(l.ctx.callerPath=n.path),l.preparedParams.forEach((function(e){switch(e.type){case"function":l.ctx.params[e.name]=e.outerFunc(l.ctx);break;case"array":l.ctx.params[e.name]=e.array.map((function(a,i){return null!=a&&t(new o(l.ctx,{profile:a,forcePath:e.forcePath||n.path+"~"+e.path+"~"+i,path:""}),e.param)}));break;default:l.ctx.params[e.name]=t(new o(l.ctx,{profile:e.prof,forcePath:e.forcePath||n.path+"~"+e.path,path:""}),e.param)}})),a(l.impl?l.impl.call(null,l.ctx,...l.preparedParams.map(e=>l.ctx.params[e.name])):t(new o(l.ctx,{cmpCtx:l.ctx}),i),i)}}catch(t){if(n.vars.$throw)throw t;e.logException(t,"exception while running run",{ctx:n,parentParam:i,settings:r})}}(...arguments);return n.probe&&0==n.probe.pathToTrace.indexOf(n.path)&&(s=n.probe.record(n,s)||s),"function"==typeof s&&e.assignDebugInfoToFunc(s,n),s}function a(e,t){return n(e,t?t.as:null)}function n(e,t){return t?(i[t],i[t](e)):e}const i={asIs:e=>e,object:t=>(Array.isArray(t)&&(t=t[0]),t&&"object"==typeof t?e.val(t):{}),string:t=>(Array.isArray(t)&&(t=t[0]),null==t?"":void 0===(t=e.val(t))?"":""+t),number(t){if(Array.isArray(t)&&(t=t[0]),null==t||null==t)return null;const a=Number(e.val(t),!0);return isNaN(a)?null:a},array:t=>("function"==typeof t&&t.profile&&(t=t()),t=e.val(t),Array.isArray(t)?t:null==t?[]:[t]),boolean:t=>(Array.isArray(t)&&(t=t[0]),!(!(t=e.val(t))||"false"==t)),single:t=>(Array.isArray(t)&&(t=t[0]),e.val(t)),ref:t=>(Array.isArray(t)&&(t=t[0]),e.asRef(t)),"ref[]":function(t){return e.asRef(t)},value:t=>e.val(t)};let r=0;class o{constructor(e,t){this.id=r++,void 0===e?(this.vars={},this.params={}):(t.profile&&null==t.path&&(t.path="?"),this.profile=void 0!==t.profile?t.profile:e.profile,this.path=(e.path||"")+(t.path?"~"+t.path:""),t.forcePath&&(this.path=this.forcePath=t.forcePath),t.comp&&(this.path=t.comp+"~impl"),this.data=void 0!==t.data?t.data:e.data,this.vars=t.vars?Object.assign({},e.vars,t.vars):e.vars,this.params=t.params||e.params,this.cmpCtx=void 0!==t.cmpCtx?t.cmpCtx:e.cmpCtx,this.probe=e.probe)}run(e,a){return t(new o(this,{profile:e,comp:e.$,path:""}),a)}exp(t,a){return e.expression(t,this,{as:a})}setVars(e){return new o(this,{vars:e})}setVar(e,t){return e?new o(this,{vars:{[e]:t}}):this}setData(e){return new o(this,{data:e})}runInner(e,a,n){return t(new o(this,{profile:e,path:n}),a)}bool(e){return this.run(e,{as:"boolean"})}ctx(e){return new o(this,e)}frame(){return e.frame}extendVars(e,t){return null==e&&null==t?this:new o(this,{vars:e?e.vars:null,data:null==t?e.data:t,forcePath:e&&e.forcePath?e.forcePath:null})}runItself(e,a){return t(this,e,a)}dataObj(e){return{data:e,vars:this.vars}}callStack(){const e=[];for(let t=this;t;t=t.cmpCtx)e.push(t);return e.map(e=>e.callerPath)}}return Object.assign(e,{frame:jbFrame,comps:{},ctxDictionary:{},run:t,jbCtx:o,jstypes:i,tojstype:n}),e}"undefined"==typeof jb&&"undefined"==typeof jbDoNotInvoke_newJbm&&(jbFrame.jb=newJbm()),Object.assign(jb,{compParams:e=>e&&e.params?Array.isArray(e.params)?e.params:entries(e.params).map(e=>Object.assign(e[1],{id:e[0]})):[],profileType(e){if(!e)return"";if("string"==typeof e)return"data";const t=jb.compName(e);return jb.comps[t]&&jb.comps[t].type||""},singleInType(e){const t=e&&e.type&&e.type.split("[")[0];return t&&jb.comps[t]&&jb.comps[t].singleInType&&t},compName(e,t){if(e&&!Array.isArray(e))return e.$||jb.singleInType(t)},path:(e,t,a)=>{let n=e;if("string"==typeof t&&(t=t.split(".")),t=jb.asArray(t),void 0===a)return t.reduce((e,t)=>e&&e[t],e);for(let e=0;e<t.length;e++)e==t.length-1?n[t[e]]=a:n=n[t[e]]=n[t[e]]||{};return a},isDelayed:e=>{if(e&&e.constructor!=={}.constructor&&!Array.isArray(e))return"object"==typeof e?jb.isPromise(e):"function"==typeof e?jb.callbag.isCallbag(e):void 0},toSynchArray:(e,t)=>{if(!jb.asArray(e).find(e=>jb.callbag.isCallbag(e)||jb.isPromise(e)))return e;const{pipe:a,fromIter:n,toPromiseArray:i,mapPromise:r,flatMap:o,map:s,isCallbag:l}=jb.callbag;return l(e)?t?i(a(e,s(e=>e&&e.vars?e.data:e))):e:Array.isArray(e)&&l(e[0])?t?i(a(e[0],s(e=>e&&e.vars?e.data:e))):e:a(n(jb.asArray(e)),r(e=>Promise.resolve(e)),o(e=>Array.isArray(e)?e:[e]),i)},subscribe:(e,t)=>jb.callbag.subscribe(t)(e),log(e,t,a){jb.spy&&jb.spy.log(e,t,a)},logError(e,t){jb.frame.console&&jb.frame.console.log("%c Error: ","color: red",e,t),jb.log("error",{err:e,...t})},logException(e,t,a){jb.frame.console&&jb.frame.console.log("%c Exception: ","color: red",t,e,a),jb.log("exception error",{e:e,err:t,stack:e.stack||"",...a})},val(e){if(null==e||"object"!=typeof e)return e;const t=jb.refHandler(e);return t?t.val(e):e},tostring:e=>jb.tojstype(e,"string"),toarray:e=>jb.tojstype(e,"array"),toboolean:e=>jb.tojstype(e,"boolean"),tosingle:e=>jb.tojstype(e,"single"),tonumber:e=>jb.tojstype(e,"number"),assignDebugInfoToFunc(e,t){e.ctx=t;const a=t.profile&&t.profile.$||"string"==typeof t.profile&&t.profile.slice(0,10)||"";Object.defineProperty(e,"name",{value:(t.path||"").split("~").pop()+": "+a})},sessionStorage:(e,t)=>null==t?JSON.parse(jb.frame.sessionStorage.getItem(e)):jb.frame.sessionStorage.setItem(e,JSON.stringify(t)),exec:(...e)=>(new jb.jbCtx).run(...e),exp:(...e)=>(new jb.jbCtx).exp(...e),eval:(e,t)=>{try{return(t||jb.frame).eval("("+e+")")}catch(e){return Symbol.for("parseError")}},addDebugInfo:(e,t)=>(e.ctx=t,e),studio:{previewjb:jb},execInStudio:(...e)=>jb.studio.studioWindow&&(new jb.studio.studioWindow.jb.jbCtx).run(...e)}),Object.assign(jb,{entries(e){if(!e||"object"!=typeof e)return[];let t=[];for(let a in e)e.hasOwnProperty&&e.hasOwnProperty(a)&&0!=a.indexOf("$jb_")&&t.push([a,e[a]]);return t},objFromEntries(e){const t={};return e.forEach(e=>t[e[0]]=e[1]),t},unique:(e,t)=>{t=t||(e=>e);const a={},n=[];return e.forEach(e=>{a[t(e)]||(a[t(e)]=!0,n.push(e))}),n},isEmpty:e=>0===Object.keys(e).length,isObject:e=>null!=e&&"object"==typeof e,asArray:e=>null==e?[]:Array.isArray(e)?e:[e],filterEmpty:e=>Object.entries(e).reduce((e,[t,a])=>null==a?e:{...e,[t]:a},{}),equals:(e,t)=>e==t||jb.val(e)==jb.val(t),delay:(e,t)=>new Promise(a=>setTimeout(()=>a(t),e)),compareArrays:(e,t)=>{if(e===t)return!0;if(!Array.isArray(e)&&!Array.isArray(t))return e===t;if(!e||!t||e.length!=t.length)return!1;for(let a=0;a<e.length;a++){const n=(e[a]||{}).key,i=(t[a]||{}).key;if((!n||!i||n!==i||e[a].val!==t[a].val)&&e[a]!==t[a])return!1}return!0},range:(e,t)=>Array.apply(0,Array(t)).map((t,a)=>a+e),flattenArray:e=>{let t=[];return e.filter(e=>e).forEach((function(e){Array.isArray(e)?t=t.concat(e):t.push(e)})),t},isPromise:e=>e&&"[object Promise]"===Object.prototype.toString.call(e)}),function(){function e(e){return e&&"object"==typeof e&&1==e._state?e._result:e}function t(e){return"ref"===e||"ref[]"===e}function a(i,r,o){let s=""+i;if("boolean"==(o&&(o.ref?"ref":o.as)))return n(s,r);if(0==s.indexOf("$debugger:")&&(s=s.split("$debugger:")[1]),0==s.indexOf("$log:")){const e=a(s.split("$log:")[1],r,o);return jb.comps.log.impl(r,e),e}return-1==s.indexOf("%")&&-1==s.indexOf("{")?s:"{%%}"==s||"%%"==s?l(""):0==s.lastIndexOf("{%")&&s.indexOf("%}")==s.length-2?l(s.substring(2,s.length-2)):(s=(s=s.replace(/{%(.*?)%}/g,(e,t)=>jb.tostring(l(t,{as:"string"})))).replace(/{\?(.*?)\?}/g,(e,t)=>jb.tostring(function(e){const t=e.match(/%([^%;{}\s><"']*)%/);return t&&jb.tostring(l(t[1]))?a(e,r,{as:"string"}):""}(t)))).match(/^%[^%;{}\s><"']*%$/)?l(s.substring(1,s.length-1),o):s=s.replace(/%([^%;{}\s><"']*)%/g,(e,t)=>jb.tostring(l(t,{as:"string"})));function l(a,n){return e(function(a,n,i){const r=i&&(i.ref?"ref":i.as),o=a.split(/[./[]/);return o.reduce((a,s,l)=>(function a(o,s,l,c,d){if(""==s)return o;s.match(/]$/)&&(s=s.slice(0,-1));const p=jb.objHandler(o);const m=s.match(/=([a-zA-Z]*)\(?([^)]*)\)?/);if(m&&jb.functions[m[1]])return tojstype(jb.functions[m[1]](n,m[2]),r,n);if(s.match(/\(\)$/))return a(o,s.slice(0,-2),l,c,!0);if(c&&"$"==s.charAt(0)&&s.length>1){const a=function(a,n,i){let r;return a.cmpCtx&&void 0!==a.cmpCtx.params[n]?r=a.cmpCtx.params[n]:void 0!==a.vars[n]?r=a.vars[n]:a.vars.scope&&void 0!==a.vars.scope[n]?r=a.vars.scope[n]:jb.resources&&void 0!==jb.resources[n]?r=t(i)?jb.mainWatchableHandler.refOfPath([n]):jb.resource(n):jb.consts&&void 0!==jb.consts[n]&&(r=t(i)?jb.simpleValueByRefHandler.objectProperty(jb.consts,n):r=jb.consts[n]),e(r)}(n,s.substr(1),l?r:null);return"function"==typeof a&&d?a(n):a}const u=jb.val(o);if("length"==s&&u&&"number"==typeof u.length)return u.length;if(Array.isArray(u)&&isNaN(Number(s)))return[].concat.apply([],u.map(e=>a(e,s,l,!1,p)).filter(e=>null!=e));if(null!=o&&"object"==typeof o){if(null==u)return;if("function"==typeof u[s]&&(d||u[s].profile&&i&&i.dynamic))return u[s](n);if(s.match(/\(\)$/)){const e=s.slice(0,-2);return"function"==typeof u[e]&&u[e]()}if(s.match(/^@/)&&u.getAttribute)return u.getAttribute(s.slice(1));if(t(r)){if(l)return p.objectProperty(u,s,n);void 0===u[s]&&(u[s]=function(e,t,a){return jb.log("core innerObject created",{parent:e,prop:t,refHandler:a}),e[t]={},a.refreshMapDown&&a.refreshMapDown(e),e[t]}(u,s,p))}return l&&r?jb.jstypes[r](u[s]):u[s]}})(a,s,l==o.length-1,0==l),n.data)}(a,r,n||o))}}function n(e,t,i){if(0==e.indexOf("$debugger:")&&(e=e.split("$debugger:")[1]),0==e.indexOf("$log:")){const r=a(e.split("$log:")[1],t,{as:"boolean"}),o=n(e.split("$log:")[1],t,i);return jb.comps.log.impl(t,r+":"+o),o}if(0==e.indexOf("!"))return!n(e.substring(1),t);const r=e.match(/(.+)(==|!=|<|>|>=|<=|\^=|\$=)(.+)/);if(!r){const n=a(e,t,i);if(jb.isRef(n))return n;const r=jb.tostring(n);if("boolean"==typeof r)return r;const o=jb.tostring(r);return!!o&&"false"!=o}if(4!=r.length)return jb.logError("invalid boolean expression: "+e,{ctx:t});const o=r[2].trim();if("=="==o||"!="==o||"$="==o||"^="==o){const e=jb.tostring(a(c(r[1]),t,{as:"string"}));let n=jb.tostring(a(c(r[3]),t,{as:"string"}));if(n=(n.match(/^["'](.*)["']/)||["",n])[1],"=="==o)return e==n;if("!="==o)return e!=n;if("^="==o)return 0==e.lastIndexOf(n,0);if("$="==o)return-1!==e.indexOf(n,e.length-n.length)}const s=jb.tonumber(a(r[1].trim(),t)),l=jb.tonumber(a(r[3].trim(),t));if(">"==o)return s>l;if("<"==o)return s<l;if(">="==o)return s>=l;if("<="==o)return s<=l;function c(e){return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}}Object.assign(jb,{bool_expression:n,expression:a})}(),Object.assign(jb,{resources:{},consts:{},simpleValueByRefHandler:{val:e=>e&&e.$jb_val?e.$jb_val():e&&e.$jb_parent?e.$jb_parent[e.$jb_property]:e,writeValue(e,t,a){if(jb.log("writeValue jbParent",{value:t,to:e,srcCtx:a}),e)return e.$jb_val?e.$jb_val(this.val(t)):e.$jb_parent&&(e.$jb_parent[e.$jb_property]=this.val(t)),e},push(e,t){const a=jb.asArray(jb.val(e));jb.toarray(t).forEach(e=>a.push(e))},asRef:e=>e,isRef:e=>e&&(e.$jb_parent||e.$jb_val||e.$jb_obj),objectProperty(e,t){return this.isRef(e[t])?e[t]:{$jb_parent:e,$jb_property:t}},pathOfRef:()=>[]},resource:(e,t)=>(void 0!==t&&(jb.resources[e]=t),jb.mainWatchableHandler&&jb.mainWatchableHandler.resourceReferred(e),jb.resources[e]),passiveSym:Symbol.for("passive"),passive:(e,t)=>void 0===t?jb.consts[e]:jb.consts[e]=jb.markAsPassive(t||{}),markAsPassive:e=>(e&&"object"==typeof e&&(e[jb.passiveSym]=!0,Object.values(e).forEach(e=>jb.markAsPassive(e))),e),extraWatchableHandlers:[],extraWatchableHandler:(e,t)=>{jb.extraWatchableHandlers.push(e);const a=jb.extraWatchableHandlers.indexOf(t);return-1!=a&&jb.extraWatchableHandlers.splice(a,1),jb.watchableHandlers=[jb.mainWatchableHandler,...jb.extraWatchableHandlers].map(e=>e),e},setMainWatchableHandler:e=>{jb.mainWatchableHandler=e,jb.watchableHandlers=[jb.mainWatchableHandler,...jb.extraWatchableHandlers].map(e=>e)},watchableHandlers:[],safeRefCall:(e,t)=>{const a=jb.refHandler(e);return a&&a.isRef(e)?t(a):jb.logError("invalid ref",{ref:e})},refHandler:e=>e&&e.handler?e.handler:jb.simpleValueByRefHandler.isRef(e)?jb.simpleValueByRefHandler:jb.watchableHandlers.find(t=>t.isRef(e)),objHandler:e=>e&&jb.refHandler(e)||jb.watchableHandlers.find(t=>t.watchable(e))||jb.simpleValueByRefHandler,asRef:e=>{const t=jb.watchableHandlers.find(t=>t.watchable(e)||t.isRef(e));return t?t.asRef(e):jb.simpleValueByRefHandler.asRef(e)},writeValue:(e,t,a,n)=>!a.probe&&jb.safeRefCall(e,i=>{n&&i.startTransaction&&i.startTransaction(),i.writeValue(e,t,a),n&&i.endTransaction&&i.endTransaction(!0)}),objectProperty:(e,t,a)=>jb.objHandler(e).objectProperty(e,t,a),splice:(e,t,a)=>!a.probe&&jb.safeRefCall(e,n=>n.splice(e,t,a)),move:(e,t,a)=>!a.probe&&jb.safeRefCall(e,n=>n.move(e,t,a)),push:(e,t,a)=>!a.probe&&jb.safeRefCall(e,n=>n.push(e,t,a)),isRef:e=>jb.refHandler(e),isWatchable:()=>!1,isValid:e=>jb.safeRefCall(e,t=>t.isValid(e)),refreshRef:e=>jb.safeRefCall(e,t=>t.refresh(e))}),Object.assign(jb,{location:Symbol.for("location"),loadingPhase:Symbol.for("loadingPhase"),component:(e,t)=>{const a=jb.macroName(e);try{const e=(new Error).stack.split(/\r|\n/).filter(e=>e&&"Error"!=e&&!e.match(/at Object.component/)).shift();if(t[jb.location]=e?(e.match(/\\?([^:]+):([^:]+):[^:]+$/)||["","","",""]).slice(1,3):["",""],t[jb.location][0]=t[jb.location][0].split("?")[0],void 0!==t.watchableData)return jb.comps[jb.addDataResourcePrefix(a)]=t,jb.resource(jb.removeDataResourcePrefix(a),t.watchableData);if(void 0!==t.passiveData)return jb.comps[jb.addDataResourcePrefix(a)]=t,jb.passive(jb.removeDataResourcePrefix(a),t.passiveData)}catch(e){console.log(e)}jb.comps[a]=t,(t.params||[]).forEach(e=>{"boolean"==e.as&&-1==["boolean","ref"].indexOf(e.type)&&(e.type="boolean")}),t[jb.loadingPhase]=jb.frame.jbLoadingPhase,jb.registerMacro&&jb.registerMacro(a,t)},macroDef:Symbol("macroDef"),macroNs:{},macro:{},macroName:e=>e.replace(/[_-]([a-zA-Z])/g,(e,t)=>t.toUpperCase()),ns:e=>(e.split(",").forEach(e=>jb.registerMacro(e+".$forwardDef",{})),jb.macro),fixMacroByValue:(e,t)=>{if(e&&e.$byValue){const a=jb.compParams(t);e.$byValue.forEach((t,n)=>Object.assign(e,{[a[n].id]:t})),delete e.$byValue}},importAllMacros:()=>["var { ",jb.unique(Object.keys(jb.macro).map(e=>e.split("_")[0])).join(", "),"} = jb.macro;"].join(""),registerMacro:(e,t)=>{const a=jb.macroName(e).replace(/\./g,"_"),n=-1!=e.indexOf(".")&&jb.macroName(e.split(".")[0]);function i(t){jb.macro[t]=new Proxy(()=>0,{get:(e,a)=>"symbol"==typeof a||(jb.macro[t+"_"+a]||function(e,t){return(...a)=>{const{args:n,system:i}=r(a),o={$:`${e}.${t}`};return 1!=n.length||"object"!=typeof n[0]||jb.compName(n[0])?Object.assign(o,{$byValue:n}):Object.assign(o,n[0]),Object.assign(o,i)}}(t,a)),apply:function(t,a,n){const{args:i,system:o}=r(n);return Object.assign(function(t){const a=e.replace(/\.\$forwardDef$/,""),n=jb.comps[a];if(!n)return jb.logError("forward def "+a+" was not implemented"),{$:a};if(0==t.length)return{$:a};const i=n.params||[],r=-1!=(i[0]&&i[0].type||"").indexOf("[]");if(1==i.length&&r)return{$:a,[i[0].id]:t};const o=1==t.length&&"object"==typeof t[0]&&(i[0]&&t[0][i[0].id]||i[1]&&t[0][i[1].id]);if((n.macroByValue||i.length<3)&&!1!==n.macroByValue&&!o)return{$:a,...jb.objFromEntries(t.filter((e,t)=>i[t]).map((e,t)=>[i[t].id,e]))};if(1==t.length&&!Array.isArray(t[0])&&"object"==typeof t[0]&&!t[0].$)return{$:a,...t[0]};if(1==t.length&&i.length)return{$:a,[i[0].id]:t[0]};if(2==t.length&&i.length>1)return{$:a,[i[0].id]:t[0],[i[1].id]:t[1]}}(i),o)}})}function r(e){const t=[],a={};return e.forEach(e=>{e&&"object"==typeof e&&(jb.comps[e.$]||{}).isSystem?jb.comps[e.$].macro(a,e):t.push(e)}),1==t.length&&"object"==typeof t[0]&&(jb.asArray(t[0].vars).forEach(e=>jb.comps[e.$].macro(a,e)),t[0].remark&&jb.comps.remark.macro(a,t[0])),{args:t,system:a}}function o(t,a){return jb.frame[t]&&!jb.frame[t][jb.macroDef]?(jb.logError(t+" is reserved by system or libs. please use a different name"),!1):(void 0===jb.macro[t]||a||jb.macroNs[t]||t.match(/_\$forwardDef$/)||jb.logError(t.replace(/_/g,".")+" is defined more than once, using last definition "+e),!0)}o(a)&&i(a),n&&o(n,!0)&&!jb.macro[n]&&(i(n),jb.macroNs[n]=!0)},removeDataResourcePrefix:e=>0==e.indexOf("dataResource.")?e.slice("dataResource.".length):e,addDataResourcePrefix:e=>0==e.indexOf("dataResource.")?e:"dataResource."+e}),Object.assign(jb,{spySettings:{includeLogs:"exception,error",stackFilter:/spy|jb_spy|Object.log|rx-comps|jb-core|node_modules/i,MAX_LOG_SIZE:1e4},initSpy({Error:e,settings:t,spyParam:a,memoryUsage:n,resetSpyToNull:i}){const r=jb.frame;return e=e||r.Error,n=n||(()=>r.performance&&performance.memory&&performance.memory.usedJSHeapSize),t=Object.assign(t||{},jb.spySettings),jb.spy=i?null:{logs:[],spyParam:a,otherSpies:[],observable(){const e=jb.path(jb,"studio.studiojb")||jb;return this._obs=this._obs||e.callbag.subject(),this._obs},enabled:()=>!0,calcIncludeLogsFromSpyParam(e){const a=(e||"").split(",").filter(e=>"-"!==e[0]).filter(e=>e),n=(e||"").split(",").filter(e=>"-"===e[0]).map(e=>e.slice(1));this.includeLogs=t.includeLogs.split(",").concat(a).filter(e=>-1===n.indexOf(e)).reduce((e,t)=>(e[t]=!0,e),{}),this.includeLogsInitialized=!0},shouldLog(e,t){const a=t&&(t.ctx||t.srcCtx||t.cmp&&t.cmp.ctx);return(!a||!a.vars.$disableLog)&&("all"===this.spyParam||"object"==typeof t&&e.split(" ").reduce((e,t)=>e||this.includeLogs[t],!1))},log(e,a,{takeFrom:i,funcTitle:r,modifier:o}={}){if(this.includeLogsInitialized||this.calcIncludeLogsFromSpyParam(this.spyParam),this.updateCounters(e),this.updateLocations(e,i),!this.shouldLog(e,a))return;const s=new Date,l=this.logs.length,c={logNames:e,...a,index:l,source:this.source(i),_time:`${s.getSeconds()}:${s.getMilliseconds()}`,time:s.getTime(),mem:n()/1e6,activeElem:jb.path(jb.frame.document,"activeElement"),$attsOrder:a&&Object.keys(a)};this.logs.length>0&&jb.path(jb.frame.document,"activeElement")!=this.logs[l-1].activeElem&&(this.logs[l-1].logNames+=" focus",this.logs[l-1].activeElemAfter=c.activeElem,this.logs[l-1].focusChanged=!0),this.logs.push(c),this.logs.length>1.1*t.MAX_LOG_SIZE&&(this.logs=this.logs.slice(-1*t.MAX_LOG_SIZE)),this._obs&&this._obs.next(c)},frameAccessible(e){try{return Boolean(e.document||e.contentDocument)}catch(e){return!1}},source(a){e.stackTraceLimit=50;let n=[r].reverse().filter(e=>this.frameAccessible(e)).map(e=>(new e.Error).stack).join("\n").split(/\r|\n/).map(e=>e.trim()).slice(4).filter(e=>"Error"!==e).filter(e=>!t.stackFilter.test(e));if(a){const e=n.findIndex(e=>-1!==e.indexOf(a));n=n.slice(e+1)}const i=n[0]||"",o=[i.split(/at |as /).pop().split(/ |]/)[0],i.split("/").pop().slice(0,-1).trim(),...n];return o.location=i.split(" ").slice(-1)[0].split("(").pop().split(")")[0],o},resetParam:e=>{this.spyParam=e,this.includeLogs=null},setLogs(e){"all"===e&&(this.spyParam="all"),this.calcIncludeLogsFromSpyParam(e)},clear(){this.logs=[],this.counters={}},updateCounters(e){this.counters=this.counters||{},this.counters[e]=this.counters[e]||0,this.counters[e]++},updateLocations(e){this.locations=this.locations||{},this.locations[e]=this.locations[e]||this.source().location},count(e){return e.split(/,|\|/).reduce((e,t)=>(function(e,t){return[...e,...t]})(e,t.split(" ").reduce((e,t)=>(function(e,t){return"!"==t[0]?e.filter(e=>!e[0].match(new RegExp(`\\b${t.slice(1)}\\b`))):e.filter(e=>e[0].match(new RegExp(`\\b${t}\\b`)))})(e,t),jb.entries(this.counters))),[]).reduce((e,t)=>e+t[1],0)},search(e,t=-1e3){return e.split(/,|\|/).reduce((e,a)=>(function(e,t){let a=[...e,...t].sort((e,t)=>e.index<t.index);return a.filter((e,t)=>0==t||a[t-1].index!=e.index)})(e,a.split(" ").reduce((e,t)=>(function(e,t){return"!"==t[0]?e.filter(e=>-1==e.logNames.toLowerCase().indexOf(t.slice(1))):e.filter(e=>-1!=e.logNames.toLowerCase().indexOf(t))})(e,t),this.logs.slice(t))),[])}}},initSpyByUrl(){const e=jb.frame,t=()=>{try{return e.location&&e.location.href}catch(e){}},a=e=>(e.match("[?&]spy=([^&]+)")||["",""])[1],n=e&&"studio"==e.jbUri&&(t().match("[?&]sspy=([^&]+)")||["",""])[1]||a((()=>{try{return e.parent&&e.parent.location.href}catch(e){}})()||"")||a(t()||"");n&&jb.initSpy({spyParam:n}),e&&(e.spy=jb.spy)},injectDebuggerJbm(){jb.jbms.visualDebugger=jb.createChildjbm(`${distPath}/jb-debugger.js?${parentUri}`)},injectVisualDebugger(e,t){const a=jb.remote.pathOfDistFolder(),n=jb.frame.jbUri||"";-1==e.indexOf("->")&&"undefined"!=typeof jb_loadFile&&"undefined"==typeof jbDebugger?(jb_loadFile(`${a}/jb-debugger.js?${n}`),jbDebugger.remote.cbPortFromFrame(jb.frame,`${n}-debugger`,t)):jb.exec(rx.pipe(source.data(()=>jb.remote.servers[e.split("->").pop()]),rx.var("worker","%%"),rx.var("distPath",()=>jb.remote.pathOfDistFolder()),rx.var("debuggerUri",()=>e),rx.var("debuggerClientUri",()=>t),remote.operator(({},{distPath:e,debuggerUri:t,debuggerClientUri:a})=>{self.jbDebugger||(importScripts(`${e}/jb-debugger.js?${self.jbUri}`),jbDebugger.remote.cbPortFromFrame(self,t,a))},"%$worker%")))},getDebugVms:()=>[jb.frame.jbUri,...Object.values(jb.remote.servers).map(e=>e.jbUri)].map(e=>`${e}-debugger`)}),jb.initSpyByUrl();var{not:not,and:and,or:or,contains:contains,writeValue:writeValue,obj:obj,prop:prop,log:log,pipeline:pipeline,filter:filter,firstSucceeding:firstSucceeding,runActions:runActions}=jb.ns("not,and,or,contains,writeValue,obj,prop,log,pipeline,filter,firstSucceeding,runActions");jb.component("call",{type:"any",params:[{id:"param",as:"string"}],impl:function(e,t){const a=e.cmpCtx&&e.cmpCtx.params[t];return"function"==typeof a?a(new jb.jbCtx(e,{data:e.data,vars:e.vars,cmpCtx:e.cmpCtx.cmpCtx,forcePath:a.srcPath})):a}}),jb.pipe=function(e,t,a){let n=jb.toarray(e.data);if(0==n.length&&(n=[null]),"string"==typeof e.profile.items)return e.runInner(e.profile.items,null,"items");const i=jb.asArray(e.profile.items||e.profile[t]),r=e.profile.items&&e.profile.items.sugar?"":e.profile[t]?t+"~":"items~";return"$pipe"==t?i.reduce((e,t,n)=>e.then(e=>jb.toSynchArray(e,!a)).then(e=>o(t,n,e)),Promise.resolve(n)).then(e=>jb.toSynchArray(e,!a)):i.reduce((e,t,a)=>o(t,a,e),n);function o(t,a,n){if(!t||t.$disabled)return n;const o=r+a,s=a<i.length-1?{as:"array"}:e.parentParam||{};return"aggregator"==jb.profileType(t)?jb.run(new jb.jbCtx(e,{data:n,profile:t,path:o}),s):[].concat.apply([],n.map(a=>jb.run(new jb.jbCtx(e,{data:a,profile:t,path:o}),s)).filter(e=>null!=e).map(e=>{const t=jb.val(e);return Array.isArray(t)?t:e}))}},jb.component("pipeline",{type:"data",description:"map data arrays one after the other, do not wait for promises and rx",params:[{id:"items",type:"data,aggregator[]",ignore:!0,mandatory:!0,composite:!0,description:'click "=" for functions list'}],impl:e=>jb.pipe(e,"$pipeline")}),jb.component("pipe",{type:"data",description:"synch data, wait for promises and reactive (callbag) data",params:[{id:"items",type:"data,aggregator[]",ignore:!0,mandatory:!0,composite:!0}],impl:e=>jb.pipe(e,"$pipe",!1)}),jb.component("pipePassRx",{type:"data",description:"wait for promises, do not wait for reactive data",params:[{id:"items",type:"data,aggregator[]",ignore:!0,mandatory:!0,composite:!0}],impl:e=>jb.pipe(e,"$pipe",!0)}),jb.component("data.if",{type:"data",macroByValue:!0,params:[{id:"condition",as:"boolean",mandatory:!0,dynamic:!0,type:"boolean"},{id:"then",mandatory:!0,dynamic:!0},{id:"else",dynamic:!0,defaultValue:"%%"}],impl:({},e,t,a)=>e()?t():a()}),jb.component("action.if",{type:"action",description:"if then else",macroByValue:!0,params:[{id:"condition",type:"boolean",as:"boolean",mandatory:!0},{id:"then",type:"action",mandatory:!0,dynamic:!0,composite:!0},{id:"else",type:"action",dynamic:!0}],impl:({},e,t,a)=>e?t():a()}),jb.component("jbRun",{type:"action",params:[{id:"profile",as:"string",mandatory:!0,description:"profile name"},{id:"params",as:"single"}],impl:(e,t,a)=>e.run(Object.assign({$:t},a||{}))}),jb.component("list",{type:"data",description:"also flatten arrays",params:[{id:"items",type:"data[]",as:"array",composite:!0}],impl:({},e)=>e.flatMap(e=>Array.isArray(e)?e:[e])}),jb.component("firstSucceeding",{type:"data",params:[{id:"items",type:"data[]",as:"array",composite:!0}],impl:({},e)=>{for(let t=0;t<e.length;t++){const a=jb.val(e[t]),n="number"==typeof a;if(""!==a&&null!=a&&(!n||!isNaN(a)&&a!==1/0&&a!==-1/0))return e[t]}return e.slice(-1)[0]}}),jb.component("keys",{type:"data",description:"Object.keys",params:[{id:"obj",defaultValue:"%%",as:"single"}],impl:({},e)=>Object.keys(e&&"object"==typeof e?e:{})}),jb.component("properties",{description:"object entries as id,val",type:"data",params:[{id:"obj",defaultValue:"%%",as:"single"}],impl:({},e)=>Object.keys(e).filter(e=>0!=e.indexOf("$jb_")).map((t,a)=>({id:t,val:e[t],index:a}))}),jb.component("entries",{description:"object entries as array 0/1",type:"data",params:[{id:"obj",defaultValue:"%%",as:"single"}],impl:({},e)=>jb.entries(e)}),jb.component("aggregate",{type:"aggregator",description:"calc function on all items, rather then one by one",params:[{id:"aggregator",type:"aggregator",mandatory:!0,dynamic:!0}],impl:({},e)=>e()}),jb.ns("math"),jb.component("math.max",{type:"aggregator",impl:e=>Math.max.apply(0,e.data)}),jb.component("math.min",{type:"aggregator",impl:e=>Math.max.apply(0,e.data)}),jb.component("math.sum",{type:"aggregator",impl:e=>e.data.reduce((e,t)=>+t+e,0)}),jb.component("math.plus",{params:[{id:"x",as:"number",mandatory:!0},{id:"y",as:"number",mandatory:!0}],impl:({},e,t)=>e+t}),jb.component("math.minus",{params:[{id:"x",as:"number",mandatory:!0},{id:"y",as:"number",mandatory:!0}],impl:({},e,t)=>e-t}),"abs,acos,acosh,asin,asinh,atan,atan2,atanh,cbrt,ceil,clz32,cos,cosh,exp,expm1,floor,fround,hypot,log2,random,round,sign,sin,sinh,sqrt,tan,tanh,trunc".split(",").forEach(e=>jb.component(`math.${e}`,{impl:t=>Math[e](t.data)})),jb.component("objFromEntries",{description:"object from entries",type:"aggregator",params:[{id:"entries",defaultValue:"%%",as:"array"}],impl:({},e)=>jb.objFromEntries(e)}),jb.component("evalExpression",{description:"evaluate javascript expression",type:"data",params:[{id:"expression",as:"string",defaultValue:"%%",expression:"e.g. 1+2"}],impl:({},expression)=>{try{return eval("("+expression+")")}catch(e){}}}),jb.component("prefix",{type:"data",params:[{id:"separator",as:"string",mandatory:!0},{id:"text",as:"string",defaultValue:"%%"}],impl:({},e,t)=>(t||"").substring(0,t.indexOf(e))}),jb.component("suffix",{type:"data",params:[{id:"separator",as:"string",mandatory:!0},{id:"text",as:"string",defaultValue:"%%"}],impl:({},e,t)=>(t||"").substring(t.lastIndexOf(e)+e.length)}),jb.component("removePrefix",{type:"data",params:[{id:"separator",as:"string",mandatory:!0},{id:"text",as:"string",defaultValue:"%%"}],impl:({},e,t)=>-1==t.indexOf(e)?t:t.substring(t.indexOf(e)+e.length)}),jb.component("removeSuffix",{type:"data",params:[{id:"separator",as:"string",mandatory:!0},{id:"text",as:"string",defaultValue:"%%"}],impl:({},e,t)=>-1==t.lastIndexOf(e)?t:t.substring(0,t.lastIndexOf(e))}),jb.component("removeSuffixRegex",{type:"data",params:[{id:"suffix",as:"string",mandatory:!0,description:"regular expression. e.g [0-9]*"},{id:"text",as:"string",defaultValue:"%%"}],impl:(e,t,a)=>{e.profile.prefixRegexp=e.profile.prefixRegexp||new RegExp(t+"$");const n=(a||"").match(e.profile.prefixRegexp);return n&&(a||"").substring(n.index+1)||a}}),jb.component("writeValue",{type:"action",params:[{id:"to",as:"ref",mandatory:!0},{id:"value",mandatory:!0},{id:"noNotifications",as:"boolean"}],impl:(e,t,a,n)=>{if(!jb.isRef(t))return e.run(e.profile.to,{as:"ref"}),jb.logError(`can not write to: ${e.profile.to}`,{ctx:e});const i=jb.val(a);if(jb.isDelayed(i))return Promise.resolve(i).then(a=>jb.writeValue(t,a,e,n));jb.writeValue(t,i,e,n)}}),jb.component("property",{description:"navigate/select/path property of object",params:[{id:"prop",as:"string",mandatory:!0},{id:"obj",defaultValue:"%%"}],impl:(e,t,a)=>jb.objectProperty(a,t,e)}),jb.component("indexOf",{params:[{id:"array",as:"array",mandatory:!0},{id:"item",as:"single",mandatory:!0}],impl:({},e,t)=>e.indexOf(t)}),jb.component("addToArray",{type:"action",params:[{id:"array",as:"ref",mandatory:!0},{id:"toAdd",as:"array",mandatory:!0}],impl:(e,t,a)=>jb.push(t,JSON.parse(JSON.stringify(a)),e)}),jb.component("move",{type:"action",description:"move item in tree, activated from D&D",params:[{id:"from",as:"ref",mandatory:!0},{id:"to",as:"ref",mandatory:!0}],impl:(e,t,a)=>jb.move(t,a,e)}),jb.component("splice",{type:"action",params:[{id:"array",as:"ref",mandatory:!0},{id:"fromIndex",as:"number",mandatory:!0},{id:"noOfItemsToRemove",as:"number",defaultValue:0},{id:"itemsToAdd",as:"array",defaultValue:[]}],impl:(e,t,a,n,i)=>jb.splice(t,[[a,n,...i]],e)}),jb.component("removeFromArray",{type:"action",params:[{id:"array",as:"ref",mandatory:!0},{id:"itemToRemove",as:"single",description:"choose item or index"},{id:"index",as:"number",description:"choose item or index"}],impl:(e,t,a,n)=>{const i=a?jb.toarray(t).indexOf(a):n;-1!=i&&jb.splice(t,[[i,1]],e)}}),jb.component("toggleBooleanValue",{type:"action",params:[{id:"of",as:"ref"}],impl:(e,t)=>jb.writeValue(t,!jb.val(t),e)}),jb.component("slice",{type:"aggregator",params:[{id:"start",as:"number",defaultValue:0,description:"0-based index",mandatory:!0},{id:"end",as:"number",mandatory:!0,description:"0-based index of where to end the selection (not including itself)"}],impl:({data:e},t,a)=>e&&e.slice?a?e.slice(t,a):e.slice(t):null}),jb.component("sort",{type:"aggregator",params:[{id:"propertyName",as:"string",description:"sort by property inside object"},{id:"lexical",as:"boolean",type:"boolean"},{id:"ascending",as:"boolean",type:"boolean"}],impl:({data:e},t,a,n)=>{if(!e||!Array.isArray(e))return null;let i;const r=jb.entries(e[0]||{})[0][1];return i=a||isNaN(r)?t?(e,a)=>e[t]==a[t]?0:e[t]<a[t]?-1:1:(e,t)=>e==t?0:e<t?-1:1:t?(e,a)=>e[t]-a[t]:(e,t)=>e-t,n?e.slice(0).sort((e,t)=>i(e,t)):e.slice(0).sort((e,t)=>i(t,e))}}),jb.component("first",{type:"aggregator",params:[{id:"items",as:"array",defaultValue:"%%"}],impl:({},e)=>e[0]}),jb.component("last",{type:"aggregator",params:[{id:"items",as:"array",defaultValue:"%%"}],impl:({},e)=>e.slice(-1)[0]}),jb.component("count",{type:"aggregator",description:"length, size of array",params:[{id:"items",as:"array",defaultValue:"%%"}],impl:({},e)=>e.length}),jb.component("reverse",{type:"aggregator",params:[{id:"items",as:"array",defaultValue:"%%"}],impl:({},e)=>e.reverse()}),jb.component("sample",{type:"aggregator",params:[{id:"size",as:"number",defaultValue:300},{id:"items",as:"array",defaultValue:"%%"}],impl:({},e,t)=>t.filter((a,n)=>n%(Math.floor(t.length/e)||1)==0)}),jb.component("obj",{description:"build object (dictionary) from props",params:[{id:"props",type:"prop[]",mandatory:!0,sugar:!0}],impl:(e,t)=>jb.objFromEntries(t.map(t=>[t.title,jb.tojstype(t.val(e),t.type)]))}),jb.component("extend",{description:"assign and extend with calculated properties",params:[{id:"props",type:"prop[]",mandatory:!0,defaultValue:[]}],impl:(e,t)=>Object.assign({},e.data,jb.objFromEntries(t.map(t=>[t.title,jb.tojstype(t.val(e),t.type)])))}),jb.component("assign",jb.comps.extend),jb.component("extendWithIndex",{type:"aggregator",description:"extend with calculated properties. %$index% is available ",params:[{id:"props",type:"prop[]",mandatory:!0,defaultValue:[]}],impl:(e,t)=>jb.toarray(e.data).map((a,n)=>Object.assign({},a,jb.objFromEntries(t.map(t=>[t.title,jb.tojstype(t.val(e.setData(a).setVars({index:n})),t.type)]))))}),jb.component("prop",{type:"prop",macroByValue:!0,params:[{id:"title",as:"string",mandatory:!0},{id:"val",dynamic:!0,type:"data",mandatory:!0,defaultValue:""},{id:"type",as:"string",options:"string,number,boolean,object,array,asIs",defaultValue:"asIs"}],impl:e=>e.params}),jb.component("refProp",{type:"prop",description:"value by reference allows to change or watch the value",params:[{id:"title",as:"string",mandatory:!0},{id:"val",dynamic:!0,as:"ref",mandatory:!0}],impl:e=>({...e.params,type:"ref"})}),jb.component("pipeline.var",{type:"aggregator",params:[{id:"name",as:"string",mandatory:!0},{id:"val",mandatory:!0,dynamic:!0,defaultValue:"%%"}],impl:e=>({[Symbol.for("Var")]:!0,...e.params})}),jb.component("Var",{type:"var,system",isSystem:!0,params:[{id:"name",as:"string",mandatory:!0},{id:"val",dynamic:!0,type:"data",mandatory:!0,defaultValue:"%%"}],macro:(e,t)=>{e.$vars=e.$vars||[],e.$vars.push(t)},impl:""}),jb.component("remark",{type:"system",isSystem:!0,params:[{id:"remark",as:"string",mandatory:!0}],macro:(e,t)=>Object.assign(e,{remark:t.remark})}),jb.component("If",{macroByValue:!0,params:[{id:"condition",as:"boolean",mandatory:!0,dynamic:!0,type:"boolean"},{id:"then",dynamic:!0},{id:"Else",dynamic:!0}],impl:({},e,t,a)=>e()?t():a()}),jb.component("not",{type:"boolean",params:[{id:"of",type:"boolean",as:"boolean",mandatory:!0,composite:!0}],impl:({},e)=>!e}),jb.component("and",{description:"logical and",type:"boolean",params:[{id:"items",type:"boolean[]",ignore:!0,mandatory:!0,composite:!0}],impl:function(e){const t=e.profile.$and||e.profile.items||[],a=e.profile.$and?"$and~":"items~";for(let n=0;n<t.length;n++)if(!e.runInner(t[n],{type:"boolean"},a+n))return!1;return!0}}),jb.component("or",{description:"logical or",type:"boolean",params:[{id:"items",type:"boolean[]",ignore:!0,mandatory:!0,composite:!0}],impl:function(e){const t=e.profile.$or||e.profile.items||[],a=e.profile.$or?"$or~":"items~";for(let n=0;n<t.length;n++)if(e.runInner(t[n],{type:"boolean"},a+n))return!0;return!1}}),jb.component("between",{description:"checks if number is in range",type:"boolean",params:[{id:"from",as:"number",mandatory:!0},{id:"to",as:"number",mandatory:!0},{id:"val",as:"number",defaultValue:"%%"}],impl:({},e,t,a)=>a>=e&&a<=t}),jb.component("contains",{type:"boolean",params:[{id:"text",type:"data[]",as:"array",mandatory:!0},{id:"allText",defaultValue:"%%",as:"string"},{id:"inOrder",defaultValue:!0,as:"boolean",type:"boolean"}],impl:({},e,t,a)=>{let n=-1;for(let i=0;i<e.length;i++){const r=t.indexOf(jb.tostring(e[i]),n+1);if(-1==r)return!1;n=a?r:-1}return!0}}),jb.component("notContains",{type:"boolean",params:[{id:"text",type:"data[]",as:"array",mandatory:!0},{id:"allText",defaultValue:"%%",as:"array"}],impl:not(contains({text:"%$text%",allText:"%$allText%"}))}),jb.component("startsWith",{description:"begins with, includes, contains",type:"boolean",params:[{id:"startsWith",as:"string",mandatory:!0},{id:"text",defaultValue:"%%",as:"string"}],impl:({},e,t)=>0==t.indexOf(e)}),jb.component("endsWith",{description:"includes, contains",type:"boolean",params:[{id:"endsWith",as:"string",mandatory:!0},{id:"text",defaultValue:"%%",as:"string"}],impl:({},e,t)=>-1!==t.indexOf(e,t.length-e.length)}),jb.component("filter",{type:"aggregator",params:[{id:"filter",type:"boolean",as:"boolean",dynamic:!0,mandatory:!0}],impl:(e,t)=>jb.toarray(e.data).filter(a=>t(e,a))}),jb.component("matchRegex",{description:"validation with regular expression",type:"boolean",params:[{id:"regex",as:"string",mandatory:!0,description:"e.g: [a-zA-Z]*"},{id:"text",as:"string",defaultValue:"%%"}],impl:({},e,t)=>t.match(new RegExp(e))}),jb.component("toUpperCase",{params:[{id:"text",as:"string",defaultValue:"%%"}],impl:({},e)=>e.toUpperCase()}),jb.component("toLowerCase",{params:[{id:"text",as:"string",defaultValue:"%%"}],impl:({},e)=>e.toLowerCase()}),jb.component("capitalize",{params:[{id:"text",as:"string",defaultValue:"%%"}],impl:({},e)=>e.charAt(0).toUpperCase()+e.slice(1)}),jb.component("join",{params:[{id:"separator",as:"string",defaultValue:",",mandatory:!0},{id:"prefix",as:"string"},{id:"suffix",as:"string"},{id:"items",as:"array",defaultValue:"%%"},{id:"itemText",as:"string",dynamic:!0,defaultValue:"%%"}],type:"aggregator",impl:(e,t,a,n,i,r)=>{const o=e.profile.itemText?t=>r(e.setData(t)):e=>jb.tostring(e);return a+i.map(o).join(t)+n}}),jb.component("unique",{params:[{id:"id",as:"string",dynamic:!0,defaultValue:"%%"},{id:"items",as:"array",defaultValue:"%%"}],type:"aggregator",impl:(e,t,a)=>{const n="%%"==t.profile?e=>e:a=>t(e.setData(a));return jb.unique(a,n)}}),jb.component("log",{params:[{id:"logName",as:"string",mandatory:"true"},{id:"logObj",as:"single"}],impl:(e,t,a)=>jb.log(t,{...a,ctx:e})}),jb.component("asIs",{params:[{id:"$asIs",ignore:!0}],impl:()=>context.profile.$asIs}),jb.component("object",{impl:function(e){let t={};const a=e.profile.$object||e.profile;if(Array.isArray(a))return a;for(let n in a)"$"==n&&"object"==a[n]||null==a[n]||(t[n]=e.runInner(a[n],null,n));return t}}),jb.component("json.stringify",{params:[{id:"value",defaultValue:"%%"},{id:"space",as:"string",description:"use space or tab to make pretty output"}],impl:({},e,t)=>JSON.stringify(jb.val(e),null,t)}),jb.component("json.parse",{params:[{id:"text",as:"string"}],impl:(e,t)=>{try{return JSON.parse(t)}catch(a){jb.logException(a,"json parse",{text:t,ctx:e})}}}),jb.component("split",{description:"breaks string using separator",type:"data",params:[{id:"separator",as:"string",defaultValue:",",description:'E.g., "," or "<a>"'},{id:"text",as:"string",defaultValue:"%%"},{id:"part",options:"all,first,second,last,but first,but last",defaultValue:"all"}],impl:({},e,t,a)=>{const n=t.split(e.replace(/\\r\\n/g,"\n").replace(/\\n/g,"\n"));switch(a){case"first":return n[0];case"second":return n[1];case"last":return n.pop();case"but first":return n.slice(1);case"but last":return n.slice(0,-1);default:return n}}}),jb.component("replace",{type:"data",params:[{id:"find",as:"string",mandatory:!0},{id:"replace",as:"string",mandatory:!0},{id:"text",as:"string",defaultValue:"%%"},{id:"useRegex",type:"boolean",as:"boolean",defaultValue:!0},{id:"regexFlags",as:"string",defaultValue:"g",description:"g,i,m"}],impl:({},e,t,a,n,i)=>n?a.replace(new RegExp(e,i),t):a.replace(e,t)}),jb.component("touch",{description:"change the value of a watchable variable to acticate its watchers",type:"action",params:[{id:"dataRef",as:"ref"}],impl:writeValue("%$dataRef%",not("%$dataRef%"))}),jb.component("isNull",{description:"is null or undefined",type:"boolean",params:[{id:"obj",defaultValue:"%%"}],impl:({},e)=>null==jb.val(e)}),jb.component("notNull",{description:"not null or undefined",type:"boolean",params:[{id:"obj",defaultValue:"%%"}],impl:({},e)=>null!=jb.val(e)}),jb.component("isEmpty",{type:"boolean",params:[{id:"item",as:"single",defaultValue:"%%"}],impl:({},e)=>!e||Array.isArray(e)&&0==e.length}),jb.component("notEmpty",{type:"boolean",params:[{id:"item",as:"single",defaultValue:"%%"}],impl:({},e)=>e&&!(Array.isArray(e)&&0==e.length)}),jb.component("equals",{type:"boolean",params:[{id:"item1",as:"single",mandatory:!0},{id:"item2",defaultValue:"%%",as:"single"}],impl:({},e,t)=>e==t}),jb.component("notEquals",{type:"boolean",params:[{id:"item1",as:"single",mandatory:!0},{id:"item2",defaultValue:"%%",as:"single"}],impl:({},e,t)=>e!=t}),jb.component("runActions",{type:"action",params:[{id:"actions",type:"action[]",ignore:!0,composite:!0,mandatory:!0}],impl:e=>{e.profile;const t=jb.asArray(e.profile.actions||e.profile.$runActions).filter(e=>e),a=e.profile.actions&&e.profile.actions.sugar?"":e.profile.$runActions?"$runActions~":"items~";return t.reduce((t,n,i)=>t.then((function(){return e.runInner(n,{as:"single"},a+i)})),Promise.resolve())}}),jb.component("runActionOnItem",{type:"action",params:[{id:"item",mandatory:!0},{id:"action",type:"action",dynamic:!0,mandatory:!0}],impl:(e,t,a)=>null!=t&&a(e.setData(t))}),jb.component("runActionOnItems",{type:"action",macroByValue:!0,params:[{id:"items",as:"ref[]",mandatory:!0},{id:"action",type:"action",dynamic:!0,mandatory:!0},{id:"notifications",as:"string",options:"wait for all actions,no notifications",description:"notification for watch-ref, default behavior is after each action"},{id:"indexVariable",as:"string"}],impl:(e,t,a,n,i)=>(n&&jb.mainWatchableHandler&&jb.mainWatchableHandler.startTransaction(),(jb.val(t)||[]).reduce((t,n,r)=>t.then(t=>a(e.setVar(i,r).setData(n))),Promise.resolve()).catch(t=>jb.logException(t,"runActionOnItems",{item:item,action:a,ctx:e})).then(()=>n&&jb.mainWatchableHandler&&jb.mainWatchableHandler.endTransaction("no notifications"===n)))}),jb.component("delay",{type:"action,data",params:[{id:"mSec",as:"number",defaultValue:1}],impl:(e,t)=>jb.delay(t).then(()=>e.data)}),jb.component("onNextTimer",{description:"run action after delay",type:"action",params:[{id:"action",type:"action",dynamic:!0,mandatory:!0},{id:"delay",type:"number",defaultValue:1}],impl:(e,t,a)=>jb.delay(a,e).then(()=>t())}),jb.component("extractPrefix",{type:"data",params:[{id:"separator",as:"string",description:"/w- alphnumberic, /s- whitespace, ^- beginline, $-endline"},{id:"text",as:"string",defaultValue:"%%"},{id:"regex",type:"boolean",as:"boolean",description:"separator is regex"},{id:"keepSeparator",type:"boolean",as:"boolean"}],impl:({},e,t,a,n)=>{if(!a)return t.substring(0,t.indexOf(e))+(n?e:"");{const a=t.match(e);if(a)return t.substring(0,a.index)+(n?a[0]:"")}}}),jb.component("extractSuffix",{type:"data",params:[{id:"separator",as:"string",description:"/w- alphnumberic, /s- whitespace, ^- beginline, $-endline"},{id:"text",as:"string",defaultValue:"%%"},{id:"regex",type:"boolean",as:"boolean",description:"separator is regex"},{id:"keepSeparator",type:"boolean",as:"boolean"}],impl:({},e,t,a,n)=>{if(!a)return t.substring(t.lastIndexOf(e)+(n?0:e.length));{const a=t.match(e+"(?![\\s\\S]*"+e+")");if(a)return t.substring(a.index+(n?0:a[0].length))}}}),jb.component("range",{description:"returns a range of number, generator, numerator, numbers, index",type:"data",params:[{id:"from",as:"number",defaultValue:1},{id:"to",as:"number",defaultValue:10}],impl:({},e,t)=>Array.from(Array(t-e+1).keys()).map(t=>t+e)}),jb.component("typeOf",{type:"data",params:[{id:"obj",defaultValue:"%%"}],impl:({},e)=>{const t=jb.val(e);return Array.isArray(t)?"array":typeof t}}),jb.component("className",{type:"data",params:[{id:"obj",defaultValue:"%%"}],impl:({},e)=>{const t=jb.val(e);return t&&t.constructor&&t.constructor.name}}),jb.component("isOfType",{type:"boolean",params:[{id:"type",as:"string",mandatory:!0,description:"e.g., string,boolean,array"},{id:"obj",defaultValue:"%%"}],impl:({},e,t)=>{const a=jb.val(t),n=Array.isArray(a)?"array":typeof a;return-1!=e.split(",").indexOf(n)}}),jb.component("inGroup",{description:"is in list, contains in array",type:"boolean",params:[{id:"group",as:"array",mandatory:!0},{id:"item",as:"single",defaultValue:"%%"}],impl:({},e,t)=>-1!=e.indexOf(t)}),jb.urlProxy=("undefined"!=typeof window&&location.href.match(/^[^:]*/)[0]||"http")+"://jbartdb.appspot.com/jbart_db.js?op=proxy&url=",jb.cacheKiller=0,jb.component("http.get",{type:"data,action",description:"fetch data from external url",params:[{id:"url",as:"string"},{id:"json",as:"boolean",description:"convert result to json",type:"boolean"},{id:"useProxy",as:"string",options:",localhost-server,cloud"}],impl:(e,t,a,n)=>{if(e.probe)return jb.http_get_cache[t];const i=a||t.match(/json$/);let r=t;return"localhost-server"==n?r=`/?op=fetch&req=${JSON.stringify({url:r})}&cacheKiller=${jb.cacheKiller++}`:"cloud"==n&&(r=`//jbart5-server.appspot.com/?op=fetch&req={url:"${r}"}&cacheKiller=${jb.cacheKiller++}`),fetch(r,{mode:"cors"}).then(e=>i?e.json():e.text()).then(e=>jb.http_get_cache?jb.http_get_cache[r]=e:e).catch(t=>jb.logException(t,"http.get",{ctx:e})||[])}}),jb.component("http.fetch",{type:"data,action",description:"fetch, get or post data from external url",params:[{id:"url",as:"string",mandatory:!0},{id:"method",as:"string",options:"GET,POST",defaultValue:"GET"},{id:"headers",as:"single",templateValue:obj(prop("Content-Type","application/json; charset=UTF-8"))},{id:"body",as:"single"},{id:"json",as:"boolean",description:"convert result to json",type:"boolean"},{id:"useProxy",as:"string",options:",localhost-server,cloud,cloud-test-local"}],impl:(e,t,a,n,i,r,o)=>{const s={url:t,method:a,headers:n||{},mode:"cors",body:"string"==typeof i||null==i?i:JSON.stringify(i)},l=encodeURIComponent(JSON.stringify(s));return e.probe?jb.http_get_cache[l]:("localhost-server"==o?s.url=`/?op=fetch&req=${l}&cacheKiller=${jb.cacheKiller++}`:"cloud"==o?s.url=`//jbart5-server.appspot.com/fetch?req=${l}&cacheKiller=${jb.cacheKiller++}`:"cloud-test-local"==o&&(s.url=`http://localhost:8080/fetch?req=${l}&cacheKiller=${jb.cacheKiller++}`),fetch(s.url,o?{mode:"cors"}:s).then(e=>r?e.json():e.text()).then(e=>jb.http_get_cache?jb.http_get_cache[l]=e:e).catch(t=>jb.logException(t,"http.fetch",{ctx:e})||[]))}}),jb.component("isRef",{params:[{id:"obj",mandatory:!0}],impl:({},e)=>jb.isRef(e)}),jb.component("asRef",{params:[{id:"obj",mandatory:!0}],impl:({},e)=>jb.asRef(e)}),jb.component("data.switch",{macroByValue:!1,params:[{id:"cases",type:"data.switch-case[]",as:"array",mandatory:!0,defaultValue:[]},{id:"default",dynamic:!0}],impl:(e,t,a)=>{for(let a=0;a<t.length;a++)if(t[a].condition(e))return t[a].value(e);return a(e)}}),jb.component("data.case",{type:"data.switch-case",params:[{id:"condition",type:"boolean",mandatory:!0,dynamic:!0},{id:"value",mandatory:!0,dynamic:!0}],impl:e=>e.params}),jb.component("action.switch",{type:"action",params:[{id:"cases",type:"action.switch-case[]",as:"array",mandatory:!0,defaultValue:[]},{id:"defaultAction",type:"action",dynamic:!0}],impl:(e,t,a)=>{for(let a=0;a<t.length;a++)if(t[a].condition(e))return t[a].action(e);return a(e)}}),jb.component("action.switchCase",{type:"action.switch-case",params:[{id:"condition",type:"boolean",as:"boolean",mandatory:!0,dynamic:!0},{id:"action",type:"action",mandatory:!0,dynamic:!0}],impl:e=>e.params}),jb.component("formatDate",{description:"using toLocaleDateString",params:[{id:"date",defaultValue:"%%",description:"Date value"},{id:"dateStyle",as:"string",options:"full,long,medium,short"},{id:"timeStyle",as:"string",options:"full,long,medium,short"},{id:"weekday",as:"string",options:"long,short,narrow"},{id:"year",as:"string",options:"numeric,2-digit"},{id:"month",as:"string",options:"numeric,2-digit,long,short,narrow"},{id:"day",as:"string",options:"numeric,2-digit"},{id:"hour",as:"string",options:"numeric,2-digit"},{id:"minute",as:"string",options:"numeric,2-digit"},{id:"second",as:"string",options:"numeric,2-digit"},{id:"timeZoneName",as:"string",options:"long,short"}],impl:(e,t)=>new Date(t).toLocaleDateString(void 0,jb.objFromEntries(jb.entries(e.params).filter(e=>e[1])))}),jb.component("getSessionStorage",{params:[{id:"id",as:"string"}],impl:({},e)=>jb.sessionStorage(e)}),jb.component("action.setSessionStorage",{params:[{id:"id",as:"string"},{id:"value",dynamic:!0}],impl:({},e,t)=>jb.sessionStorage(e,t())}),jb.component("waitFor",{params:[{id:"check",dynamic:!0},{id:"interval",as:"number",defaultValue:50},{id:"times",as:"number",defaultValue:300}],impl:(e,t,a,n)=>{let i=0;return new Promise((e,r)=>{const o=setInterval(()=>{i++;const a=t();(a||i>=n)&&clearInterval(o),a&&e(a),i>=n&&r("timeout")},a)})}});var{Var:Var,remark:remark}=jb.macro;jb.callbag={fromIter:e=>(t,a)=>{if(0!==t)return;const n="undefined"!=typeof Symbol&&e[Symbol.iterator]?e[Symbol.iterator]():e;let i,r=!1,o=!1;a(0,(function(e,t){1===e&&(o=!0,r||i&&i.done||function(){for(r=!0;o;)o=!1,(i=n.next()).done?a(2):a(1,i.value);r=!1}())}))},pipe(...e){const t=e.filter(e=>e);if(!t[0])return;let a=t[0];for(let e=1,n=t.length;e<n;e++){const n=t[e](a);n.ctx=t[e].ctx,Object.defineProperty(n,"name",{value:"register "+t[e].name}),a=n}return a},Do:e=>t=>(a,n)=>{0===a&&t(0,(function(t,a){1==t&&e(a),n(t,a)}))},filter:e=>t=>(a,n)=>{if(0!==a)return;let i;t(0,(function(t,a){0===t?(i=a,n(t,a)):1===t?e(a)?n(t,a):i(1):n(t,a)}))},map:e=>t=>(a,n)=>{0===a&&t(0,(function(t,a){n(t,1===t?e(a):a)}))},throwError:(e,t)=>a=>(n,i)=>{let r;0===n&&a(0,(function(a,n){0===a&&(r=n),1==a&&e(n)?(r&&r(2),i(2,t)):i(a,n)}))},distinctUntilChanged:e=>t=>(a,n)=>{if(e=e||((e,t)=>e===t),0!==a)return;let i,r,o=!1;t(0,(function(t,a){0===t&&(r=a),1===t?o&&e(i,a)?r(1):(o=!0,i=a,n(1,a)):n(t,a)}))},takeUntil(e){jb.isPromise(e)&&(e=jb.callbag.fromPromise(e));const t={};return a=>(n,i)=>{if(0!==n)return;let r,o,s=!1,l=t;a(0,(function(a,n){if(0===a)return r=n,e(0,(function(e,t){if(0!==e)return 1===e?(l=void 0,o(2),r(2),void(s&&i(2))):void(2===e&&(l=t,null!=t&&(r(2),s&&i(e,t))));(o=t)(1)})),s=!0,i(0,(function(e,a){l===t&&(2===e&&o&&o(2),r(e,a))})),void(l!==t&&i(2,l));2===a&&o(2),l===t&&i(a,n)}))}},concatMap(e,t){const a=(...t)=>jb.callbag.fromAny(e(...t));return e=>(n,i)=>{if(0!==n)return;let r,o,s,l=[];t||(t=(e,t)=>t);const c=e=>(function(n,o){if(0===n)(r=o)(1);else if(1===n)i(1,t(e,o)),r(1);else if(2===n){if(r=null,0===l.length)return void p(o);const e=l.shift();a(e)(0,c(e))}});function d(e,t){2===e&&r&&r(2,t),o(e,t)}function p(e){if(null!=e)return l=[],r=r=null,void i(2,e);!s||r||0!=l.length?r&&r(1):i(2,e)}e(0,(function(e,t){if(0===e)return o=t,void i(0,d);if(1===e)if(r)l.push(t);else{const e=a(t);e(0,c(t)),e(1)}else 2===e&&(s=!0,p(t))}))}},flatMap:(e,t)=>a=>(n,i)=>{if(0!==n)return;t||(t=(e,t)=>t);let r=0;const o={};let s=!1,l=null;function c(e){s&&0===Object.keys(o).length?i(2,e):!s&&l&&l(1)}function d(e,t){const a=Object.values(o).pop();1===e&&(a&&a(1),s||l(1)),2===e&&c(t)}a(0,(function(a,n){var p,m;0===a&&(l=n,i(0,d)),1===a&&((...t)=>jb.callbag.fromAny(e(...t)))(n)(0,(p=r++,m=n,(e,a)=>{0===e&&(o[p]=a,o[p](1)),1===e&&i(1,null==a?null:t(m,a)),2===e&&(delete o[p],c(a))})),2===a&&(s=!0,c(n))}))},merge(...e){const t=e.filter(e=>e).filter(e=>jb.callbag.fromAny(e));return function(e,a){if(0!==e)return;const n=t.length,i=new Array(n);let r=0,o=!1;const s=(e,t)=>{2===e&&(o=!0);for(let a=0;a<n;a++)i[a]&&i[a](e,t)};for(let e=0;e<n;e++){if(o)return;t[e](0,(t,l)=>{if(0===t)i[e]=l,a(0,s);else if(2===t&&l){o=!0;for(let t=0;t<n;t++)t!==e&&i[t]&&i[t](2);a(2,l)}else 2===t?(i[e]=void 0,++r===n&&a(2)):a(t,l)})}}},race(...e){const t=e.filter(e=>e).filter(e=>jb.callbag.fromAny(e));return function(e,a){if(0!==e)return;const n=t.length,i=new Array(n);let r=!1;const o=(e,t)=>{2===e&&(r=!0);for(let a=0;a<n;a++)i[a]&&i[a](e,t)};for(let e=0;e<n;e++){if(r)return;t[e](0,(function(t,s){if(0===t)i[e]=s,a(0,o);else{r=!0;for(let t=0;t<n;t++)t!==e&&i[t]&&i[t](2);a(1,s),a(2)}}))}}},fromEvent:(e,t,a)=>(n,i)=>{if(!t)return;if(0!==n)return;let r=!1;const o=e=>i(1,e);if(i(0,(function(n,i){if(2===n)if(r=!0,t.removeEventListener)t.removeEventListener(e,o,a);else{if(!t.removeListener)throw new Error("cannot remove listener from elem. No method found.");t.removeListener(e,o,a)}})),!r)if(t.addEventListener)t.addEventListener(e,o,a);else{if(!t.addListener)throw new Error("cannot add listener to elem. No method found.");t.addListener(e,o,a)}},fromPromise:e=>(t,a)=>{if(0!==t)return;let n=!1;Promise.resolve(e).then(e=>{n||(a(1,e),n||a(2))},(e=new Error)=>{n||a(2,e)}),a(0,(function(e,t){2===e&&(n=!0)}))},subject(){let e=[];function t(t,a){if(0===t){const t=a;e.push(t),t(0,(function(a,n){if(2===a){const a=e.indexOf(t);a>-1&&e.splice(a,1)}}))}else{const n=e.slice(0);for(let i,r=0,o=n.length;r<o;r++)i=n[r],e.indexOf(i)>-1&&i(t,a)}}return t.next=e=>t(1,e),t.complete=()=>t(2),t.error=e=>t(2,e),t.sinks=e,t},replayWithTimeout:e=>t=>{e=e||1e3;let a=[];return t(0,(function(t,n){if(1==t&&n){const t=(new Date).getTime();(a=a.filter(a=>t<a.time+e)).push({time:t,d:n})}})),function(n,i){if(0!==n)return;t(0,(function(e,t){i(e,t)}));const r=(new Date).getTime();(a=a.filter(t=>r<t.time+e)).forEach(e=>i(1,e.d))}},replay:e=>t=>{let a,n=[],i=[],r=!1;const o=(e=e||0)>0?-1*e:0;return t(0,(function(e,t){0!=e?(1==e&&(n.push(t),i.forEach(e=>e(1,t))),2==e&&(r=!0,i.forEach(e=>e(2)),i=[])):a=t})),s.sinks=i,s;function s(e,t){0===e&&(i.push(t),t(0,(function(e,n){0!=e&&(1!=e?2==e&&(i=i.filter(e=>e!==t)):a(1))})),n.slice(o).forEach(e=>t(1,e)),r&&t(2))}},catchError:e=>t=>(a,n)=>{if(0!==a)return;let i;t(0,(function(t,a){i||(2===t&&void 0!==a?(i=!0,n(1,e(a)),n(2)):n(t,a))}))},create:e=>(t,a)=>{if(0!==t)return;if("function"!=typeof e)return a(0,()=>{}),void a(2);let n,i=!1;a(0,(e,t)=>{i||(i=2===e)&&"function"==typeof n&&n()}),i||(n=e(e=>{i||a(1,e)},e=>{i||void 0===e||(i=!0,a(2,e))},()=>{i||(i=!0,a(2))}))},debounceTime:(e,t=!0)=>a=>(n,i)=>{if(0!==n)return;let r;a(0,(function(a,n){let o=!1;!r&&t&&(i(a,n),o=!0),r&&clearTimeout(r),1===a?r=setTimeout(()=>{r=null,o||i(1,n)},"function"==typeof e?e():e):i(a,n)}))},throttleTime:(e,t)=>a=>(n,i)=>{if(0!==n)return;let r,o,s,l=!1,c=!1;i(0,(function(e,t){2===e&&(c=!0)})),a(0,(function(a,n){if(0===a)(r=n)(1);else{if(c)return;1===a?s?o=n:(i(a,n),o=null,s=setTimeout(()=>{s=null,l||r(1),void 0!==t&&!t||null==o||i(a,n)},"function"==typeof e?e():e)):2===a&&(l=!0,i(a,n))}}))},take:e=>t=>(a,n)=>{if(0!==a)return;let i,r,o=0;function s(e,t){2===e&&(r=!0),i(e,t)}t(0,(function(t,a){0===t?(i=a,n(0,s)):1===t?o<e&&(o++,n(t,a),o!==e||r||(r=!0,i(2),n(2))):n(t,a)}))},takeWhile:(e,t)=>a=>(n,i)=>{if(0!==n)return;let r;a(0,(function(a,n){0===a&&(r=n),1!==a||e(n)?i(a,n):(t&&i(a,n),r(2),i(2))}))},last:()=>e=>(t,a)=>{if(0!==t)return;let n,i,r=!1;e(0,(function(e,t){0===e?(n=t,a(e,t)):1===e?(i=t,r=!0,n(1)):2===e?(r&&a(1,i),a(2)):a(e,t)}))},forEach:e=>t=>{let a;t(0,(function(t,n){0===t&&(a=n),1===t&&e(n),1!==t&&0!==t||a(1)}))},subscribe:(e={})=>t=>{"function"==typeof e&&(e={next:e});let a,n,{next:i,error:r,complete:o}=e;return t(0,(function(t,s){0===t&&(a=s),1===t&&i&&i(s),1!==t&&0!==t||a(1),2===t&&(n=!0),2===t&&!s&&o&&o(),2===t&&s&&r&&r(s),2===t&&e.finally&&e.finally(s)})),{dispose:()=>a&&!n&&a(2),isDone:()=>n,isActive:()=>a&&!n}},toPromise:e=>new Promise((t,a)=>{jb.callbag.subscribe({next:t,error:a,complete:()=>{const e=new Error("No elements in sequence.");e.code="NO_ELEMENTS",a(e)}})(jb.callbag.last(e))}),toPromiseArray:e=>{const t=[];let a;return new Promise((n,i)=>{e(0,(function(e,r){0===e&&(a=r),1===e&&t.push(r),1!==e&&0!==e||a(1),2!==e||r||n(t),2===e&&r&&i(r)}))})},mapPromise:e=>t=>jb.callbag.concatMap(t=>jb.callbag.fromPromise(Promise.resolve().then(()=>e(t))))(t),doPromise:e=>t=>jb.callbag.concatMap(t=>jb.callbag.fromPromise(Promise.resolve().then(()=>e(t)).then(()=>t)))(t),interval:e=>(t,a)=>{if(0!==t)return;let n=0;const i=setInterval((function(){a(1,n++)}),e);a(0,e=>2===e&&clearInterval(i))},startWith:(...e)=>t=>(a,n)=>{if(0!==a)return;let i,r,o=!1,s=!1;for(n(0,(function(t,a){s&&1===t&&(r=[1,a]),2===t&&(o=!0,e.length=0),i&&i(t,a)}));0!==e.length;)1===e.length&&(s=!0),n(1,e.shift());o||t(0,(function(e,t){if(0===e)return i=t,s=!1,void(r&&(i(...r),r=null));n(e,t)}))},delay:e=>t=>(a,n)=>{if(0!==a)return;let i,r,o,s=0;t(0,(function(t,a){if(1==t&&a&&!i){let t=setTimeout(()=>{s--,clearTimeout(t),n(1,a),i&&!o&&(o=!0,n(2,r))},"function"==typeof e?e():e);s++}else 2==t?(i=!0,r=a,s||n(t,a)):n(t,a)}))},skip:e=>t=>(a,n)=>{if(0!==a)return;let i,r=0;t(0,(function(t,a){if(0===t&&(i=a),1===t&&r<e)return r++,void i(1);n(t,a)}))},sniffer:(e,t)=>(a,n)=>{if(0!==a)return;let i;const r=(e,t)=>{s("talkback",e,t),i(e,t)},o=(e,t)=>{if(s("out",e,t),0==e)return i=t,Object.defineProperty(r,"name",{value:i.name+"-sniffer"}),void n(0,r);n(e,t)};function s(e,a,n){const i=new Date,r=`${i.getSeconds()}:${i.getMilliseconds()}`;t.next({dir:e,t:a,d:n,time:r}),2==a&&t.complete&&t.complete(n)}o.ctx=e.ctx,Object.defineProperty(o,"name",{value:e.name+"-sniffer"}),o.dispose=()=>{console.log("dispose",n,i)},e(0,o)},timeoutLimit:(e,t)=>a=>(n,i)=>{if(0!==n)return;let r,o=setTimeout(()=>{r&&r(2),i(2,"function"==typeof t?t():t||"timeout")},"function"==typeof e?e():e);a(0,(function(e,t){2===e&&clearTimeout(o),0===e&&(r=t),i(e,t)}))},fromCallBag:e=>e,fromAny:(e,t,a)=>{const n=e&&"from"+(jb.isPromise(e)?"Promise":e.addEventListener?"Event":"function"==typeof e[Symbol.iterator]?"Iter":"");return jb.callbag[n]?jb.callbag[n](e,t,a):jb.callbag.isCallbag(e)?e:jb.callbag.fromIter([e])},isSink:e=>"function"==typeof e&&e.toString().match(/sinkSrc/),isCallbag:e=>"function"==typeof e&&e.toString().split("=>")[0].split("{")[0].replace(/\s/g,"").match(/start,sink|t,d/),injectSniffers:(e,t)=>e,log:e=>jb.callbag.Do(t=>console.log(e,t)),jbLog:(e,...t)=>jb.callbag.Do(a=>jb.log(e,{data:a,...t}))};var{If:If,call:call,rx:rx,sink:sink,source:source}=jb.ns("rx,sink,source");jb.component("source.data",{type:"rx",params:[{id:"data",mandatory:!0}],impl:(e,t)=>jb.callbag.map(t=>e.dataObj(t))(jb.callbag.fromIter(jb.toarray(t)))}),jb.component("source.watchableData",{type:"rx",params:[{id:"ref",as:"ref"},{id:"includeChildren",as:"string",options:"yes,no,structure",defaultValue:"no",description:"watch childern change as well"}],impl:(e,t,a)=>jb.ui.refObservable(t,null,{includeChildren:a,srcCtx:e})}),jb.component("source.callbag",{type:"rx",params:[{id:"callbag",mandatory:!0,description:"callbag source function"}],impl:(e,t)=>jb.callbag.map(t=>e.dataObj(t))(t||jb.callbag.fromIter([]))}),jb.component("source.event",{type:"rx",macroByValue:!0,params:[{id:"event",as:"string",mandatory:!0,options:"load,blur,change,focus,keydown,keypress,keyup,click,dblclick,mousedown,mousemove,mouseup,mouseout,mouseover,scroll"},{id:"elem",description:"html element",defaultValue:()=>jb.frame.document},{id:"options",description:"addEventListener options, https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener"}],impl:(e,t,a,n)=>a&&jb.callbag.map(t=>e.setVar("sourceEvent",t).dataObj(t))(jb.callbag.fromEvent(t,a,n))}),jb.component("source.any",{type:"rx",params:[{id:"source",mandatory:!0,description:"the source is detected by its type: promise, iterable, single, callbag element, etc.."}],impl:(e,t)=>jb.callbag.map(t=>e.dataObj(t))(jb.callbag.fromAny(t||[]))}),jb.component("source.promise",{type:"rx",params:[{id:"promise",mandatory:!0}],impl:(e,t)=>jb.callbag.map(t=>e.dataObj(t))(jb.callbag.fromPromise(t))}),jb.component("source.interval",{type:"rx",params:[{id:"interval",as:"number",templateValue:"1000",description:"time in mSec"}],impl:(e,t)=>jb.callbag.map(t=>e.dataObj(t))(jb.callbag.interval(t))}),jb.component("rx.pipe",{type:"rx,data,action",category:"source",description:"pipeline of reactive observables with source",params:[{id:"elems",type:"rx[]",as:"array",mandatory:!0,dynamic:!0,templateValue:[]}],impl:(e,t)=>jb.callbag.pipe(...jb.callbag.injectSniffers(t(e).filter(e=>e),e))}),jb.component("rx.merge",{type:"rx",category:"source",description:"merge callbags sources (or any)",params:[{id:"sources",type:"rx[]",as:"array",mandatory:!0,dynamic:!0,templateValue:[]}],impl:(e,t)=>jb.callbag.merge(...t(e))}),jb.component("rx.innerPipe",{type:"rx",category:"operator",description:"inner reactive pipeline without source",params:[{id:"elems",type:"rx[]",as:"array",mandatory:!0,templateValue:[]}],impl:(e,t)=>e=>jb.callbag.pipe(e,...t)}),jb.component("rx.startWith",{type:"rx",category:"operator",description:"startWith callbags sources (or any)",params:[{id:"sources",type:"rx[]",as:"array"}],impl:(e,t)=>jb.callbag.startWith(...t)}),jb.component("rx.var",{type:"rx",category:"operator",description:"define a variable that can be used later in the pipe",params:[{id:"name",as:"string",dynamic:!0,mandatory:!0,description:"if empty, does nothing"},{id:"value",dynamic:!0,defaultValue:"%%",mandatory:!0}],impl:If("%$name%",(e,{},{name:t,value:a})=>e=>(n,i)=>{if(0==n)return e(0,(function(e,n){i(e,1===e?n&&{data:n.data,vars:{...n.vars,[t()]:a(n)}}:n)}))},null)}),jb.component("rx.reduce",{type:"rx",category:"operator",description:"incrementally aggregates/accumulates data in a variable, e.g. count, concat, max, etc",params:[{id:"varName",as:"string",mandatory:!0,description:"the result is accumulated in this var",templateValue:"acc"},{id:"initialValue",dynamic:!0,description:"receives first value as input",mandatory:!0},{id:"value",dynamic:!0,defaultValue:"%%",description:"the accumulated var is available. E,g. %$acc%,%% ",mandatory:!0},{id:"avoidFirst",as:"boolean",description:"used for join with separators, initialValue uses the first value without adding the separtor"}],impl:(e,t,a,n,i)=>e=>(r,o)=>{if(0!==r)return;let s,l=!0;e(0,(function(e,r){1==e?(l?(s=a(r),l=!1,i||(s=n({data:r.data,vars:{...r.vars,[t]:s}}))):s=n({data:r.data,vars:{...r.vars,[t]:s}}),o(e,null==s?r:{data:r.data,vars:{...r.vars,[t]:s}})):o(e,r)}))}}),jb.component("rx.count",{params:[{id:"varName",as:"string",mandatory:!0,defaultValue:"count"}],impl:rx.reduce({varName:"%$varName%",initialValue:0,value:(e,{},{varName:t})=>e.vars[t]+1})}),jb.component("rx.join",{params:[{id:"varName",as:"string",mandatory:!0,defaultValue:"join"},{id:"separator",as:"string",defaultValue:","}],impl:rx.reduce({varName:"%$varName%",initialValue:"%%",value:(e,{},{varName:t,separator:a})=>[e.vars[t],e.data].join(a),avoidFirst:!0})}),jb.component("rx.max",{params:[{id:"varName",as:"string",mandatory:!0,defaultValue:"max"},{id:"value",dynamic:!0,defaultValue:"%%"}],impl:rx.reduce({varName:"%$varName%",initialValue:Number.NEGATIVE_INFINITY,value:(e,{},{varName:t,value:a})=>Math.max(e.vars[t],a(e))})}),jb.component("rx.do",{type:"rx",category:"operator",params:[{id:"action",type:"action",dynamic:!0,mandatory:!0}],impl:(e,t)=>jb.callbag.Do(e=>t(e))}),jb.component("rx.doPromise",{type:"rx",category:"operator",params:[{id:"action",type:"action",dynamic:!0,mandatory:!0}],impl:(e,t)=>jb.callbag.doPromise(e=>t(e))}),jb.component("rx.map",{type:"rx",category:"operator",params:[{id:"func",dynamic:!0,mandatory:!0}],impl:(e,t)=>jb.callbag.map(jb.addDebugInfo(e=>({data:t(e),vars:e.vars||{}}),e))}),jb.component("rx.mapPromise",{type:"rx",category:"operator",params:[{id:"func",dynamic:!0,mandatory:!0}],impl:(e,t)=>jb.callbag.mapPromise(e=>Promise.resolve(t(e)).then(t=>({vars:e.vars||{},data:t})))}),jb.component("rx.filter",{type:"rx",category:"filter",params:[{id:"filter",type:"boolean",dynamic:!0,mandatory:!0}],impl:(e,t)=>jb.callbag.filter(jb.addDebugInfo(e=>t(e),e))}),jb.component("rx.flatMap",{type:"rx",category:"operator",description:"match inputs the callbags or promises",params:[{id:"source",type:"rx",category:"source",dynamic:!0,mandatory:!0,description:"map each input to source callbag"}],impl:(e,t)=>a=>(n,i)=>{if(0!==n)return;let r,o,s=[];function l(e){o&&0==s.length&&i(2,e)}a(0,(function(a,n){0===a&&(r=n),1===a&&null!=n&&function(a){const n=t(e.setData(a.data).setVars(a.vars));s.push(n),n(0,(function(e,t){0==e&&(n.talkback=t),1==e&&i(e,t),2!=e&&n.talkback&&n.talkback(1),2==e&&(s.splice(s.indexOf(n),1),l(t))}))}(n),2===a&&(o=!0,l(n))})),i(0,(function(e,t){(1==e&&null==t||2==e)&&(r(e,t),s.forEach(a=>a.talkback&&a.talkback(e,t)))}))}}),jb.component("rx.flatMapArrays",{type:"rx",category:"operator",description:"match inputs to data arrays",params:[{id:"func",dynamic:!0,defaultValue:"%%",description:"should return array, items will be passed one by one"}],impl:rx.flatMap(source.data(call("func")))}),jb.component("rx.concatMap",{type:"rx",category:"operator,combine",params:[{id:"func",dynamic:!0,mandatory:!0,description:"keeps the order of the results, can return array, promise or callbag"},{id:"combineResultWithInput",dynamic:!0,description:"combines %$input% with the inner result %%"}],impl:(e,t,a)=>a.profile?jb.callbag.concatMap(e=>t(e),(e,{data:t})=>a({data:t,vars:{...e.vars,input:e.data}})):jb.callbag.concatMap(e=>t(e))}),jb.component("rx.distinctUntilChanged",{type:"rx",description:"filters adjacent items in stream",category:"filter",impl:()=>jb.callbag.distinctUntilChanged((e,t)=>e&&t&&e.data==t.data)}),jb.component("rx.catchError",{type:"rx",category:"error",impl:e=>jb.callbag.catchError(t=>e.dataObj(t))}),jb.component("rx.timeoutLimit",{type:"rx",category:"error",params:[{id:"timeout",dynamic:!0,defaultValue:"3000",description:"can be dynamic"},{id:"error",dynamic:!0,defaultValue:"timeout"}],impl:(e,t,a)=>jb.callbag.timeoutLimit(t,a)}),jb.component("rx.throwError",{type:"rx",category:"error",params:[{id:"condition",as:"boolean",dynamic:!0,mandatory:!0},{id:"error",mandatory:!0}],impl:(e,t,a)=>jb.callbag.throwError(e=>t(e),a)}),jb.component("rx.debounceTime",{type:"rx",description:"waits for a cooldown period, them emits the last arrived",category:"operator",params:[{id:"cooldownPeriod",dynamic:!0,description:"can be dynamic"},{id:"immediate",as:"boolean",description:"emits the first event immediately, default is true"}],impl:(e,t,a)=>jb.callbag.debounceTime(t,a)}),jb.component("rx.throttleTime",{type:"rx",description:"enforces a cooldown period. Any data that arrives during the quiet time is ignored",category:"operator",params:[{id:"cooldownPeriod",dynamic:!0,description:"can be dynamic"},{id:"emitLast",as:"boolean",description:"emits the last event arrived at the end of the cooldown, default is true"}],impl:(e,t,a)=>jb.callbag.throttleTime(t,a)}),jb.component("rx.delay",{type:"rx",category:"operator",params:[{id:"time",dynamic:!0,description:"can be dynamic"}],impl:(e,t)=>jb.callbag.delay(t)}),jb.component("rx.replay",{type:"rx",description:"stores messages and replay them for later subscription",params:[{id:"itemsToKeep",as:"number",description:"empty for unlimited"}],impl:(e,t)=>jb.callbag.replay(t)}),jb.component("rx.takeUntil",{type:"rx",description:"closes the stream when events comes from notifier",category:"terminate",params:[{id:"notifier",type:"rx",description:"can be also promise or any other"}],impl:(e,t)=>jb.callbag.takeUntil(t)}),jb.component("rx.take",{type:"rx",description:"closes the stream after taking some items",category:"terminate",params:[{id:"count",as:"number",dynamic:!0,mandatory:!0}],impl:(e,t)=>jb.callbag.take(t())}),jb.component("rx.takeWhile",{type:"rx",description:"closes the stream on condition",category:"terminate",params:[{id:"whileCondition",as:"boolean",dynamic:!0,mandatory:!0},{id:"passtLastEvent",as:"boolean"}],impl:(e,t,a)=>jb.callbag.takeWhile(e=>t(e),a)}),jb.component("rx.last",{type:"rx",category:"filter",impl:()=>jb.callbag.last()}),jb.component("rx.skip",{type:"rx",category:"filter",params:[{id:"count",as:"number",dynamic:!0}],impl:(e,t)=>jb.callbag.skip(t())}),jb.component("rx.subscribe",{type:"rx",description:"forEach action for all items",category:"sink",params:[{id:"next",type:"action",dynamic:!0,mandatory:!0},{id:"error",type:"action",dynamic:!0},{id:"complete",type:"action",dynamic:!0}],impl:(e,t,a,n)=>jb.callbag.subscribe(e=>t(e),e=>a(e),()=>n())}),jb.component("sink.action",{type:"rx",category:"sink",description:"subscribe",params:[{id:"action",type:"action",dynamic:!0,mandatory:!0}],impl:(e,t)=>jb.callbag.subscribe(e=>t(e))}),jb.component("sink.data",{type:"rx",params:[{id:"data",as:"ref",dynamic:!0,mandatory:!0}],impl:sink.action(writeValue("%$data()%","%%"))}),jb.component("rx.log",{description:"jb.log flow data, used for debug",params:[{id:"name",as:"string"},{id:"extra",as:"single",dynamic:!0}],impl:(e,t,a)=>e.run(rx.do(n=>jb.log(t,{data:n.data,vars:n.vars,ctx:e,...a(n)})))}),jb.component("rx.clog",{description:"console.log flow data, used for debug",params:[{id:"name",as:"string"}],impl:rx.do((e,{},{name:t})=>console.log(t,e))}),jb.component("rx.sniffer",{description:"console.log data & control",params:[{id:"name",as:"string"}],impl:(e,t)=>e=>jb.callbag.sniffer(e,{next:e=>console.log(t,e)})}),jb.component("rx.subject",{type:"data",description:'callbag "variable" that you can write or listen to',category:"variable",params:[{id:"replay",as:"boolean",description:"keep pushed items for late subscription"},{id:"itemsToKeep",as:"number",description:"relevant for replay, empty for unlimited"}],impl:(e,t,a)=>{const n=jb.callbag.subject(),i=t?jb.callbag.replay(a)(n):n;return i.ctx=n.ctx=e,{trigger:n,source:i}}}),jb.component("sink.subjectNext",{type:"rx",params:[{id:"subject",mandatory:!0}],impl:(e,t)=>jb.callbag.subscribe(e=>t.trigger.next(e))}),jb.component("source.subject",{type:"rx",params:[{id:"subject",mandatory:!0}],impl:(e,t)=>t.source}),jb.component("action.subjectNext",{type:"action",params:[{id:"subject",mandatory:!0},{id:"data",dynamic:!0,defaultValue:"%%"}],impl:(e,t,a)=>t.trigger.next(e.dataObj(a(e)))}),jb.component("action.subjectComplete",{type:"action",params:[{id:"subject",mandatory:!0}],impl:(e,t)=>t.trigger.complete()}),jb.component("action.subjectError",{type:"action",params:[{id:"subject",mandatory:!0},{id:"error",dynamic:!0,mandatory:!0}],impl:(e,t,a)=>t.trigger.error(a())}),function(e){var t={};function a(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(n,i,function(t){return e[t]}.bind(null,i));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s="./src/ui/pack-immutable.js")}({"./node_modules/immutability-helper/index.js":
/*!***************************************************!*\
  !*** ./node_modules/immutability-helper/index.js ***!
  \***************************************************/
/*! no static exports found */function(module,exports,__webpack_require__){eval("var invariant = __webpack_require__(/*! invariant */ \"./node_modules/invariant/browser.js\");\n\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar splice = Array.prototype.splice;\n\nvar toString = Object.prototype.toString\nvar type = function(obj) {\n  return toString.call(obj).slice(8, -1);\n}\n\nvar assign = Object.assign || /* istanbul ignore next */ function assign(target, source) {\n  getAllKeys(source).forEach(function(key) {\n    if (hasOwnProperty.call(source, key)) {\n      target[key] = source[key];\n    }\n  });\n  return target;\n};\n\nvar getAllKeys = typeof Object.getOwnPropertySymbols === 'function' ?\n  function(obj) { return Object.keys(obj).concat(Object.getOwnPropertySymbols(obj)) } :\n  /* istanbul ignore next */ function(obj) { return Object.keys(obj) };\n\n/* istanbul ignore next */\nfunction copy(object) {\n  if (Array.isArray(object)) {\n    return assign(object.constructor(object.length), object)\n  } else if (type(object) === 'Map') {\n    return new Map(object)\n  } else if (type(object) === 'Set') {\n    return new Set(object)\n  } else if (object && typeof object === 'object') {\n    var prototype = Object.getPrototypeOf(object);\n    return assign(Object.create(prototype), object);\n  } else {\n    return object;\n  }\n}\n\nfunction newContext() {\n  var commands = assign({}, defaultCommands);\n  update.extend = function(directive, fn) {\n    commands[directive] = fn;\n  };\n  update.isEquals = function(a, b) { return a === b; };\n\n  return update;\n\n  function update(object, spec) {\n    if (typeof spec === 'function') {\n      spec = { $apply: spec };\n    }\n\n    if (!(Array.isArray(object) && Array.isArray(spec))) {\n      invariant(\n        !Array.isArray(spec),\n        'update(): You provided an invalid spec to update(). The spec may ' +\n        'not contain an array except as the value of $set, $push, $unshift, ' +\n        '$splice or any custom command allowing an array value.'\n      );\n    }\n\n    invariant(\n      typeof spec === 'object' && spec !== null,\n      'update(): You provided an invalid spec to update(). The spec and ' +\n      'every included key path must be plain objects containing one of the ' +\n      'following commands: %s.',\n      Object.keys(commands).join(', ')\n    );\n\n    var nextObject = object;\n    var index, key;\n    getAllKeys(spec).forEach(function(key) {\n      if (hasOwnProperty.call(commands, key)) {\n        var objectWasNextObject = object === nextObject;\n        nextObject = commands[key](spec[key], nextObject, spec, object);\n        if (objectWasNextObject && update.isEquals(nextObject, object)) {\n          nextObject = object;\n        }\n      } else {\n        var nextValueForKey =\n          type(object) === 'Map'\n            ? update(object.get(key), spec[key])\n            : update(object[key], spec[key]);\n        var nextObjectValue =\n          type(nextObject) === 'Map'\n              ? nextObject.get(key)\n              : nextObject[key];\n        if (!update.isEquals(nextValueForKey, nextObjectValue) || typeof nextValueForKey === 'undefined' && !hasOwnProperty.call(object, key)) {\n          if (nextObject === object) {\n            nextObject = copy(object);\n          }\n          if (type(nextObject) === 'Map') {\n            nextObject.set(key, nextValueForKey);\n          } else {\n            nextObject[key] = nextValueForKey;\n          }\n        }\n      }\n    })\n    return nextObject;\n  }\n\n}\n\nvar defaultCommands = {\n  $push: function(value, nextObject, spec) {\n    invariantPushAndUnshift(nextObject, spec, '$push');\n    return value.length ? nextObject.concat(value) : nextObject;\n  },\n  $unshift: function(value, nextObject, spec) {\n    invariantPushAndUnshift(nextObject, spec, '$unshift');\n    return value.length ? value.concat(nextObject) : nextObject;\n  },\n  $splice: function(value, nextObject, spec, originalObject) {\n    invariantSplices(nextObject, spec);\n    value.forEach(function(args) {\n      invariantSplice(args);\n      if (nextObject === originalObject && args.length) nextObject = copy(originalObject);\n      splice.apply(nextObject, args);\n    });\n    return nextObject;\n  },\n  $set: function(value, nextObject, spec) {\n    invariantSet(spec);\n    return value;\n  },\n  $toggle: function(targets, nextObject) {\n    invariantSpecArray(targets, '$toggle');\n    var nextObjectCopy = targets.length ? copy(nextObject) : nextObject;\n\n    targets.forEach(function(target) {\n      nextObjectCopy[target] = !nextObject[target];\n    });\n\n    return nextObjectCopy;\n  },\n  $unset: function(value, nextObject, spec, originalObject) {\n    invariantSpecArray(value, '$unset');\n    value.forEach(function(key) {\n      if (Object.hasOwnProperty.call(nextObject, key)) {\n        if (nextObject === originalObject) nextObject = copy(originalObject);\n        delete nextObject[key];\n      }\n    });\n    return nextObject;\n  },\n  $add: function(value, nextObject, spec, originalObject) {\n    invariantMapOrSet(nextObject, '$add');\n    invariantSpecArray(value, '$add');\n    if (type(nextObject) === 'Map') {\n      value.forEach(function(pair) {\n        var key = pair[0];\n        var value = pair[1];\n        if (nextObject === originalObject && nextObject.get(key) !== value) nextObject = copy(originalObject);\n        nextObject.set(key, value);\n      });\n    } else {\n      value.forEach(function(value) {\n        if (nextObject === originalObject && !nextObject.has(value)) nextObject = copy(originalObject);\n        nextObject.add(value);\n      });\n    }\n    return nextObject;\n  },\n  $remove: function(value, nextObject, spec, originalObject) {\n    invariantMapOrSet(nextObject, '$remove');\n    invariantSpecArray(value, '$remove');\n    value.forEach(function(key) {\n      if (nextObject === originalObject && nextObject.has(key)) nextObject = copy(originalObject);\n      nextObject.delete(key);\n    });\n    return nextObject;\n  },\n  $merge: function(value, nextObject, spec, originalObject) {\n    invariantMerge(nextObject, value);\n    getAllKeys(value).forEach(function(key) {\n      if (value[key] !== nextObject[key]) {\n        if (nextObject === originalObject) nextObject = copy(originalObject);\n        nextObject[key] = value[key];\n      }\n    });\n    return nextObject;\n  },\n  $apply: function(value, original) {\n    invariantApply(value);\n    return value(original);\n  }\n};\n\nvar contextForExport = newContext();\n\nmodule.exports = contextForExport;\nmodule.exports.default = contextForExport;\nmodule.exports.newContext = newContext;\n\n// invariants\n\nfunction invariantPushAndUnshift(value, spec, command) {\n  invariant(\n    Array.isArray(value),\n    'update(): expected target of %s to be an array; got %s.',\n    command,\n    value\n  );\n  invariantSpecArray(spec[command], command)\n}\n\nfunction invariantSpecArray(spec, command) {\n  invariant(\n    Array.isArray(spec),\n    'update(): expected spec of %s to be an array; got %s. ' +\n    'Did you forget to wrap your parameter in an array?',\n    command,\n    spec\n  );\n}\n\nfunction invariantSplices(value, spec) {\n  invariant(\n    Array.isArray(value),\n    'Expected $splice target to be an array; got %s',\n    value\n  );\n  invariantSplice(spec['$splice']);\n}\n\nfunction invariantSplice(value) {\n  invariant(\n    Array.isArray(value),\n    'update(): expected spec of $splice to be an array of arrays; got %s. ' +\n    'Did you forget to wrap your parameters in an array?',\n    value\n  );\n}\n\nfunction invariantApply(fn) {\n  invariant(\n    typeof fn === 'function',\n    'update(): expected spec of $apply to be a function; got %s.',\n    fn\n  );\n}\n\nfunction invariantSet(spec) {\n  invariant(\n    Object.keys(spec).length === 1,\n    'Cannot have more than one key in an object with $set'\n  );\n}\n\nfunction invariantMerge(target, specValue) {\n  invariant(\n    specValue && typeof specValue === 'object',\n    'update(): $merge expects a spec of type \\'object\\'; got %s',\n    specValue\n  );\n  invariant(\n    target && typeof target === 'object',\n    'update(): $merge expects a target of type \\'object\\'; got %s',\n    target\n  );\n}\n\nfunction invariantMapOrSet(target, command) {\n  var typeOfTarget = type(target);\n  invariant(\n    typeOfTarget === 'Map' || typeOfTarget === 'Set',\n    'update(): %s expects a target of type Set or Map; got %s',\n    command,\n    typeOfTarget\n  );\n}\n\n\n//# sourceURL=webpack:///./node_modules/immutability-helper/index.js?")},"./node_modules/invariant/browser.js":
/*!*******************************************!*\
  !*** ./node_modules/invariant/browser.js ***!
  \*******************************************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval("/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n\n\n/**\n * Use invariant() to assert state which your program assumes to be true.\n *\n * Provide sprintf-style format (only %s is supported) and arguments\n * to provide information about what broke and what you were\n * expecting.\n *\n * The invariant message will be stripped in production, but the invariant\n * will remain to ensure logic does not differ in production.\n */\n\nvar invariant = function(condition, format, a, b, c, d, e, f) {\n  if (true) {\n    if (format === undefined) {\n      throw new Error('invariant requires an error message argument');\n    }\n  }\n\n  if (!condition) {\n    var error;\n    if (format === undefined) {\n      error = new Error(\n        'Minified exception occurred; use the non-minified dev environment ' +\n        'for the full error message and additional helpful warnings.'\n      );\n    } else {\n      var args = [a, b, c, d, e, f];\n      var argIndex = 0;\n      error = new Error(\n        format.replace(/%s/g, function() { return args[argIndex++]; })\n      );\n      error.name = 'Invariant Violation';\n    }\n\n    error.framesToPop = 1; // we don't care about invariant's own frame\n    throw error;\n  }\n};\n\nmodule.exports = invariant;\n\n\n//# sourceURL=webpack:///./node_modules/invariant/browser.js?")},"./src/ui/pack-immutable.js":
/*!**********************************!*\
  !*** ./src/ui/pack-immutable.js ***!
  \**********************************/
/*! no exports provided */function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var immutability_helper__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! immutability-helper */ "./node_modules/immutability-helper/index.js");\n/* harmony import */ var immutability_helper__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(immutability_helper__WEBPACK_IMPORTED_MODULE_0__);\n\r\njb.ui = jb.ui || {}\r\njb.ui.update = immutability_helper__WEBPACK_IMPORTED_MODULE_0___default.a;\r\n\n\n//# sourceURL=webpack:///./src/ui/pack-immutable.js?')}}),function(){const e=Symbol.for("isProxy"),t=Symbol.for("originalVal"),a=Symbol.for("targetVal"),n=Symbol("jbId");class i{constructor(e){this.resources=e,this.objToPath=new Map,this.idCounter=1,this.opCounter=1,this.allowedTypes=[Object.getPrototypeOf({}),Object.getPrototypeOf([])],this.resourceChange=jb.callbag.subject(),this.observables=[],this.primitiveArraysDeltas={},jb.ui.originalResources=jb.resources;const t=e();t[n]=this.idCounter++,this.objToPath.set(t[n],[]),this.propagateResourceChangeToObservables()}doOp(t,a,i){try{const r=a.$merge||a.$push||a.$splice||a.$set;this.isRef(t)||(t=this.asRef(t));const o=this.removeLinksFromPath(this.pathOfRef(t)),s={},l=this.valOfPath(o);if(!o||t.$jb_val)return;if(void 0!==a.$set&&a.$set===l)return;a.$push&&(a.$push=jb.asArray(a.$push)),this.addJbId(o),jb.path(s,o,a);const c=jb.path(a.$splice,[0,2])&&jb.path(a.$splice,[0,0])||a.$push&&r.length,d=null!=c&&o.concat(c),p={op:a,path:o,insertedPath:d,ref:t,srcCtx:i,oldVal:l,opVal:r,timeStamp:(new Date).getTime(),opCounter:this.opCounter++};this.resources(jb.ui.update(this.resources(),s),p);const m=null!=r&&r[e]?r:this.valOfPath(o);return a.$push?(a.$push.forEach((e,t)=>this.addObjToMap(e,[...o,l.length+t])),m[n]=l[n],p.ref=this.refOfPath(p.path)):null===a.$set&&"object"==typeof l?(this.removeObjFromMap(l),this.addObjToMap(m,o),p.ref.$jb_path=()=>o):a.$splice?a.$splice.forEach(e=>{this.fixSplicedPaths(o,e),l.slice(e[0],e[0]+e[1]).forEach(e=>this.removeObjFromMap(e)),jb.asArray(e[2]).forEach(e=>this.addObjToMap(e,o.concat(m.indexOf(e))))}):(this.removeObjFromMap(l),this.addObjToMap(m,o)),a.$splice&&(this.primitiveArraysDeltas[t.$jb_obj[n]]=this.primitiveArraysDeltas[t.$jb_obj[n]]||[],this.primitiveArraysDeltas[t.$jb_obj[n]].push(a.$splice)),p.newVal=m,jb.log("watchable set",{opEvent:p,ref:t,opOnRef:a,srcCtx:i}),this.transactionEventsLog?this.transactionEventsLog.push(p):this.resourceChange.next(p),p}catch(e){jb.logException(e,"doOp",{srcCtx:i,ref:t,opOnRef:a,srcCtx:i})}}resourceReferred(e){const t=this.resources()[e];this.objToPath.has(t)||this.addObjToMap(t,[e])}addJbId(e){for(let t=0;t<e.length;t++){const a=e.slice(0,t+1),i=this.valOfPath(a,!0);i&&"object"==typeof i&&!i[n]&&(i[n]=this.idCounter++,this.addObjToMap(i,a))}}addObjToMap(t,a){!t||t[e]||t[jb.passiveSym]||t.$jb_val||"object"!=typeof t||-1==this.allowedTypes.indexOf(Object.getPrototypeOf(t))||(t[n]?(this.objToPath.set(t[n],a),this.objToPath.delete(t)):this.objToPath.set(t,a),Object.keys(t).filter(e=>"object"==typeof t[e]&&0!=e.indexOf("$jb_")).forEach(e=>this.addObjToMap(t[e],[...a,e])))}removeObjFromMap(e,t){e&&"object"==typeof e&&-1!=this.allowedTypes.indexOf(Object.getPrototypeOf(e))&&(this.objToPath.delete(e),e[n]&&t&&this.objToPath.delete(e[n]),Object.keys(e).filter(t=>t=>"object"==typeof e[t]&&0!=t.indexOf("$jb_")).forEach(t=>this.removeObjFromMap(e[t],!0)))}fixSplicedPaths(e,t){const a=e.length;Array.from(this.objToPath.keys()).filter(t=>(function(t){if(t.length<=a)return;for(let n=0;n<a;n++)if(t[n]!=e[n])return;return!0})(this.objToPath.get(t))).forEach(e=>{const n=this.objToPath.get(e);n[a]=function(e){return e+(e<t[0]?0:jb.asArray(t[2]).length-t[1])}(+n[a]),n[a]>=0&&this.objToPath.set(e,n)})}pathOfRef(e){if(e.$jb_path)return e.$jb_path();const t=this.isRef(e)&&(this.objToPath.get(e.$jb_obj)||this.objToPath.get(e.$jb_obj[n]));return t&&void 0!==e.$jb_childProp?(this.refreshPrimitiveArrayRef(e),[...t,e.$jb_childProp]):t}urlOfRef(e){const t=this.pathOfRef(e);this.addJbId(t);const a=[e.$jb_obj[n],e.$jb_childProp].filter(e=>null!=e).map(e=>(""+e).replace(/~|;|,/g,"")).join("~"),i=t.map(e=>(""+e).replace(/~|;|,/g,"")).join("~");return`${this.resources.id}://${a};${i}`}refOfUrl(e){const t=e.split(";")[0].split("~");return{handler:this,$jb_obj:{[n]:+t[0]},...t[1]?{$jb_childProp:t[1]}:{}}}asRef(t,i){if(this.isRef(t))return t;if(!t||"object"!=typeof t)return t;const r=t[e]?t[a]:t,o=this.objToPath.get(r)||this.objToPath.get(r[n]);return o?{$jb_obj:this.valOfPath(o),handler:this,path:function(){return this.handler.pathOfRef(this)}}:(i||jb.logError("asRef can not make a watchable ref of obj",{obj:t}),null)}valOfPath(e){return e.reduce((e,t)=>this.noProxy(e&&e[t]),this.resources())}noProxy(a){return a&&a[e]&&a[t]||a}hasLinksInPath(t){let a=this.resources();for(let n=0;n<t.length;n++){if(a&&a[e])return!0;a=a&&a[t[n]]}}removeLinksFromPath(a){if(Array.isArray(a))return this.hasLinksInPath(a)?a.reduce(({val:a,path:i},r)=>{const o=a&&a[e],s=o?a[t]:a,l=o?this.objToPath.get(s)||this.objToPath.get(s[n]):i;return{val:s&&s[r],path:[l,r].join("~")}},{val:this.resources(),path:""}).path:a}refOfPath(e){const t=this.valOfPath(e);if(!t||"object"!=typeof t&&e.length>0){const t=this.asRef(this.valOfPath(e.slice(0,-1)),!0);return 1==e.length?{$jb_obj:this.resources(),$jb_childProp:e[0],handler:this,$jb_path:()=>e}:this.objectProperty(t,e.slice(-1)[0])}return this.asRef(t)}asStr(e){return this.pathOfRef(e).join("~")}isValid(e){return this.isRef(e)&&this.pathOfRef(e)}val(e){if(null==e)return e;if(e.$jb_val)return e.$jb_val();if(!e.$jb_obj)return e;if(e.handler!=this)return e.handler.val,e.handler.val(e);this.refreshPrimitiveArrayRef(e);const t=this.pathOfRef(e);return t||this.pathOfRef(e),this.valOfPath(t)}watchable(e){return this.resources()===e||"number"!=typeof e&&(this.objToPath.get(e)||e&&this.objToPath.get(e[n]))}isRef(e){return e&&e.$jb_obj&&this.watchable(e.$jb_obj)}objectProperty(t,a,i){if(!t)return jb.logError("watchable objectProperty: null obj",{obj:t,prop:a,ctx:i});if(t&&t[a]&&this.watchable(t[a])&&!t[a][e])return this.asRef(t[a]);const r=this.asRef(t);if(r&&r.$jb_obj){const e={$jb_obj:r.$jb_obj,$jb_childProp:a,handler:this,path:function(){return this.handler.pathOfRef(this)}};return this.isPrimitiveArray(r.$jb_obj)&&(e.$jb_delta_version=(this.primitiveArraysDeltas[r.$jb_obj[n]]||[]).length,e.$jb_childProp=+a),e}return t[a]}writeValue(e,t,a){return e&&this.isRef(e)&&this.pathOfRef(e)?(jb.log("watchable writeValue",{ref:e,value:t,ref:e,srcCtx:a}),e.$jb_val?e.$jb_val(t):this.val(e)!==t?this.doOp(e,{$set:this.createSecondaryLink(t)},a):void 0):jb.logError("writeValue: err in ref",{srcCtx:a,ref:e,value:t})}createSecondaryLink(n){if(n&&"object"==typeof n&&!n[e]){const i=this.asRef(n,!0);if(i&&i.$jb_obj)return new Proxy(n,{get:(i,r)=>r===a?i:r===e||(r===t?n:jb.val(this.asRef(n))[r]),set:(e,t,a)=>e[t]=a})}return n}splice(e,t,a){return this.doOp(e,{$splice:t},a)}move(e,t,a){const n=this.pathOfRef(e),i=this.pathOfRef(t),r=n.slice(0,-1).join("~")==i.slice(0,-1).join("~"),o=Number(n.slice(-1));let s=Number(i.slice(-1));const l=this.refOfPath(n.slice(0,-1)),c=this.refOfPath(i.slice(0,-1));if(isNaN(o)||isNaN(s))return jb.logError("move: not array element",{srcCtx:a,fromRef:e,toRef:t});var d=jb.val(e);if(r){const e=[[o,1],[s,0,d]];return e.fromIndex=o,e.toIndex=s,this.doOp(l,{$splice:e},a)}this.startTransaction();const p=[[o,1]];p.fromIndex=o,p.toIndex=s,p.toArray=c,this.doOp(l,{$splice:p},a),this.doOp(c,{$splice:[[s,0,d]]},a),this.endTransaction()}isPrimitiveArray(e){return Array.isArray(e)&&e.some(e=>null!=e&&"object"!=typeof e)}refreshPrimitiveArrayRef(e){if(!this.isPrimitiveArray(e.$jb_obj))return;const t=e.$jb_obj[n],a=this.primitiveArraysDeltas[t]||[];a.slice(e.$jb_delta_version).forEach(t=>{if(null!=t.fromIndex&&t.fromIndex===e.$jb_childProp)return e.$jb_childProp=t.toIndex,void(t.toArray&&(e.$jb_obj=t.toArray.$jb_obj));t.forEach(([t,a,n])=>{-1!=e.$jb_childProp&&(e.$jb_childProp>=t&&e.$jb_childProp<t+a?e.$jb_childProp=-1:e.$jb_childProp>=t&&(e.$jb_childProp=e.$jb_childProp-a+(null!=n)?1:0))})}),e.$jb_delta_version=a.length}startTransaction(){this.transactionEventsLog=[]}endTransaction(e){e||(this.transactionEventsLog||[]).forEach(e=>this.resourceChange.next(e)),delete this.transactionEventsLog}push(e,t,a){return this.doOp(e,{$push:this.createSecondaryLink(t)},a)}merge(e,t,a){return this.doOp(e,{$merge:this.createSecondaryLink(t)},a)}getOrCreateObservable(e){const t=jb.callbag.subject();e.srcCtx=e.srcCtx||{path:""};const a=e.cmpOrElem&&e.cmpOrElem.ctx||jb.ui.ctxOfElem(e.cmpOrElem)||e.srcCtx,n=this.pathOfRef(e.ref).join("~")+" : "+a.path,i=e.cmpOrElem&&e.cmpOrElem.getAttribute&&+(e.cmpOrElem.getAttribute("recycleCounter")||0),r={...e,subject:t,key:n,recycleCounter:i,ctx:a};this.observables.push(r),this.observables.sort((e,t)=>jb.ui.comparePaths(e.ctx.path,t.ctx.path));const o=e.cmpOrElem&&(e.cmpOrElem.ver?e.cmpOrElem:e.cmpOrElem._component);return jb.log("register uiComp observable",{cmp:o,key:n,obs:r}),t}frame(){return this.resources.frame||jb.frame}propagateResourceChangeToObservables(){jb.subscribe(this.resourceChange,e=>{const t=this.observables.slice(0),a=this.removeLinksFromPath(this.pathOfRef(e.ref));a&&t.forEach(t=>{const n=jb.path(t.cmpOrElem,"getAttribute")&&+t.cmpOrElem.getAttribute("recycleCounter")>t.recycleCounter;jb.path(t.cmpOrElem,"_destroyed")||n?-1!=this.observables.indexOf(t)&&(jb.log("remove cmpObservable",{obs:t}),this.observables.splice(this.observables.indexOf(t),1)):this.notifyOneObserver(e,t,a)})})}notifyOneObserver(e,t,a){let n=jb.refHandler(t.ref).pathOfRef(t.ref);if(!(n=n&&this.removeLinksFromPath(n)))return jb.logError("observer ref path is empty",{obs:t,e:e});const i=jb.ui.comparePaths(a,n),r=1==i,o=r&&("yes"===t.includeChildren||!0===t.includeChildren),s=r&&"structure"===t.includeChildren&&("object"==typeof e.oldVal||"object"==typeof e.newVal);(-1==i||0==i||o||s)&&(jb.log("notify cmpObservable",{srcCtx:e.srcCtx,obs:t,e:e}),t.subject.next(e))}dispose(){this.resourceChange.complete()}}function r(e){if(void 0===e)return jb.resources;jb.resources=e}jb.ui.comparePaths=function(e,t){e=e||"",t=t||"";let a=0;for(;e[a]===t[a]&&a<e.length;)a++;return a==e.length&&a==t.length?0:a==e.length&&a<t.length?-1:a==t.length&&a<e.length?1:e[a]<t[a]?-2:2},r.id="resources",jb.setMainWatchableHandler(new i(r)),jb.rebuildRefHandler=()=>{jb.mainWatchableHandler&&jb.mainWatchableHandler.dispose(),jb.setMainWatchableHandler(new i(r))},jb.isWatchable=e=>jb.refHandler(e)instanceof i||e&&e.$jb_observable,jb.ui.refObservable=(e,t,a={})=>e&&e.$jb_observable?e.$jb_observable(t):jb.isWatchable(e)?jb.refHandler(e).getOrCreateObservable({ref:e,cmpOrElem:t,...a}):(jb.logError("ref is not watchable: ",{ref:e,cmpOrElem:t}),jb.callbag.fromIter([])),jb.ui.extraWatchableHandler=(e,t)=>{const a=jb.extraWatchableHandler(new i(e),t);return jb.ui.subscribeToRefChange(a),a},jb.ui.resourceChange=()=>jb.mainWatchableHandler.resourceChange,jb.component("runTransaction",{type:"action",params:[{id:"actions",type:"action[]",ignore:!0,composite:!0,mandatory:!0},{id:"noNotifications",as:"boolean",type:"boolean"}],impl:e=>{const t=jb.asArray(e.profile.actions||e.profile.$runActions||[]).filter(e=>e),a=e.profile.actions&&e.profile.actions.sugar?"":e.profile.$runActions?"$runActions~":"items~";return jb.mainWatchableHandler.startTransaction(),t.reduce((t,n,i)=>t.then(t=>e.runInner(n,{as:"single"},a+i)),Promise.resolve()).catch(t=>jb.logException(t,"runTransaction",{ctx:e})).then(()=>jb.mainWatchableHandler.endTransaction(e.params.noNotifications))}})}(),function(){class e{constructor(e,t,a){const n=jb.objFromEntries(jb.entries(t).map(e=>[e[0].toLowerCase(),e[1]]).map(([e,t])=>[e.match(/^on[^-]/)?`${e.slice(0,2)}-${e.slice(2)}`:e,"object"==typeof t?t:""+t]));let i=""===a?null:a;-1!==["string","boolean","number"].indexOf(typeof i)&&(n.$text=""+i,i=null),i&&"function"==typeof i.then&&(n.$text="...",i=null),null==i||Array.isArray(i)||(i=[i]),null!=i&&(i=i.filter(e=>e).map(e=>"string"==typeof e?jb.ui.h("span",{$text:e}):e)),i&&0==i.length&&(i=null),this.attributes=n,"string"==typeof e&&e.indexOf("#"),"string"==typeof e&&-1!=e.indexOf(".")&&(this.addClass(e.split(".").pop().trim()),e=e.split(".")[0]),null!=i&&i.forEach(e=>e.parentNode=this),Object.assign(this,{["string"==typeof e?"tag":"cmp"]:e,...i&&{children:i}})}getAttribute(e){const t=(this.attributes||{})[e];return null==t?t:""+t}setAttribute(e,t){if(null!=t)return this.attributes=this.attributes||{},this.attributes[e.toLowerCase()]=""+t,this}removeAttribute(e){this.attributes&&delete this.attributes[e.toLowerCase()]}addClass(e){return-1!=e.indexOf(" ")?(e.split(" ").filter(e=>e).forEach(e=>this.addClass(e)),this):(this.attributes=this.attributes||{},void 0===this.attributes.class&&(this.attributes.class=""),e&&-1==this.attributes.class.split(" ").indexOf(e)&&(this.attributes.class=[this.attributes.class,e].filter(e=>e).join(" ")),this)}hasClass(e){return-1!=(jb.path(this,"attributes.class")||"").split(" ").indexOf(e)}querySelector(...e){return this.querySelectorAll(...e)[0]}querySelectorAll(e,{includeSelf:t}={}){let a=50;if(e.match(/^:scope>/)&&(a=1,e=e.slice(7)),""==e||":scope"==e)return[this];if(-1!=e.indexOf(","))return e.split(",").map(e=>e.trim()).reduce((e,a)=>[...e,...this.querySelectorAll(a,{includeSelf:t})],[]);const n=e.match(/^\[([a-zA-Z0-9_$\-]+)\]$/),i=e.match(/^\[([a-zA-Z0-9_$\-]+)="([a-zA-Z0-9_\-→]+)"\]$/),r=e.match(/^\.([a-zA-Z0-9_$\-]+)$/),o=e.match(/^[a-zA-Z0-9_\-]+$/),s=e.match(/^#([a-zA-Z0-9_$\-]+)$/),l=n?e=>e.attributes&&e.attributes[n[1]]:r?e=>e.hasClass(r[1]):o?e=>e.tag===o[0]:i?e=>e.attributes&&e.attributes[i[1]]==i[2]:s?e=>e.attributes&&e.attributes.id==s[1]:null;return l&&function e(t,n,i,r){return r>=a?[]:[...!i&&n(t)?[t]:[],...(t.children||[]).flatMap(t=>e(t,n,!1,r+1))]}(this,l,!t,0)}}function t(e){return"VNode"!=jb.path(e,"constructor.name")?(jb.logError("stripVdom - not vnode",{vdom:e}),jb.ui.h("span")):{...e.attributes&&{attributes:e.attributes},...e.children&&e.children.length&&{children:e.children.map(e=>t(e))},tag:e.tag}}function a(t,a){return function t(a,n){if(a)return a.parentNode=n,Object.setPrototypeOf(a,e.prototype),(a.children||[]).forEach(e=>t(e,a)),a}(JSON.parse(JSON.stringify(t)),a)}Object.assign(jb.ui,{VNode:e,cloneVNode:function(e){return a(JSON.parse(JSON.stringify(t(e))))},toVdomOrStr:function(t){if(jb.isDelayed(t))return jb.toSynchArray(t).then(e=>jb.ui.toVdomOrStr(e[0]));const a=Array.isArray(t)?t.map(e=>jb.val(e)):t;let n=jb.val(Array.isArray(a)&&1==a.length?a[0]:a);return n&&n instanceof e||Array.isArray(n)?n:("boolean"==typeof n||"object"==typeof n?n=""+n:"string"==typeof n&&(n=n.slice(0,1e3)),n)},stripVdom:t,unStripVdom:a,vdomDiff:function(e,t){const a=/\$|checked|style|value|parentNode|frontend|__|widget|on-|remoteuri|width|height|top|left|aria-|tabindex/,n=/__undefined/,i=/selected|mdc-tab-[0-9]+/;return function e(t,r,o){Array.isArray(r)&&0==r.length&&(r=null);Array.isArray(t)&&0==t.length&&(t=null);if(r===t)return{};if("string"==typeof r&&n.test(r)||"string"==typeof t&&n.test(t))return{};if("class"==o&&("string"==typeof r&&i.test(r)||"string"==typeof t&&i.test(t)))return{};if(!jb.isObject(r)||!jb.isObject(t))return t;const s=Object.keys(r).filter(e=>!a.test(e)).filter(e=>!("string"==typeof r[e]&&n.test(r[e]))).filter(e=>!(Array.isArray(r[e])&&0==r[e].length)).reduce((e,a)=>t.hasOwnProperty(a)?e:{...e,[a]:"__undefined"},{});return Object.keys(t).filter(e=>!a.test(e)).filter(e=>!("string"==typeof t[e]&&n.test(t[e]))).filter(e=>!(Array.isArray(t[e])&&0==t[e].length)).reduce((a,n)=>{if(!r.hasOwnProperty(n))return{...a,[n]:t[n]};const i=e(t[n],r[n],n);return jb.isObject(i)&&jb.isEmpty(i)?a:{...a,[n]:i}},s)}(e,t)}})}(),function(){jb.ui=jb.ui||{};const e=jb.ui,t=(e,t)=>{try{return e()}catch(a){jb.logException(a,t,{f:e,ctx:this&&this.ctx})}};function a(t,a,n){return t instanceof e.VNode?t:t&&t.renderVdom?t.renderVdomAndFollowUp():new jb.ui.VNode(t,a,n)}function n(t,a,r){const o=a instanceof e.VNode?e.stripVdom(a):a;jb.log("vdom diff compare",{before:t,after:o,ctx:r});const s=jb.objectDiff(o.attributes||{},t.attributes||{}),l=function(e,t){if(0==e.length&&0==t.length)return;if(1==t.length&&1==e.length&&t[0].tag==e[0].tag)return{0:{...n(e[0],t[0],r),__afterIndex:0},length:1};jb.log("vdom child diff start",{before:e,after:t,ctx:r});const a=e.map((e,t)=>({i:t,...e}));let o=a.slice(0);const s=t.map(e=>(function(e,t){const a=t.findIndex(t=>i(t,e));if(-1!=a)return t.splice(a,1)[0]})(e,o));t.forEach((e,t)=>s[t]=s[t]||function(e,t,a){const n=a.findIndex(a=>a.tag&&a.i==t&&a.tag===e.tag);if(-1!=n){const t=a.splice(n,1)[0];return t.attributes.ctxId&&!i(t,e)&&(t.$remount=!0),t}}(e,t,o));const l=[],c={length:0,sameOrder:!0};return a.forEach((e,a)=>{const i=s.indexOf(e);if(i!=a&&(c.sameOrder=!1),-1==i)c.length=a+1,c[a]={$:"delete"};else{l[i]=!0;const o={__afterIndex:i,...n(e,t[i],r),...e.$remount?{remount:!0}:{}};Object.keys(o).length>1&&(c[a]=o,c.length=a+1)}}),c.toAppend=t.flatMap((e,t)=>l[t]?[]:[Object.assign(e,{__afterIndex:t})]),jb.log("vdom child diff result",{res:c,before:e,after:t,ctx:r}),c.length||c.toAppend.length?c:null}(t.children||[],o.children||[]);return{...Object.keys(s).length?{attributes:s}:{},...l?{children:l}:{},...o.tag!=t.tag?{tag:o.tag}:{}}}function i(e,t){if(e.cmp&&e.cmp===t.cmp)return!0;const a=e.attributes||{},n=t.attributes||{};return!!(a["cmp-id"]&&a["cmp-id"]===n["cmp-id"]||a["jb-ctx"]&&a["jb-ctx"]===n["jb-ctx"])||(!(!r("path",a,n)||!r("data",a,n))||(!!function(e,t,a){for(let n=0;n<e.length;n++)if(t[e[n]]&&t[e[n]]==a[e[n]])return!0}(["id","path","name"],a,n)||void 0))}function r(e,t,a){const n=t.ctxId&&jb.path(jb.ui.ctxDictionary[t.ctxId],e),i=a.ctxId&&jb.path(jb.ui.ctxDictionary[a.ctxId],e);return n&&i&&n==i}function o(t,a,{strongRefresh:i,ctx:r}={}){const o=jb.ui.headlessWidgetId(t);if(jb.log("applyNew vdom",{widgetId:o,elem:t,vdomAfter:a,strongRefresh:i,ctx:r}),o){const e=t.getAttribute("cmp-id"),i=n(t,a,r),s=JSON.parse(JSON.stringify(jb.ui.stripVdom(t)));return t!=a&&((t.children||[]).forEach(e=>e.parentNode=null),Object.keys(t).filter(e=>"parentNode"!=e).forEach(e=>delete t[e]),Object.assign(t,a),(a.children||[]).forEach(e=>e.parentNode=t)),void jb.ui.renderingUpdates.next({assumedVdom:s,delta:i,cmpId:e,widgetId:o})}const c=jb.ui.activeElement()===t;if(a.tag!=t.tagName.toLowerCase()||i){d(t);const e=p(a,t.parentElement);t.parentElement.replaceChild(e,t),jb.log("replaceTop vdom",{newElem:e,elem:t}),t=e}else{const o=t instanceof e.VNode?t:s(t),d=n(o,a,r);jb.log("apply delta top dom",{vdomBefore:o,vdomAfter:a,active:c,elem:t,vdomAfter:a,strongRefresh:i,delta:d,ctx:r}),l(t,d)}e.refreshFrontEnd(t),c&&jb.ui.focus(t,"apply Vdom diff",r),e.garbageCollectCtxDictionary()}function s(e){return e instanceof jb.ui.VNode?e:e.getAttribute("jb_external")?void 0:{tag:e.tagName.toLowerCase(),attributes:jb.objFromEntries([...Array.from(e.attributes).map(e=>[e.name,e.value]),..."#text"==jb.path(e,"firstChild.nodeName")?[["$text",e.firstChild.nodeValue]]:[]]),...e.childElementCount&&{children:Array.from(e.children).map(e=>s(e)).filter(e=>e)}}}function l(e,t){jb.log("applyDelta dom",{elem:e,delta:t});const a=t.children;if(a){const i=a.length?Array.from(Array(a.length).keys()).map(e=>a[e]):[],r=Array.from(e.children),{toAppend:o,deleteCmp:s,sameOrder:c,resetAll:m}=a;m&&Array.from(e.children).forEach(e=>n(e)),s&&Array.from(e.children).filter(e=>e.getAttribute("cmp-id")==s).forEach(e=>n(e)),i.forEach((a,n)=>{a?"delete"==a.$?(d(r[n]),e.removeChild(r[n]),jb.log("removeChild dom",{childElem:r[n],e:a,elem:e,delta:t})):(l(r[n],a),!c&&r[n].setAttribute("__afterIndex",a.__afterIndex)):!c&&r[n].setAttribute("__afterIndex",""+n)}),(o||[]).forEach(a=>{const n=p(a,e);jb.log("appendChild dom",{newElem:n,e:a,elem:e,delta:t}),!c&&n.setAttribute("__afterIndex",a.__afterIndex)}),!1===c&&Array.from(e.children).sort((e,t)=>Number(e.getAttribute("__afterIndex"))-Number(t.getAttribute("__afterIndex"))).forEach(t=>{const a=Number(t.getAttribute("__afterIndex"));e.children[a]!=t&&e.insertBefore(t,e.children[a]),t.removeAttribute("__afterIndex")}),e.childElementCount&&Array.from(e.childNodes).filter(e=>"#text"==e.nodeName).forEach(a=>{e.removeChild(a),jb.log("removeChild dom leftover",{ch:a,elem:e,delta:t})})}function n(a){d(a),e.removeChild(a),jb.log("removeChild dom",{toDelete:a,elem:e,delta:t})}jb.entries(t.attributes).filter(t=>!("$text"===t[0]&&e.firstElementChild)).forEach(t=>c(e,t[0],t[1]))}function c(e,t,a){if("__undefined"==a&&(a=null),"$"!==t[0]&&null==a)e.removeAttribute(t),jb.log("dom change remove",{elem:e,att:t,val:a});else if(0!=t.indexOf("on-")||null==a||e[`registeredTo-${t}`])if(0==t.indexOf("on-")&&null==a)e.removeEventListener(t.slice(3),e=>jb.ui.handleCmpEvent(e,a)),e[`registeredTo-${t}`]=!1;else if("checked"===t&&"input"===e.tagName.toLowerCase())e.setAttribute(t,a),jb.delay(1).then(()=>{e.checked=!0,jb.log("dom set checked",{elem:e,att:t,val:a})});else if(0===t.indexOf("$__input"))try{!function({assumedVal:t,newVal:a,selectionStart:n}){const i=jb.ui.findIncludeSelf(e,"input,textarea")[0];if(jb.log("dom set input check",{el:i,assumedVal:t,newVal:a,selectionStart:n}),!i)return jb.logError("setInput: can not find input under elem",{elem:e});if(t!=i.value)return jb.logError("setInput: assumed val is not as expected",{assumedVal:t,value:i.value,el:i});const r=document.activeElement===i;jb.log("dom set input",{el:i,assumedVal:t,newVal:a,selectionStart:n}),i.value=a,"number"==typeof n&&(i.selectionStart=n);r&&document.activeElement!==i&&i.focus()}(JSON.parse(a))}catch(e){}else if(0===t.indexOf("$__")){const n=t.slice(3);try{e[n]=JSON.parse(a)||""}catch(e){}jb.log(`dom set data ${n}`,{elem:e,att:t,val:a})}else if("$focus"===t&&a)e.setAttribute("__focus",a),jb.ui.focus(e,a);else if("$scrollDown"===t&&a)e.__appScroll=!0,e.scrollTop=e.scrollTop=e.scrollHeight-e.clientHeight-1;else if("$scrollDown"===t&&null==a)delete e.__appScroll;else if("$text"===t)e.innerText=a||"",jb.log("dom set text",{elem:e,att:t,val:a});else if("$html"===t)e.innerHTML=a||"",jb.log("dom set html",{elem:e,att:t,val:a});else if("style"===t&&"object"==typeof a)e.setAttribute(t,jb.entries(a).map(e=>`${e[0]}:${e[1]}`).join(";")),jb.log("dom set style",{elem:e,att:t,val:a});else if("value"==t&&e.tagName.match(/select|input|textarea/i)){const n=document.activeElement===e;if(e.value==a)return;e.value=a,n&&document.activeElement!==e&&e.focus(),jb.log("dom set elem value",{elem:e,att:t,val:a})}else e.setAttribute(t,a);else e.addEventListener(t.slice(3),e=>jb.ui.handleCmpEvent(e,a)),e[`registeredTo-${t}`]=!0}function d(e){if(!e||!e.setAttribute)return;const t={};jb.ui.findIncludeSelf(e,"[cmp-id]").forEach(a=>{if(a._component&&a._component.destroyFE(),jb.ui.frontendWidgetId(e))return;const n=jb.ui.headlessWidgetId(a)||"_local_";t[n]=t[n]||{cmps:[]};const i=(a.getAttribute("methods")||"").split(",").filter(e=>0==e.indexOf("destroy-")).map(e=>e.split("destroy-").pop()),r=a.getAttribute("cmp-id"),o=a.getAttribute("cmp-ver");t[n].cmps.push({cmpId:r,ver:o,el:a,destroyCtxs:i})}),jb.log("unmount",{elem:e,groupByWidgets:t}),jb.entries(t).forEach(([t,a])=>jb.ui.BECmpsDestroyNotification.next({widgetId:t,cmps:a.cmps,destroyLocally:"_local_"==t,destroyWidget:jb.ui.findIncludeSelf(e,`[widgetid="${t}"]`).length}))}function p(t,a,n){jb.log("render",{vdom:t,parentElem:a,prepend:n});const i=function e(t,a){jb.log("dom createElement",{tag:t.tag,vdom:t,parentElem:a});const i=(r=a.ownerDocument,o=t.tag,-1!=["svg","circle","ellipse","image","line","mesh","path","polygon","polyline","rect","text"].indexOf(o=o||"div")?r.createElementNS("http://www.w3.org/2000/svg",o):r.createElement(o));var r,o;return jb.entries(t.attributes).forEach(e=>c(i,e[0],e[1])),jb.asArray(t.children).map(t=>e(t,i)).forEach(e=>i.appendChild(e)),n?a.prepend(i):a.appendChild(i),i}(t,a);e.findIncludeSelf(i,"[interactive]").forEach(e=>u(e));const r=s(i),o=jb.ui.vdomDiff(r,t);return r&&Object.keys(o).length&&jb.logError("render diff",{diff:o,checkResultingVdom:r,vdom:t}),i}Object.assign(jb.ui,{handleCmpEvent(e,t){t="true"==t||t;const a=jb.ui.rawEventToUserRequest(e,t);if(jb.log("handle cmp event",{ev:e,specificMethod:t,userReq:a}),a)if(a.widgetId)jb.ui.widgetUserRequests.next(a);else{const n=jb.ctxDictionary[a.ctxIdToRun];n||jb.logError(`handleCmpEvent - no ctx in dictionary for id ${a.ctxIdToRun}`,{ev:e,specificMethod:t}),n&&jb.ui.runCtxAction(n,a.data,a.vars)}},rawEventToUserRequest(e,t){const a=jb.ui.closestCmpElem(e.currentTarget);if(!a)return jb.logError("rawEventToUserRequest can not find closest elem with jb-ctx",{ev:e});const n=t&&"string"==typeof t?t:`on${e.type}Handler`,i=jb.ui.ctxIdOfMethod(a,n),r=jb.ui.frontendWidgetId(a)||e.tstWidgetId;return i&&{$:"runCtxAction",method:n,widgetId:r,ctxIdToRun:i,vars:{ev:jb.ui.buildUserEvent(e,a)}}},calcElemProps:e=>e instanceof jb.ui.VNode?{}:{outerHeight:jb.ui.outerHeight(e),outerWidth:jb.ui.outerWidth(e),clientRect:e.getBoundingClientRect()},buildUserEvent(e,t){if(!e)return null;const a={value:(e.target||{}).value,elem:jb.ui.calcElemProps(t),ev:{}},n=(t.getAttribute("usereventprops")||"").split(",").filter(e=>e).filter(e=>"elem"!=e.split(".")[0]),i=(t.getAttribute("usereventprops")||"").split(",").filter(e=>e).filter(e=>"elem"==e.split(".")[0]).map(e=>e.split(".")[1]);return["type","keyCode","ctrlKey","altKey","clientX","clientY",...n].forEach(t=>null!=e[t]&&(a.ev[t]=e[t])),["id","class",...i].forEach(e=>a.elem[e]=t.getAttribute(e)),jb.path(t,"_component.enrichUserEvent")&&t._component.enrichUserEvent(e,a),e.fixedTarget&&(a.elem=jb.ui.calcElemProps(e.fixedTarget)),a},ctxIdOfMethod:(e,t)=>t.match(/^[0-9]+$/)?t:(e.getAttribute("methods")||"").split(",").filter(e=>0==e.indexOf(t+"-")).map(e=>e.split("-")[1]).filter(e=>e)[0],runCtxActionAndUdateCmpState(e,t,a){jb.path(a,"$updateCmpState.cmpId")==jb.path(e.vars,"cmp.cmpId")&&jb.path(a,"$updateCmpState.state")&&Object.assign(e.vars.cmp.state,a.$updateCmpState.state),e.setData(t).setVars(a).runInner(e.profile.action,"action","action")},runCtxAction(e,t,a){e.setData(t).setVars(a).runInner(e.profile.action,"action","action")},runBEMethodInAnyContext(e,t,a,n){const i=e.vars.cmp;i instanceof jb.ui.JbComponent?i.runBEMethod(t,a,n?{...e.vars,...n}:e.vars):jb.ui.runBEMethod(i.base,t,a,{$updateCmpState:{state:i.state,cmpId:i.cmpId},$state:i.state,ev:e.vars.ev,...n})},runBEMethod(e,t,a,n){if(!e)return jb.logError(`runBEMethod, no elem provided: ${t}`,{elem:e,data:a,vars:n});const i=jb.ui.frontendWidgetId(e),r=jb.ui.ctxIdOfMethod(e,t);if(!r)return jb.logError(`no method in cmp: ${t}`,{elem:e,data:a,vars:n});if(i)jb.ui.widgetUserRequests.next({$:"runCtxAction",method:t,widgetId:i,ctxIdToRun:r,data:a,vars:n});else{const i=jb.ctxDictionary[r];if(!i)return jb.logError(`no ctx found for method: ${t}`,{ctxIdToRun:r,elem:e,data:a,vars:n});jb.log(`backend method request: ${t}`,{cmp:i.vars.cmp,method:t,ctx:i,elem:e,data:a,vars:n}),jb.ui.runCtxActionAndUdateCmpState(i,a,n)}}}),Object.assign(jb.ui,{h:a,render:p,unmount:d,applyNewVdom:o,applyDeltaToDom:l,applyDeltaToVDom:function e(t,a){if(t){if(jb.log("applyDelta vdom",{elem:t,delta:a}),a.children){const n=a.children.toAppend||[],{resetAll:i,deleteCmp:r}=a.children;if(i&&(t.children&&t.children.forEach(e=>e.parentNode=null),t.children=[]),r){const e=t.children.findIndex(e=>e.getAttribute("cmp-id")==r);-1!=e&&(t.children[e]&&(t.children[e].parentNode=null),t.children.splice(e,1))}n.forEach(e=>{t.children=t.children||[],t.children.push(jb.ui.unStripVdom(e,t))}),Object.keys(a.children).filter(e=>!isNaN(e)).forEach(n=>e(t.children[+n],a.children[n]))}Object.assign(t.attributes,a.attributes)}},elemToVdom:s,mountFrontEnd:u,compareVdom:n,refreshFrontEnd:function(t){e.findIncludeSelf(t,"[interactive]").forEach(e=>e._component?e._component.newVDomApplied():u(e))},BECmpsDestroyNotification:jb.callbag.subject(),refreshNotification:jb.callbag.subject(),renderingUpdates:jb.callbag.subject(),followUps:{},ctrl(t,a){const n="styleByControl"==jb.path(t,"cmpCtx.profile.$"),i=t.vars.$refreshElemCall||n?t.vars.$state:{},r=t.vars.$cmpId,o=t.vars.$cmpVer;t.vars.$serviceRegistry||jb.logError("no serviceRegistry",{ctx:t});const s=t.setVars({$model:{ctx:t,...t.params},$state:i,$serviceRegistry:t.vars.$serviceRegistry,$refreshElemCall:void 0,$props:void 0,cmp:void 0,$cmpId:void 0,$cmpVer:void 0}),l=function(e){const a=t.profile,n="$theme."+(a.$||"");return!a.style&&t.vars[n]?e.run({$:t.vars[n]}):t.params.style?t.params.style(e):{}}(s)||{};return l instanceof e.JbComponent?l.orig(s).jbExtend(a,s).applyParamFeatures(s):new e.JbComponent(s,r,o).jbExtend(a,s).jbExtend(l,s).applyParamFeatures(s)},garbageCollectCtxDictionary(t,a){if(!t)return jb.delay(1e3).then(()=>e.garbageCollectCtxDictionary(!0));const n="jb-ctx,full-cmp-ctx,pick-ctx,props-ctx,methods,frontEnd,originators".split(",").flatMap(e=>u(`[${e}]`).flatMap(t=>t.getAttribute(e).split(",").map(e=>Number(e.split("-").pop())).filter(e=>e))).sort((e,t)=>e-t),i=Object.keys(jb.ctxDictionary).map(e=>Number(e)).sort((e,t)=>e-t);let r=0;const o=[],s=[],l=n.slice(-1)[0]||(a?Number.MAX_SAFE_INTEGER:0);for(let e=0;e<i.length&&i[e]<l;e++){for(;n[r]<i[e];)r++;n[r]!=i[e]&&(o.push(i[e]),delete jb.ctxDictionary[""+i[e]])}const c=jb.unique(n.map(e=>jb.ctxDictionary[""+e]).filter(e=>e).map(e=>(e=>Object.values(e.vars).filter(e=>jb.isWatchable(e)).map(e=>jb.asRef(e)).map(e=>jb.refHandler(e).pathOfRef(e)).flat())(e)).flat());Object.keys(jb.resources).filter(e=>-1!=e.indexOf(":")).filter(e=>-1==c.indexOf(e)).filter(e=>+e.split(":").pop<l).forEach(e=>{s.push(e),delete jb.resources[e]});const d=jb.objFromEntries(Array.from(u("[widgetid]")).filter(e=>e.getAttribute("frontend")).map(e=>[e.getAttribute("widgetid"),1])),p=Object.keys(jb.ui.frontendWidgets).filter(e=>!d[e]);p.forEach(e=>{jb.ui.widgetUserRequests.next({$:"destroy",widgetId:e,destroyWidget:!0,cmps:[]}),delete jb.ui.frontendWidgets[e]});const m=Object.keys(jb.ui.followUps).flatMap(e=>{const t=Array.from(u(`[cmp-id="${e}"]`)).map(e=>+e.getAttribute("cmp-ver"))[0];return jb.ui.followUps[e].flatMap(({cmp:e})=>e).filter(e=>!t||e.ver>t)});function u(e){return jb.ui.headless?[...Object.values(jb.ui.headless).flatMap(t=>t.body.querySelectorAll(e,{includeSelf:!0})),...Array.from(document.querySelectorAll(e))]:[]}m.length&&jb.ui.BECmpsDestroyNotification.next({cmps:m}),jb.log("garbageCollect",{maxUsed:l,removedCtxs:o,removedResources:s,removeWidgets:p,removeFollowUps:m})},applyDeltaToCmp({delta:e,ctx:t,cmpId:a,elem:n,assumedVdom:i}){if(!e)return;if(!(n=n||jb.ui.elemOfCmp(t,a))||e._$prevVersion&&e._$prevVersion!=n.getAttribute("cmp-ver")){const i=n?"unexpected version":"elem not found";return void jb.logError(`applyDeltaToCmp: ${i}`,{reason:i,delta:e,ctx:t,cmpId:a,elem:n})}if(i){const r=s(n),o=jb.ui.vdomDiff(i,r);if(Object.keys(o).length)return jb.logError("wrong assumed vdom",{actualVdom:r,assumedVdom:i,diff:o,delta:e,ctx:t,cmpId:a,elem:n}),{recover:!0,reason:{diff:o,description:"wrong assumed vdom"}}}const r=e._$bySelector&&Object.keys(e._$bySelector)[0],o=r?jb.ui.find(n,r)[0]:n,l=r?e._$bySelector[r]:e;jb.log("applyDelta uiComp",{cmpId:a,delta:e,ctx:t,elem:n,bySelector:r,actualElem:o}),o instanceof jb.ui.VNode?(jb.ui.applyDeltaToVDom(o,l),jb.ui.renderingUpdates.next({delta:e,cmpId:a,widgetId:t.vars.headlessWidgetId})):o&&(jb.ui.applyDeltaToDom(o,l),jb.ui.refreshFrontEnd(o))},refreshElem(t,n,i){if("initializing"==jb.path(t,"_component.state.frontEndStatus")||jb.ui.findIncludeSelf(t,"[__refreshing]")[0])return jb.logError("circular refresh",{elem:t,state:n,options:i});const r=t.getAttribute("cmp-id"),s=+t.getAttribute("cmp-ver"),l=e.ctxOfElem(t);if(!l)return jb.logError("refreshElem - no ctx for elem",{elem:t,cmpId:r,cmpVer:s});const c=jb.path(i,"strongRefresh");let d=l.setVar("$model",null).setVar("$state",c?{refresh:!0}:{refresh:!0,...jb.path(t._component,"state"),...n});d._parent=null,i&&i.extendCtx&&(d=i.extendCtx(d)),d=d.setVar("$refreshElemCall",!0).setVar("$cmpId",r).setVar("$cmpVer",s+1),jb.ui.inStudio()&&(d.profile=jb.execInStudio({$:"studio.val",path:d.path})||d.profile),t.setAttribute("__refreshing","");const p="openDialog"==d.profile.$?d.run(dialog.buildComp()):d.runItself();if(jb.log("refresh elem start",{cmp:p,ctx:d,elem:t,state:n,options:i}),jb.path(i,"cssOnly")){const e=(t.className.match(/(w|jb-)[0-9]?-[0-9]+/)||[""])[0],a=Array.from(document.querySelectorAll("style")).map(e=>({el:e,txt:e.innerText})).filter(t=>-1!=t.txt.indexOf(e+" "))[0].el;jb.log("refresh element css only",{cmp:p,lines:p.cssLines,ctx:d,elem:t,state:n,options:i}),jb.ui.hashCss(p.calcCssLines(),p.ctx,{existingClass:e,cssStyleElem:a})}else jb.log("do refresh element",{cmp:p,ctx:d,elem:t,state:n,options:i}),p&&o(t,a(p),{strongRefresh:c,ctx:d});t.removeAttribute("__refreshing"),jb.ui.refreshNotification.next({cmp:p,ctx:d,elem:t,state:n,options:i})},subscribeToRefChange:t=>jb.subscribe(t.resourceChange,a=>{const n=t.removeLinksFromPath(a.insertedPath||t.pathOfRef(a.ref)),i=!jb.frame.document||jb.path(a,"srcCtx.vars.headlessWidgetId")||jb.path(a,"srcCtx.vars.testID")?jb.ui.widgetBody(a.srcCtx):jb.frame.document.body,r=jb.ui.find(i,"[observe]"),o=r.map(e=>e.getAttribute("jb-ctx")),s=jb.path(a.srcCtx,"vars.cmp.cmpId");jb.log("refresh check observable elements",{originatingCmpId:s,elemsToCheck:r,e:a,srcCtx:a.srcCtx}),r.forEach((r,l)=>{const c=r.getAttribute("cmp-id");if(!jb.ui.parents(r).find(e=>e==i))return jb.log("observable elem was detached in refresh process",{originatingCmpId:s,cmpId:c,elem:r});if(o[l]!=r.getAttribute("jb-ctx"))return jb.log("observable elem was refreshed from top in refresh process",{originatingCmpId:s,cmpId:c,elem:r});let d=!1,p=!1,m=!0;r.getAttribute("observe").split(",").map(e=>(function(e){const a=e.split("://"),n=a[1].split(";"),i=((n[2]||"").match(/includeChildren=([a-z]+)/)||["",""])[1],r=-1!=n.indexOf("strongRefresh"),o=-1!=n.indexOf("cssOnly"),s=-1!=n.indexOf("allowSelfRefresh");return a[0]==t.resources.id&&{ref:t.refOfUrl(n[0]),includeChildren:i,strongRefresh:r,cssOnly:o,allowSelfRefresh:s}})(e)).filter(e=>e).forEach(i=>{if(!i.allowSelfRefresh&&jb.ui.findIncludeSelf(r,`[cmp-id="${s}"]`)[0])return jb.log("blocking self refresh observableElems",{cmpId:c,originatingCmpId:s,elem:r,obs:i,e:a});const o=t.removeLinksFromPath(t.pathOfRef(i.ref));if(!o)return jb.logError("observer ref path is empty",{originatingCmpId:s,cmpId:c,obs:i,e:a});p=p||i.strongRefresh,m=m&&i.cssOnly;const l=e.comparePaths(n,o),u=1==l,b=u&&("yes"===i.includeChildren||!0===i.includeChildren),f=u&&"structure"===i.includeChildren&&("object"==typeof a.oldVal||"object"==typeof a.newVal);(-1==l||0==l||b||f)&&(d=!0)}),d&&(jb.log("refresh from observable elements",{cmpId:c,originatingCmpId:s,elem:r,ctx:a.srcCtx,e:a}),d&&e.refreshElem(r,null,{srcCtx:a.srcCtx,strongRefresh:p,cssOnly:m}))})})});class m{constructor(e,t){this.ctx=jb.ui.parents(e,{includeSelf:!0}).map(e=>e.ctxForFE).filter(e=>e)[0]||new jb.jbCtx,this.state={...e.state,...t&&jb.path(e._component,"state"),frontEndStatus:"initializing"},this.base=e,this.cmpId=e.getAttribute("cmp-id"),this.ver=e.getAttribute("cmp-ver"),this.pt=e.getAttribute("cmp-pt"),this.destroyed=new Promise(e=>this.resolveDestroyed=e),this.flows=[],e._component=this,this.runFEMethod("calcProps",null,null,!0),this.runFEMethod("init",null,null,!0),(e.getAttribute("eventhandlers")||"").split(",").forEach(t=>{const[a,n]=t.split("-");e.addEventListener(a,e=>jb.ui.handleCmpEvent(e,n))}),this.state.frontEndStatus="ready"}runFEMethod(e,a,n,i){if("ready"!=this.state.frontEndStatus&&-1==["init","calcProps"].indexOf(e))return jb.logError("frontEnd - running method before init",{cmp:{...this},method:e,data:a,_vars:n});const r=(this.base.frontEndMethods||[]).filter(t=>t.method==e);if(0==r.length&&!i)return jb.logError(`frontEnd - no method ${e}`,{cmp:{...this}});r.forEach(({path:i})=>t(()=>{const t=i.split("~").reduce((e,t)=>e[t],jb.comps),r=new jb.jbCtx(this.ctx,{profile:t,path:i,forcePath:i}),o=jb.run(r),s=this.base,l={cmp:this,$state:this.state,el:s,...this.base.vars,...n},c=this.ctx.setData(a).setVars(l),{_prop:d,_flow:p}=o.frontEndMethod;d?jb.log(`frontend uiComp calc prop ${d}`,{cmp:{...this},srcCtx:r,...o.frontEndMethod,el:s,ctxToUse:c}):p?jb.log(`frontend uiComp start flow ${jb.ui.rxPipeName(p)}`,{cmp:{...this},srcCtx:r,...o.frontEndMethod,el:s,ctxToUse:c}):jb.log(`frontend uiComp run method ${e}`,{cmp:{...this},srcCtx:r,...o.frontEndMethod,el:s,ctxToUse:c});const m=c.run(o.frontEndMethod.action);p&&this.flows.push(m)},`frontEnd-${e}`))}enrichUserEvent(e,a){(this.base.frontEndMethods||[]).filter(e=>"enrichUserEvent"==e.method).map(({path:n})=>t(()=>{const t=n+"~action",i=t.split("~").reduce((e,t)=>e[t],jb.comps),r={cmp:this,$state:this.state,el:this.base,...this.base.vars,ev:e,userEvent:a};Object.assign(a,jb.run(new jb.jbCtx(this.ctx,{vars:r,profile:i,path:t})))},"enrichUserEvent"))}refresh(t,a){jb.log("frontend uiComp refresh request",{cmp:{...this},state:t,options:a}),this._deleted||(Object.assign(this.state,t),this.base.state=this.state,e.refreshElem(this.base,this.state,a))}refreshFE(e){this._deleted||(Object.assign(this.state,e),this.base.state=this.state,this.runFEMethod("onRefresh",null,null,!0))}newVDomApplied(){Object.assign(this.state,{...this.base.state}),this.ver=this.base.getAttribute("cmp-ver"),this.runFEMethod("onRefresh",null,null,!0)}destroyFE(){this._deleted=!0,this.flows.forEach(e=>e.dispose()),this.runFEMethod("destroy",null,null,!0),this.resolveDestroyed()}}function u(e,t){new m(e,t)}e.subscribeToRefChange(jb.mainWatchableHandler),jb.callbag.subscribe(e=>{if(!e.widgetId&&e.cmpId&&"undefined"!=typeof document){const t=document.querySelector(`[cmp-id="${e.cmpId}"]`);t&&(jb.ui.applyDeltaToDom(t,e.delta),jb.ui.refreshFrontEnd(t))}})(jb.ui.renderingUpdates),jb.callbag.subscribe(e=>{const{widgetId:t,destroyLocally:a,cmps:n}=e;n.forEach(e=>{const t=jb.ui.followUps[e.cmpId];if(!t)return;const a=t.findIndex(({cmp:t})=>e.cmpId==t.cmpId&&e.ver==t.ver);-1!=a&&(t[a].pipe.dispose(),t.splice(a,1)),t.length||delete jb.ui.followUps[e.cmpId]}),t&&!a?jb.ui.widgetUserRequests.next({$:"destroy",...e}):n.forEach(e=>(e.destroyCtxs||[]).forEach(t=>{jb.log("backend method destroy uiComp",{cmp:e,el:e.el}),jb.ui.runCtxAction(jb.ctxDictionary[t])}))})(jb.ui.BECmpsDestroyNotification)}(),function(){const e=jb.ui;let t=1;e.propCounter=0;const a=(e,t)=>{try{return e()}catch(e){jb.logException(e,t,{ctx:this.ctx})}},n=new Set("init,extendCtx,templateModifier,followUp,destroy".split(",")),i=new Set("enrichField,icon,watchAndCalcModelProp,css,method,calcProp,userEventProps,validations,frontEndMethod,frontEndVar,eventHandler".split(",")),r=new Set("template,calcRenderProps,toolbar,styleParams,ctxForPick".split(","));Object.assign(jb.ui,{cssHashCounter:0,cssHashMap:{},hashCss(t,a,{existingClass:n,cssStyleElem:i}={}){const r=(t||[]).filter(e=>e),o=r.join("\n");if(!o)return"";const s=a.vars.headlessWidget&&a.vars.headlessWidgetId,l=s||"jb",c=this.cssHashMap[l]=this.cssHashMap[l]||{};if(!c[o]){if(n){const e=Object.keys(c).filter(e=>c[e].classId==n)[0];e&&delete c[e]}else this.cssHashCounter++;const t=n||`${l}➤${this.cssHashCounter}`;c[o]={classId:t,paths:{[a.path]:!0}};const d=function(e){const t=r.map(t=>{return t.split("{")[0].split(",").map(e=>e.trim().replace("|>"," ")).map(t=>-1==t.indexOf("~")?`.${e}${t}`:t.replace("~",`.${e}`))+" { "+t.split("{")[1]}).join("\n");return`/*style: ${a.profile.style&&a.profile.style.$}, path: ${a.path}*/\n`+t}(t);i?i.innerText=d:e.addStyleElem(a,d,s)}return Object.assign(c[o].paths,{[a.path]:!0}),c[o].classId}});class o{constructor(e,a,n){this.ctx=e;const i=e.vars.headlessWidget&&e.vars.headlessWidgetId||"";this.cmpId=a||(i?i+"-"+t++:""+t++),this.ver=n||1,this.eventObservables=[],this.cssLines=[],this.contexts=[],this.originators=[e]}init(){if(this.initialized)return;jb.log("init uiComp",{cmp:this});const e=this.ctx.vars;this.ctx=(this.extendCtxFuncs||[]).reduce((e,t)=>a(()=>t(e,this),"extendCtx"),this.ctx.setVar("cmp",this)),this.newVars=jb.objFromEntries(jb.entries(this.ctx.vars).filter(([t,a])=>e[t]!=a)),this.renderProps={},this.state=this.ctx.vars.$state,this.calcCtx=this.ctx.setVar("$props",this.renderProps).setVar("cmp",this),this.initialized=!0}calcRenderProps(){return this.init(),(this.initFuncs||[]).sort((e,t)=>e.phase-t.phase).forEach(e=>a(()=>e.action(this.calcCtx,this.calcCtx.vars),"init")),this.toObserve=this.watchRef?this.watchRef.map(e=>({...e,ref:e.refF(this.ctx)})).filter(e=>jb.isWatchable(e.ref)):[],this.watchAndCalcModelProp&&this.watchAndCalcModelProp.forEach(e=>{if(null!=this.state[e.prop])return;const t=this.ctx.vars.$model[e.prop];if(!t)return jb.logError("calcRenderProps",`missing model prop "${e.prop}"`,{cmp:this,model:this.ctx.vars.$model,ctx:this.ctx});const a=t(this.ctx);jb.isWatchable(a)&&this.toObserve.push({id:e.prop,cmp:this,ref:a,...e});const n=jb.val(a);this.renderProps[e.prop]=e.transformValue(this.ctx.setData(null==n?e.defaultValue:n))}),[...this.calcProp||[],...this.method||[]].forEach(e=>"function"==typeof e.value&&Object.defineProperty(e.value,"name",{value:e.id})),(this.calcProp||[]).filter(e=>0==this.calcProp.filter(t=>t.id==e.id&&t.priority>e.priority).length).sort((e,t)=>e.phase-t.phase||e.index-t.index).forEach(e=>{const t=jb.val(a(()=>null===e.value.profile?this.calcCtx.vars.$model[e.id]:e.value(this.calcCtx),`renderProp:${e.id}`)),n=null==t?e.defaultValue:t;Object.assign(this.renderProps,{..."$props"==e.id?n:{[e.id]:n}})}),(this.calcProp||[]).filter(e=>e.userStateProp&&!this.state.refresh).forEach(e=>this.state[e.id]=this.renderProps[e.id]),Object.assign(this.renderProps,this.styleParams,this.state),this.renderProps}renderVdom(){if(jb.log("uiComp start renderVdom",{cmp:this}),this.calcRenderProps(),this.ctx.probe&&this.ctx.probe.outOfTime)return;this.template=this.template||(()=>"");const t=a(()=>this.template(this,this.renderProps,e.h),"template")||{},n=(this.templateModifierFuncs||[]).reduce((t,n)=>t&&"object"==typeof t?a(()=>n(t,this,this.renderProps,e.h)||t,"templateModifier"):t,t),i=this.toObserve.map(e=>[e.ref.handler.urlOfRef(e.ref),e.includeChildren&&`includeChildren=${e.includeChildren}`,e.strongRefresh&&"strongRefresh",e.cssOnly&&"cssOnly",e.allowSelfRefresh&&"allowSelfRefresh",e.phase&&`phase=${e.phase}`].filter(e=>e).join(";")).join(","),r=(this.method||[]).map(t=>`${t.id}-${e.preserveCtx(t.ctx.setVars({cmp:this,$props:this.renderProps,...this.newVars}))}`).join(","),o=(this.eventHandler||[]).map(t=>`${t.event}-${e.preserveCtx(t.ctx.setVars({cmp:this}))}`).join(","),s=this.originators.map(t=>e.preserveCtx(t)).join(","),l=(this.userEventProps||[]).join(","),c=(this.frontEndMethod||[]).map(e=>({method:e.method,path:e.path})),d=this.frontEndVar&&jb.objFromEntries(this.frontEndVar.map(e=>[e.id,jb.val(e.value(this.calcCtx))]));return n instanceof jb.ui.VNode&&(n.addClass(this.jbCssClass()),n.attributes=Object.assign(n.attributes||{},{"jb-ctx":e.preserveCtx(this.originatingCtx()),"cmp-id":this.cmpId,"cmp-ver":""+this.ver,"cmp-pt":this.ctx.profile.$,"full-cmp-ctx":e.preserveCtx(this.calcCtx)},i&&{observe:i},r&&{methods:r},o&&{eventhandlers:o},s&&{originators:s},l&&{usereventprops:l},c.length&&{$__frontEndMethods:JSON.stringify(c)},c.length&&{interactive:"true"},d&&{$__vars:JSON.stringify(d)},this.state&&{$__state:JSON.stringify(this.state)},this.ctxForPick&&{"pick-ctx":e.preserveCtx(this.ctxForPick)})),jb.log("uiComp end renderVdom",{cmp:this,vdom:n}),this.afterFirstRendering=!0,n}renderVdomAndFollowUp(){const e=this.renderVdom();return jb.delay(1).then(()=>(this.followUpFuncs||[]).forEach(e=>a(()=>{jb.log("backend uiComp followUp",{cmp:this,fu:e,srcCtx:e.srcCtx}),e.action(this.calcCtx),this.ver>1&&jb.ui.BECmpsDestroyNotification.next({cmps:[{cmpId:this.cmpId,ver:this.ver-1}]})},"followUp"))).then(()=>this.ready=!0),this.ready=!1,e}hasBEMethod(e){return(this.method||[]).filter(t=>t.id==e)[0]}runBEMethod(e,t,a){jb.log(`backend uiComp method ${e}`,{cmp:this,data:t,vars:a}),jb.path(a,"$state")&&Object.assign(this.state,a.$state);const n=(this.method||[]).filter(t=>t.id==e);n.forEach(e=>jb.ui.runCtxAction(e.ctx,t,{cmp:this,$state:this.state,$props:this.renderProps,...a})),0==n.length&&jb.logError(`no method ${e} in cmp`,{cmp:this,data:t,vars:a})}refresh(e,t){const a=jb.ui.elemOfCmp(this.ctx,this.cmpId);jb.log("backend uiComp refresh request",{cmp:this,elem:a,state:e,options:t}),jb.ui.BECmpsDestroyNotification.next({cmps:[{cmpId:this.cmpId,ver:this.ver,destroyCtxs:[]}]}),a&&jb.ui.refreshElem(a,e,t)}calcCssLines(){return jb.unique((this.css||[]).map(e=>"function"==typeof e?e(this.calcCtx):e).flatMap(e=>e.split(/}\s*/m).map(e=>e.trim()).filter(e=>e).map(e=>e+"}").map(e=>e.replace(/^!/," "))))}jbCssClass(){return jb.ui.hashCss(this.calcCssLines(),this.ctx)}originatingCtx(){return this.originators[this.originators.length-1]}field(){if(this._field)return this._field;const t=this.originatingCtx();this._field={class:"",ctxId:e.preserveCtx(t),control:(e,a,n)=>this.getOrCreateItemField(e,()=>t.setData(e).setVars({index:(a||0)+1}).runItself(),n)},this.enrichField&&this.enrichField.forEach(e=>e(this._field));let a=jb.tosingle(jb.val(t.params.title))||(()=>"");return void 0!==this._field.title&&(a=this._field.title),this._field.title="function"==typeof a?a:()=>""+a,this.itemfieldCache=new Map,this._field}getOrCreateItemField(e,t,a){return a?t():(this.itemfieldCache.get(e)||this.itemfieldCache.set(e,t()),this.itemfieldCache.get(e))}orig(e){return jb.comps[e.profile&&e.profile.$].type.split(/,|-/).indexOf("control"),this.originators.push(e),this}applyParamFeatures(e){return(e.params.features&&e.params.features(e)||[]).forEach(t=>this.jbExtend(t,e)),this}jbExtend(t,a){if(!t)return this;(a=a||this.ctx)||console.log("no ctx provided for jbExtend");const o=t.$?a.run(t):t;return Array.isArray(o)?(o.forEach(e=>this.jbExtend(e,a)),this):(o.afterViewInit&&(o.frontEnd=o.afterViewInit),"string"==typeof o.class&&(o.templateModifier=e=>e.addClass(o.class)),Object.keys(o).forEach(e=>{"function"==typeof o[e]&&Object.defineProperty(o[e],"name",{value:e}),n.has(e)&&(this[e+"Funcs"]=this[e+"Funcs"]||[],this[e+"Funcs"].push(o[e])),i.has(e)&&(this[e]=this[e]||[],this[e].push(o[e])),r.has(e)&&(this[e]=this[e]||o[e])}),o.watchRef&&(this.watchRef=this.watchRef||[],this.watchRef.push({cmp:this,...o.watchRef})),this.eventObservables=this.eventObservables.concat(Object.keys(o).filter(e=>0==e.indexOf("on"))),jb.asArray(o.featuresOptions||[]).filter(e=>e).forEach(e=>this.jbExtend(e.$?a.run(e):e,a)),jb.asArray(e.inStudio()&&o.studioFeatures).filter(e=>e).forEach(e=>this.jbExtend(a.run(e),a)),this)}}e.JbComponent=o,jb.jstypes.renderable=t=>null==t?"":t instanceof e.VNode?t:t instanceof o?e.h(t):Array.isArray(t)?e.h("div",{},t.map(e=>jb.jstypes.renderable(e))):""+jb.val(t,!0)}(),Object.assign(jb.ui,{focus(e,t,a){const n=(new Date).getTime(),i=jb.studio.lastStudioActivity||jb.path(jb,["studio","studioWindow","jb","studio","lastStudioActivity"]);jb.log("focus request",{srcCtx:a,logTxt:t,timeDiff:n-i,elem:e,srcCtx:a}),jb.studio.previewjb==jb&&"studio-helper"!=jb.path(jb.frame.parent,"jb.resources.studio.project")&&i&&n-i<1e3||(jb.log("focus dom",{elem:e,srcCtx:a,logTxt:t}),jb.delay(1).then(()=>e.focus()))},withUnits:e=>""===e||void 0===e?"":(""+e||"").match(/[^0-9]$/)?e:`${e}px`,propWithUnits:(e,t)=>""===t||void 0===t?"":`${e}: `+((""+t||"").match(/[^0-9]$/)?t:`${t}px`)+";",fixCssLine:e=>-1!=e.indexOf("\n")||e.match(/}\s*/)?e:`{ ${e} }`,preserveCtx:e=>(jb.ctxDictionary[e.id]=e,""+e.id),inStudio:()=>jb.studio&&jb.studio.studioWindow,inPreview(){try{return!jb.ui.inStudio()&&jb.frame.parent&&jb.frame.parent.jb.studio.initPreview}catch(e){}},previewOverlayDocument:e=>(jb.path(e.frame(),"document.body")||jb.path(e.frame(),"parent.document.body")).ownerDocument,widgetBody(e){const{elemToTest:t,previewOverlay:a,tstWidgetId:n,headlessWidget:i,FEwidgetId:r,headlessWidgetId:o}=e.vars,s=t||a&&jb.path(this.previewOverlayDocument(e),"body")||n&&jb.path(jb.ui.headless[n],"body")||i&&jb.path(jb.ui.headless[o],"body")||jb.path(e.frame().document,"body");return r?jb.ui.findIncludeSelf(s,`[widgetid="${r}"]`)[0]:s},ctxOfElem:(e,t)=>e&&e.getAttribute&&jb.ctxDictionary[e.getAttribute(t||"jb-ctx")],parentCmps:e=>jb.ui.parents(e).map(e=>e._component).filter(e=>e),closestCmpElem:e=>jb.ui.parents(e,{includeSelf:!0}).find(e=>e.getAttribute&&null!=e.getAttribute("cmp-id")),headlessWidgetId:e=>jb.ui.parents(e,{includeSelf:!0}).filter(e=>e.getAttribute&&e.getAttribute("widgettop")&&e.getAttribute("headless")).map(e=>e.getAttribute("widgetid"))[0],frontendWidgetId:e=>jb.ui.parents(e,{includeSelf:!0}).filter(e=>e.getAttribute&&e.getAttribute("widgettop")&&e.getAttribute("frontend")).map(e=>e.getAttribute("widgetid"))[0],elemOfCmp:(e,t)=>jb.ui.findIncludeSelf(jb.ui.widgetBody(e),`[cmp-id="${t}"]`)[0],fromEvent:(e,t,a,n)=>jb.callbag.pipe(jb.callbag.fromEvent(t,a||e.base,n),jb.callbag.takeUntil(e.destroyed)),renderWidget(profile,topElem,ctx){return!jb.ui.renderWidgetInStudio&&jb.path(jb.frame,"parent.jb.ui.renderWidgetInStudio")&&eval("jb.ui.renderWidgetInStudio= "+jb.frame.parent.jb.ui.renderWidgetInStudio.toString()),jb.frame.parent!=jb.frame&&jb.ui.renderWidgetInStudio?jb.ui.renderWidgetInStudio(profile,topElem):jb.ui.render(jb.ui.h(jb.ui.extendWithServiceRegistry(ctx).run(profile)),topElem)},extendWithServiceRegistry(e){const t=e||new jb.jbCtx;return t.setVar("$serviceRegistry",{baseCtx:t,parentRegistry:t.vars.$serviceRegistry,services:{}})},rxPipeName:e=>(jb.path(e,"0.event")||jb.path(e,"0.$")||"")+"..."+jb.path(e,"length")});var{feature:feature,action:action}=jb.ns("feature");jb.component("feature.serviceRegistey",{type:"feature",impl:()=>({extendCtx:e=>jb.ui.extendWithServiceRegistry(e)})}),jb.component("service.registerBackEndService",{type:"data",params:[{id:"id",as:"string",mandatory:!0,dynamic:!0},{id:"service",mandatory:!0,dynamic:!0},{id:"allowOverride",as:"boolean"}],impl:feature.init((e,{$serviceRegistry:t},{id:a,service:n,allowOverride:i})=>{const r=a(e),o=n(e);jb.log("register service",{id:r,service:o,ctx:e.cmpCtx}),t.services[r]&&!i&&jb.logError("overridingService ${_id}",{id:r,service:t.services[r],service:o,ctx:e}),t.services[r]=o})}),Object.assign(jb.ui,{outerWidth(e){const t=getComputedStyle(e);return e.offsetWidth+parseInt(t.marginLeft)+parseInt(t.marginRight)},outerHeight(e){const t=getComputedStyle(e);return e.offsetHeight+parseInt(t.marginTop)+parseInt(t.marginBottom)},offset:e=>e.getBoundingClientRect(),parents(e,{includeSelf:t}={}){const a=[];for(e=t?e:e&&e.parentNode;e;)a.push(e),e=e.parentNode;return a},closest(e,t){for(;e;){if(jb.ui.matches(e,t))return e;e=e.parentNode}},activeElement:()=>document.activeElement,find:(e,t,a)=>e?("jbCtx"==jb.path(e,"constructor.name")&&(e=jb.ui.widgetBody(e)),e?e instanceof jb.ui.VNode?e.querySelectorAll(t,a):[...a&&a.includeSelf&&jb.ui.matches(e,t)?[e]:[],...Array.from(e.querySelectorAll(t))]:[]):[],findIncludeSelf:(e,t)=>jb.ui.find(e,t,{includeSelf:!0}),addClass:(e,t)=>e&&e.classList&&e.classList.add(t),removeClass:(e,t)=>e&&e.classList&&e.classList.remove(t),hasClass:(e,t)=>e&&e.classList&&e.classList.contains(t),matches:(e,t)=>e&&e.matches&&e.matches(t),indexOfElement:e=>Array.from(e.parentNode.children).indexOf(e),limitStringLength:(e,t)=>"string"==typeof e&&e.length>t-3?e.substring(0,t)+"...":e,addHTML(e,t){const a=document.createElement("div");a.innerHTML=t,e.appendChild(a.firstChild)},addStyleElem(e,t,a){if(!a||e.vars.previewOverlay){const a=document.createElement("style");return a.innerHTML=t,this.previewOverlayDocument(e).head.appendChild(a),a}jb.ui.renderingUpdates.next({widgetId:a,css:t})},valueOfCssVar(e,t){if(!(t=t||document.body))return jb.logError("valueOfCssVar: no parent"),"red";el=t.ownerDocument.createElement("div"),el.style.display="none",el.style.color=`var(--${e})`,t.appendChild(el);const a=getComputedStyle(el).color;return t.removeChild(el),a}}),jb.objectDiff=function(e,t){if(t===e)return{};if(!jb.isObject(t)||!jb.isObject(e))return e;const a=Object.keys(t).reduce((t,a)=>e.hasOwnProperty(a)?t:{...t,[a]:"__undefined"},{});return Object.keys(e).reduce((a,n)=>{if(!t.hasOwnProperty(n))return{...a,[n]:e[n]};const i=jb.objectDiff(e[n],t[n]);return jb.isObject(i)&&jb.isEmpty(i)?a:{...a,[n]:i}},a)},jb.component("action.applyDeltaToCmp",{type:"action",params:[{id:"delta",mandatory:!0},{id:"cmpId",as:"string",mandatory:!0},{id:"assumedVdom"}],impl:(e,t,a,n)=>jb.ui.applyDeltaToCmp({ctx:e,delta:t,cmpId:a,assumedVdom:n})}),jb.component("sink.applyDeltaToCmp",{type:"rx",params:[{id:"delta",dynamic:!0,mandatory:!0},{id:"cmpId",as:"string",mandatory:!0}],impl:sink.action(action.applyDeltaToCmp("%$delta()%","%$cmpId%"))}),jb.component("action.focusOnCmp",{description:"runs both in FE and BE",type:"action",params:[{id:"description",as:"string"},{id:"cmpId",as:"string",defaultValue:"%$cmp/cmpId%"}],impl:(e,t,a)=>{const n=jb.path(e.vars.cmp,"base");if(n)return jb.log("frontend focus on cmp",{frontEndElem:n,ctx:e,desc:t,cmpId:a}),jb.ui.focus(n,t,e);{jb.log("backend focus on cmp",{frontEndElem:n,ctx:e,desc:t,cmpId:a});const i={attributes:{$focus:t}};jb.ui.applyDeltaToCmp({delta:i,ctx:e,cmpId:a})}}}),jb.component("customStyle",{typePattern:e=>/\.style$/.test(e),category:"advanced:10,all:10",params:[{id:"template",as:"single",mandatory:!0,dynamic:!0,ignore:!0},{id:"css",as:"string"},{id:"features",type:"feature[]",dynamic:!0}],impl:(e,t,a)=>({template:e.profile.template,css:t,featuresOptions:a(),styleParams:e.cmpCtx.params})}),jb.component("styleByControl",{typePattern:e=>/\.style$/.test(e),category:"advanced:10,all:20",params:[{id:"control",type:"control",mandatory:!0,dynamic:!0},{id:"modelVar",as:"string",mandatory:!0}],impl:(e,t,a)=>t(e.setVar(a,e.vars.$model))}),jb.component("styleWithFeatures",{typePattern:e=>/\.style$/.test(e),description:"customize, add more features to style",category:"advanced:10,all:20",params:[{id:"style",type:"$asParent",mandatory:!0,composite:!0},{id:"features",type:"feature[]",templateValue:[],dynamic:!0,mandatory:!0}],impl:(e,t,a)=>t instanceof jb.ui.JbComponent?t.jbExtend(a(),e):t&&{...t,featuresOptions:(t.featuresOptions||[]).concat(a())}}),jb.component("controlWithFeatures",{type:"control",description:"customize, add more features to control",category:"advanced:10,all:20",params:[{id:"control",type:"control",mandatory:!0},{id:"features",type:"feature[]",templateValue:[],mandatory:!0}],impl:(e,t,a)=>t.jbExtend(a,e).orig(e)});var{customStyle:customStyle,styleByControl:styleByControl,styleWithFeatures:styleWithFeatures,controlWithFeatures:controlWithFeatures}=jb.macro,{variable:variable,followUp:followUp,backEnd:backEnd,method:method,features:features,onDestroy:onDestroy,htmlAttribute:htmlAttribute,templateModifier:templateModifier,watchAndCalcModelProp:watchAndCalcModelProp,calcProp:calcProp,watchRef:watchRef}=jb.ns("variable,followUp,backEnd,method,htmlAttribute,features,onDestroy,templateModifier,watchAndCalcModelProp,calcProp,watchRef,group");jb.component("method",{type:"feature",description:"define backend event handler",params:[{id:"id",as:"string",mandatory:!0,description:'to be used in html, e.g. onclick="myMethod" '},{id:"action",type:"action[]",mandatory:!0,dynamic:!0}],impl:(e,t)=>({method:{id:t,ctx:e}})}),jb.component("feature.onEvent",{type:"feature",category:"events",params:[{id:"event",as:"string",mandatory:!0,options:"load,blur,change,focus,keydown,keypress,keyup,click,dblclick,mousedown,mousemove,mouseup,mouseout,mouseover,scroll"},{id:"action",type:"action[]",mandatory:!0,dynamic:!0}],impl:(e,t)=>({eventHandler:{event:t,ctx:e}})}),jb.component("watchAndCalcModelProp",{type:"feature",description:"Use a model property in the rendering and watch its changes (refresh on change)",params:[{id:"prop",as:"string",mandatory:!0},{id:"transformValue",dynamic:!0,defaultValue:"%%"},{id:"allowSelfRefresh",as:"boolean",description:"allow refresh originated from the components or its children",type:"boolean"},{id:"defaultValue"}],impl:e=>({watchAndCalcModelProp:e.params})}),jb.component("calcProp",{type:"feature",description:"define a variable to be used in the rendering calculation process",params:[{id:"id",as:"string",mandatory:!0},{id:"value",mandatory:!0,dynamic:!0,description:"when empty value is taken from model"},{id:"priority",as:"number",defaultValue:1,description:"if same prop was defined elsewhere decides who will override. range 1-1000"},{id:"phase",as:"number",defaultValue:10,description:"props from different features can use each other, phase defines the calculation order"},{id:"defaultValue"}],impl:e=>({calcProp:{...e.params,index:jb.ui.propCounter++}})}),jb.component("userStateProp",{type:"feature",description:"define a user state (e.g., selection) that is passed to the FE and back to the BE via refresh calls. The first calculation is done at the BE and then the FE can change it",params:[{id:"id",as:"string",mandatory:!0},{id:"value",mandatory:!0,dynamic:!0,description:"when empty value is taken from model"},{id:"priority",as:"number",defaultValue:1,description:"if same prop was defined elsewhere decides who will override. range 1-1000"},{id:"phase",as:"number",defaultValue:10,description:"props from different features can use each other, phase defines the calculation order"}],impl:e=>({calcProp:{...e.params,userStateProp:!0,index:jb.ui.propCounter++}})}),jb.component("calcProps",{type:"feature",description:"define variables to be used in the rendering calculation process",params:[{id:"props",as:"object",mandatory:!0,description:"props as object",dynamic:!0},{id:"phase",as:"number",defaultValue:10,description:"props from different features can use each other, phase defines the calculation order"}],impl:(e,t,a)=>({calcProp:{id:"$props",value:e=>t(e),phase:a,index:jb.ui.propCounter++}})}),jb.component("feature.initValue",{type:"feature",category:"lifecycle",description:"set value if the value is empty, activated before calc properties",params:[{id:"to",as:"ref",mandatory:!0,dynamic:!0},{id:"value",mandatory:!0,dynamic:!0},{id:"alsoWhenNotEmpty",as:"boolean"}],impl:(e,t,a,n)=>({init:{action:(i,{cmp:r})=>{const o=a(i),s=t(i),l=jb.val(o),c=jb.val(s);!n&&null!=c||l===c?l!==c&&jb.logError(`feature.initValue: init non empty value ${jb.prettyPrint(s.profile)}`,{toAssign:l,currentVal:c,cmp:r,ctx:e,to:s,value:o}):(jb.log("init value",{cmp:r,...e.params}),jb.writeValue(s,l,e,!0))},phase:10}})}),jb.component("feature.requireService",{params:[{id:"service",type:"service"},{id:"condition",dynamic:!0,defaultValue:!0}],impl:(e,t,a)=>({init:{action:e=>a(e)&&t.init(e),phase:10}})}),jb.component("feature.init",{type:"feature:0",category:"lifecycle",description:"activated before calc properties, use initValue or require instead",params:[{id:"action",type:"action",mandatory:!0,dynamic:!0},{id:"phase",as:"number",defaultValue:10,description:"init funcs from different features can use each other, phase defines the calculation order"}],impl:({},e,t)=>({init:{action:e,phase:t}})}),jb.component("onDestroy",{type:"feature",category:"lifecycle",params:[{id:"action",type:"action",mandatory:!0,dynamic:!0}],impl:method("destroy","%$action()%")}),jb.component("templateModifier",{type:"feature",description:"change the html template",params:[{id:"value",mandatory:!0,dynamic:!0}],impl:(e,t)=>({templateModifier:(e,a)=>t(a.calcCtx.setVars({vdom:e,...a.renderProps}))})}),jb.component("frontEnd.var",{type:"feature",description:"calculate in the BE and pass to frontEnd",params:[{id:"id",as:"string",mandatory:!0},{id:"value",mandatory:!0,dynamic:!0}],impl:e=>({frontEndVar:e.params})}),jb.component("features",{type:"feature",description:"list of features, auto flattens",params:[{id:"features",type:"feature[]",as:"array",composite:!0}],impl:(e,t)=>t.flatMap(e=>Array.isArray(e)?e:[e])}),jb.component("followUp.action",{type:"feature",description:"runs at the backend a tick after the vdom was returned. Try to avoid it, use initValue or require instead",category:"lifecycle",params:[{id:"action",type:"action",mandatory:!0,dynamic:!0}],impl:e=>({followUp:{action:t=>e.params.action(t),srcCtx:e}})}),jb.component("followUp.flow",{type:"feature",description:"rx flow at the backend after the vdom was sent. Try to avoid it, use watchRef instead",params:[{id:"elems",type:"rx[]",as:"array",mandatory:!0,dynamic:!0,templateValue:[]}],impl:followUp.action(runActions(Var("followUpCmp","%$cmp%"),Var("pipeToRun",rx.pipe("%$elems()%")),(e,{cmp:t,pipeToRun:a})=>{jb.ui.followUps[t.cmpId]=jb.ui.followUps[t.cmpId]||[],jb.ui.followUps[t.cmpId].push({cmp:t,pipe:a,srcPath:e.cmpCtx.callerPath})}))}),jb.component("watchRef",{type:"feature",category:"watch:100",description:"subscribes to data changes to refresh component",params:[{id:"ref",mandatory:!0,as:"ref",dynamic:!0,description:"reference to data"},{id:"includeChildren",as:"string",options:"yes,no,structure",defaultValue:"no",description:"watch childern change as well"},{id:"allowSelfRefresh",as:"boolean",description:"allow refresh originated from the components or its children",type:"boolean"},{id:"strongRefresh",as:"boolean",description:"rebuild the component and reinit wait for data",type:"boolean"},{id:"cssOnly",as:"boolean",description:"refresh only css features",type:"boolean"},{id:"phase",as:"number",description:"controls the order of updates on the same event. default is 0"}],impl:e=>({watchRef:{refF:e.params.ref,...e.params}})}),jb.component("followUp.watchObservable",{type:"feature",category:"watch",description:"subscribes to a custom observable to refresh component",params:[{id:"toWatch",mandatory:!0,dynamic:!0},{id:"debounceTime",as:"number",description:"in mSec"}],impl:followUp.flow(source.data(0),rx.var("cmp","%$cmp%"),rx.flatMap("%$toWatch()%"),rx.debounceTime("%$debounceTime%"),sink.refreshCmp())}),jb.component("followUp.onDataChange",{type:"feature",category:"watch",description:"watch observable data reference, subscribe and run action",params:[{id:"ref",mandatory:!0,as:"ref",dynamic:!0,description:"reference to data"},{id:"includeChildren",as:"string",options:"yes,no,structure",defaultValue:"no",description:"watch childern change as well"},{id:"action",type:"action",dynamic:!0,description:"run on change"}],impl:followUp.flow(source.watchableData("%$ref()%","%$includeChildren%"),sink.action(call("action")))}),jb.component("group.data",{type:"feature",category:"general:100,watch:80",params:[{id:"data",mandatory:!0,dynamic:!0,as:"ref"},{id:"itemVariable",as:"string",description:"optional. define data as a local variable"},{id:"watch",as:"boolean",type:"boolean"},{id:"includeChildren",as:"string",options:"yes,no,structure",defaultValue:"no",description:"watch childern change as well"}],impl:({},e,t,a,n)=>({...a?{watchRef:{refF:e,includeChildren:n}}:{},extendCtx:a=>{const n=e();return a.setData(n).setVar(t,n)}})}),jb.component("htmlAttribute",{type:"feature",description:"set attribute to html element and give it value",params:[{id:"attribute",mandatory:!0,as:"string"},{id:"value",mandatory:!0,as:"string",dynamic:!0}],impl:(e,t,a)=>({templateModifier:(e,n)=>e.setAttribute(t.match(/^on[^-]/)?`${t.slice(0,2)}-${t.slice(2)}`:t,a(n.ctx))})}),jb.component("id",{type:"feature",description:"adds id to html element",params:[{id:"id",mandatory:!0,as:"string",dynamic:!0}],impl:htmlAttribute("id","%$id()%")}),jb.component("feature.hoverTitle",{type:"feature",description:"set element title, usually shown by browser on hover",params:[{id:"title",as:"string",mandatory:!0}],impl:htmlAttribute("title","%$title%")}),jb.component("variable",{type:"feature",category:"general:90",description:"define a variable. watchable or passive, local or global",params:[{id:"name",as:"string",mandatory:!0},{id:"value",dynamic:!0,defaultValue:"",mandatory:!0},{id:"watchable",as:"boolean",type:"boolean",description:"E.g., selected item variable"}],impl:({},e,t,a)=>({destroy:t=>{if(!a)return;const n=e+":"+t.ctx.id;t.ctx.run(writeValue(`%$${n}%`,null))},extendCtx:(n,i)=>{if(!a)return n.setVar(e,jb.val(t(n)));const r=e+":"+i.ctx.id;jb.log("create watchable var",{cmp:i,ctx:n,fullName:r});const o=jb.mainWatchableHandler.refOfPath([r]);return jb.writeValue(o,t(n),n),n.setVar(e,o)}})}),jb.component("calculatedVar",{type:"feature",category:"general:60",description:"defines a local variable that watches other variables with auto recalc",params:[{id:"name",as:"string",mandatory:!0},{id:"value",dynamic:!0,defaultValue:"",mandatory:!0},{id:"watchRefs",as:"array",dynamic:!0,mandatory:!0,defaultValue:[],description:"variable to watch. needs to be in array"}],impl:features(onDestroy(writeValue("%${%$name%}:{%$cmp/cmpId%}%",null)),followUp.flow(rx.merge((e,{},{watchRefs:t})=>t(e).map(t=>e.setData(t).run(source.watchableData("%%")))),rx.log("check calculatedVar"),rx.map("%$value()%"),sink.data("%${%$name%}:{%$cmp/cmpId%}%")),e=>({extendCtx:(t,a)=>{const{name:n,value:i}=e.cmpCtx.params,r=n+":"+a.cmpId;jb.log("create watchable calculatedVar",{ctx:e,cmp:a,fullName:r}),jb.resource(r,jb.val(i(t)));const o=t.exp(`%$${r}%`,"ref");return t.setVar(n,o)}}))}),jb.component("feature.if",{type:"feature",category:"feature:85",description:"adds/remove element to dom by condition. keywords: hidden/show",params:[{id:"showCondition",as:"boolean",mandatory:!0,dynamic:!0,type:"boolean"}],impl:(e,t)=>({templateModifier:(e,a)=>jb.toboolean(t(a.ctx))?e:jb.ui.h("span",{style:{display:"none"}})})}),jb.component("hidden",{type:"feature",category:"feature:85",description:"display:none on element. keywords: show",params:[{id:"showCondition",type:"boolean",mandatory:!0,dynamic:!0}],impl:(e,t)=>({templateModifier:(e,a)=>(jb.path(e,["attributes","style","display"],jb.toboolean(t(a.ctx))?"inherit":"none"),e)})}),jb.component("refreshControlById",{type:"action",params:[{id:"id",as:"string",mandatory:!0},{id:"strongRefresh",as:"boolean",description:"rebuild the component and reinit wait for data",type:"boolean"},{id:"cssOnly",as:"boolean",description:"refresh only css features",type:"boolean"}],impl:(e,t)=>{const a=jb.ui.widgetBody(e).querySelector("#"+t);return a?jb.ui.refreshElem(a,null,{srcCtx:e,...e.params}):jb.logError("refreshControlById can not find elem for #"+t,{ctx:e})}}),jb.component("group.autoFocusOnFirstInput",{type:"feature",impl:templateModifier(({},{vdom:e})=>{const t=e.querySelectorAll("input,textarea,select").filter(e=>"checkbox"!=e.getAttribute("type"))[0];return t&&t.setAttribute("$focus","autoFocusOnFirstInput"),e})}),jb.component("refreshIfNotWatchable",{type:"action",params:[{id:"data"}],impl:(e,t)=>!jb.isWatchable(t)&&e.vars.cmp.refresh(null,{strongRefresh:!0})}),jb.component("feature.byCondition",{type:"feature",description:"conditional feature, define feature if then else condition",macroByValue:!0,params:[{id:"condition",type:"boolean",as:"boolean",mandatory:!0},{id:"then",type:"feature",mandatory:!0,dynamic:!0,composite:!0},{id:"else",type:"feature",dynamic:!0}],impl:(e,t,a,n)=>t?a():n()}),jb.component("feature.userEventProps",{type:"feature",description:"add data to the event sent from the front end",params:[{id:"props",as:"string",description:"comma separated props to take from the original event e.g., altKey,ctrlKey"}],impl:(e,t)=>({userEventProps:t})});var{rx:rx,key:key,frontEnd:frontEnd,sink:sink,service:service,replace:replace}=jb.ns("rx,key,frontEnd,sink,service");jb.component("action.runBEMethod",{type:"action",description:"can be activated on both FE & BE, assuming $cmp variable",macroByValue:!0,params:[{id:"method",as:"string",dynamic:!0},{id:"data",defaultValue:"%%",dynamic:!0},{id:"vars",dynamic:!0}],impl:(e,t,a,n)=>jb.ui.runBEMethodInAnyContext(e,t(),a(),n())}),jb.component("action.runFEMethod",{type:"action",description:"cab be activated in frontEnd only with $cmp variable",macroByValue:!0,params:[{id:"method",as:"string",dynamic:!0},{id:"data",defaultValue:"%%",dynamic:!0},{id:"vars",dynamic:!0}],impl:(e,t,a,n)=>e.vars.cmp&&e.vars.cmp.runFEMethod(t(),a(),n())}),jb.component("sink.BEMethod",{type:"rx",category:"sink",macroByValue:!0,params:[{id:"method",as:"string",dynamic:!0},{id:"data",defaultValue:({data:e})=>e instanceof Event?null:e,dynamic:!0},{id:"vars",dynamic:!0}],impl:sink.action((e,{},{method:t,data:a,vars:n})=>jb.ui.runBEMethodInAnyContext(e,t(e),a(e),n(e)))}),jb.component("sink.FEMethod",{type:"rx",category:"sink",macroByValue:!0,params:[{id:"method",as:"string",dynamic:!0},{id:"data",defaultValue:"%%",dynamic:!0},{id:"vars",dynamic:!0}],impl:sink.action((e,{cmp:t},{method:a,data:n,vars:i})=>t&&t.runFEMethod(a(e),n(e),i(e)))}),jb.component("action.refreshCmp",{type:"action",description:"can be activated on both FE & BE, assuming $cmp variable",params:[{id:"state",dynamic:!0},{id:"options",dynamic:!0}],impl:(e,t,a)=>{const n=e.vars.cmp,i=a(e),r=t(e);jb.log("refresh uiComp",{cmp:n,ctx:e,state:r,options:i}),n&&n.refresh(r,{srcCtx:e,...i})}}),jb.component("sink.refreshCmp",{type:"rx",description:"can be activated on both FE & BE, assuming $cmp variable",params:[{id:"state",dynamic:!0},{id:"options",dynamic:!0}],impl:sink.action(action.refreshCmp("%$state()%","%$options()%"))}),jb.component("frontEnd.method",{type:"feature",category:"front-end",description:"register as front end method, the context is limited to cmp & state. can be run with cmp.runFEMetod(id,data,vars)",params:[{id:"method",as:"string"},{id:"action",type:"action",mandatory:!0,dynamic:!0}],impl:(e,t,a)=>({frontEndMethod:{method:t,path:e.path,action:a.profile}})}),jb.component("frontEnd.enrichUserEvent",{type:"feature",category:"front-end",description:"the result is assigned to userEvent, can use %$cmp%, %$ev%, %$userEvent%",params:[{id:"action",type:"action",mandatory:!0,dynamic:!0}],impl:(e,t)=>({frontEndMethod:{method:"enrichUserEvent",path:e.path,action:t.profile}})}),jb.component("frontEnd.onRefresh",{type:"feature",category:"front-end",description:"rerun on frontend when after refresh is activated",params:[{id:"action",type:"action",mandatory:!0,dynamic:!0}],impl:(e,t)=>({frontEndMethod:{method:"onRefresh",path:e.path,action:t.profile}})}),jb.component("frontEnd.init",{type:"feature",category:"front-end",description:"initializes the front end, mount, component did update. runs after props",params:[{id:"action",type:"action",mandatory:!0,dynamic:!0}],impl:(e,t)=>({frontEndMethod:{method:"init",path:e.path,action:t.profile}})}),jb.component("frontEnd.prop",{type:"feature",category:"front-end",description:"assign front end property (calculated using the limited FE context). runs before init",params:[{id:"id",as:"string",mandatory:!0},{id:"value",mandatory:!0,dynamic:!0}],impl:(e,t,a)=>({frontEndMethod:{method:"calcProps",path:e.path,_prop:t,action:(e,{cmp:n})=>n[t]=a(e)}})}),jb.component("frontEnd.onDestroy",{type:"feature",description:"destructs the front end",params:[{id:"action",type:"action",mandatory:!0,dynamic:!0}],impl:(e,t)=>({frontEndMethod:{method:"destroy",path:e.path,action:t.profile}})}),jb.component("source.frontEndEvent",{type:"rx",category:"source",description:"assumes cmp in context",params:[{id:"event",as:"string",options:"load,blur,change,focus,keydown,keypress,keyup,click,dblclick,mousedown,mousemove,mouseup,mouseout,mouseover,scroll"}],impl:rx.pipe(source.event("%$event%","%$cmp.base%"),rx.takeUntil("%$cmp.destroyed%"))}),jb.component("frontEnd.addUserEvent",{type:"rx",impl:rx.var("ev",({data:e})=>jb.ui.buildUserEvent(e,jb.ui.closestCmpElem(e.currentTarget||e.target)))}),jb.component("frontEnd.flow",{type:"feature",category:"front-end",description:"rx flow at front end",params:[{id:"elems",type:"rx[]",as:"array",dynamic:!0,mandatory:!0,templateValue:[]}],impl:(e,t)=>({frontEndMethod:{method:"init",path:e.path,_flow:t.profile,action:rx.pipe(e=>t(e))}})}),jb.component("feature.onHover",{type:"feature",description:"on mouse enter",category:"events",params:[{id:"action",type:"action",mandatory:!0,dynamic:!0},{id:"onLeave",type:"action",mandatory:!0,dynamic:!0}],impl:features(method("onHover","%$action()%"),method("onLeave","%$onLeave()%"),frontEnd.flow(source.frontEndEvent("mouseenter"),sink.BEMethod("onHover")),frontEnd.flow(source.frontEndEvent("mouseleave"),sink.BEMethod("onLeave")))}),jb.component("feature.classOnHover",{type:"feature",description:"set css class on mouse enter",category:"events",params:[{id:"clz",type:"string",defaultValue:"item-hover",description:"css class to add/remove on hover"}],impl:features(frontEnd.flow(source.frontEndEvent("mouseenter"),sink.action(({},{cmp:e},{clz:t})=>jb.ui.addClass(e.base,t))),frontEnd.flow(source.frontEndEvent("mouseleave"),sink.action(({},{cmp:e},{clz:t})=>jb.ui.removeClass(e.base,t))))}),jb.component("key.eventMatchKey",{type:"boolean",params:[{id:"event"},{id:"key",as:"string",description:"E.g., a,27,Enter,Esc,Ctrl+C or Alt+V"}],impl:(e,t,a)=>{if(jb.log("keyboard search eventMatchKey",{e:t,key:a}),!a)return;const n=(a=a.replace(/-/,"+")).split("+").pop();let i={tab:9,delete:46,tab:9,esc:27,enter:13,right:39,left:37,up:38,down:40}[n.toLowerCase()];return+n&&(i=+n),1==n.length&&(i=n.charCodeAt(0)),a.match(/^[Cc]trl/)&&!t.ctrlKey||a.match(/^[Aa]lt/)&&!t.altKey?void 0:(jb.log(`keyboard ${t.keyCode==i?"found":"notFound"} eventMatchKey`,{e:t,key:a,eventKey:t.keyCode,keyCode:i}),t.keyCode==i)}}),jb.component("key.eventToMethod",{type:"boolean",params:[{id:"event"},{id:"elem"}],impl:(e,t,a)=>{a.keysHash=a.keysHash||function(){const e=a.getAttribute("methods").split(",").map(e=>e.split("-")[0]).filter(e=>0==e.indexOf("onKey")).map(e=>e.slice(5).slice(0,-7)),t={tab:9,delete:46,tab:9,esc:27,enter:13,right:39,left:37,up:38,down:40};return e.map(e=>{const a=e.replace(/-/,"+"),n=a.split("+").pop();let i=t[n.toLowerCase()];return+n&&(i=+n),1==n.length&&(i=n.charCodeAt(0)),{keyCode:i,ctrl:!!a.match(/^[Cc]trl/),alt:!!a.match(/^[Aa]lt/),methodName:`onKey${e}Handler`}})}(),jb.log("keyboard search eventToMethod",{elem:a,event:t});const n=a.keysHash.find(e=>e.keyCode==t.keyCode&&t.ctrlKey==e.ctrl&&t.altKey==e.alt),i=n&&n.methodName;return jb.log(`keyboard ${n?"found":"notFound"} eventToMethod`,{resMethod:i,elem:a,event:t}),i}}),jb.component("feature.onKey",{type:"feature",category:"events",params:[{id:"key",as:"string",description:"E.g., a,27,Enter,Esc,Ctrl+C or Alt+V"},{id:"action",type:"action",mandatory:!0,dynamic:!0}],impl:features(method(replace({find:"-",replace:"+",text:"onKey%$key%Handler",useRegex:!0}),call("action")),frontEnd.init((e,{cmp:t,el:a})=>{t.hasOnKeyHanlder||(t.hasOnKeyHanlder=!0,e.run(rx.pipe(source.frontEndEvent("keydown"),frontEnd.addUserEvent(),rx.map(key.eventToMethod("%%",a)),rx.filter("%%"),rx.log("keyboard uiComp onKey %$key%"),sink.BEMethod("%%"))))}))}),jb.component("feature.keyboardShortcut",{type:"feature",category:"events",params:[{id:"key",as:"string",description:"e.g. Alt+C"},{id:"action",type:"action",dynamic:!0}],impl:features(method(replace({find:"-",replace:"+",text:"onKey%$key%Handler",useRegex:!0}),call("action")),frontEnd.init((e,{cmp:t,el:a})=>{t.hasDocOnKeyHanlder||(t.hasDocOnKeyHanlder=!0,e.run(rx.pipe(source.frontEndEvent("keydown"),rx.map(key.eventToMethod("%%",a)),rx.filter("%%"),rx.log("keyboardShortcut keyboard uiComp run handler"),sink.BEMethod("%%"))))}))}),jb.component("feature.globalKeyboardShortcut",{type:"feature",category:"events",description:"listen to events at the document level even when the component is not active",params:[{id:"key",as:"string",description:"e.g. Alt+C"},{id:"action",type:"action",dynamic:!0}],impl:features(method(replace({find:"-",replace:"+",text:"onKey%$key%Handler",useRegex:!0}),call("action")),frontEnd.init((e,{cmp:t,el:a})=>{t.hasDocOnKeyHanlder||(t.hasDocOnKeyHanlder=!0,e.run(rx.pipe(source.event("keydown","%$cmp.base.ownerDocument%"),rx.takeUntil("%$cmp.destroyed%"),rx.map(key.eventToMethod("%%",a)),rx.filter("%%"),rx.log("keyboardShortcut keyboard uiComp run handler"),sink.BEMethod("%%"))))}))}),jb.component("feature.onEnter",{type:"feature",category:"events",params:[{id:"action",type:"action",mandatory:!0,dynamic:!0}],impl:feature.onKey("Enter",call("action"))}),jb.component("feature.onEsc",{type:"feature",category:"events",params:[{id:"action",type:"action[]",mandatory:!0,dynamic:!0}],impl:feature.onKey("Esc",call("action"))}),jb.component("frontEnd.selectionKeySourceService",{type:"feature",description:"assign cmp.selectionKeySource with observable for meta-keys, also stops propagation !!!",params:[{id:"autoFocs",as:"boolean"}],impl:features(service.registerBackEndService({id:"selectionKeySource",service:obj(prop("cmpId","%$cmp/cmpId%")),allowOverride:!0}),frontEnd.var("autoFocs","%$autoFocs%"),frontEnd.prop("selectionKeySource",(e,{cmp:t,el:a,autoFocs:n})=>{if(a.keydown_src)return;const{pipe:i,takeUntil:r,subject:o}=jb.callbag;return a.keydown_src=o(),a.onkeydown=t=>-1==[38,40,13,27].indexOf(t.keyCode)||(console.log("key source",t),a.keydown_src.next(e.dataObj(t)),!1),n&&jb.ui.focus(a,"selectionKeySource"),jb.log("register selectionKeySource",{cmp:t,cmp:t,el:a,ctx:e}),i(a.keydown_src,r(t.destroyed))}))}),jb.component("frontEnd.passSelectionKeySource",{type:"feature",impl:frontEnd.var("selectionKeySourceCmpId","%$$serviceRegistry/services/selectionKeySource/cmpId%")}),jb.component("source.findSelectionKeySource",{type:"rx",category:"source",description:'used in front end, works with "selectionKeySourceService" and "passSelectionKeySource"',impl:rx.pipe(Var("clientCmp","%$cmp%"),rx.merge(source.data([]),(e,{cmp:t,selectionKeySourceCmpId:a})=>{jb.log("keyboard search selectionKeySource",{cmp:t,selectionKeySourceCmpId:a,ctx:e});const n=jb.ui.elemOfCmp(e,a),i=jb.path(n,"_component.selectionKeySource");return i?jb.log("keyboard found selectionKeySource",{cmp:t,el:n,selectionKeySourceCmpId:a,ctx:e}):jb.log("keyboard selectionKeySource notFound",{cmp:t,selectionKeySourceCmpId:a,el:n,ctx:e}),i}),rx.takeUntil("%$clientCmp.destroyed%"),rx.var("cmp","%$clientCmp%"),rx.log("keyboard from selectionKeySource"))});var{css:css}=jb.ns("css");!function(){const e=jb.ui.withUnits,t=jb.ui.fixCssLine;jb.component("css",{description:"e.g. {color: red; width: 20px} or div>.myClas {color: red} ",type:"feature,dialog-feature",params:[{id:"css",mandatory:!0,dynamic:!0,as:"string"}],impl:(e,a)=>({css:e=>t(a(e))})}),jb.component("css.class",{type:"feature,dialog-feature",params:[{id:"class",mandatory:!0,as:"string"}],impl:(e,t)=>({class:t})}),jb.component("css.width",{type:"feature,dialog-feature",params:[{id:"width",mandatory:!0,as:"string",description:"e.g. 200, 100%, calc(100% - 100px)"},{id:"overflow",as:"string",options:",auto,hidden,scroll"},{id:"minMax",as:"string",options:",min,max"},{id:"selector",as:"string"}],impl:(t,a,n,i)=>({css:`${t.params.selector} { ${i?i+"-":""}width: ${e(a)} ${n?"; overflow-x:"+n+";":""} }`})}),jb.component("css.height",{type:"feature,dialog-feature",params:[{id:"height",mandatory:!0,as:"string",description:"e.g. 200, 100%, calc(100% - 100px)"},{id:"overflow",as:"string",options:",auto,hidden,scroll"},{id:"minMax",as:"string",options:",min,max"},{id:"selector",as:"string"}],impl:(t,a,n,i)=>({css:`${t.params.selector} { ${i?i+"-":""}height: ${e(a)} ${n?"; overflow-y:"+n:""} }`})}),jb.component("css.opacity",{type:"feature",params:[{id:"opacity",mandatory:!0,as:"string",description:"0-1"},{id:"selector",as:"string"}],impl:(e,t)=>({css:`${e.params.selector} { opacity: ${t} }`})}),jb.component("css.padding",{type:"feature,dialog-feature",params:[{id:"top",as:"string",description:"e.g. 20, 20%, 0.4em"},{id:"left",as:"string"},{id:"right",as:"string"},{id:"bottom",as:"string"},{id:"selector",as:"string"}],impl:t=>{const a=["top","left","right","bottom"].filter(e=>""!=t.params[e]).map(a=>`padding-${a}: ${e(t.params[a])}`).join("; ");return{css:`${t.params.selector} {${a}}`}}}),jb.component("css.margin",{type:"feature,dialog-feature",params:[{id:"top",as:"string",description:"e.g. 20, 20%, 0.4em, -20"},{id:"left",as:"string"},{id:"bottom",as:"string"},{id:"right",as:"string"},{id:"selector",as:"string"}],impl:t=>{const a=["top","left","right","bottom"].filter(e=>null!=t.params[e]).map(a=>`margin-${a}: ${e(t.params[a])}`).join("; ");return{css:`${t.params.selector} {${a}}`}}}),jb.component("css.marginAllSides",{type:"feature,dialog-feature",params:[{id:"value",as:"string",mandatory:!0,description:"e.g. 20, 20%, 0.4em"},{id:"selector",as:"string"}],impl:(t,a,n)=>({css:`${n} margin: ${e(a)}`})}),jb.component("css.marginVerticalHorizontal",{type:"feature,dialog-feature",params:[{id:"vertical",as:"string",mandatory:!0},{id:"horizontal",as:"string",mandatory:!0},{id:"selector",as:"string"}],impl:(t,a,n,i)=>({css:`${i} margin: ${e(a)+" "+e(n)}`})}),jb.component("css.transformRotate",{type:"feature",params:[{id:"angle",as:"string",description:"0-360"},{id:"selector",as:"string"}],impl:(e,t,a)=>({css:`${a} {transform:rotate(${t}deg)}`})}),jb.component("css.color",{type:"feature",params:[{id:"color",as:"string",dynamic:!0},{id:"background",as:"string",editAs:"color",dynamic:!0},{id:"selector",as:"string"}],impl:e=>{const t=["color","background"].filter(t=>e.params[t](e)).map(t=>`${t}: ${e.params[t](e)}`).join("; ");return t&&{css:`${e.params.selector} {${t}}`}}}),jb.component("css.transformScale",{type:"feature",params:[{id:"x",as:"string",description:"0-1"},{id:"y",as:"string",description:"0-1"},{id:"selector",as:"string"}],impl:e=>({css:`${e.params.selector} {transform:scale(${e.params.x},${e.params.y})}`})}),jb.component("css.transformTranslate",{type:"feature",description:"margin, move, shift, offset",params:[{id:"x",as:"string",description:"10px",defaultValue:"0"},{id:"y",as:"string",description:"20px",defaultValue:"0"},{id:"selector",as:"string"}],impl:t=>({css:`${t.params.selector} {transform:translate(${e(t.params.x)},${e(t.params.y)})}`})}),jb.component("css.bold",{type:"feature",impl:e=>({css:"{font-weight: bold}"})}),jb.component("css.underline",{type:"feature",impl:e=>({css:"{text-decoration: underline}"})}),jb.component("css.boxShadow",{type:"feature,dialog-feature",params:[{id:"blurRadius",as:"string",templateValue:"5"},{id:"spreadRadius",as:"string",templateValue:"0"},{id:"shadowColor",as:"string",templateValue:"#000000"},{id:"opacity",as:"string",templateValue:.5,description:"0-1"},{id:"horizontal",as:"string",templateValue:"10"},{id:"vertical",as:"string",templateValue:"10"},{id:"selector",as:"string"}],impl:(t,a,n,i,r,o,s,l)=>{const c=[parseInt(i.slice(1,3),16)||0,parseInt(i.slice(3,5),16)||0,parseInt(i.slice(5,7),16)||0].join(",");return{css:`${l} { box-shadow: ${e(o)} ${e(s)} ${e(a)} ${e(n)} rgba(${c},${r}) }`}}}),jb.component("css.border",{type:"feature,dialog-feature",params:[{id:"width",as:"string",defaultValue:"1"},{id:"side",as:"string",options:"top,left,bottom,right"},{id:"style",as:"string",options:"solid,dotted,dashed,double,groove,ridge,inset,outset",defaultValue:"solid"},{id:"color",as:"string",defaultValue:"black"},{id:"selector",as:"string"}],impl:(t,a,n,i,r,o)=>({css:`${o} { border${n?"-"+n:""}: ${e(a)} ${i} ${r} }`})}),jb.component("css.borderRadius",{type:"feature,dialog-feature",params:[{id:"radius",as:"string",defaultValue:"5"},{id:"selector",as:"string"}],impl:(t,a,n)=>({css:`${n} { border-radius: ${e(a)}}`})}),jb.component("css.lineClamp",{type:"feature",description:"ellipsis after X lines",params:[{id:"lines",mandatory:!0,as:"string",templateValue:3,description:"no of lines to clump"},{id:"selector",as:"string"}],impl:css("%$selector% { overflow: hidden; text-overflow: ellipsis; -webkit-box-orient: vertical; display: -webkit-box; -webkit-line-clamp: %$lines% }")}),jb.component("css.valueOfCssVar",{description:"value of css variable --var under element",params:[{id:"varName",description:"without the -- prefix"},{id:"parent",description:"html element under which to check the var, default is document.body"}],impl:(e,t,a)=>jb.ui.valueOfCssVar(t,a)}),jb.component("css.conditionalClass",{type:"feature",description:"toggle class by condition",params:[{id:"cssClass",as:"string",mandatory:!0,dynamic:!0},{id:"condition",type:"boolean",mandatory:!0,dynamic:!0}],impl:(e,t,a)=>({templateModifier:(e,n)=>(jb.toboolean(a(n.ctx))&&e.addClass(t()),e)})}),["layout","typography","detailedBorder","detailedColor","gridArea"].forEach(e=>jb.component(`css.${e}`,{type:"feature:0",params:[{id:"css",mandatory:!0,as:"string"}],impl:(e,a)=>({css:t(a)})}))}();var{text:text,firstSucceeding:firstSucceeding,customStyle:customStyle,styleByControl:styleByControl,controlWithFeatures:controlWithFeatures}=jb.ns("text");jb.component("text",{type:"control",category:"control:100,common:100",params:[{id:"text",as:"ref",mandatory:!0,templateValue:"my text",dynamic:!0},{id:"title",as:"ref",mandatory:!0,templateValue:"my title",dynamic:!0},{id:"style",type:"text.style",defaultValue:text.span(),dynamic:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e)}),jb.component("label",{...jb.comps.text,type:"depricated-control"}),jb.component("text.bindText",{type:"feature",category:"text:0",impl:features(watchAndCalcModelProp({prop:"text",transformValue:({data:e})=>jb.ui.toVdomOrStr(e)}),()=>({studioFeatures:{$:"feature.contentEditable",param:"text"}}))}),jb.component("text.allowAsynchValue",{type:"feature",description:"allows a text value to be reactive or promise",params:[{id:"propId",defaultValue:"text"}],impl:features(calcProp("%$propId%",firstSucceeding("%$$state/{%$propId%}%","%$$props/{%$propId%}%")),followUp.flow(source.any(If("%$$state/{%$propId%}%","","%$$props/{%$propId%}%")),rx.log("followUp allowAsynchValue"),rx.map(({data:e})=>jb.ui.toVdomOrStr(e)),sink.refreshCmp(e=>e.run(obj(prop("%$propId%","%%"))))))}),jb.component("text.highlight",{type:"data",macroByValue:!0,params:[{id:"base",as:"string",dynamic:!0},{id:"highlight",as:"string",dynamic:!0},{id:"cssClass",as:"string",defaultValue:"mdl-color-text--deep-purple-A700"}],impl:(e,t,a,n)=>{const i=a(),r=t();if(!i||!r)return r;const o=(r.match(new RegExp(i,"i"))||[])[0];return o?jb.ui.h("div",{},[r.split(o)[0],jb.ui.h("span",{class:n},o),r.split(o).slice(1).join(o)]):r}});var{group:group,layout:layout,tabs:tabs,controlWithCondition:controlWithCondition}=jb.ns("group,layout,tabs,controlWithCondition");jb.component("group",{type:"control",category:"group:100,common:90",params:[{id:"title",as:"string",dynamic:!0},{id:"layout",type:"layout"},{id:"style",type:"group.style",defaultValue:group.div(),mandatory:!0,dynamic:!0},{id:"controls",type:"control[]",mandatory:!0,flattenArray:!0,dynamic:!0,composite:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e,e.params.layout)}),jb.component("group.initGroup",{type:"feature",category:"group:0",impl:calcProp("ctrls",(e,{$model:t})=>t.controls(e).filter(e=>e))}),jb.component("inlineControls",{type:"control",description:"controls without a wrapping group",params:[{id:"controls",type:"control[]",mandatory:!0,flattenArray:!0,dynamic:!0,composite:!0}],impl:e=>e.params.controls().filter(e=>e)}),jb.component("dynamicControls",{type:"control",description:"calculated controls by data items without a wrapping group",params:[{id:"controlItems",type:"data",as:"array",mandatory:!0,dynamic:!0},{id:"genericControl",type:"control",mandatory:!0,dynamic:!0},{id:"itemVariable",as:"string",defaultValue:"controlItem"},{id:"indexVariable",as:"string"}],impl:(e,t,a,n,i)=>(t()||[]).map((t,r)=>jb.tosingle(a(e.setVar(n,t).setVar(i,r).setData(t))))}),jb.component("group.firstSucceeding",{type:"feature",category:"group:70",description:"Used with controlWithCondition. Takes the fhe first succeeding control",impl:calcProp({id:"ctrls",value:(e,{$model:t})=>{const a=t.controls.runCtx.setVars(e.vars);return[jb.asArray(t.controls.profile).reduce((e,t,n)=>e||a.runInner(t,{},`controls~${n}`),null)]},priority:5})}),jb.component("controlWithCondition",{type:"control",description:"Used with group.firstSucceeding",category:"group:10",macroByValue:!0,params:[{id:"condition",type:"boolean",dynamic:!0,mandatory:!0,as:"boolean"},{id:"control",type:"control",mandatory:!0,dynamic:!0},{id:"title",as:"string"}],impl:(e,t,a)=>t(e)?a(e):null}),jb.component("group.wait",{type:"feature",category:"group:70",description:"wait for asynch data before showing the control",params:[{id:"for",mandatory:!0,dynamic:!0,description:"a promise or rx"},{id:"loadingControl",type:"control",defaultValue:text("loading ..."),dynamic:!0},{id:"error",type:"control",defaultValue:text("error: %$error%"),dynamic:!0},{id:"varName",as:"string",description:"variable for the promise result"},{id:"passRx",as:"boolean",description:"do not wait for reactive data to end, and pass it as is"}],impl:features(calcProp({id:"ctrls",value:(e,{cmp:t},{loadingControl:a,error:n})=>{const i=t.state.error?n():a(e);return"itemlist"==t.ctx.profile.$?[[i]]:[i]},priority:e=>jb.path(e.vars.$state,"dataArrived")?0:10}),followUp.action((e,{cmp:t},{varName:a,passRx:n})=>!t.state.dataArrived&&!t.state.error&&Promise.resolve(jb.toSynchArray(e.cmpCtx.params.for(),!n)).then(n=>t.refresh({dataArrived:!0},{srcCtx:e.cmpCtx,extendCtx:e=>e.setVar(a,n).setData(n)})).catch(e=>t.refresh({error:JSON.stringify(e)}))))}),jb.component("group.eliminateRecursion",{type:"feature",description:"can be put on a global top group",params:[{id:"maxDepth",as:"number"}],impl:(e,t)=>{const a=e.cmpCtx.cmpCtx.path;if(e.callStack().filter(e=>e&&-1!=e.indexOf(a)).length>t)return e.run(calcProp({id:"ctrls",value:()=>[],phase:1,priority:100}))}});var{html:html}=jb.ns("html");jb.component("html",{type:"control",description:"rich text",category:"control:100,common:80",params:[{id:"html",as:"ref",mandatory:!0,templateValue:"<p>html here</p>",dynamic:!0},{id:"title",as:"string",mandatory:!0,templateValue:"html",dynamic:!0},{id:"style",type:"html.style",defaultValue:html.plain(),dynamic:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e)}),jb.component("html.plain",{type:"html.style",impl:customStyle({template:(e,{html:t},a)=>a("div",{$html:(t||"").replace(/^(<[a-z0-9]*)/,'$1 jb_external="true"')}),features:[watchAndCalcModelProp("html"),()=>({studioFeatures:{$:"feature.contentEditable",param:"html"}})]})}),jb.component("html.inIframe",{type:"html.style",params:[{id:"width",as:"string",defaultValue:"100%"},{id:"height",as:"string",defaultValue:"100%"}],impl:customStyle({template:(e,{width:t,height:a},n)=>n("iframe",{sandbox:"allow-same-origin allow-forms allow-scripts",frameborder:0,width:t,height:a,src:"javascript: document.write(parent.contentForIframe)"}),features:[frontEnd.var("html","%$$model/html()%"),frontEnd.init(({},{html:e})=>window.contentForIframe=e)]})});var{image:image,pipeline:pipeline}=jb.ns("image,css");jb.component("image",{type:"control,image",category:"control:50,common:70",params:[{id:"url",as:"string",mandatory:!0,templateValue:"https://freesvg.org/img/UN-CONSTRUCTION-2.png"},{id:"width",as:"string",mandatory:!0,templateValue:"100",description:"e.g: 100, 20%"},{id:"height",as:"string",mandatory:!0,description:"e.g: 100, 20%"},{id:"resize",type:"image.resize",description:"background-size, resize the image",defaultValue:image.fullyVisible()},{id:"position",type:"image.position",description:"move/shift image"},{id:"style",type:"image.style",dynamic:!0,defaultValue:image.background()},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e,{studioFeatures:{$:"feature.contentEditable"}})}),jb.component("image.widthHeight",{type:"image.resize",description:"fixed size or precentage of the original",params:[{id:"width",as:"string",description:"e.g: 100, 20%"},{id:"height",as:"string",description:"e.g: 100, 20%"}],impl:(e,t,a)=>[jb.ui.withUnits(t)||"auto",jb.ui.withUnits(a)||"auto"].join(" ")}),jb.component("image.cover",{description:"auto resize or crop to cover all area",type:"image.resize",impl:"cover"}),jb.component("image.fullyVisible",{description:"contain, auto resize to ensure the image is fully visible",type:"image.resize",impl:"contain"}),jb.component("image.position",{description:"offset move shift original image",type:"image.position",params:[{id:"x",as:"string",description:"e.g. 7, 50%, right"},{id:"y",as:"string",description:"e.g. 10, 50%, bottom"}],impl:(e,t,a)=>[t&&`x: ${jb.ui.withUnits(t)}`,a&&`y: ${jb.ui.withUnits(a)}`].filter(e=>e).map(e=>`background-position-${e}`).join(";")}),jb.component("image.background",{type:"image.style",impl:customStyle({template:(e,t,a)=>a("div"),css:pipeline(Var("url",(e,{$model:t})=>t.url.replace(/__WIDTH__/,t.width).replace(/__HEIGHT__/,t.height)),Var("width",(e,{$model:t})=>jb.ui.withUnits(t.width)),Var("height",(e,{$model:t})=>jb.ui.withUnits(t.height)),"\n      {\n          background-image: url('%$url%');\n          {? background-size: %$$model/resize%; ?}\n          {? %$$model/position%; ?}\n          background-repeat: no-repeat;\n          {?width: %$width%; ?}\n          {?height: %$height%; ?}\n      }")})}),jb.component("image.img",{type:"image.style",impl:customStyle({template:({},{url:e},t)=>t("img",{src:e}),css:pipeline(Var("width",(e,{$model:t})=>jb.ui.withUnits(t.width)),Var("height",(e,{$model:t})=>jb.ui.withUnits(t.height)),"\n      { \n          {?width: %$width%; ?}\n          {?height: %$height%; ?}\n      }"),features:calcProp("url")})});var{icon:icon,control:control}=jb.ns("icon,control");jb.component("control.icon",{type:"control",category:"control:50",params:[{id:"icon",as:"string",mandatory:!0},{id:"title",as:"string",dynamic:!0},{id:"type",as:"string",options:"mdi,mdc",defaultValue:"mdc"},{id:"size",as:"number",defaultValue:24},{id:"style",type:"icon.style",dynamic:!0,defaultValue:icon.material()},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e,features(calcProp("icon"),calcProp("type"),calcProp("title"),calcProp("size")))}),jb.component("icon",{type:"icon",params:[{id:"icon",as:"string",mandatory:!0},{id:"title",as:"string",dynamic:!0},{id:"type",as:"string",options:"mdi,mdc",defaultValue:"mdc"},{id:"style",type:"icon.style",dynamic:!0,defaultValue:icon.material()},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>e.params}),jb.component("icon.material",{type:"icon.style",impl:customStyle({template:(e,{icon:t,type:a,title:n,size:i},r)=>"mdc"==a?r("i",{class:"material-icons",title:n(),onclick:!0,style:{"font-size":`${i}px`,width:`${i}px`,height:`${i}px`}},t):r("div",{title:n(),onclick:!0,$html:`<svg width="24" height="24" jb_external="true" fill="currentColor" transform="scale(${i/24})"><path d="${jb.path(jb.ui,["MDIcons",t])}"/></svg>`})})}),jb.component("feature.icon",{type:"feature",category:"control:50",params:[{id:"icon",as:"string",mandatory:!0},{id:"title",as:"string",dynamic:!0},{id:"position",as:"string",options:",pre,post,raised",defaultValue:""},{id:"type",as:"string",options:"mdi,mdc",defaultValue:"mdc"},{id:"size",as:"number",defaultValue:24},{id:"style",type:"icon.style",dynamic:!0,defaultValue:icon.material()},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>({icon:jb.ui.ctrl(e,features(calcProp("icon"),calcProp("type"),calcProp("title"),calcProp("size"),calcProp("iconPosition","%$$model/position%")))})});var{button:button}=jb.ns("button");jb.component("button",{type:"control,clickable",category:"control:100,common:100",params:[{id:"title",as:"ref",mandatory:!0,templateValue:"click me",dynamic:!0},{id:"action",type:"action",mandatory:!0,dynamic:!0},{id:"style",type:"button.style",defaultValue:button.mdc(),dynamic:!0},{id:"raised",as:"boolean",dynamic:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e,features(watchAndCalcModelProp("title"),watchAndCalcModelProp("raised"),method("onclickHandler",(t,{cmp:a,ev:n})=>{jb.path(n,"ev.ctrlKey")?a.runBEMethod("ctrlAction",t.data,t.vars):jb.path(n,"ev.alyKey")?a.runBEMethod("altAction",t.data,t.vars):e.params.action(t)}),feature.userEventProps("ctrlKey,altKey"),()=>({studioFeatures:{$:"feature.contentEditable",param:"title"}})))}),jb.component("button.ctrlAction",{type:"feature",category:"button:70",description:"action to perform on control+click",params:[{id:"action",type:"action",mandatory:!0,dynamic:!0}],impl:method("ctrlAction",(e,{},{action:t})=>t(e))}),jb.component("button.altAction",{type:"feature",category:"button:70",description:"action to perform on alt+click",params:[{id:"action",type:"action",mandatory:!0,dynamic:!0}],impl:method("altAction",(e,{},{action:t})=>t(e))});var{field:field,validation:validation}=jb.ns("field,validation");!function(){function e(e,t,a,n){jb.val(e.vars.$model.databind(t.ctx))!=a&&(jb.writeValue(e.vars.$model.databind(t.ctx),a,e),jb.ui.checkValidationError(t,a,e),t.hasBEMethod("onValueChange")&&t.runBEMethod("onValueChange",a,e.vars),!n&&t.refresh({},{srcCtx:e.cmpCtx}))}jb.ui.field_id_counter=jb.ui.field_id_counter||0,jb.component("field.databind",{type:"feature",category:"field:0",params:[{id:"debounceTime",as:"number",defaultValue:0},{id:"oneWay",as:"boolean"}],impl:features(If("%$oneWay%",calcProp({id:"databind",value:"%$$model/databind()%",defaultValue:""}),watchAndCalcModelProp({prop:"databind",allowSelfRefresh:!0,defaultValue:""})),calcProp("title"),calcProp({id:"fieldId",value:()=>jb.ui.field_id_counter++}),method("writeFieldValue",(t,{cmp:a},{oneWay:n})=>e(t,a,t.data,n)),method("onblurHandler",(t,{cmp:a,ev:n},{oneWay:i})=>e(t,a,n.value,i)),method("onchangeHandler",(t,{$model:a,cmp:n,ev:i},{oneWay:r})=>!a.updateOnBlur&&e(t,n,i.value,r)),method("onkeyupHandler",(t,{$model:a,cmp:n,ev:i},{oneWay:r})=>!a.updateOnBlur&&e(t,n,i.value,r)),method("onkeydownHandler",(t,{$model:a,cmp:n,ev:i},{oneWay:r})=>!a.updateOnBlur&&e(t,n,i.value,r)),feature.byCondition("%$$dialog%",feature.initValue("%$$dialog/hasFields%",!0)))}),jb.ui.checkValidationError=(e,t,a)=>{const n=function(){if(!e.validations)return;const a=e.ctx.setData(t),n=(e.validations||[]).filter(e=>!e.validCondition(a)).map(e=>e.errorMessage(a))[0];a.exp("%$formContainer%")&&a.run(writeValue("%$formContainer/err%",n));return n}();e.state.error!=n&&(jb.log("field validation set error state",{cmp:e,err:n}),e.refresh({valid:!n,error:n},{srcCtx:a.cmpCtx}))},jb.ui.checkFormValidation=function(e){jb.ui.find(e,"[jb-ctx]").map(e=>e._component).filter(e=>e&&e.validations).forEach(e=>jb.ui.checkValidationError(e,jb.val(e.ctx.vars.$model.databind(e.ctx)),e.ctx))},jb.ui.fieldTitle=function(e,t,a){let n=t.field&&t.field()||t;if((n="function"==typeof n?n():n).titleCtrl){const t=e.ctx.setData(n).setVars({input:e.ctx.data}),i=n.titleCtrl(t);return i&&a(i,{"jb-ctx":jb.ui.preserveCtx(t)})}return n.title(e.ctx)},jb.ui.preserveFieldCtxWithItem=(e,t)=>{const a=jb.ctxDictionary[e.ctxId];return a&&jb.ui.preserveCtx(a.setData(t))},jb.component("field.onChange",{type:"feature",category:"field:100",description:"on picklist selection, text or boolean value change",params:[{id:"action",type:"action",dynamic:!0}],impl:followUp.onDataChange({ref:"%$$model/databind%",action:call("action")})}),jb.component("field.databindText",{type:"feature",category:"field:0",params:[{id:"debounceTime",as:"number",defaultValue:0},{id:"oneWay",type:"boolean",as:"boolean",defaultValue:!0}],impl:field.databind("%$debounceTime%","%$oneWay%")}),jb.component("validation",{type:"feature",category:"validation:100",params:[{id:"validCondition",mandatory:!0,as:"boolean",dynamic:!0,type:"boolean"},{id:"errorMessage",mandatory:!0,as:"string",dynamic:!0}],impl:(e,t,a)=>({validations:{validCondition:t,errorMessage:a}})}),jb.component("field.title",{description:"used to set table title in button and label",type:"feature",category:"table:80",params:[{id:"title",as:"string",dynamic:!0,mandatory:!0}],impl:(e,t)=>({enrichField:e=>e.title=e=>t(e)})}),jb.component("field.titleCtrl",{description:"title as control, buttons are usefull",type:"feature",category:"table:80",params:[{id:"titleCtrl",type:"control",mandatory:!0,dynamic:!0,templateValue:button({title:"%title%",style:button.href()})}],impl:(e,t)=>({enrichField:e=>e.titleCtrl=e=>t(e)})}),jb.component("field.columnWidth",{description:"used in itemlist fields",type:"feature",category:"table:80",params:[{id:"width",as:"number",mandatory:!0}],impl:(e,t)=>({enrichField:e=>e.width=t})})}();var{editableText:editableText}=jb.ns("editableText");jb.component("editableText",{type:"control",category:"input:100,common:80",params:[{id:"title",as:"string",dynamic:!0},{id:"databind",as:"ref",mandaroy:!0,dynamic:!0},{id:"updateOnBlur",as:"boolean",type:"boolean"},{id:"style",type:"editable-text.style",defaultValue:editableText.mdcInput(),dynamic:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e)}),jb.component("editableText.xButton",{type:"feature",impl:features(method("cleanValue",writeValue("%$$model/databind()%","")),templateModifier(({},{vdom:e,databind:t})=>jb.ui.h("div",{},[e,...t?[jb.ui.h("button",{class:"delete",onclick:"cleanValue"},"×")]:[]])),css(">.delete {\n          margin-left: -16px;\n          float: right;\n          cursor: pointer; font: 20px sans-serif;\n          border: none; background: transparent; color: #000;\n          text-shadow: 0 1px 0 #fff; opacity: .1;\n      }\n      { display : flex }\n      >.delete:hover { opacity: .5 }"))});var{editableBoolean:editableBoolean,refreshIfNotWatchable:refreshIfNotWatchable}=jb.ns("editableBoolean");jb.component("editableBoolean",{type:"control",category:"input:20",params:[{id:"databind",as:"ref",type:"boolean",mandaroy:!0,dynamic:!0},{id:"style",type:"editable-boolean.style",defaultValue:editableBoolean.checkbox(),dynamic:!0},{id:"title",as:"string",dynamic:!0},{id:"textForTrue",as:"string",defaultValue:"yes",dynamic:!0},{id:"textForFalse",as:"string",defaultValue:"no",dynamic:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e,features(calcProp("toggleText",If("%$$model/databind()%","%$$model/textForTrue()%","%$$model/textForFalse()%")),watchRef({ref:"%$$model/databind()%",allowSelfRefresh:!0,strongRefresh:!0}),method("toggle",runActions(writeValue("%$$model/databind()%",not("%$$model/databind()%")),refreshIfNotWatchable("%$$model/databind()%"))),method("toggleByKey",(e,{cmp:t,ev:a})=>27!=a.keyCode&&t.runBEMethod("toggle"))))});var{editableNumber:editableNumber}=jb.ns("editableNumber");jb.component("editableNumber",{type:"control",category:"input:30",params:[{id:"databind",as:"ref",mandaroy:!0,dynamic:!0},{id:"title",as:"string",dynamic:!0},{id:"style",type:"editable-number.style",defaultValue:editableText.mdcInput(),dynamic:!0},{id:"symbol",as:"string",description:"leave empty to parse symbol from value"},{id:"min",as:"number",defaultValue:0},{id:"max",as:"number",defaultValue:10},{id:"displayString",as:"string",dynamic:!0,defaultValue:"%$Value%%$Symbol%"},{id:"dataString",as:"string",dynamic:!0,defaultValue:"%$Value%%$Symbol%"},{id:"autoScale",as:"boolean",defaultValue:!0,description:"adjust its scale if at edges",type:"boolean"},{id:"step",as:"number",defaultValue:1,description:"used by slider"},{id:"initialPixelsPerUnit",as:"number",description:"used by slider"},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>{return jb.ui.ctrl(e.setVars({editableNumber:new class{constructor(e){Object.assign(this,e),null==this.min&&(this.min=NaN),null==this.max&&(this.max=NaN)}numericPart(e){if("number"==typeof e)return e;if(""==e)return NaN;var t=(""+e).match(/([^0-9\.\-]*)([0-9\.\-]+)([^0-9\.\-]*)/);return t&&(this.symbol=t[1]||t[3]),+(t&&t[2])}calcDisplayString(e,t){return isNaN(e)?this.placeholder||"":this.displayString(t.setVars({Value:""+e,Symbol:this.symbol}))}calcDataString(e,t){return isNaN(e)?"":this.dataString(t.setVars({Value:""+e,Symbol:this.symbol}))}keepInDomain(e){return Math.min(this.max,Math.max(this.min,e))}}(e.params)}))}});var{openDialog:openDialog,dialog:dialog,dialogs:dialogs,dialogFeature:dialogFeature,and:and,or:or,runActionOnItems:runActionOnItems,getSessionStorage:getSessionStorage,userStateProp:userStateProp}=jb.ns("dialog,dialogs,openDialog,dialogFeature");jb.component("openDialog",{type:"action,has-side-effects",params:[{id:"title",as:"renderable",dynamic:!0},{id:"content",type:"control",dynamic:!0,templateValue:group(),defaultValue:text("")},{id:"style",type:"dialog.style",dynamic:!0,defaultValue:dialog.default()},{id:"menu",type:"control",dynamic:!0},{id:"onOK",type:"action",dynamic:!0},{id:"id",as:"string"},{id:"features",type:"dialog-feature[]",dynamic:!0}],impl:e=>{const t={id:e.params.id||`dlg-${e.id}`,launcherCmpId:e.exp("%$cmp/cmpId%")},a=e.setVars({$dialog:t,dialogData:{},formContainer:{err:""}});t.ctx=a,a.run(runActions(dialog.createDialogTopIfNeeded(),action.subjectNext(dialogs.changeEmitter(),obj(prop("open",!0),prop("dialog","%$$dialog%")))))}}),jb.component("openDialog.probe",{type:"control:0",params:jb.comps.openDialog.params,impl:e=>jb.ui.ctrl(e.setVar("$dialog",{}),dialog.init()).renderVdom()}),jb.component("dialog.init",{type:"feature",impl:features(calcProp("dummy",e=>jb.log("dialog init uiComp",{dialog:e.vars.$dialog,cmp:e.vars.cmp,ctx:e})),calcProp("title","%$$model/title()%"),calcProp("contentComp","%$$model/content%"),calcProp("hasMenu","%$$model/menu/profile%"),calcProp("menuComp","%$$model/menu%"),feature.initValue("%$$dialog/cmpId%","%$cmp/cmpId%"),htmlAttribute("id","%$$dialog/id%"),method("dialogCloseOK",dialog.closeDialog(!0)),method("dialogClose",dialog.closeDialog(!1)),css("z-index: 100"))}),jb.component("dialog.buildComp",{type:"control:0",params:[{id:"dialog",defaultValue:"%$$dialog%"}],impl:(e,t)=>jb.ui.ctrl(t.ctx,dialog.init())}),jb.component("dialog.createDialogTopIfNeeded",{type:"action",impl:e=>{const t=jb.ui.widgetBody(e);if(t.querySelector(":scope>.jb-dialogs"))return;const a=e.run(dialog.dialogTop()).renderVdomAndFollowUp();e.vars.headlessWidget&&t instanceof jb.ui.VNode?(t.children.push(a),a.parentNode=t,jb.log("dialog headless createTop",{vdom:a,widgetBody:t})):(jb.ui.render(a,t),jb.log("dialog dom createTop",{vdom:a,widgetBody:t}))}}),jb.component("dialog.closeDialog",{type:"action",description:"close parent dialog",params:[{id:"OK",type:"boolean",as:"boolean",defaultValue:!0}],impl:action.if("%$$dialog%",runActions(action.if(and("%$OK%","%$$dialog.hasFields%",(e,{$dialog:t})=>jb.ui.checkFormValidation&&jb.ui.checkFormValidation(jb.ui.elemOfCmp(e,t.cmpId)))),action.if(and("%$OK%",not("%$formContainer.err%")),(e,{$dialog:t})=>{jb.log("dialog onOK",{$dialog:t,ctx:e}),t.ctx.params.onOK(e)}),action.if(or(not("%$OK%"),not("%$formContainer.err%")),action.subjectNext(dialogs.changeEmitter(),obj(prop("close",!0),prop("dialogId","%$$dialog/id%"))))))}),jb.component("dialog.closeDialogById",{type:"action",description:"close dialog fast without checking validations and running onOK",params:[{id:"id",as:"string"}],impl:action.subjectNext(dialogs.changeEmitter(),obj(prop("close",!0),prop("dialogId","%$id%")))}),jb.component("dialog.closeAll",{type:"action",impl:runActionOnItems(dialog.shownDialogs(),dialog.closeDialogById("%%"))}),jb.component("dialog.closeAllPopups",{type:"action",impl:runActionOnItems(dialogs.shownPopups(),dialog.closeDialogById("%%"))}),jb.component("dialog.shownDialogs",{impl:e=>jb.ui.find(jb.ui.widgetBody(e),".jb-dialog").map(e=>e.getAttribute("id"))}),jb.component("dialog.isOpen",{params:[{id:"id",as:"string"}],impl:dialogs.cmpIdOfDialog("%$id%")}),jb.component("dialogs.cmpIdOfDialog",{params:[{id:"id",as:"string"}],impl:(e,t)=>jb.ui.find(jb.ui.widgetBody(e),`[id="${t}"]`).map(e=>e.getAttribute("cmp-id"))[0]}),jb.component("dialogs.shownPopups",{impl:e=>jb.ui.find(jb.ui.widgetBody(e),".jb-popup").map(e=>e.getAttribute("id"))}),jb.component("dialogFeature.modal",{description:"blocks all other screen elements",type:"dialog-feature",impl:features(frontEnd.init(()=>jb.ui.addHTML(document.body,'<div class="modal-overlay"></div>')),frontEnd.onDestroy(()=>Array.from(document.body.querySelectorAll(">.modal-overlay")).forEach(e=>document.body.removeChild(e))))}),jb.component("dialogFeature.uniqueDialog",{type:"dialog-feature",params:[{id:"id",as:"string"}],impl:If("%$id%",features(feature.initValue({to:"%$$dialog/id%",value:"%$id%",alsoWhenNotEmpty:!0}),followUp.flow(source.data(e=>jb.ui.find(jb.ui.widgetBody(e),".jb-dialog")),rx.filter(({data:e},{cmp:t},{id:a})=>e.getAttribute("id")==a&&e.getAttribute("cmp-id")!=t.cmpId),rx.map(({data:e})=>e.getAttribute("cmp-id")),rx.map(obj(prop("closeByCmpId",!0),prop("cmpId","%%"),prop("dialogId","%$id%"))),rx.log("dialog close uniqueDialog"),sink.subjectNext(dialogs.changeEmitter()))))}),jb.component("source.eventIncludingPreview",{type:"rx",params:[{id:"event",as:"string"}],impl:rx.merge(source.event("%$event%",()=>document),source.event("%$event%",()=>jb.path(jb.studio,"previewWindow.document")))}),jb.component("dialogFeature.dragTitle",{type:"dialog-feature",params:[{id:"id",as:"string"},{id:"useSessionStorage",as:"boolean"},{id:"selector",as:"string",defaultValue:".dialog-title"}],impl:features(calcProp("sessionStorageId","dialogPos-%$id%"),calcProp("posFromSessionStorage",If("%$useSessionStorage%",getSessionStorage("%$$props/sessionStorageId%"))),css("%$selector% { cursor: pointer; user-select: none }"),frontEnd.method("setPos",({data:e},{el:t})=>{t.style.top=e.top+"px",t.style.left=e.left+"px"}),frontEnd.var("selector","%$selector%"),frontEnd.var("useSessionStorage","%$useSessionStorage%"),frontEnd.var("sessionStorageId","%$$props/sessionStorageId%"),frontEnd.var("posFromSessionStorage","%$$props/posFromSessionStorage%"),frontEnd.init(({},{el:e,posFromSessionStorage:t})=>{t&&(e.style.top=t.top+"px",e.style.left=t.left+"px")}),frontEnd.prop("titleElem",({},{el:e,selector:t})=>e.querySelector(t)),frontEnd.flow(source.event("mousedown","%$cmp/titleElem%"),rx.takeUntil("%$cmp/destroyed%"),rx.var("offset",({data:e},{el:t})=>({left:e.clientX-t.getBoundingClientRect().left,top:e.clientY-t.getBoundingClientRect().top})),rx.flatMap(rx.pipe(source.eventIncludingPreview("mousemove"),rx.takeWhile("%buttons%!=0"),rx.var("ev"),rx.map(({data:e},{offset:t})=>({left:Math.max(0,e.clientX-t.left),top:Math.max(0,e.clientY-t.top)})))),sink.action(runActions(action.runFEMethod("setPos"),If("%$useSessionStorage%",action.setSessionStorage("%$sessionStorageId%","%%"))))))}),jb.component("dialog.default",{type:"dialog.style",impl:customStyle({template:({},{title:e,contentComp:t},a)=>a("div.jb-dialog jb-default-dialog",{},[a("div.dialog-title",{},e),a("button.dialog-close",{onclick:"dialogClose"},"×"),a(t)]),features:dialogFeature.dragTitle()})}),jb.component("dialogFeature.nearLauncherPosition",{type:"dialog-feature",params:[{id:"offsetLeft",as:"number",dynamic:!0,defaultValue:0},{id:"offsetTop",as:"number",dynamic:!0,defaultValue:0},{id:"rightSide",as:"boolean"}],impl:features(calcProp("launcherRectangle","%$ev/elem/clientRect%"),frontEnd.var("launcherRectangle","%$$props/launcherRectangle%"),frontEnd.var("launcherCmpId","%$$dialog/launcherCmpId%"),frontEnd.var("pos",({},{},{offsetLeft:e,offsetTop:t,rightSide:a})=>({offsetLeft:e()||0,offsetTop:t()||0,rightSide:a})),userStateProp("dialogPos",({},{ev:e,$props:t},{offsetLeft:a,offsetTop:n,rightSide:i})=>{if(!e)return{left:0,top:0};const r=a()||0,o=n()||0;return t.launcherRectangle?{left:t.launcherRectangle.left+r+(i?e.elem.outerWidth:0),top:t.launcherRectangle.top+o+e.elem.outerHeight}:{left:r+e.clientX||0,top:o+e.clientY||0}}),frontEnd.onRefresh(({},{$state:e,el:t})=>{const{top:a,left:n}=e.dialogPos||{top:0,left:0};t.style.top=`${a}px`,t.style.left=`${n}px`}),frontEnd.init((e,{cmp:t,pos:a,launcherCmpId:n,elemToTest:i})=>{if(!i&&n&&0==t.state.dialogPos.left&&0==t.state.dialogPos.top){const i=jb.ui.elemOfCmp(e,n);if(!i)return;const r=i.getBoundingClientRect(),o={left:r.left+a.offsetLeft+(a.rightSide?jb.ui.outerWidth(i):0),top:r.top+a.offsetTop+jb.ui.outerHeight(i)};0==o.left&&0==o.top||t.refreshFE({dialogPos:o})}}),frontEnd.init(({},{cmp:e,elemToTest:t})=>{if(t||0==e.state.dialogPos.left&&0==e.state.dialogPos.top)return;const a=jb.ui.findIncludeSelf(e.base,".jb-dialog")[0],n=e.state.dialogPos;let i,r;const o=jb.ui.outerHeight(a),s=jb.ui.outerWidth(a);n.top>o&&n.top+o+2>window.innerHeight+window.pageYOffset&&(i=n.top-o),n.left>s&&n.left+s+2>window.innerWidth+window.pageXOffset&&(r=n.left-s),(r||i)&&e.refreshFE({dialogPos:{top:i||n.top,left:r||n.left}})}))}),jb.component("dialogFeature.onClose",{type:"dialog-feature",params:[{id:"action",type:"action",dynamic:!0}],impl:onDestroy(call("action"))}),jb.component("dialogFeature.closeWhenClickingOutside",{type:"dialog-feature",impl:features(feature.initValue("%$$dialog.isPopup%",!0),frontEnd.flow(source.data(0),rx.delay(100),rx.flatMap(source.eventIncludingPreview("mousedown")),rx.takeUntil("%$cmp.destroyed%"),rx.filter(({data:e})=>null==jb.ui.closest(e.target,".jb-dialog")),rx.var("dialogId",({},{cmp:e})=>e.base.getAttribute("id")),sink.action(dialog.closeDialogById("%$dialogId%"))))}),jb.component("dialogFeature.autoFocusOnFirstInput",{type:"dialog-feature",params:[{id:"selectText",as:"boolean",type:"boolean"}],impl:features(frontEnd.var("selectText","%$selectText%"),frontEnd.init((e,{el:t,selectText:a})=>{const n=jb.ui.find(t,"input,textarea,select").filter(e=>"checkbox"!=e.getAttribute("type"))[0];n&&jb.ui.focus(n,"dialog-feature.auto-focus-on-first-input",e),a&&n.select()}))}),jb.component("dialogFeature.cssClassOnLaunchingElement",{type:"dialog-feature",description:'launching element toggles class "dialog-open" if the dialog is open',impl:features(frontEnd.prop("launchingElement",(e,{cmp:t})=>t.launchingCmp&&jb.ui.elemOfCmp(e,t.launchingCmp)),frontEnd.init(({},{cmp:e})=>e.launchingElement&&jb.ui.addClass(e.launchingElement,"dialog-open")),frontEnd.onDestroy(({},{cmp:e})=>e.launchingElement&&jb.ui.removeClass(e.launchingElement,"dialog-open")))}),jb.component("dialogFeature.maxZIndexOnClick",{type:"dialog-feature",params:[{id:"minZIndex",as:"number",defaultValue:100}],impl:features(frontEnd.var("minZIndex","%$minZIndex%"),frontEnd.method("setAsMaxZIndex",({},{el:e,minZIndex:t})=>{const a=Array.from(document.querySelectorAll(".jb-dialog")).filter(e=>!jb.ui.hasClass(e,"jb-popup")).reduce((e,t)=>Math.max(e,t&&parseInt(t.style.zIndex||100)+1||100),t||100);e.style.zIndex=a}),frontEnd.init(({},{cmp:e})=>{e.state.frontEndStatus="ready",e.runFEMethod("setAsMaxZIndex")}),frontEnd.flow(source.frontEndEvent("mousedown"),sink.FEMethod("setAsMaxZIndex")))}),jb.component("dialog.dialogOkCancel",{type:"dialog.style",params:[{id:"okLabel",as:"string",defaultValue:"OK"},{id:"cancelLabel",as:"string",defaultValue:"Cancel"}],impl:customStyle({template:(e,{title:t,contentComp:a,cancelLabel:n,okLabel:i},r)=>r("div.jb-dialog jb-default-dialog",{},[r("div.dialog-title",{},t),r("button.dialog-close",{onclick:"dialogClose"},"×"),r(a),r("div.dialog-buttons",{},[r("button.mdc-button",{onclick:"dialogClose"},[r("div.mdc-button__ripple"),r("span.mdc-button__label",{},n)]),r("button.mdc-button",{onclick:"dialogCloseOK"},[r("div.mdc-button__ripple"),r("span.mdc-button__label",{},i)])])]),css:">.dialog-buttons { display: flex; justify-content: flex-end; margin: 5px }",features:dialogFeature.maxZIndexOnClick()})}),jb.component("dialogFeature.resizer",{type:"dialog-feature",params:[{id:"autoResizeInnerElement",as:"boolean",description:'effective element with "autoResizeInDialog" class',type:"boolean"}],impl:features(templateModifier(({},{vdom:e})=>{e&&"div"==e.tag&&e.children.push(jb.ui.h("img.jb-resizer",{}))}),css(">.jb-resizer { cursor: pointer; position: absolute; right: 1px; bottom: 1px }"),frontEnd.var("autoResizeInnerElement","%$autoResizeInnerElement%"),frontEnd.method("setSize",({data:e},{cmp:t,el:a,autoResizeInnerElement:n})=>{a.style.height=e.top+"px",a.style.width=e.left+"px";const i=a.querySelector(".autoResizeInDialog");n&&i&&(t.innerElemOffset=t.innerElemOffset||i.getBoundingClientRect().top-a.getBoundingClientRect().top+(a.getBoundingClientRect().bottom-i.getBoundingClientRect().bottom),i.style.height=e.top-t.innerElemOffset+"px")}),frontEnd.prop("resizerElem",({},{cmp:e})=>e.base.querySelector(".jb-resizer")),frontEnd.flow(source.event("mousedown","%$cmp.resizerElem%"),rx.takeUntil("%$cmp.destroyed%"),rx.var("offset",({},{el:e})=>({left:e.getBoundingClientRect().left,top:e.getBoundingClientRect().top})),rx.flatMap(rx.pipe(source.eventIncludingPreview("mousemove"),rx.takeWhile("%buttons%!=0"),rx.map(({data:e},{offset:t})=>({left:Math.max(0,e.clientX-t.left),top:Math.max(0,e.clientY-t.top)})))),sink.FEMethod("setSize")))}),jb.component("dialog.popup",{type:"dialog.style",impl:customStyle({template:({},{contentComp:e},t)=>t("div.jb-dialog jb-popup",{},t(e)),css:"{ position: absolute; background: var(--jb-dropdown-bg); box-shadow: 2px 2px 3px var(--jb-dropdown-shadow); padding: 3px 0; border: 1px solid var(--jb-dropdown-border) }",features:[dialogFeature.maxZIndexOnClick(),dialogFeature.closeWhenClickingOutside(),dialogFeature.cssClassOnLaunchingElement(),dialogFeature.nearLauncherPosition()]})}),jb.component("dialog.transparent-popup",{type:"dialog.style",impl:customStyle({template:({},{contentComp:e},t)=>t("div.jb-dialog jb-popup",{},t(e)),css:"{ position: absolute; padding: 3px 0; }",features:[dialogFeature.maxZIndexOnClick(),dialogFeature.closeWhenClickingOutside(),dialogFeature.cssClassOnLaunchingElement(),dialogFeature.nearLauncherPosition()]})}),jb.component("dialog.div",{type:"dialog.style",impl:customStyle({template:({},{contentComp:e},t)=>t("div.jb-dialog jb-popup",{},t(e)),css:"{ position: absolute }"})}),jb.component("dialogs.changeEmitter",{type:"rx",params:[{id:"widgetId",defaultValue:"%$headlessWidgetId%"}],category:"source",impl:(e,t)=>{const a=!e.vars.previewOverlay&&t||"default";return jb.ui.dlgEmitters=jb.ui.dlgEmitters||{},jb.ui.dlgEmitters[a]=jb.ui.dlgEmitters[a]||e.run(rx.subject({replay:!0})),jb.ui.dlgEmitters[a]}}),jb.component("dialogs.destroyAllEmitters",{type:"action",impl:()=>Object.keys(jb.ui.dlgEmitters||{}).forEach(e=>{jb.ui.dlgEmitters[e].trigger.complete(),delete jb.ui.dlgEmitters[e]})}),jb.component("dialog.dialogTop",{type:"control",params:[{id:"style",type:"dialogs.style",defaultValue:dialogs.defaultStyle(),dynamic:!0}],impl:e=>jb.ui.ctrl(e)}),jb.component("dialogs.defaultStyle",{type:"dialogs.style",impl:customStyle({template:({},{},e)=>e("div.jb-dialogs"),features:[followUp.flow(source.subject(dialogs.changeEmitter()),rx.filter("%open%"),rx.var("dialogVdom",pipeline(dialog.buildComp("%dialog%"),"%renderVdomAndFollowUp()%")),rx.var("delta",obj(prop("children",obj(prop("toAppend",pipeline("%$dialogVdom%",({data:e})=>jb.ui.stripVdom(e))))))),rx.log("open dialog",obj(prop("dialogId","%dialog/id%"))),sink.applyDeltaToCmp("%$delta%","%$followUpCmp/cmpId%")),followUp.flow(source.subject(dialogs.changeEmitter()),rx.filter("%close%"),rx.var("dlgCmpId",dialogs.cmpIdOfDialog("%dialogId%")),rx.filter("%$dlgCmpId%"),rx.var("delta",obj(prop("children",obj(prop("deleteCmp","%$dlgCmpId%"))))),rx.log("close dialog",obj(prop("dialogId","%dialogId%"))),sink.applyDeltaToCmp("%$delta%","%$followUpCmp/cmpId%")),followUp.flow(source.subject(dialogs.changeEmitter()),rx.filter("%closeByCmpId%"),rx.var("delta",obj(prop("children",obj(prop("deleteCmp","%cmpId%"))))),rx.log("close dialog",obj(prop("dialogId","%dialogId%"))),sink.applyDeltaToCmp("%$delta%","%$followUpCmp/cmpId%"))]})});var{itemlist:itemlist}=jb.ns("itemlist,itemlistContainer");jb.component("itemlist",{description:"list, dynamic group, collection, repeat",type:"control",category:"group:80,common:80",params:[{id:"title",as:"string"},{id:"items",as:"array",dynamic:!0,mandatory:!0},{id:"controls",type:"control[]",mandatory:!0,dynamic:!0},{id:"style",type:"itemlist.style",dynamic:!0,defaultValue:itemlist.ulLi()},{id:"layout",type:"layout"},{id:"itemVariable",as:"string",defaultValue:"item"},{id:"visualSizeLimit",as:"number",defaultValue:100,description:"by default itemlist is limmited to 100 shown items"},{id:"features",type:"feature[]",dynamic:!0,flattenArray:!0}],impl:e=>jb.ui.ctrl(e,e.params.layout)}),jb.component("itemlist.noContainer",{type:"feature",category:"group:20",impl:()=>({extendCtx:e=>e.setVars({itemlistCntr:null})})}),jb.component("itemlist.init",{type:"feature",impl:features(calcProp("allItems","%$$model/items%"),calcProp("visualSizeLimit",({},{$model:e,$state:t})=>Math.max(e.visualSizeLimit,t.visualSizeLimit||0)),calcProp("items",itemlist.calcSlicedItems()),calcProp("ctrls",(e,{$model:t,$props:a})=>{return a.items.map((a,n)=>((a,n)=>t.controls(e.setVars({index:n+(e.vars.$baseIndex||0)}).setVar(t.itemVariable,a).setData(a)).filter(e=>e))(a,n+1)).filter(e=>e.length>0)}),calcProp({id:"updateItemlistCntr",value:action.if("%$itemlistCntr%",writeValue("%$itemlistCntr.items%","%$$props.items%")),phase:100}))});var{runActionOnItem:runActionOnItem,isRef:isRef,inGroup:inGroup,list:list}=jb.macro;jb.component("itemlist.selection",{type:"feature",params:[{id:"databind",as:"ref",defaultValue:"%$itemlistCntrData/selected%",dynamic:!0},{id:"selectedToDatabind",dynamic:!0,defaultValue:"%%"},{id:"databindToSelected",dynamic:!0,defaultValue:"%%"},{id:"onSelection",type:"action",dynamic:!0},{id:"onDoubleClick",type:"action",dynamic:!0},{id:"autoSelectFirst",type:"boolean"},{id:"cssForSelected",as:"string",defaultValue:"color: var(--jb-menubar-selection-fg); background: var(--jb-menubar-selection-bg)"}],impl:features(css(({},{},{cssForSelected:e})=>[">.selected",">*>.selected",">*>*>.selected"].map(t=>t+" "+jb.ui.fixCssLine(e)).join("\n")),userStateProp({id:"selected",value:(e,{$props:t,$state:a},{databind:n,autoSelectFirst:i,databindToSelected:r})=>{const o=a.selected&&jb.path(jb.ctxDictionary[a.selected],"data"),s=jb.val(n()),l=jb.val(null!=s&&r(e.setData(s))||o||i&&t.items[0]);return t.items.findIndex(e=>jb.val(e)==l)},phase:20}),templateModifier(({},{vdom:e,selected:t})=>{const a=e.querySelector(".jb-items-parent")||e,n=jb.path(a,`children.${t}`);n&&n.addClass("selected")}),method("onSelection",runActionOnItem(itemlist.indexToData(),runActions(If(isRef("%$databind()%"),writeValue("%$databind()%","%$selectedToDatabind()%")),call("onSelection")))),method("onDoubleClick",runActionOnItem(itemlist.indexToData(),runActions(If(isRef("%$databind()%"),writeValue("%$databind()%","%$selectedToDatabind()%")),call("onDoubleClick")))),followUp.flow(source.data("%$$props/selected%"),rx.filter(and("%$autoSelectFirst%",not("%$$state/refresh%"))),sink.BEMethod("onSelection")),frontEnd.method("applyState",({},{cmp:e})=>{Array.from(e.base.querySelectorAll(".jb-item.selected,*>.jb-item.selected,*>*>.jb-item.selected")).forEach(e=>e.classList.remove("selected"));const t=(e.base.querySelector(".jb-items-parent")||e.base).children[e.state.selected];t&&(t.classList.add("selected"),t.scrollIntoViewIfNeeded())}),frontEnd.method("setSelected",({data:e},{cmp:t})=>{t.base.state.selected=t.state.selected=e,t.runFEMethod("applyState")}),frontEnd.prop("selectionEmitter",rx.subject()),frontEnd.flow(source.frontEndEvent("dblclick"),rx.map(itemlist.indexOfElem("%target%")),rx.filter("%%"),sink.action(runActions(action.runFEMethod("setSelected"),action.runBEMethod("onDoubleClick")))),frontEnd.flow(rx.merge(rx.pipe(source.frontEndEvent("click"),rx.map(itemlist.indexOfElem("%target%")),rx.filter("%%")),source.subject("%$cmp/selectionEmitter%")),rx.distinctUntilChanged(),sink.action(runActions(action.runFEMethod("setSelected"),action.runBEMethod("onSelection")))))}),jb.component("itemlist.keyboardSelection",{type:"feature",macroByValue:!1,params:[{id:"autoFocus",type:"boolean"},{id:"onEnter",type:"action",dynamic:!0}],impl:features(htmlAttribute("tabIndex",0),method("onEnter",runActionOnItem(itemlist.indexToData(),call("onEnter"))),frontEnd.passSelectionKeySource(),frontEnd.prop("onkeydown",rx.merge(source.frontEndEvent("keydown"),source.findSelectionKeySource())),frontEnd.flow("%$cmp.onkeydown%",rx.filter("%keyCode%==13"),rx.filter("%$cmp.state.selected%"),sink.BEMethod("onEnter","%$cmp.state.selected%")),frontEnd.flow("%$cmp.onkeydown%",rx.filter(not("%ctrlKey%")),rx.filter(inGroup(list(38,40),"%keyCode%")),rx.map(itemlist.nextSelected(If("%keyCode%==40",1,-1))),rx.log("itemlist frontend nextSelected"),sink.subjectNext("%$cmp/selectionEmitter%")),frontEnd.var("autoFocus","%$autoFocus%"),frontEnd.init(If(and("%$autoFocus%","%$selectionKeySourceCmpId%"),action.focusOnCmp("itemlist autofocus"))))}),jb.component("itemlist.indexOfElem",{type:"data:0",description:"also supports multiple elements",params:[{id:"elem",defaultValue:"%%"}],impl:({},e)=>{const t=jb.ui.closest(e,".jb-item");return t&&jb.ui.indexOfElement(t)}}),jb.component("itemlist.indexToData",{type:"data:0",params:[{id:"index",as:"number",defaultValue:"%%"}],impl:(e,t)=>jb.val(jb.path(e.vars.cmp,"renderProps.items")||[])[t]}),jb.component("itemlist.findSelectionSource",{type:"data:0",impl:e=>{const{cmp:t,itemlistCntr:a}=e.vars,n=a&&a.selectionKeySourceCmp;return[jb.ui.parentCmps(t.base).find(e=>e.selectionKeySource),document.querySelector(`[ctxId="${n}"]`)].map(e=>e&&e._component&&e._component.selectionKeySource).filter(e=>e)[0]}}),jb.component("itemlist.nextSelected",{type:"data:0",params:[{id:"diff",as:"number"},{id:"elementFilter",dynamic:"true",defaultValue:!0}],impl:(e,t,a)=>{const{cmp:n}=e.vars,i=n.base.querySelector(".jb-items-parent")||n.base,r=Array.from(i.children).map((e,t)=>[e,t]).filter(([t])=>a(e.setData(t))).map(([e,t])=>t),o=r.indexOf(+n.state.selected)+t;return r[Math.min(r.length-1,Math.max(0,o))]}});var{move:move}=jb.macro;jb.component("itemlist.dragAndDrop",{type:"feature",impl:features(method("moveItem",runActions(move(itemlist.indexToData("%from%"),itemlist.indexToData("%to%")),action.refreshCmp())),frontEnd.prop("drake",({},{cmp:e})=>jb.frame.dragula?dragula([e.base.querySelector(".jb-items-parent")||e.base],{moves:(e,t,a)=>jb.ui.parents(a,{includeSelf:!0}).some(e=>jb.ui.hasClass(e,"drag-handle"))}):jb.logError("itemlist.dragAndDrop - the dragula lib is not loaded")),frontEnd.flow(source.dragulaEvent("drag",list("el")),rx.map(itemlist.indexOfElem("%el%")),rx.do(({},{cmp:e})=>Array.from(e.base.querySelectorAll(".jb-item,*>.jb-item,*>*>.jb-item")).forEach(e=>e.setAttribute("jb-original-index",jb.ui.indexOfElement(e)))),sink.subjectNext("%$cmp/selectionEmitter%")),frontEnd.flow(source.dragulaEvent("drop",list("dropElm","target","source","sibling")),rx.map(obj(prop("from",itemlist.indexOfElem("%dropElm%")),prop("to",itemlist.orignialIndexFromSibling("%sibling%")))),sink.BEMethod("moveItem")),frontEnd.flow(source.frontEndEvent("keydown"),rx.filter("%ctrlKey%"),rx.filter(inGroup(list(38,40),"%keyCode%")),rx.map(obj(prop("from",itemlist.nextSelected(0)),prop("to",itemlist.nextSelected(If("%keyCode%==40",1,-1))))),sink.BEMethod("moveItem")))}),jb.component("source.dragulaEvent",{type:"rx:0",params:[{id:"event",as:"string"},{id:"argNames",as:"array",description:"e.g., ['dropElm', 'target', 'source']"}],impl:source.callbag(({},{cmp:e},{event:t,argNames:a})=>jb.callbag.create(n=>e.drake.on(t,(...e)=>n(jb.objFromEntries(e.map((e,t)=>[a[t],e]))))))}),jb.component("itemlist.orignialIndexFromSibling",{type:"data:0",params:[{id:"sibling",defaultValue:"%%"}],impl:(e,t)=>{const a=e.vars.cmp,n=a.base.querySelector(".jb-items-parent")||a.base,i=Array.from(n.children).map(e=>+e.getAttribute("jb-original-index")),r=t?jb.ui.indexOfElement(t):i.length,o=i[r-1];return jb.log("itemlist DD orignialIndexFromSibling",{sibling:t,indeces:i,targetIndex:r,result:o,ctx:e}),o}}),jb.component("itemlist.dragHandle",{description:"put on the control inside the item which is used to drag the whole line",type:"feature",impl:features(css.class("drag-handle"),css("{cursor: pointer}"))}),jb.component("itemlist.infiniteScroll",{type:"feature",params:[{id:"pageSize",as:"number",defaultValue:2}],impl:features(method("fetchNextPage",itemlist.applyDeltaOfNextPage("%$pageSize%")),feature.userEventProps("elem.scrollTop,elem.scrollHeight"),frontEnd.flow(rx.merge(source.frontEndEvent("scroll"),source.frontEndEvent("wheel")),rx.var("applicative","%target/__appScroll%"),rx.do(action.if("%$applicative%",runActions(log("itemlist applicative scroll terminated"),({data:e})=>e.target.__appScroll=null))),rx.filter(not("%$applicative%")),rx.var("scrollPercentFromTop",({data:e})=>(e.currentTarget.scrollTop+e.currentTarget.getBoundingClientRect().height)/e.currentTarget.scrollHeight),rx.log("itemlist frontend infiniteScroll"),rx.filter("%$scrollPercentFromTop%>0.9"),sink.BEMethod("fetchNextPage")))}),jb.component("itemlist.applyDeltaOfNextPage",{type:"action",params:[{id:"pageSize",as:"number",defaultValue:2}],impl:(e,t)=>{const a=e.vars.$props,n=e.vars.cmp,i=n.state,r=n.cmpId;i.visualSizeLimit=i.visualSizeLimit||a.visualSizeLimit;const o=a.allItems.slice(i.visualSizeLimit,i.visualSizeLimit+t);if(i.visualSizeLimit=i.visualSizeLimit+o.length,0==o.length)return null;const s=n.ctx.setVar("$refreshElemCall",!0).setVars({$cmpId:r,$cmpVer:n.ver+1,$baseIndex:i.visualSizeLimit-o.length}).ctx({profile:{...n.ctx.profile,items:()=>o},path:""}).runItself(),l=s.renderVdom();n.renderProps.items=[...n.renderProps.items,...s.renderProps.items],n.renderProps.ctrls=[...n.renderProps.ctrls,...s.renderProps.ctrls];const c=jb.ui.find(l,".jb-items-parent")[0]||l,d={children:{toAppend:jb.ui.stripVdom(c).children}},p=c==l?d:{_$bySelector:{".jb-items-parent":d}},m={attributes:{$scrollDown:!0,$__state:JSON.stringify(i)}};jb.ui.applyDeltaToCmp({ctx:e,delta:p,cmpId:r,assumedVdom:jb.ui.elemToVdom(jb.ui.elemOfCmp(e,r))}),jb.ui.applyDeltaToCmp({ctx:e,delta:m,cmpId:r})}}),jb.component("itemlist.deltaOfItems",{impl:e=>{const t=e.vars.cmp,a=t.renderVdom(),n=t.oldVdom||{},i=jb.ui.compareVdom(n,a,e);return t.oldVdom=a,jb.log("uiComp itemlist delta incrementalFromRx",{cmp:t,newVdom:a,oldVdom:n,delta:i}),i}}),jb.component("itemlist.incrementalFromRx",{type:"feature",params:[{id:"prepend",as:"boolean",boolean:"last at top"}],impl:followUp.flow(source.callbag(e=>e.exp("%$$props.items%").callbag||jb.callbag.fromIter([])),rx.map(If("%vars%","%data%","%%")),rx.do(({data:e},{$props:t})=>t.items.push(e)),rx.var("delta",itemlist.deltaOfItems()),sink.applyDeltaToCmp("%$delta%","%$followUpCmp/cmpId%"))}),jb.component("itemlist.calcSlicedItems",{impl:e=>{const{allItems:t,visualSizeLimit:a,items:n}=e.vars.$props;if(n)return n;const i=t[0];if(jb.callbag.isCallbag(i)){const e=[];return e.callbag=i,e}const r=t.length>a?t.slice(0,a):t;return jb.isRef(jb.asRef(r))?Object.keys(r).map(e=>jb.objectProperty(r,e)):r}});var{search:search,itemlistContainer:itemlistContainer}=jb.ns("search,itemlistContainer");jb.component("group.itemlistContainer",{description:"itemlist writable container to support addition, deletion and selection",type:"feature",category:"itemlist:80,group:70",params:[{id:"initialSelection",as:"single"}],impl:features(feature.serviceRegistey(),variable({name:"itemlistCntrData",value:{$:"object",search_pattern:"",selected:"%$initialSelection%"},watchable:!0}),variable({name:"itemlistCntr",value:{$:"object",filters:()=>[]}}))}),jb.component("itemlistContainer.filter",{type:"aggregator",category:"itemlist-filter:100",requireService:"dataFilters",params:[{id:"updateCounters",as:"boolean"}],impl:(e,t)=>{if(!e.vars.itemlistCntr)return;const a=e.vars.itemlistCntr.filters.reduce((e,t)=>t.filter(e),e.data||[]);return t?jb.delay(1).then(t=>{jb.writeValue(e.exp("%$itemlistCntrData/countBeforeFilter%","ref"),(e.data||[]).length,e),jb.writeValue(e.exp("%$itemlistCntrData/countBeforeMaxFilter%","ref"),resBeforeMaxFilter.length,e),jb.writeValue(e.exp("%$itemlistCntrData/countAfterFilter%","ref"),a.length,e)}):e.vars.itemlistCntrData.countAfterFilter=a.length,a}}),jb.component("itemlistContainer.search",{type:"control",category:"itemlist-filter:100",requires:e=>e.vars.itemlistCntr,params:[{id:"title",as:"string",dynamic:!0,defaultValue:"Search"},{id:"searchIn",type:"search-in",dynamic:!0,defaultValue:search.searchInAllProperties()},{id:"databind",as:"ref",dynamic:!0,defaultValue:"%$itemlistCntrData/search_pattern%"},{id:"style",type:"editable-text.style",defaultValue:editableText.mdcSearch(),dynamic:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:controlWithFeatures(e=>jb.ui.ctrl(e.cmpCtx),features(calcProp("init",(e,{cmp:t,itemlistCntr:a},{searchIn:n,databind:i})=>{a&&a.filters.push({filter:t=>{const a=jb.val(i())||"";return jb.frame.Fuse&&"search.fuse"==jb.path(n,"profile.$")?a?new jb.frame.Fuse(t,n()).search(a).map(e=>e.item):t:"function"==typeof n.profile?t.filter(e=>""==a||-1!=n.profile(e).toLowerCase().indexOf(a.toLowerCase())):t.filter(t=>""==a||-1!=n(e.setData(t)).toLowerCase().indexOf(a.toLowerCase()))}})}),frontEnd.selectionKeySourceService()))}),jb.component("itemlistContainer.moreItemsButton",{type:"control",category:"itemlist-filter:100",requires:e=>e.vars.itemlistCntr,params:[{id:"title",as:"string",dynamic:!0,defaultValue:"show %$delta% more ... (%$itemlistCntrData/countAfterFilter%/%$itemlistCntrData/countBeforeMaxFilter%)"},{id:"delta",as:"number",defaultValue:200},{id:"style",type:"button.style",defaultValue:button.href(),dynamic:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:controlWithFeatures(e=>jb.ui.ctrl(e.cmpCtx),features(watchRef("%$itemlistCntrData/maxItems%"),method("onclickHandler",writeValue("%$itemlistCntrData/maxItems%",(e,{itemlistCntrData:t},{delta:a})=>a+t.maxItems)),calcProp({id:"title",value:(e,{},{title:t,delta:a})=>t(e.setVar("delta",a))}),e=>({templateModifier:(e,t,a)=>t.ctx.exp("%$itemlistCntrData/countBeforeMaxFilter%","number")==t.ctx.exp("%$itemlistCntrData/countAfterFilter%","number")?"":e})))}),jb.ui.extractPropFromExpression=e=>{if(e.match(/^%.*%$/)&&!e.match(/[./[]/))return e.match(/^%(.*)%$/)[1]},jb.component("itemlistContainer.filterField",{type:"feature",category:"itemlist:80",requires:e=>e.vars.itemlistCntr,params:[{id:"fieldData",dynamic:!0,mandatory:!0},{id:"filterType",type:"filter-type"}],impl:feature.init((e,{cmp:t,itemlistCntr:a},{fieldData:n,filterType:i})=>{a&&(a.filters.find(e=>e.cmpId==t.cmpId)||a.filters.push({cmpId:t.cmpId,filter:a=>{const r=jb.val(e.vars.$model.databind());if(!r)return a;const o=a.filter(t=>i.filter(r,n(e.setData(t))));return!i.sort||t.state.sortOptions&&0!=t.state.sortOptions.length||i.sort(o,t=>n(e.setData(t)),r),o}}))})}),jb.component("filterType.text",{type:"filter-type",params:[{id:"ignoreCase",as:"boolean",defaultValue:!0,type:"boolean"}],impl:(e,t)=>t?{filter:(e,t)=>-1!=(t||"").toLowerCase().indexOf((e||"").toLowerCase()),sort:(e,t,a)=>{const n=new RegExp("\\b"+a+"\\b","i"),i=e=>(n.test(e)?5:0)+(0==e.toLowerCase().indexOf(a.toLowerCase())?3:0);e.sort((e,a)=>i(t(e)||"")-i(t(a)||""))}}:{filter:(e,t)=>-1!=(t||"").indexOf(e||""),sort:(e,t,a)=>{const n=new RegExp("\\b"+a+"\\b"),i=e=>(n.test(e)?5:0)+(0==e.indexOf(a)?3:0);e.sort((e,a)=>i(t(e)||"")-i(t(a)||""))}}}),jb.component("filterType.exactMatch",{type:"filter-type",impl:e=>({filter:(e,t)=>{const a=(e||"").trim(),n=(t||"").trim();return 0==n.indexOf(a)&&n.length==a.length}})}),jb.component("filterType.numeric",{type:"filter-type",impl:e=>({filter:(e,t)=>Number(t)>=Number(e),sort:(e,t)=>e.sort((e,a)=>Number(t(e))-Number(t(a)))})}),jb.component("search.searchInAllProperties",{type:"search-in",impl:e=>"string"==typeof e.data?e.data:"object"!=typeof e.data?"":jb.entries(e.data).map(e=>e[1]).filter(e=>"string"==typeof e).join("#")}),jb.component("search.fuse",{type:"search-in",description:"fuse.js search https://fusejs.io/api/options.html#basic-options",params:[{id:"keys",as:"array",defaultValue:list("id","name"),description:"List of keys that will be searched. This supports nested paths, weighted search, searching in arrays of strings and objects"},{id:"findAllMatches",as:"boolean",defaultValue:!1,description:"When true, the matching function will continue to the end of a search pattern even if a perfect match has already been located in the string"},{id:"isCaseSensitive",as:"boolean",defaultValue:!1},{id:"minMatchCharLength",as:"number",defaultValue:1,description:"Only the matches whose length exceeds this value will be returned. (For instance, if you want to ignore single character matches in the result, set it to 2)"},{id:"shouldSort",as:"boolean",defaultValue:!0,description:"Whether to sort the result list, by score"},{id:"location",as:"number",defaultValue:0,description:"Determines approximately where in the text is the pattern expected to be found"},{id:"threshold",as:"number",defaultValue:.6,description:"At what point does the match algorithm give up. A threshold of 0.0 requires a perfect match (of both letters and location), a threshold of 1.0 would match anything"},{id:"distance",as:"number",defaultValue:100,description:"Determines how close the match must be to the fuzzy location (specified by location). An exact letter match which is distance characters away from the fuzzy location would score as a complete mismatch"}],impl:e=>({fuseOptions:!0,...e.params})}),jb.component("table.expandToEndOfRow",{type:"feature",description:"allows expandToEndOfRow in itemlist with table style",impl:templateModifier(({},{$props:e,vdom:t})=>((t.querySelector(".jb-items-parent")||t).children||[]).forEach((t,a)=>{const n=e.ctrls[a]?e.ctrls[a].findIndex(e=>e.renderProps.expandToEndOfRow):-1;-1!=n&&(t.children=t.children.slice(0,n+1),t.children[n].setAttribute("colspan","10"))}))}),jb.component("feature.expandToEndOfRow",{type:"feature",description:"put on a field to expandToEndOfRow by condition",params:[{id:"condition",as:"boolean",dynamic:!0}],impl:calcProp("expandToEndOfRow","%$condition()%")});var{menu:menu,menuStyle:menuStyle,menuSeparator:menuSeparator,mdc:mdc,icon:icon,key:key}=jb.ns("menu,menuStyle,menuSeparator,mdc,icon,key");jb.component("menu.menu",{type:"menu.option",params:[{id:"title",as:"string",dynamic:!0,mandatory:!0},{id:"options",type:"menu.option[]",dynamic:!0,flattenArray:!0,mandatory:!0,defaultValue:[]},{id:"icon",type:"icon"},{id:"optionsFilter",type:"data",dynamic:!0,defaultValue:"%%"}],impl:e=>({options:function(t){const a=e.setVars({...e.vars,...t&&t.vars,menuDepth:this.ctx.vars.menuDepth});return e.params.optionsFilter(e.setData(e.params.options(a)))},title:e.params.title(),icon:e.params.icon,runShortcut:function(e){return this.options().reduce((t,a)=>t||a.runShortcut&&a.runShortcut(e),!1)},ctx:e.setVar("menuDepth",(e.vars.menuDepth||0)+1)})}),jb.component("menu.dynamicOptions",{type:"menu.option",params:[{id:"items",type:"data",as:"array",mandatory:!0,dynamic:!0},{id:"genericOption",type:"menu.option",mandatory:!0,dynamic:!0}],impl:pipeline("%$items()%",call("genericOption"))}),jb.component("menu.endWithSeparator",{type:"menu.option",params:[{id:"options",type:"menu.option[]",dynamic:!0,flattenArray:!0,mandatory:!0},{id:"separator",type:"menu.option",defaultValue:menu.separator()},{id:"title",as:"string"}],impl:pipeline(Var("opts","%$options()%"),If("%$opts/length%>0",list("%$opts%","%$separator%")))}),jb.component("menu.separator",{type:"menu.option",impl:obj(prop("separator",!0))}),jb.component("menu.action",{type:"menu.option",params:[{id:"title",as:"string",dynamic:!0,mandatory:!0},{id:"action",type:"action",dynamic:!0,mandatory:!0},{id:"icon",type:"icon"},{id:"shortcut",as:"string"},{id:"showCondition",type:"boolean",as:"boolean",defaultValue:!0}],impl:e=>e.params.showCondition&&{leaf:e.params,action:t=>e.params.action(e.setVars({topMenu:null})),title:e.params.title(e),shortcut:e.params.shortcut,runShortcut:t=>{e.run(key.eventMatchKey(()=>t.ev,()=>e.params.shortcut))&&e.params.action()},ctx:e.setVar("menuDepth",(e.vars.menuDepth||0)+1)}}),jb.component("menu.control",{type:"control,clickable,menu",params:[{id:"menu",type:"menu.option",dynamic:!0,mandatory:!0},{id:"style",type:"menu.style",defaultValue:menuStyle.contextMenu(),dynamic:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>{const t=e.params.menu(),a=t||{options:[],ctx:e,title:""},n=e.setVars({menuModel:a}),i=e.vars.topMenu?n:jb.ui.extendWithServiceRegistry(n.setVar("topMenu",{}));return jb.log("menu create uiComp",{topMenu:e.vars.topMenu,menuModel:a,ctx:e,ctxToUse:i}),jb.ui.ctrl(i,features(()=>({ctxForPick:a.ctx}),calcProp("title","%$menuModel.title%"),htmlAttribute("menuDepth","%$menuModel/ctx/vars/menuDepth%")))}}),jb.component("menu.openContextMenu",{type:"action",params:[{id:"menu",type:"menu.option",dynamic:!0,mandatory:!0},{id:"popupStyle",type:"dialog.style",dynamic:!0,defaultValue:dialog.contextMenuPopup()},{id:"menuStyle",type:"menu.style",dynamic:!0,defaultValue:menuStyle.contextMenu()},{id:"features",type:"dialog-feature[]",dynamic:!0},{id:"id",as:"string"}],impl:openDialog({id:"%$id%",style:call("popupStyle"),content:menu.control({menu:call("menu"),style:call("menuStyle")}),features:call("features")})}),jb.component("menuStyle.pulldown",{type:"menu.style",params:[{id:"innerMenuStyle",type:"menu.style",dynamic:!0,defaultValue:menuStyle.popupAsOption()},{id:"leafOptionStyle",type:"menu-option.style",dynamic:!0,defaultValue:menuStyle.optionLine()},{id:"layout",type:"group.style",dynamic:!0,defaultValue:itemlist.horizontal()}],impl:styleByControl(Var("optionsParentId",e=>e.id),Var("innerMenuStyle","%$innerMenuStyle%"),Var("leafOptionStyle","%$leafOptionStyle%"),itemlist({items:"%$menuModel.options()%",controls:menu.control({menu:"%$item%",style:menuStyle.popupThumb()}),style:call("layout"),features:menu.selection()}))}),jb.component("menuStyle.contextMenu",{type:"menu.style",params:[{id:"leafOptionStyle",type:"menu-option.style",dynamic:!0,defaultValue:menuStyle.optionLine()}],impl:styleByControl(Var("optionsParentId",e=>e.id),Var("leafOptionStyle","%$leafOptionStyle%"),itemlist({items:"%$menuModel.options()%",controls:menu.control({menu:"%$item%",style:menuStyle.applyMultiLevel({})}),features:menu.selection()}))}),jb.component("menu.initPopupMenu",{type:"feature",params:[{id:"popupStyle",type:"dialog.style",dynamic:!0,defaultValue:dialog.contextMenuPopup()}],impl:features(calcProp("title","%$menuModel.title%"),method("openPopup",runActions(e=>e.run(menu.openContextMenu({popupStyle:call("popupStyle"),menu:()=>e.run(If("%$innerMenu%","%$innerMenu.menu()%","%$$model.menu()%"))})))),method("closePopup",dialog.closeDialogById("%$optionsParentId%")),method("openNewPopup",runActions(action.runBEMethod("closePopup"),action.runBEMethod("openPopup"))),frontEnd.onDestroy(action.runBEMethod("closePopup")),menu.passMenuKeySource(),frontEnd.flow(source.findMenuKeySource(),rx.filter("%keyCode%==39"),sink.BEMethod("openPopup")),frontEnd.flow(source.findMenuKeySource(),rx.filter(inGroup(list(37,27),"%keyCode%")),sink.BEMethod("closePopup")))}),jb.component("menu.initMenuOption",{type:"feature",impl:features(calcProp({id:"title",value:"%$menuModel.leaf.title%"}),calcProp({id:"icon",value:"%$menuModel.leaf.icon%"}),calcProp({id:"shortcut",value:"%$menuModel.leaf.shortcut%"}),method("closeAndActivate",runActions(dialog.closeAllPopups(),"%$menuModel.action()%")),menu.passMenuKeySource(),frontEnd.flow(source.findMenuKeySource(),rx.filter("%keyCode%==13"),sink.BEMethod("closeAndActivate")))}),jb.component("menuStyle.applyMultiLevel",{type:"menu.style",params:[{id:"menuStyle",type:"menu.style",dynamic:!0,defaultValue:menuStyle.popupAsOption()},{id:"leafStyle",type:"menu.style",dynamic:!0,defaultValue:menuStyle.optionLine()},{id:"separatorStyle",type:"menu-separator.style",defaultValue:menuSeparator.line()}],impl:(e,t,a,n)=>{const{menuModel:i,leafOptionStyle:r,innerMenuStyle:o}=e.vars;return i.leaf?r?r(e):a():i.separator?n:o?o(e):t()}}),jb.component("menu.selection",{type:"feature",impl:features(htmlAttribute("tabIndex",0),css(">.selected { color: var(--jb-menubar-selection-fg); background: var(--jb-menubar-selection-bg) }"),userStateProp("selected",0),templateModifier(({},{vdom:e,selected:t})=>{const a=e.querySelector(".jb-items-parent")||e,n=jb.path(a,`children.${t}`);n&&n.addClass("selected")}),method("closeMenu",dialog.closeDialog()),menu.selectionKeySourceService(),menu.passMenuKeySource(),frontEnd.method("applyState",({},{cmp:e})=>{Array.from(e.base.querySelectorAll(".jb-item.selected,*>.jb-item.selected,*>*>.jb-item.selected")).forEach(e=>e.classList.remove("selected"));const t=(e.base.querySelector(".jb-items-parent")||e.base).children[e.state.selected];t&&(t.classList.add("selected"),t.scrollIntoViewIfNeeded())}),frontEnd.method("setSelected",({data:e},{cmp:t})=>{t.base.state.selected=t.state.selected=e,t.runFEMethod("applyState")}),frontEnd.flow(source.findMenuKeySource(),rx.filter(not("%ctrlKey%")),rx.filter(inGroup(list(38,40),"%keyCode%")),rx.map(itemlist.nextSelected(If("%keyCode%==40",1,-1),menu.notSeparator("%%"))),sink.FEMethod("setSelected")),frontEnd.flow(source.findMenuKeySource(),rx.filter("%keyCode%==27"),sink.BEMethod("closeMenu")),frontEnd.flow(source.frontEndEvent("mousemove"),rx.filter(menu.notSeparator("%target%")),rx.var("elem",({data:e})=>e.target.ownerDocument.elementsFromPoint(e.pageX,e.pageY)[0]),rx.var("ctxId",itemlist.indexOfElem("%$elem%")),rx.map("%$ctxId%"),rx.distinctUntilChanged(),sink.FEMethod("setSelected")))}),jb.component("menu.selectionKeySourceService",{type:"feature",impl:If("%$$serviceRegistry/services/menuKeySource%",[],features(service.registerBackEndService("menuKeySource","%$cmp/cmpId%"),frontEnd.prop("menuKeySource",(e,{cmp:t,el:a})=>{if(a.keydown_src)return;const{pipe:n,takeUntil:i,subject:r}=jb.callbag;return a.keydown_src=r(),a.onkeydown=n=>-1==[37,38,39,40,13,27].indexOf(n.keyCode)||(jb.log("menuKeySource",{ctx:e,cmp:t,e:n}),a.keydown_src.next(e.dataObj(n)),!1),jb.ui.focus(a,"menu.selectionKeySourceService",e),jb.log("menuKeySource register",{cmp:t,el:a,ctx:e}),n(a.keydown_src,i(t.destroyed))})))}),jb.component("menu.passMenuKeySource",{type:"feature",impl:frontEnd.var("menuKeySourceCmpId","%$$serviceRegistry/services/menuKeySource%")}),jb.component("source.findMenuKeySource",{type:"rx",category:"source",params:[{id:"clientCmp",defaultValue:"%$cmp%"}],impl:rx.pipe(rx.merge(source.data([]),(e,{menuKeySourceCmpId:t},{clientCmp:a})=>{jb.log("search menuKeySource",{menuKeySourceCmpId:t,clientCmp:a,ctx:e});const n=jb.ui.elemOfCmp(e,t),i=jb.path(n,"_component.menuKeySource");return i?jb.log("found menuKeySource",{menuKeySourceCmpId:t,clientCmp:a,el:n,ctx:e}):jb.log("menuKeySource notFound",{menuKeySourceCmpId:t,clientCmp:a,el:n,ctx:e}),i}),rx.var("cmp","%$clientCmp%"),rx.takeUntil("%$cmp.destroyed%"),rx.filter(menu.isRelevantMenu()),rx.log("from menuKeySource"))}),jb.component("menu.isRelevantMenu",{impl:e=>{const t=e.data.keyCode,a=e.vars.cmp.base,n=jb.ui.find(e,"[menuDepth]").filter(e=>jb.ui.hasClass(e,"jb-itemlist")),i=n.reduce((e,t)=>Math.max(e,+t.getAttribute("menudepth")),0),r=+a.getAttribute("menudepth")||0,o=jb.ui.parents(a,{includeSelf:!0}).find(e=>jb.ui.hasClass(e,"selected")),s=jb.ui.hasClass(a,"jb-itemlist"),l=s&&(40==t||38==t||27==t)&&r==i,c=o&&(37==t||27==t)&&r==i,d=o&&(39==t||13==t)&&r==i+1,p=l||c||d;return jb.log("check isRelevantMenu",{res:p,key:t,el:a,isMenu:s,isSelected:o,depth:r,maxDepth:i,upDownInMenu:l,leftArrowEntryBefore:c,rightArrowCurrentEntry:d,menus:n}),p}}),jb.component("menuStyle.optionLine",{type:"menu-option.style",impl:customStyle({template:(e,{icon:t,title:a,shortcut:n},i)=>i("div.line noselect",{onmousedown:"closeAndActivate"},[i(e.ctx.run({$:"control.icon",...t,size:20})),i("span.title",{},a),i("span.shortcut",{},n),i("div.mdc-line-ripple")]),css:"{ display: flex; cursor: pointer; font1: 13px Arial; height: 24px}\n\t\t\t\t.selected { color: var(--jb-menubar-selection-fg); background: var(--jb-menubar-selection-bg) }\n\t\t\t\t>i { padding: 3px 8px 0 3px }\n\t\t\t\t>span { padding-top: 3px }\n\t\t\t\t>.title { display: block; text-align: left; white-space: nowrap; }\n\t\t\t\t>.shortcut { margin-left: auto; text-align: right; padding-right: 15px }",features:[menu.initMenuOption(),mdc.rippleEffect()]})}),jb.component("menuStyle.popupAsOption",{type:"menu.style",impl:customStyle({template:(e,{title:t},a)=>a("div.line noselect",{onmousedown:"closeAndActivate"},[a("span.title",{},t),a("i.material-icons",{onmouseenter:"openPopup"},"play_arrow")]),css:"{ display: flex; cursor: pointer; font1: 13px Arial; height: 24px}\n\t\t\t\t>i { width: 100%; text-align: right; font-size:16px; padding-right: 3px; padding-top: 3px; }\n\t\t\t\t\t\t>.title { display: block; text-align: left; padding-top: 3px; padding-left: 32px; white-space: nowrap; }\n\t\t\t",features:menu.initPopupMenu(dialog.contextMenuPopup(-24,!0))})}),jb.component("menuStyle.popupThumb",{type:"menu.style",description:"used for pulldown",impl:customStyle({template:({},{title:e},t)=>t("div.pulldown-top-menu-item",{onclick:"openPopup"},e),features:[menu.initPopupMenu(),mdc.rippleEffect(),frontEnd.flow(source.frontEndEvent("mouseenter"),rx.filter(e=>jb.ui.find(e,".pulldown-mainmenu-popup")[0]),sink.BEMethod("openNewPopup"))]})}),jb.component("dialog.contextMenuPopup",{type:"dialog.style",params:[{id:"offsetTop",as:"number"},{id:"rightSide",as:"boolean",type:"boolean"},{id:"toolbar",as:"boolean",type:"boolean"}],impl:customStyle({template:({},{contentComp:e,toolbar:t},a)=>a("div.jb-dialog jb-popup context-menu-popup",{class:t?"toolbar-popup":"pulldown-mainmenu-popup"},a(e)),features:[dialogFeature.uniqueDialog("%$optionsParentId%",!1),dialogFeature.maxZIndexOnClick(),dialogFeature.closeWhenClickingOutside(),dialogFeature.cssClassOnLaunchingElement(),dialogFeature.nearLauncherPosition({offsetTop:"%$offsetTop%",rightSide:"%$rightSide%"})]})}),jb.component("menuSeparator.line",{type:"menu-separator.style",impl:customStyle({template:({},{},e)=>e("div",{separator:!0}),css:"{ margin: 6px 0; border-bottom: 1px solid var(--jb-menu-separator-fg);}"})}),jb.component("menu.notSeparator",{type:"boolean",params:[{id:"elem"}],impl:(e,t)=>t.firstElementChild&&!t.firstElementChild.getAttribute("separator")}),jb.component("menuStyle.toolbar",{type:"menu.style",params:[{id:"leafOptionStyle",type:"menu-option.style",dynamic:!0,defaultValue:menuStyle.icon()},{id:"itemlistStyle",type:"itemlist.style",dynamic:!0,defaultValue:itemlist.horizontal(5)}],impl:styleByControl(Var("optionsParentId",e=>e.id),Var("leafOptionStyle","%$leafOptionStyle%"),itemlist({style:call("itemlistStyle"),items:"%$menuModel/options()%",controls:menu.control({menu:"%$item%",style:menuStyle.applyMultiLevel({menuStyle:menuStyle.iconMenu(),leafStyle:menuStyle.icon()})})}))}),jb.component("menuStyle.icon",{type:"menu-option.style",params:[{id:"buttonSize",as:"number",defaultValue:20}],impl:styleWithFeatures(button.mdcIcon("%$menuModel/leaf/icon%","%$buttonSize%"),feature.onEvent("click","%$menuModel.action()%"))}),jb.component("menuStyle.iconMenu",{type:"menu.style",impl:styleByControl(button({title:"%title%",action:action.runBEMethod("openPopup"),style:button.mdcIcon(icon({icon:"%icon/icon%",type:"%icon/type%",features:css("transform: translate(7px,0px) !important")}),16),features:[feature.icon({icon:"more_vert",type:"mdc",features:css("transform: translate(-3px,0px) !important")}),menu.initPopupMenu(dialog.contextMenuPopup({toolbar:!0,rightSide:!0}))]}),"innerMenu")});var{picklist:picklist}=jb.ns("picklist");jb.component("picklist",{type:"control",description:"select, choose, pick, choice",category:"input:80",params:[{id:"title",as:"string",dynamic:!0},{id:"databind",as:"ref",mandaroy:!0,dynamic:!0},{id:"options",type:"picklist.options",dynamic:!0,mandatory:!0,templateValue:picklist.optionsByComma()},{id:"promote",type:"picklist.promote",dynamic:!0},{id:"style",type:"picklist.style",defaultValue:picklist.native(),dynamic:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e)}),jb.component("picklist.init",{type:"feature",impl:features(calcProp("options","%$$model/options()%"),calcProp("hasEmptyOption",(e,{$props:t})=>t.options.filter(e=>!e.text)[0]))}),jb.component("picklist.onChange",{category:"picklist:100",type:"feature",description:"action on picklist selection",params:[{id:"action",type:"action",dynamic:!0}],impl:method("onValueChange",call("action"))}),jb.component("picklist.optionsByComma",{type:"picklist.options",params:[{id:"options",as:"string",mandatory:!0},{id:"allowEmptyValue",type:"boolean"}],impl:(e,t,a)=>{return(a?[{code:"",text:""}]:[]).concat((t||"").split(",").map(e=>({code:e,text:e})))}}),jb.component("picklist.options",{type:"picklist.options",params:[{id:"options",type:"data",as:"array",dynamic:!0,mandatory:!0},{id:"code",as:"string",dynamic:!0,defaultValue:"%%"},{id:"text",as:"string",dynamic:!0,defaultValue:"%%"},{id:"icon",type:"icon",dynamic:!0},{id:"allowEmptyValue",type:"boolean"}],impl:(e,t,a,n,i,r)=>{return(r?[{code:"",text:""}]:[]).concat(t().map(t=>({code:a(e.setData(t)),text:n(e.setData(t)),icon:i(e.setData(t))})))}}),jb.component("picklist.sortedOptions",{type:"picklist.options",params:[{id:"options",type:"picklist.options",dynamic:!0,mandatory:!0,composite:!0},{id:"marks",as:"array",description:"e.g input:80,group:90. 0 mark means hidden. no mark means 50"}],impl:(e,t,a)=>{let n=t()||[];return a.forEach(e=>{const t=n.filter(t=>t.code==e.code)[0];t&&(t.mark=Number(e.mark||50))}),(n=n.filter(e=>0!=e.mark)).sort((e,t)=>(t.mark||50)-(e.mark||50)),n}}),jb.component("picklist.promote",{type:"picklist.promote",params:[{id:"groups",as:"array"},{id:"options",as:"array"}],impl:e=>e.params}),jb.component("picklist.initGroups",{type:"feature",impl:calcProp({id:"groups",phase:20,value:(e,{$model:t,$props:a})=>{const n=a.options,i={},r=(t.promote()||{}).groups||[],o=[];return n.filter(e=>e.text).forEach(e=>{const t=function(e){return e.group||-1!=e.text.indexOf(".")?e.group||e.text.split(".").shift():"---"}(e),a=i[t]||{options:[],text:t};i[t]||(o.push(a),i[t]=a),a.options.push({text:(e.text||"").split(".").pop(),code:e.code})}),o.sort((e,t)=>r.indexOf(t.text)-r.indexOf(e.text)),o}})});var{multiSelect:multiSelect,removeFromArray:removeFromArray,addToArray:addToArray}=jb.ns("multiSelect");jb.component("multiSelect",{type:"control",description:"select list of options, check multiple",category:"input:80",params:[{id:"title",as:"string",dynamic:!0},{id:"databind",as:"ref",mandaroy:!0,dynamic:!0},{id:"options",type:"picklist.options",dynamic:!0,mandatory:!0},{id:"promote",type:"picklist.promote",dynamic:!0},{id:"style",type:"multiSelect.style",defaultValue:picklist.native(),dynamic:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e)}),jb.component("multiSelect.modelAsBooleanRef",{params:[{id:"multiSelectModel"},{id:"code"}],impl:(e,t,a)=>{const n=t.databind();return{$jb_val:t=>void 0===t?i():!0===t?void(i()||jb.push(n,a,e)):function(){const t=jb.val(n).indexOf(a);-1!=t&&jb.splice(n,[[t,1]],e)}()};function i(){return-1!=jb.val(n).indexOf(a)}}}),jb.component("multiSelect.choiceList",{type:"multiSelect.style",params:[{id:"choiceStyle",type:"editable-boolean.style",dynamic:!0,defaultValue:editableBoolean.checkboxWithLabel()},{id:"itemlistStyle",type:"itemlist.style",dynamic:!0,defaultValue:itemlist.ulLi()}],impl:styleByControl(itemlist({items:"%$multiSelectModel/options%",controls:editableBoolean({textForTrue:"%text%",textForFalse:"%text%",databind:multiSelect.modelAsBooleanRef("%$multiSelectModel%","%code%"),style:call("choiceStyle")}),style:call("itemlistStyle"),features:watchRef({ref:"%$multiSelectModel/databind%",includeChildren:"yes"})}),"multiSelectModel")}),jb.component("multiSelect.chips",{type:"multiSelect.style",params:[{id:"chipStyle",type:"text.style",dynamic:!0,defaultValue:text.chip()},{id:"itemlistStyle",type:"itemlist.style",dynamic:!0,defaultValue:itemlist.horizontal()}],type:"multiSelect.style",impl:styleByControl(group({layout:layout.horizontal(),controls:[itemlist({items:"%$multiSelectModel/databind%",style:call("itemlistStyle"),controls:group({layout:layout.flex({wrap:"wrap",spacing:"4"}),controls:[text({text:"%% ",style:call("chipStyle"),features:itemlist.dragHandle()}),button({title:"delete",style:button.x(),action:removeFromArray("%$multiSelectModel/databind%","%%"),features:[css("z-index: 1000;margin-left: -25px"),itemlist.shownOnlyOnItemHover()]})]}),features:itemlist.dragAndDrop()}),picklist({options:pipeline("%$multiSelectModel/options%",filter(not(inGroup("%$multiSelectModel/databind%","%code%")))),features:[picklist.onChange(addToArray("%$multiSelectModel/databind%","%%")),picklist.plusIcon()]})],features:watchRef({ref:"%$multiSelectModel/databind%",includeChildren:"yes",allowSelfRefresh:!0,strongRefresh:!1})}),"multiSelectModel")}),jb.component("defaultTheme",{impl:e=>jb.ui.addStyleElem(e,'\n    body {\n      /* vscode compatible with light theme */\n      --jb-font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif;\n      --jb-font-size: 13px;\n      --jb-font-weight: normal;\n      --jb-fg: #616161;\n    \n      --jb-menu-bg: #ffffff;\n      --jb-menu-fg: #616161;\n      --jb-menu-selection-bg: #006ab1;\n      --jb-menu-selection-fg: #ffffff;\n      --jb-menu-separator-fg: #888888;\n      --jb-menubar-selection-bg: rgba(0, 0, 0, 0.1);\n      --jb-menubar-selection-fg: #333333;\n      --jb-menubar-active-bg: #dddddd;\n      --jb-menubar-active-fg: #333333;\n      --jb-menubar-inactive-bg: rgba(221, 221, 221, 0.6);\n      --jb-dropdown-bg: #ffffff;\n      --jb-dropdown-border: #cecece;\n      --jb-error-fg: #a1260d;\n    \n      --jb-input-bg: #ffffff;\n      --jb-input-fg: #616161;\n      --jb-textLink-active-fg: #034775;\n      --jb-textLink-fg: #006ab1;\n\n      --jb-on-primary: #ffffff;\n      --jb-on-secondary: #616161;\n      \n      --jb-icon-fg: #424242;\n    \n      --jb-list-active-selection-bg: #0074e8;\n      --jb-list-active-selection-fg: #ffffff;\n    \n    \n    /* mdc mappaing */\n      --mdc-theme-primary: #616161; /* The theme primary color*/\n      --mdc-theme-secondary: var(--jb-menubar-active-bg);\n      --mdc-theme-background: var(--jb-input-bg);\n      --mdc-theme-surface: var(--jb-input-bg);\n      --mdc-theme-error: var(--jb-error-fg);\n    \n      --mdc-theme-on-primary: var(--jb-on-primary); /* Primary text on top of a theme primary color background */\n      --mdc-theme-on-secondary: var(--jb-on-secondary);\n      --mdc-theme-on-surface: var(--jb-input-fg);\n      --mdc-theme-on-error: var(--jb-input-bg);\n    \n      --mdc-theme-text-primary-on-background: var(--jb-input-fg); /* Primary text on top of the theme background color. */\n      --mdc-theme-text-secondary-on-background: var(--jb-input-fg);\n      --mdc-theme-text-hint-on-background: var(--jb-input-fg);\n      --mdc-theme-text-disabled-on-background: var(--jb-input-fg);\n      --mdc-theme-text-icon-on-background: var(--jb-input-fg);\n      \n      --mdc-theme-text-primary-on-light: var(--jb-input-fg); /* Primary text on top of a light-colored background */\n      --mdc-theme-text-secondary-on-light: var(--jb-input-fg);\n      --mdc-theme-text-hint-on-light: var(--jb-input-fg);\n      --mdc-theme-text-disabled-on-light: var(--jb-input-fg);\n      --mdc-theme-text-icon-on-light: var(--jb-input-fg);\n                                \n      --mdc-theme-text-primary-on-dark: var(--jb-menu-selection-fg);\n      --mdc-theme-text-secondary-on-dark: var(--jb-menu-selection-fg);\n      --mdc-theme-text-hint-on-dark: var(--jb-menu-selection-fg);\n      --mdc-theme-text-disabled-on-dark: var(--jb-menu-selection-fg);\n      --mdc-theme-text-icon-on-dark: var(--jb-menu-selection-fg);\n\n    /* jBart only */\n      --jb-dropdown-shadow: #a8a8a8;\n      --jb-tree-value: red;\n      --jb-expandbox-bg: green;\n ')}),jb.component("group.theme",{type:"feature",params:[{id:"theme",type:"theme"}],impl:(e,t)=>({extendCtx:(e,a)=>e.setVars(t)})}),jb.component("theme.materialDesign",{type:"theme",impl:()=>({"$theme.editable-text":"editable-text.mdc-input"})});var{slider:slider,editableNumber:editableNumber,mdcStyle:mdcStyle}=jb.ns("slider,mdcStyle");jb.component("editableNumber.sliderNoText",{type:"editable-number.style",impl:customStyle({template:(e,{min:t,max:a,step:n,numbericVal:i},r)=>r("input",{type:"range",value:i,mouseup:"onblurHandler",tabindex:-1,min:t,max:a,step:n}),features:[field.databind(0,!0),slider.init(),slider.drag()]})}),jb.component("editableNumber.slider",{type:"editable-number.style",impl:styleByControl(group({title:"%$editableNumberModel/title%",controls:group({layout:layout.horizontal(20),controls:[editableText({databind:"%$editableNumberModel/databind()%",style:editableText.input(),features:[slider.init(),css("width: 30px; padding-left: 3px; border: 0; border-bottom: 1px solid var(--jb-menubar-inactive-bg);"),css("color: var(--mdc-theme-text-primary-on-background); background: var(--mdc-theme-background)"),css.class("text-input")]}),editableNumber({databind:"%$editableNumberModel/databind()%",style:editableNumber.sliderNoText(),max:"%$editableNumberModel/max%",min:"%$editableNumberModel/min%",step:"%$editableNumberModel/step%",features:[css.width(80),css.class("slider-input")]})],features:watchRef({ref:"%$editableNumberModel/databind()%",allowSelfRefresh:!0})})}),"editableNumberModel")}),jb.component("editableNumber.mdcSlider",{type:"editable-number.style",impl:styleByControl(group({title:"%$editableNumberModel/title%",controls:group({layout:layout.horizontal(20),controls:[editableText({databind:"%$editableNumberModel/databind()%",style:editableText.input(),features:[slider.init(),css("width: 40px; height: 20px; padding-top: 14px; padding-left: 3px; border: 0; border-bottom: 1px solid black; background: transparent;"),css.class("text-input")]}),editableNumber({databind:"%$editableNumberModel/databind()%",max:"%$editableNumberModel/max%",min:"%$editableNumberModel/min%",step:"%$editableNumberModel/step%",style:editableNumber.mdcSliderNoText({})})],features:watchRef({ref:"%$editableNumberModel/databind()%",allowSelfRefresh:!0})})}),"editableNumberModel")}),jb.component("editableNumber.mdcSliderNoText",{type:"editable-number.style",params:[{id:"thumbSize",as:"number",defaultValue:21},{id:"cx",as:"number",defaultValue:10.5},{id:"cy",as:"number",defaultValue:10.5},{id:"r",as:"number",defaultValue:7.875}],impl:customStyle({template:(e,{title:t,min:a,max:n,step:i,numbericVal:r,thumbSize:o,cx:s,cy:l,r:c},d)=>d("div.mdc-slider mdc-slider--discrete",{tabIndex:-1,role:"slider","data-step":i,"aria-valuemin":a,"aria-valuemax":n,"aria-valuenow":r,"aria-label":t()},[d("div.mdc-slider__track-container",{},d("div.mdc-slider__track")),d("div.mdc-slider__thumb-container",{},[d("div.mdc-slider__pin",{},d("span.mdc-slider__pin-value-marker")),d("svg.mdc-slider__thumb",{width:o,height:o},d("circle",{cx:s,cy:l,r:c})),d("div.mdc-slider__focus-ring")])]),features:[field.databind(),slider.init(),frontEnd.init((e,{cmp:t})=>{t.mdcSlider=new jb.ui.material.MDCSlider(t.base),t.mdcSlider.listen("MDCSlider:change",()=>e.run(action.runBEMethod("assignIgnoringUnits",()=>t.mdcSlider.value)))}),frontEnd.onRefresh((e,{cmp:t,el:a})=>{t.mdcSlider&&(t.mdcSlider.value=+a.getAttribute("aria-valuenow"),t.mdcSlider.min=+a.getAttribute("aria-valuemin"),t.mdcSlider.max=+a.getAttribute("aria-valuemax"),t.mdcSlider.step=+a.getAttribute("data-step"))}),frontEnd.onDestroy((e,{cmp:t})=>t.mdcSlider&&t.mdcSlider.destroy())]})}),jb.component("slider.init",{type:"feature",impl:features(calcProp("numbericVal",({},{editableNumber:e,$model:t})=>e.numericPart(jb.val(t.databind()))),calcProp("min"),calcProp("step"),calcProp("max",(e,{$model:t,$props:a})=>{const n=a.numbericVal;return n>=+t.max&&t.autoScale?1.2*n:+t.max}),method("delete",writeValue("%$$model/databind()%",()=>null)),method("assignIgnoringUnits",(e,{editableNumber:t,$model:a})=>{void 0!==t.numericPart(jb.val(a.databind()))&&jb.writeValue(a.databind(),t.calcDataString(e.data,e),e)}),method("incIgnoringUnits",(e,{editableNumber:t,$model:a,$props:n})=>{const i=t.numericPart(jb.val(a.databind()));if(void 0===i)return;const r=i+e.data*n.step,o=t.autoScale?r:t.keepInDomain(r);jb.writeValue(a.databind(),t.calcDataString(o,e),e)}),frontEnd.flow(source.frontEndEvent("keydown"),rx.filter("%keyCode%==46"),sink.BEMethod("delete")),frontEnd.flow(source.frontEndEvent("keydown"),rx.filter("%keyCode%==39"),rx.map(If("%shiftKey%",9,1)),sink.BEMethod("incIgnoringUnits")),frontEnd.flow(source.frontEndEvent("keydown"),rx.filter("%keyCode%==37"),rx.map(If("%shiftKey%",-9,-1)),sink.BEMethod("incIgnoringUnits")))}),jb.component("slider.drag",{type:"feature",impl:features(frontEnd.flow(source.frontEndEvent("mousemove"),rx.filter("%buttons%!=0"),sink.BEMethod("assignIgnoringUnits","%$cmp.base.value%")),frontEnd.flow(source.frontEndEvent("click"),sink.BEMethod("assignIgnoringUnits","%$cmp.base.value%")))}),jb.component("winUtils.gotoUrl",{type:"action",description:"navigate/open a new web page, change href location",params:[{id:"url",as:"string",mandatory:!0},{id:"target",type:"enum",values:["new tab","self"],defaultValue:"new tab",as:"string"}],impl:(e,t,a)=>{var n="new tab"==a?"_blank":"_self";e.probe||window.open(t,n)}});var{divider:divider}=jb.ns("divider");jb.component("divider",{type:"control",params:[{id:"style",type:"divider.style",defaultValue:divider.br(),dynamic:!0},{id:"title",as:"string",defaultValue:"divider"},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e)}),jb.component("divider.br",{type:"divider.style",impl:customStyle({template:(e,t,a)=>a("div"),css:"{ border-top-color: var(--jb-menu-separator-fg); display: block; border-top-width: 1px; border-top-style: solid;margin-top: 10px; margin-bottom: 10px;} "})}),jb.component("divider.vertical",{type:"divider.style",impl:customStyle({template:(e,t,a)=>a("div"),css:"{ border-left-color: var(--jb-menu-separator-fg); display: block; border-left-width: 1px; border-left-style: solid;margin-left: 10px; margin: 5px 5px;} "})}),jb.component("divider.flexAutoGrow",{type:"divider.style",impl:customStyle({template:(e,t,a)=>a("div"),css:"{ flex-grow: 10 }"})});var{notEmpty:notEmpty,touch:touch}=jb.macro;jb.component("editableText.picklistHelper",{type:"feature",params:[{id:"options",type:"picklist.options",dynamic:!0,mandatory:!0},{id:"picklistStyle",type:"picklist.style",dynamic:!0,defaultValue:picklist.labelList()},{id:"showHelper",as:"boolean",dynamic:!0,defaultValue:notEmpty("%value%"),description:"show/hide helper according to input content",type:"boolean"},{id:"autoOpen",as:"boolean",type:"boolean"},{id:"onEnter",type:"action",dynamic:!0,defaultValue:writeValue("%$$model/databind%","%$selectedOption%")},{id:"onEsc",type:"action",dynamic:!0},{id:"popupId",as:"string",defaultValue:"editableTextHelper"}],impl:features(variable({name:"selectedOption",watchable:!0}),variable({name:"watchableInput",watchable:!0,value:obj(prop("value",""))}),variable("helperCmp","%$cmp%"),method("openPopup",openDialog({style:dialog.popup(),content:picklist({options:pipeline("%$watchableInput%",call("options")),databind:"%$selectedOption%",features:watchRef("%$watchableInput%"),style:call("picklistStyle")}),features:[dialogFeature.maxZIndexOnClick(),dialogFeature.uniqueDialog("%$popupId%")]})),method("closePopup",dialog.closeDialogById("%$popupId%")),method("refresh",runActions(writeValue("%$watchableInput%","%%"),If(call("showHelper"),If(not(dialog.isOpen("%$popupId%")),action.runBEMethod("openPopup")),action.runBEMethod("closePopup")))),frontEnd.enrichUserEvent(({},{cmp:e})=>{const t=jb.ui.findIncludeSelf(e.base,"input,textarea")[0];return{input:{value:t.value,selectionStart:t.selectionStart}}}),method("onEnter",action.if(e=>e.run(dialog.isOpen("%$popupId%")),runActions(call("onEnter"),dialog.closeDialogById("%$popupId%")))),method("onEsc",action.if(dialog.isOpen("%$popupId%"),runActions(call("onEsc"),dialog.closeDialogById("%$popupId%")))),feature.serviceRegistey(),frontEnd.selectionKeySourceService(),frontEnd.prop("keyUp",rx.pipe(source.frontEndEvent("keyup"),rx.delay(1))),frontEnd.flow("%$cmp/keyUp%",rx.log("editableTextHelper keyup"),rx.filter("%keyCode% == 13"),editableText.addUserEvent(),sink.BEMethod("onEnter")),frontEnd.flow("%$cmp/keyUp%",rx.filter(not(inGroup(list(13,27,38,40),"%keyCode%"))),editableText.addUserEvent(),sink.BEMethod("refresh")),frontEnd.flow("%$cmp/keyUp%",rx.filter("%keyCode% == 27"),editableText.addUserEvent(),sink.BEMethod("onEsc")),onDestroy(action.runBEMethod("closePopup")),followUp.action(action.if("%$autoOpen%",runActions(writeValue("%$watchableInput%",obj(prop("value","%$helperCmp/renderProps/databind%"))),action.runBEMethod("openPopup")))))}),jb.component("editableText.setInputState",{type:"action",params:[{id:"newVal",as:"string"},{id:"assumedVal",description:"contains value and selectionStart, the action is not performed if the not in this state"},{id:"selectionStart",as:"number"},{id:"cmp",defaultValue:"%$cmp%"}],impl:action.applyDeltaToCmp((e,{cmp:t},{newVal:a,selectionStart:n,assumedVal:i})=>(jb.log("dom set input create userRequest",{cmp:t,newVal:a,ctx:e}),{attributes:{$__input:JSON.stringify({assumedVal:i,newVal:a,selectionStart:n})}}),"%$cmp/cmpId%")}),jb.component("editableText.addUserEvent",{type:"rx",impl:rx.innerPipe(frontEnd.addUserEvent(),rx.map("%$ev/input%"))}),jb.component("editableText.helperPopup",{type:"feature",params:[{id:"control",type:"control",dynamic:!0,mandatory:!0},{id:"popupStyle",type:"dialog.style",dynamic:!0,defaultValue:dialog.popup()},{id:"showHelper",as:"boolean",dynamic:!0,defaultValue:notEmpty("%value%"),description:"show/hide helper according to input content",type:"boolean"},{id:"autoOpen",as:"boolean",type:"boolean"},{id:"onEnter",type:"action",dynamic:!0},{id:"onEsc",type:"action",dynamic:!0},{id:"popupId",as:"string",defaultValue:"editableTextHelper"}],impl:features(method("openPopup",openDialog({style:call("popupStyle"),content:call("control"),features:[dialogFeature.maxZIndexOnClick(),dialogFeature.uniqueDialog("%$popupId%"),group.data(firstSucceeding("%$ev/input%",obj(prop("value","%$helperCmp/renderProps/databind%"))))]})),variable("helperCmp","%$cmp%"),method("closePopup",dialog.closeDialogById("%$popupId%")),method("refresh",If(call("showHelper"),If(dialog.isOpen("%$popupId%"),touch("%$watchableInput%"),action.runBEMethod("openPopup")),action.runBEMethod("closePopup"))),frontEnd.enrichUserEvent(({},{cmp:e})=>{const t=jb.ui.findIncludeSelf(e.base,"input,textarea")[0];return{input:{value:t.value,selectionStart:t.selectionStart}}}),method("onEnter",action.if(dialog.isOpen("%$popupId%"),runActions(call("onEnter"),dialog.closeDialogById("%$popupId%")))),method("onEsc",action.if(dialog.isOpen("%$popupId%"),runActions(call("onEsc"),dialog.closeDialogById("%$popupId%")))),frontEnd.selectionKeySourceService(),frontEnd.prop("keyUp",rx.pipe(source.frontEndEvent("keyup"),rx.delay(1))),frontEnd.flow("%$cmp/keyUp%",rx.log("editableTextHelper keyup"),rx.filter("%keyCode% == 13"),editableText.addUserEvent(),sink.BEMethod("onEnter")),frontEnd.flow("%$cmp/keyUp%",rx.filter(not(inGroup(list(13,27,38,40),"%keyCode%"))),editableText.addUserEvent(),sink.BEMethod("refresh")),frontEnd.flow("%$cmp/keyUp%",rx.filter("%keyCode% == 27"),editableText.addUserEvent(),sink.BEMethod("onEsc")),onDestroy(action.runBEMethod("closePopup")),followUp.action(action.if("%$autoOpen%",action.runBEMethod("openPopup"))))});var{mdc:mdc,mdcStyle:mdcStyle}=jb.ns("mdc,mdcStyle");jb.component("mdcStyle.initDynamic",{type:"feature",params:[{id:"query",as:"string"}],impl:features(frontEnd.init(({},{cmp:e})=>{if(!jb.ui.material)return jb.logError("please load mdc library");e.mdc_comps=e.mdc_comps||[],["switch","chip-set","tab-bar","slider","select","text-field"].forEach(t=>{const a=jb.ui.findIncludeSelf(e.base,`.mdc-${t}`)[0];if(a){const n=t.replace(/[_-]([a-zA-Z])/g,(e,t)=>t.toUpperCase()),i=n[0].toUpperCase()+n.slice(1);e.mdc_comps.push({mdc_cmp:new jb.ui.material[`MDC${i}`](a),cmpName:t}),jb.log(`mdc frontend init ${t}`,{cmp:e})}}),(e.base.classList.contains("mdc-button")||e.base.classList.contains("mdc-fab"))&&(e.mdc_comps.push({mdc_cmp:new jb.ui.material.MDCRipple(e.base),cmpName:"ripple"}),jb.log("mdc frontend init ripple",{cmp:e}))}),frontEnd.onDestroy(({},{cmp:e})=>(e.mdc_comps||[]).forEach(({mdc_cmp:t,cmpName:a})=>{t.destroy(),jb.log(`mdc frontend destroy ${a}`,{cmp:e})})))}),jb.component("mdc.rippleEffect",{type:"feature",description:"add ripple effect",impl:e=>({templateModifier:e=>e.addClass("mdc-ripple-surface mdc-ripple-radius-bounded mdc-states mdc-states-base-color(red)")})}),jb.component("label.mdcRippleEffect",{type:"text.style",impl:customStyle({template:({},{text:e},t)=>t("button.mdc-button",{},[t("div.mdc-button__ripple"),t("span.mdc-button__label",{},e)]),css:">span { text-transform: none; }",features:[text.bindText(),mdcStyle.initDynamic()]})}),jb.component("text.htmlTag",{type:"text.style",params:[{id:"htmlTag",as:"string",defaultValue:"p",options:"span,p,h1,h2,h3,h4,h5,div,li,article,aside,details,figcaption,figure,footer,header,main,mark,nav,section,summary,label"},{id:"cssClass",as:"string"}],impl:customStyle({template:(e,{text:t,htmlTag:a,cssClass:n},i)=>i(`${a}.${n}`,{},t),features:text.bindText()})}),jb.component("text.noWrappingTag",{type:"text.style",category:"text:0",impl:customStyle({template:(e,{text:t},a)=>t,features:text.bindText()})}),jb.component("text.span",{type:"text.style",impl:customStyle({template:(e,{text:t},a)=>a("span",{},t),features:text.bindText()})}),jb.component("text.chip",{type:"text.style",impl:customStyle({template:(e,{text:t},a)=>a("div.jb-chip",{},a("span",{},t)),features:text.bindText()})}),[1,2,3,4,5,6].map(e=>jb.component(`header.h${e}`,{type:"text.style",impl:customStyle({template:(t,{text:a},n)=>n(`h${e}`,{},a),features:text.bindText()})})),[1,2,3,4,5,6].map(e=>jb.component(`header.mdcHeadline${e}`,{type:"text.style",impl:customStyle({template:(t,{text:a},n)=>n("h2",{class:`mdc-typography mdc-typography--headline${e}`},a),features:text.bindText()})})),[1,2].map(e=>jb.component(`header.mdcSubtitle${e}`,{type:"text.style",impl:customStyle({template:(t,{text:a},n)=>n("h2",{class:`mdc-typography mdc-typography--subtitle${e}`},a),features:text.bindText()})})),jb.component("header.mdcHeaderWithIcon",{type:"text.style",params:[{id:"level",options:"1,2,3,4,5,6",as:"string",defaultValue:"1"}],impl:customStyle({template:(e,{text:t,level:a},n)=>n(`h${a}`,{class:"mdc-tab__content"},[...jb.ui.chooseIconWithRaised(e.icon).map(n),n("span",{class:"mdc-tab__text-label"},t),...(e.icon||[]).filter(e=>e&&"post"==e.ctx.vars.$model.position).map(n).map(e=>e.addClass("mdc-tab__icon"))]),css:"{justify-content: initial}",features:text.bindText()})}),jb.component("text.alignToBottom",{type:"text.style",impl:customStyle({template:(e,{text:t},a)=>a("div",{},a("span",{},t)),css:"{position: relative } ~>span { position: absolute; left: 0; bottom: 0 }",features:text.bindText()})}),[1,2].map(e=>jb.component(`text.mdcBody${e}`,{type:"text.style",impl:customStyle({template:(t,{text:a},n)=>n("h2",{class:`mdc-typography mdc-typography--body${e}`},a),features:text.bindText()})})),jb.ui.chooseIconWithRaised=(e,t)=>{if(!e)return[];const a=e.filter(e=>e&&"raised"==e.ctx.vars.$model.position)[0],n=(a&&e.filter(e=>e&&"raised"!=e.ctx.vars.$model.position)||e).filter(e=>e&&"post"!=e.ctx.vars.$model.position);return t&&a?[a]:n},jb.component("button.href",{type:"button.style",impl:customStyle({template:(e,{title:t,raised:a},n)=>n("a",{class:a?"raised":"",href:"javascript:;",onclick:!0},t),css:"{color: var(--jb-textLink-fg)} .raised { color: var(--jb-textLink-active-fg) }"})}),jb.component("button.hrefText",{type:"button.style",impl:customStyle({template:(e,{title:t,raised:a},n)=>n("a",{class:a?"raised":"",href:"javascript:;",onclick:!0},t),css:"{color: var(--jb-input-fg) ; text-decoration: none }     ~.hover, ~.active: { text-decoration: underline }"})}),jb.component("button.x",{type:"button.style",params:[{id:"size",as:"number",defaultValue:"21"}],impl:customStyle({template:(e,t,a)=>a("button",{title:t.title,onclick:!0},"×"),css:"{\n            padding: 0;\n            cursor: pointer;\n            font: %$size%px sans-serif;\n            border: none;\n            background: transparent;\n            color: var(--mdc-theme-text-primary-on-background);\n            text-shadow: 0 1px 0 var(--jb-dropdown-shadow);\n            font-weight: 700;\n        }\n        :hover { color: var(--jb-menubar-active-fg) }"})}),jb.component("button.native",{type:"button.style",impl:customStyle({template:(e,{title:t,raised:a},n)=>n("button",{class:a?"raised":"",title:t,onclick:!0},t),css:".raised {font-weight: bold}"})}),jb.component("button.mdc",{type:"button.style",params:[{id:"noRipple",as:"boolean"},{id:"noTitle",as:"boolean"}],impl:customStyle({template:(e,{title:t,raised:a,noRipple:n,noTitle:i},r)=>r("button",{class:["mdc-button",a&&"raised mdc-button--raised"].filter(e=>e).join(" "),onclick:!0},[!n&&r("div.mdc-button__ripple"),...jb.ui.chooseIconWithRaised(e.icon,a).map(r).map(e=>e.addClass("mdc-button__icon")),!i&&r("span.mdc-button__label",{},t),...(e.icon||[]).filter(e=>e&&"post"==e.ctx.vars.$model.position).map(r).map(e=>e.addClass("mdc-button__icon"))]),features:mdcStyle.initDynamic()})}),jb.component("button.mdcChipAction",{type:"button.style",impl:customStyle({template:(e,{title:t,raised:a},n)=>n("div.mdc-chip-set mdc-chip-set--filter",{onclick:!0},n("div.mdc-chip",{class:[a&&"mdc-chip--selected raised"].filter(e=>e).join(" ")},[n("div.mdc-chip__ripple"),...jb.ui.chooseIconWithRaised(e.icon,a).map(n).map(e=>e.addClass("mdc-chip__icon mdc-chip__icon--leading")),n("span",{role:"gridcell"},n("span",{role:"button",tabindex:-1,class:"mdc-chip__text"},t)),...(e.icon||[]).filter(e=>e&&"post"==e.ctx.vars.$model.position).map(n).map(e=>e.addClass("mdc-chip__icon mdc-chip__icon--trailing"))])),features:mdcStyle.initDynamic()})}),jb.component("button.plainIcon",{type:"button.style",impl:customStyle((e,{title:t,raised:a},n)=>jb.ui.chooseIconWithRaised(e.icon,a).map(n).map(e=>e.setAttribute("title",e.getAttribute("title")||t))[0])}),jb.component("button.mdcIcon",{type:"button.style,icon.style",params:[{id:"icon",type:"icon"},{id:"buttonSize",as:"number",defaultValue:40,description:"button size is larger than the icon size, usually at the rate of 40/24"}],impl:styleWithFeatures(button.mdcFloatingAction({withTitle:!1,buttonSize:"%$buttonSize%"}),features((e,{},{icon:t})=>t&&e.run({$:"feature.icon",...t,title:"%$model.title%",size:({},{},{buttonSize:e})=>24*e/40})))}),jb.component("button.mdcFloatingAction",{type:"button.style,icon.style",description:"fab icon",params:[{id:"buttonSize",as:"number",defaultValue:60,description:"mini is 40"},{id:"withTitle",as:"boolean"}],impl:customStyle({template:(e,{title:t,withTitle:a,raised:n},i)=>i("button",{class:["mdc-fab",n&&"raised mdc-icon-button--on"].filter(e=>e).join(" "),title:t,tabIndex:-1,onclick:!0},[i("div",{class:"mdc-fab__ripple"}),...jb.ui.chooseIconWithRaised(e.icon,n).filter(e=>e).map(i).map(e=>e.addClass("mdc-fab__icon").setAttribute("title",e.getAttribute("title")||t)),...[a&&i("span",{class:"mdc-fab__label"},t)].filter(e=>e)]),css:"{width: %$buttonSize%px; height: %$buttonSize%px;}",features:mdcStyle.initDynamic()})}),jb.component("button.mdcTab",{type:"button.style",impl:customStyle({template:(e,{title:t,raised:a},n)=>n("button.mdc-tab",{class:a?"mdc-tab--active":"",tabIndex:-1,role:"tab",onclick:!0},[n("span.mdc-tab__content",{},[...jb.ui.chooseIconWithRaised(e.icon,a).map(n).map(e=>e.addClass("mdc-tab__icon")),n("span.mdc-tab__text-label",{},t),...(e.icon||[]).filter(e=>e&&"post"==e.ctx.vars.$model.position).map(n).map(e=>e.addClass("mdc-tab__icon"))]),n("span",{class:["mdc-tab-indicator",a&&"mdc-tab-indicator--active"].filter(e=>e).join(" ")},n("span",{class:"mdc-tab-indicator__content mdc-tab-indicator__content--underline"})),n("span.mdc-tab__ripple")]),features:mdcStyle.initDynamic()})}),jb.component("button.mdcHeader",{type:"button.style",params:[{id:"stretch",as:"boolean"}],impl:styleWithFeatures(button.mdcTab(),css(pipeline(Var("contentWidth",If("%$stretch%","width: 100%;","")),"\n    {width: 100%; border-bottom: 1px solid black; margin-bottom: 7px; padding: 0}\n    ~ .mdc-tab__content { %$contentWidth% display: flex; align-content: space-between;}\n    ~ .mdc-tab__text-label { width: 100% }\n  ")))});var{hidden:hidden}=jb.ns("mdc,mdc-style");jb.component("editableText.input",{type:"editable-text.style",impl:customStyle({template:(e,{databind:t},a)=>a("input",{value:t,onchange:!0,onkeyup:!0,onblur:!0}),features:field.databindText()})}),jb.component("editableText.textarea",{type:"editable-text.style",params:[{id:"rows",as:"number",defaultValue:4},{id:"cols",as:"number",defaultValue:120},{id:"oneWay",type:"boolean",as:"boolean",defaultValue:!0}],impl:customStyle({template:(e,{databind:t,rows:a,cols:n},i)=>i("textarea",{rows:a,cols:n,value:t,onchange:!0,onkeyup:!0,onblur:!0}),features:field.databindText(0,"%$oneWay%")})}),jb.component("editableText.mdcInput",{type:"editable-text.style,editable-number.style",params:[{id:"width",as:"number"},{id:"noLabel",as:"boolean"},{id:"noRipple",as:"boolean"}],impl:customStyle({template:(e,{databind:t,fieldId:a,title:n,noLabel:i,noRipple:r,error:o},s)=>s("div",{},[s("div.mdc-text-field",{class:[(e.icon||[]).filter(e=>e&&"pre"==e.ctx.vars.$model.position)[0]&&"mdc-text-field--with-leading-icon",(e.icon||[]).filter(e=>e&&"post"==e.ctx.vars.$model.position)[0]&&"mdc-text-field--with-trailing-icon"].filter(e=>e).join(" ")},[...(e.icon||[]).filter(e=>e&&"pre"==e.ctx.vars.$model.position).map(s).map(e=>e.addClass("mdc-text-field__icon mdc-text-field__icon--leading")),s("input.mdc-text-field__input",{type:"text",id:"input_"+a,name:"input_"+a,value:t,onchange:!0,onkeyup:!0,onblur:!0,autocomplete:"off"}),...(e.icon||[]).filter(e=>e&&"post"==e.ctx.vars.$model.position).map(s).map(e=>e.addClass("mdc-text-field__icon mdc-text-field__icon--trailing")),...[!i&&s("label.mdc-floating-label",{class:t?"mdc-floating-label--float-above":"",for:"input_"+a},n())].filter(e=>e),...[!r&&s("div.mdc-line-ripple")].filter(e=>e)]),s("div.mdc-text-field-helper-line",{},o||"")]),css:"~ .mdc-text-field-helper-line { color: var(--jb-error-fg) }\n    ~ .mdc-text-field:not(.mdc-text-field--disabled) .mdc-text-field__input { color: var(--mdc-theme-text-primary-on-background); background: var(--mdc-theme-background); border-color: var(--jb-menubar-inactive-bg); }\n    ~ .mdc-text-field--focused:not(.mdc-text-field--disabled) .mdc-floating-label { color: var(--mdc-theme-primary) }\n    ",features:[field.databindText(),mdcStyle.initDynamic(),css(({},{},{width:e})=>`>.mdc-text-field { ${jb.ui.propWithUnits("width",e)} }`)]})}),jb.component("editableText.mdcNoLabel",{type:"editable-text.style",params:[{id:"width",as:"number"}],impl:editableText.mdcInput({width:"%$width%",noLabel:!0})}),jb.component("editableText.mdcSearch",{params:[{id:"width",as:"number"}],description:"debounced and one way binding",type:"editable-text.style",impl:styleWithFeatures(editableText.mdcInput({width:"%$width%",noLabel:!0}),feature.icon({icon:"search",position:"post"}))}),jb.component("editableText.expandable",{description:"label that changes to editable class on double click",type:"editable-text.style",params:[{id:"buttonFeatures",type:"feature[]",flattenArray:!0,dynamic:!0},{id:"editableFeatures",type:"feature[]",flattenArray:!0,dynamic:!0},{id:"buttonStyle",type:"button.style",dynamic:!0,defaultValue:button.href()},{id:"editableStyle",type:"editable-text.style",dynamic:!0,defaultValue:editableText.input()},{id:"onToggle",type:"action",dynamic:!0}],impl:styleByControl(group({controls:[editableText({databind:"%$editableTextModel/databind%",style:call("editableStyle"),features:[watchRef({ref:"%$editable%",allowSelfRefresh:!0}),hidden("%$editable%"),method("exitEditable",runActions(writeValue("%$editable%",!1),call("onToggle"))),method("regainFocus",action.focusOnCmp()),frontEnd.flow(source.frontEndEvent("blur"),sink.BEMethod("exitEditable")),frontEnd.flow(source.frontEndEvent("keyup"),rx.filter(or("%keyCode%==13","%keyCode%==27")),sink.BEMethod("exitEditable")),(e,{},{editableFeatures:t})=>t(e)]}),button({title:"%$editableTextModel/databind%",action:runActions(writeValue("%$editable%",!0),(e,{expandableContext:t})=>t.regainFocus&&t.regainFocus(),call("onToggle")),style:call("buttonStyle"),features:[watchRef({ref:"%$editable%",allowSelfRefresh:!0}),hidden(not("%$editable%")),(e,{},{buttonFeatures:t})=>t(e)]})],features:[variable({name:"editable",watchable:!0}),variable({name:"expandableContext",value:obj()})]}),"editableTextModel")}),jb.component("layout.vertical",{type:"layout,feature",params:[{id:"spacing",as:"string",defaultValue:3}],impl:css(({},{},{spacing:e})=>`{display: flex; flex-direction: column}\n          >* { ${jb.ui.propWithUnits("margin-bottom",e)} }\n          >*:last-child { margin-bottom:0 }`)}),jb.component("layout.horizontal",{type:"layout,feature",params:[{id:"spacing",as:"string",defaultValue:3}],impl:css(({},{},{spacing:e})=>`{display: flex}\n        >* { ${jb.ui.propWithUnits("margin-right",e)} }\n        >*:last-child { margin-right:0 }`)}),jb.component("layout.horizontalFixedSplit",{type:"layout,feature",params:[{id:"leftWidth",as:"string",defaultValue:"200px",mandatory:!0},{id:"rightWidth",as:"string",defaultValue:"100%",mandatory:!0},{id:"spacing",as:"string",defaultValue:3}],impl:e=>({css:`{display: flex}\n        >*:first-child { ${jb.ui.propWithUnits("margin-right",e.params.spacing)}\n        ${jb.ui.propWithUnits("width",e.params.leftWidth)} }\n        >*:last-child { margin-right:0; ${jb.ui.propWithUnits("width",e.params.rightWidth)} }`})}),jb.component("layout.horizontalWrapped",{type:"layout,feature",params:[{id:"spacing",as:"string",defaultValue:3}],impl:e=>({css:`{display: flex}\n        >* {${jb.ui.propWithUnits("margin-right",e.params.spacing)} }\n        >*:last-child { margin-right:0 }`})}),jb.component("layout.flex",{type:"layout,feature",params:[{id:"direction",as:"string",options:",row,row-reverse,column,column-reverse"},{id:"justifyContent",as:"string",options:",flex-start,flex-end,center,space-between,space-around"},{id:"alignItems",as:"string",options:",normal,stretch,center,start,end,flex-start,flex-end,baseline,first baseline,last baseline,safe center,unsafe center"},{id:"wrap",as:"string",options:",wrap,wrap-reverse,nowrap"},{id:"spacing",as:"string"}],impl:e=>({css:e.setVars({spacingWithUnits:jb.ui.withUnits(e.params.spacing),marginSpacing:e.params.direction.match(/col/)?"bottom":"right",...e.params}).exp(`{ display: flex; {?align-items:%$alignItems%;?} {?justify-content:%$justifyContent%;?} {?flex-direction:%$direction%;?} {?flex-wrap:%$wrap%;?} }\n      {?>* { margin-%$marginSpacing%: %$spacingWithUnits% }?}\n    ${e.params.spacing?">*:last-child { margin-%$marginSpacing%:0 }":""}`)})}),jb.component("layout.grid",{type:"layout,feature",params:[{id:"columnSizes",as:"array",templateValue:list("auto","auto"),description:"grid-template-columns, list of lengths"},{id:"rowSizes",as:"array",description:"grid-template-rows, list of lengths"},{id:"columnGap",as:"string",description:"grid-column-gap"},{id:"rowGap",as:"string",description:"grid-row-gap"}],impl:e=>({css:e.setVars({...e.params,colSizes:e.params.columnSizes.map(e=>jb.ui.withUnits(e)).join(" "),rowSizes:e.params.rowSizes.map(e=>jb.ui.withUnits(e)).join(" ")}).exp("{ display: grid; {?grid-template-columns:%$colSizes%;?} {?grid-template-rows:%$rowSizes%;?}\n            {?grid-column-gap:%$columnGap%;?} {?grid-row-gap:%$rowGap%;?} }")})}),jb.component("flexItem.grow",{type:"feature",category:"flex-item",params:[{id:"factor",as:"string",defaultValue:"1"}],impl:{$:"feature.css",$byValue:["flex-grow: %$factor%"]}}),jb.component("flexItem.basis",{type:"feature",category:"flex-item",params:[{id:"factor",as:"string",defaultValue:"1"}],impl:{$:"feature.css",$byValue:["flex-basis: %$factor%"]}}),jb.component("flexItem.alignSelf",{type:"feature",category:"flex-item",params:[{id:"align",as:"string",options:"auto,flex-start,flex-end,center,baseline,stretch",defaultValue:"auto"}],impl:{$:"feature.css",$byValue:["align-self: %$align%"]}});var{dynamicControls:dynamicControls,css:css,header:header}=jb.ns("css");jb.component("group.htmlTag",{type:"group.style",params:[{id:"htmlTag",as:"string",defaultValue:"section",options:"div,ul,article,aside,details,figcaption,figure,footer,header,main,mark,nav,section,summary,label,form"},{id:"groupClass",as:"string"},{id:"itemClass",as:"string"}],impl:customStyle({template:(e,{htmlTag:t,groupClass:a,itemClass:n,ctrls:i},r)=>r(t,{class:a},i.map(e=>r(e,{class:n}))),features:group.initGroup()})}),jb.component("group.div",{type:"group.style",impl:group.htmlTag("div")}),jb.component("group.section",{type:"group.style",impl:group.htmlTag("section")}),jb.component("group.ulLi",{type:"group.style",impl:customStyle({template:(e,{ctrls:t},a)=>a("ul.jb-itemlist",{},t.map(e=>a("li",{class:"jb-item"},a(e)))),css:"{ list-style: none; padding: 0; margin: 0;}\n    >li { list-style: none; padding: 0; margin: 0;}",features:group.initGroup()})}),jb.component("group.card",{type:"feature",category:"card:100",params:[{id:"padding",as:"string",defaultValue:10},{id:"width",as:"string",defaultValue:320},{id:"outlined",as:"boolean",type:"boolean"}],impl:features(css.class(({},{},{outlined:e})=>["mdc-card",...e?["mdc-card--outlined"]:[]].join(" ")),css(({},{},{padding:e,width:t})=>[jb.ui.propWithUnits("padding",e),jb.ui.propWithUnits("width",t)].filter(e=>e).join(";")))}),jb.component("group.chipSet",{type:"feature",category:"chip:100",params:[{id:"spacing",as:"string",defaultValue:3}],impl:features(css.class("mdc-chip-set"),mdcStyle.initDynamic())}),jb.component("group.tabs",{type:"group.style",params:[{id:"tabStyle",type:"button.style",dynamic:!0,defaultValue:button.mdcTab()},{id:"barStyle",type:"group.style",dynamic:!0,defaultValue:group.mdcTabBar()},{id:"innerGroupStyle",type:"group.style",dynamic:!0,defaultValue:group.div()}],impl:styleByControl(group({controls:[group({style:call("barStyle"),controls:dynamicControls({controlItems:"%$tabsModel/controls%",genericControl:button({title:"%$tab/field()/title%",action:writeValue("%$selectedTab%","%$tabIndex%"),style:call("tabStyle"),raised:"%$tabIndex% == %$selectedTab%",features:[e=>"group.mdcTabBar"!==e.cmpCtx.params.barStyle.profile.$&&watchRef("%$selectedTab%"),e=>e.run(features((e.vars.tab.icon||[]).map(e=>e.ctx.profile).filter(e=>e)))]}),itemVariable:"tab",indexVariable:"tabIndex"})}),group({style:call("innerGroupStyle"),controls:"%$tabsModel/controls[{%$selectedTab%}]%",features:watchRef("%$selectedTab%")})],features:variable({name:"selectedTab",value:0,watchable:!0})}),"tabsModel")}),jb.component("group.mdcTabBar",{type:"group.style",impl:customStyle({template:(e,{ctrls:t},a)=>a("div",{class:"mdc-tab-bar",role:"tablist"},a("div",{class:"mdc-tab-scroller"},a("div",{class:"mdc-tab-scroller__scroll-area mdc-tab-scroller__scroll-area--scroll"},a("div",{class:"mdc-tab-scroller__scroll-content"},t.map(e=>a(e)))))),features:[group.initGroup(),mdcStyle.initDynamic()]})}),jb.component("group.accordion",{type:"group.style",params:[{id:"titleStyle",type:"button.style",dynamic:!0,defaultValue:button.mdcHeader(!0)},{id:"sectionStyle",type:"group.style",dynamic:!0,defaultValue:group.section()},{id:"innerGroupStyle",type:"group.style",dynamic:!0,defaultValue:group.div()}],impl:styleByControl(group({controls:dynamicControls({controlItems:"%$sectionsModel/controls%",genericControl:group({style:call("sectionStyle"),controls:[button({title:"%$section/field()/title()%",action:writeValue("%$selectedTab%","%$sectionIndex%"),style:call("titleStyle"),raised:"%$sectionIndex% == %$selectedTab%",features:[css.width("%$width%"),css("{justify-content: left}"),watchRef("%$selectedTab%"),e=>e.run(features((e.vars.section.icon||[]).map(e=>e.ctx.profile).filter(e=>e)))]}),group({style:call("innerGroupStyle"),controls:"%$sectionsModel/controls[{%$sectionIndex%}]%",features:[feature.if("%$sectionIndex% == %$selectedTab%"),watchRef("%$selectedTab%")]})]}),itemVariable:"section",indexVariable:"sectionIndex"}),features:variable({name:"selectedTab",value:0,watchable:!0})}),"sectionsModel")}),jb.component("group.sections",{type:"group.style",params:[{id:"titleStyle",type:"text.style",dynamic:!0,defaultValue:header.mdcHeaderWithIcon()},{id:"sectionStyle",type:"group.style",dynamic:!0,defaultValue:group.div()},{id:"innerGroupStyle",type:"group.style",dynamic:!0,defaultValue:group.div()}],impl:styleByControl(group({controls:dynamicControls({controlItems:"%$sectionsModel/controls%",genericControl:group({title:"",style:call("sectionStyle"),controls:[text({text:"%$section/field()/title()%",style:call("titleStyle"),features:e=>e.run(features((e.vars.section.icon||[]).map(e=>e.ctx.profile).filter(e=>e)))}),group({style:call("innerGroupStyle"),controls:"%$section%"})]}),itemVariable:"section"})}),"sectionsModel")}),jb.component("group.sectionExpandCollapse",{type:"group.style",params:[{id:"titleCtrl",type:"control",dynamic:!0,defaultValue:text({text:"%$sectionsModel.title()%",style:header.h2()})},{id:"toggleStyle",type:"editable-boolean.style",defaultValue:editableBoolean.expandCollapse()},{id:"autoExpand",as:"boolean"}],impl:styleByControl(group({controls:[group({controls:[editableBoolean({databind:"%$sectionExpanded%",style:call("toggleStyle")}),call("titleCtrl")],layout:layout.flex({justifyContent:"start",direction:"row",alignItems:"center"})}),group({controls:controlWithCondition("%$sectionExpanded%","%$sectionsModel/controls%"),features:watchRef("%$sectionExpanded%")})],features:variable({name:"sectionExpanded",watchable:!0,value:"%$autoExpand%"})}),"sectionsModel")}),jb.component("group.sectionsExpandCollapse",{type:"group.style",params:[{id:"autoExpand",as:"boolean"},{id:"titleStyle",type:"text.style",dynamic:!0,defaultValue:header.h2()},{id:"toggleStyle",type:"editable-boolean.style",defaultValue:editableBoolean.expandCollapse()},{id:"titleGroupStyle",type:"group.style",dynamic:!0,defaultValue:group.div()},{id:"innerGroupStyle",type:"group.style",dynamic:!0,defaultValue:group.div()}],impl:styleByControl(group({controls:dynamicControls({controlItems:"%$sectionsModel/controls%",genericControl:group({controls:[group({style:call("titleGroupStyle"),controls:[editableBoolean({databind:"%$sectionExpanded%",style:call("toggleStyle")}),text({text:"%$section/field()/title()%",style:call("titleStyle")})],layout:layout.flex({justifyContent:"start",direction:"row",alignItems:"center"})}),group({style:call("innerGroupStyle"),controls:controlWithCondition("%$sectionExpanded%","%$sectionsModel/controls[{%$sectionIndex%}]%"),features:watchRef("%$sectionExpanded%")})],features:variable({name:"sectionExpanded",watchable:!0,value:"%$autoExpand%"})}),itemVariable:"section",indexVariable:"sectionIndex"})}),"sectionsModel")}),jb.ns("mdcStyle,table"),jb.component("itemlist.shownOnlyOnItemHover",{type:"feature",category:"itemlist:75",description:"put on the control inside the item which is shown when the mouse enters the line",impl:css.class("jb-shown-on-item-hover")}),jb.component("itemlist.divider",{type:"feature",params:[{id:"space",as:"number",defaultValue:5}],impl:css(">.jb-item:not(:first-of-type) { border-top: 1px solid rgba(0,0,0,0.12); padding-top: %$space%px }")}),jb.component("itemlist.ulLi",{type:"itemlist.style",impl:customStyle({template:({},{ctrls:e},t)=>t("ul.jb-itemlist",{},e.map(e=>t("li.jb-item",{},e.map(e=>t(e))))),css:"{ list-style: none; padding: 0; margin: 0;}\n    >li { list-style: none; padding: 0; margin: 0;}",features:itemlist.init()})}),jb.component("itemlist.div",{type:"itemlist.style",params:[{id:"spacing",as:"number",defaultValue:0}],impl:customStyle({template:({},{ctrls:e},t)=>t("div.jb-itemlist",{},e.map(e=>t("div.jb-item",{},e.map(e=>t(e))))),features:itemlist.init()})}),jb.component("itemlist.horizontal",{type:"itemlist.style",params:[{id:"spacing",as:"number",defaultValue:0}],impl:customStyle({template:({},{ctrls:e},t)=>t("div.jb-itemlist",{},e.map(e=>t("div.jb-item",{},e.map(e=>t(e))))),css:"{display: flex}\n        >* { margin-right: %$spacing%px }\n        >*:last-child { margin-right:0 }",features:itemlist.init()})}),jb.component("table.plain",{params:[{id:"hideHeaders",as:"boolean",type:"boolean"}],type:"itemlist.style",impl:customStyle({template:(e,{ctrls:t,hideHeaders:a,headerFields:n},i)=>i("div.jb-itemlist",{},i("table",{},[...a?[]:[i("thead",{},i("tr",{},n.map(t=>i("th",{"jb-ctx":t.ctxId,...t.width&&{style:`width: ${t.width}px`}},jb.ui.fieldTitle(e,t,i)))))],i("tbody.jb-items-parent",{},t.map(e=>i("tr.jb-item",{},e.map(e=>i("td",{},i(e)))))),0==t.length?"no items":""])),css:">table{border-spacing: 0; text-align: left; width: 100%}\n    >table>tbody>tr>td { padding-right: 5px }\n    ",features:[itemlist.init(),calcProp("headerFields","%$$model/controls()/field()%")]})}),jb.component("table.mdc",{type:"itemlist.style",params:[{id:"hideHeaders",as:"boolean",type:"boolean"},{id:"classForTable",as:"string",defaultValue:"mdc-data-table__table mdc-data-table--selectable"}],impl:customStyle({template:(e,{ctrls:t,sortOptions:a,hideHeaders:n,classForTable:i,headerFields:r},o)=>o("div.jb-itemlist mdc-data-table",{},o("table",{class:i},[...n?[]:[o("thead",{},o("tr.mdc-data-table__header-row",{},r.map((t,n)=>o("th.mdc-data-table__header-cell",{"jb-ctx":t.ctxId,class:["asc"==(a&&a.filter(e=>e.field==t)[0]||{}).dir?"mdc-data-table__header--sorted-ascending":"","des"==(a&&a.filter(e=>e.field==t)[0]||{}).dir?"mdc-data-table__header--sorted-descending":""].filter(e=>e).join(" "),style:{width:t.width?t.width+"px":""},onclick:"toggleSort",fieldIndex:n},jb.ui.fieldTitle(e,t,o)))))],o("tbody.jb-items-parent mdc-data-table__content",{},t.map(e=>o("tr.jb-item mdc-data-table__row",{},e.map(e=>o("td.mdc-data-table__cell",{},o(e)))))),0==t.length?"no items":""])),css:"{width: 100%}  \n    ~ .mdc-data-table__header-cell, ~ .mdc-data-table__cell {color: var(--jb-fg)}",features:[itemlist.init(),mdcStyle.initDynamic(),calcProp("headerFields","%$$model/controls()/field()%")]})}),jb.component("picklist.native",{type:"picklist.style",impl:customStyle({template:({},{databind:e,options:t},a)=>a("select",{onchange:!0},t.map(t=>a("option",{value:t.code,...e==t.code&&{selected:""}},t.text))),features:[field.databind(),picklist.init()]})}),jb.component("picklist.nativePlus",{type:"picklist.style",impl:customStyle({template:({},{databind:e,options:t},a)=>a("select",{onchange:!0},t.map(t=>a("option",{value:t.code,...e==t.code&&{selected:""}},t.text))),css:"\n{ display: block; width: 100%; height: 34px; padding: 6px 12px; font-size: 14px; line-height: 1.42857; \n  color: var(--jb-menu-fg); background: var(--jb-menu-bg); \n  background-image: none; border: 1px solid var(--jb-menubar-inactive-bg); border-radius: 4px; box-shadow: inset 0 1px 1px var(--jb-dropdown-shadow);\n}\n:focus { border-color: border-color: var(--jb-menubar-active-bg); outline: 0; box-shadow: inset 0 1px 1px var(--jb-dropdown-shadow); }\n::input-placeholder { color: var(--jb-menu-fg) }",features:[field.databind(),picklist.init()]})}),jb.component("picklist.nativeMdLookOpen",{type:"picklist.style",impl:customStyle({template:(e,t,a)=>a("div",{},[a("input",{type:"text",value:t.databind,list:"list_"+e.ctx.id,onchange:!0}),a("datalist",{id:"list_"+e.ctx.id},t.options.map(e=>a("option",{},e.text)))]),css:">input {  appearance: none; -webkit-appearance: none;\n  padding: 6px 0;\n  width: 100%;\n  color: rgba(0,0,0, 0.82);\n  border: none;\n  border-bottom: 1px solid var(--jb-menubar-inactive-bg);\n  color: var(--mdc-theme-text-primary-on-background); background: var(--mdc-theme-background);\n}\n  { position: relative;}\n  >input:focus { border-color: var(--jb-menubar-active-bg); border-width: 2px}\n\n  :after1 { position: absolute;\n        top: 0.75em;\n        right: 0.5em;\n        /* Styling the down arrow */\n        width: 0;\n        height: 0;\n        padding: 0;\n        content: '';\n        border-left: .25em solid transparent;\n        border-right: .25em solid transparent;\n        border-top: .375em solid var(--mdc-theme-text-primary-on-background);\n        pointer-events: none; }",features:[field.databind(),picklist.init()]})}),jb.component("picklist.plusIcon",{type:"feature",categories:"feature:0,picklist:50",impl:features(Var("color",css.valueOfCssVar("--mdc-theme-text-primary-on-background")),css("-webkit-appearance: none; appearance: none; width: 6px; height: 23px; background-repeat: no-repeat; background-position-y: -1px;"),css("background-image: url(\"data:image/svg+xml;utf8,<svg fill='%$color%' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M17,13 H13 V17 H11 V13 H7 V11 H11 V7 H13 V11 H17 V13 Z'/></svg>\");"))}),jb.component("picklist.radio",{type:"picklist.style",params:[{id:"radioCss",as:"string",defaultValue:"",description:"e.g. display: none"},{id:"text",defaultValue:"%text%",dynamic:!0}],impl:customStyle({template:(e,{databind:t,options:a,fieldId:n,text:i},r)=>r("div",{},a.flatMap((a,o)=>[r("input",{type:"radio",name:n,id:o,...t==a.code&&{checked:""},value:a.code,onchange:!0}),r("label",{for:o},i(e.ctx.setData(a)))])),css:">input { %$radioCss% }",features:[field.databind(),picklist.init()]})}),jb.component("picklist.mdcRadio",{type:"picklist.style",params:[{id:"text",defaultValue:"%text%",dynamic:!0}],impl:customStyle({template:(e,{databind:t,options:a,fieldId:n,text:i},r)=>r("div.mdc-form-field",{},a.flatMap((a,o)=>[r("div.mdc-radio",{},[r("input.mdc-radio__native-control",{type:"radio",name:n,id:o,...t==a.code&&{checked:""},value:a.code,onchange:!0}),r("div.mdc-radio__background",{},[r("div.mdc-radio__outer-circle"),r("div.mdc-radio__inner-circle")]),r("div.mdc-radio__ripple")]),r("label",{for:o},i(e.ctx.setData(a)))])),features:[field.databind(),picklist.init()]})}),jb.component("picklist.radioVertical",{type:"picklist.style",impl:styleWithFeatures(picklist.radio(),layout.grid({columnSizes:list("30px","auto")}))}),jb.component("picklist.mdcSelect",{type:"picklist.style",params:[{id:"width",as:"number",defaultValue:300},{id:"noLabel",as:"boolean",type:"boolean"},{id:"noRipple",as:"boolean",type:"boolean"}],impl:customStyle({template:(e,{databind:t,options:a,title:n,noLabel:i,noRipple:r,hasEmptyOption:o},s)=>s("div.mdc-select",{},[s("div.mdc-select__anchor",{},[...(e.icon||[]).filter(e=>e&&"pre"==e.ctx.vars.$model.position).map(s).map(e=>e.addClass("mdc-text-field__icon mdc-text-field__icon--leading")),s("i.mdc-select__dropdown-icon",{}),s("div.mdc-select__selected-text",{"aria-required":!o},t),...[!i&&s("label.mdc-floating-label",{class:t?"mdc-floating-label--float-above":""},n())].filter(e=>e),...[!r&&s("div.mdc-line-ripple")].filter(e=>e)]),s("div.mdc-select__menu mdc-menu mdc-menu-surface demo-width-class",{},[s("ul.mdc-list",{},a.map(e=>s("li.mdc-list-item",{"data-value":e.code,class:e.code==t?"mdc-list-item--selected":""},s("span.mdc-list-item__text",{},e.text))))])]),features:[field.databind(),picklist.init(),mdcStyle.initDynamic(),css(({},{},{width:e})=>`>* { ${jb.ui.propWithUnits("width",e)} }`),frontEnd.flow(source.callbag(({},{cmp:e})=>jb.callbag.create(t=>e.mdc_comps.forEach(({mdc_cmp:e})=>e.listen("MDCSelect:change",()=>t(e.value))))),rx.takeUntil("%$cmp/destroyed%"),sink.BEMethod("writeFieldValue","%%")),css("~.mdc-select:not(.mdc-select--disabled) .mdc-select__selected-text { color: var(--mdc-theme-text-primary-on-background); background: var(--mdc-theme-background); border-color: var(--jb-menubar-inactive-bg); }\n        ~.mdc-select:not(.mdc-select--disabled) .mdc-floating-label { color: var(--mdc-theme-primary) }")]})}),jb.component("picklist.labelList",{type:"picklist.style",params:[{id:"labelStyle",type:"text.style",dynamic:!0,defaultValue:text.span()},{id:"itemlistStyle",type:"itemlist.style",dynamic:!0,defaultValue:itemlist.ulLi()},{id:"cssForSelected",as:"string",description:"e.g. background: red OR >a { color: red }",defaultValue:"background: #bbb; color: #fff"}],impl:styleByControl(itemlist({items:"%$picklistModel/options%",controls:text({text:"%text%",style:call("labelStyle")}),style:call("itemlistStyle"),features:[itemlist.selection({databind:"%$picklistModel/databind%",selectedToDatabind:"%code%",databindToSelected:(e,{$props:t})=>t.items.find(t=>t.code==e.data),cssForSelected:"%$cssForSelected%"}),itemlist.keyboardSelection(),watchRef("%$picklistModel/databind%")]}),"picklistModel")}),jb.component("picklist.buttonList",{type:"picklist.style",params:[{id:"buttonStyle",type:"button.style",dynamic:!0,defaultValue:button.mdc()},{id:"itemlistStyle",type:"itemlist.style",dynamic:!0,defaultValue:itemlist.horizontal()},{id:"cssForSelected",as:"string",description:"e.g. background: red;color: blue;font-weight: bold;",defaultValue:"background: #bbb; color: #fff"}],impl:styleByControl(itemlist({items:"%$picklistModel/options%",controls:button({title:"%text%",style:call("buttonStyle")}),style:call("itemlistStyle"),features:[itemlist.selection({databind:"%$picklistModel/databind%",selectedToDatabind:"%code%",databindToSelected:(e,{$props:t})=>t.items.find(t=>t.code==e.data),cssForSelected:"%$cssForSelected%"}),watchRef("%$picklistModel/databind%")]}),"picklistModel")}),jb.component("picklist.hyperlinks",{type:"picklist.style",impl:picklist.buttonList({buttonStyle:button.href(),itemlistStyle:itemlist.horizontal("10"),cssForSelected:">a { color: red }"})}),jb.component("picklist.groups",{type:"picklist.style",impl:customStyle({template:(e,{databind:t,hasEmptyOption:a,groups:n},i)=>i("select",{onchange:!0},(a?[i("option",{value:""},"")]:[]).concat(n.map(e=>i("optgroup",{label:e.text},e.options.map(e=>i("option",{value:e.code,...t==e.code&&{selected:""}},e.text)))))),features:[field.databind(),picklist.init(),picklist.initGroups()]})}),jb.component("propertySheet.titlesLeft",{type:"group.style",params:[{id:"titleStyle",type:"text.style",defaultValue:styleWithFeatures(text.span(),css.bold()),dynamic:!0},{id:"titleText",defaultValue:"%%:",dynamic:!0},{id:"spacing",as:"string",description:"grid-column-gap",defaultValue:"10px"}],impl:customStyle({template:(e,{ctrls:t,titleStyle:a,titleText:n},i)=>i("div",{},t.flatMap(t=>[i(e.ctx.run(text({text:e=>n(e.setData(t.field().title())),style:e=>a(e)}))),i(t)])),css:"{ display: grid; grid-template-columns: auto auto; grid-column-gap:%$spacing%}",features:group.initGroup()})}),jb.component("propertySheet.titlesAbove",{type:"group.style",params:[{id:"titleStyle",type:"text.style",defaultValue:styleWithFeatures(text.span(),css.bold()),dynamic:!0},{id:"titleText",defaultValue:"%%",dynamic:!0},{id:"spacing",as:"string",description:"grid-column-gap",defaultValue:"10px"}],impl:customStyle({template:(e,{ctrls:t,titleStyle:a,titleText:n},i)=>i("div",{style:{"grid-template-columns":t.map(()=>"auto").join(" ")}},[...t.map(t=>i(e.ctx.run(text({text:e=>n(e.setData(t.field().title())),style:e=>a(e)})))),...t.map(e=>i(e))]),css:"{ display: grid; grid-column-gap:%$spacing% }",features:group.initGroup()})}),jb.component("editableBoolean.checkbox",{type:"editable-boolean.style",impl:customStyle({template:({},{databind:e},t)=>t("input",{type:"checkbox",...e&&{checked:""},onclick:"toggle",onchange:"toggle",onkeyup:"toggleByKey"}),features:field.databind()})}),jb.component("editableBoolean.checkboxWithLabel",{type:"editable-boolean.style",impl:customStyle({template:({},{title:e,databind:t,fieldId:a},n)=>n("div",{},[n("input",{type:"checkbox",...t&&{checked:""},id:"switch_"+a,onchange:"toggle",onkeyup:"toggleByKey"}),n("label",{for:"switch_"+a},e())]),features:field.databind()})}),jb.component("editableBoolean.expandCollapseWithUnicodeChars",{type:"editable-boolean.style",params:[{id:"toExpandSign",as:"string",defaultValue:"⯈"},{id:"toCollapseSign",as:"string",defaultValue:"⯆"}],impl:customStyle({template:({},{databind:e,toExpandSign:t,toCollapseSign:a},n)=>n("span",{onclick:"toggle"},e?a:t),css:"{cursor: pointer; opacity: 0.6; user-select: none}",features:field.databind()})}),jb.component("editableBoolean.expandCollapse",{type:"editable-boolean.style",impl:customStyle({template:({},{databind:e},t)=>t("i",{class:"material-icons noselect",onclick:"toggle"},e?"keyboard_arrow_down":"keyboard_arrow_right"),css:"{ font-size:16px; cursor: pointer }",features:field.databind()})}),jb.component("editableBoolean.mdcXV",{type:"editable-boolean.style",description:"two icons",params:[{id:"yesIcon",as:"string",mandatory:!0,defaultValue:"check"},{id:"noIcon",as:"string",mandatory:!0,defaultValue:"close"}],impl:customStyle({template:({},{title:e,databind:t,yesIcon:a,noIcon:n},i)=>i("button",{class:["mdc-icon-button material-icons",t&&"raised mdc-icon-button--on"].filter(e=>e).join(" "),title:e(),tabIndex:-1,onclick:"toggle",onkeyup:"toggleByKey"},[i("i",{class:"material-icons mdc-icon-button__icon mdc-icon-button__icon--on"},a),i("i",{class:"material-icons mdc-icon-button__icon "},n)]),css:"{ border-radius: 2px; padding: 0; width: 24px; height: 24px;}",features:[field.databind(),mdcStyle.initDynamic()]})}),jb.component("editableBoolean.buttonXV",{type:"editable-boolean.style",description:"two icons",params:[{id:"yesIcon",type:"icon",mandatory:!0,defaultValue:icon("check")},{id:"noIcon",type:"icon",mandatory:!0,defaultValue:icon("close")},{id:"buttonStyle",type:"button.style",mandatory:!0,defaultValue:button.mdcFloatingAction()}],impl:styleWithFeatures(call("buttonStyle"),features(htmlAttribute("onclick","toggle"),e=>e.run({...e.cmpCtx.params[jb.toboolean(e.vars.$model.databind())?"yesIcon":"noIcon"],title:e.exp("%$$model/title%"),$:"feature.icon"})))}),jb.component("editableBoolean.iconWithSlash",{type:"editable-boolean.style",params:[{id:"buttonSize",as:"number",defaultValue:40,description:"button size is larger than the icon size, usually at the rate of 40/24"}],impl:styleWithFeatures(button.mdcIcon({buttonSize:"%$buttonSize%"}),features(Var("strokeColor",css.valueOfCssVar("mdc-theme-on-secondary")),htmlAttribute("onclick","toggle"),htmlAttribute("title","%$$model/title%"),css(If("%$$model/databind%","","background-repeat: no-repeat; background-image: url(\"data:image/svg+xml;utf8,<svg width='%$buttonSize%' height='%$buttonSize%' viewBox='0 0 %$buttonSize% %$buttonSize%' xmlns='http://www.w3.org/2000/svg'><line x1='0' y1='0' x2='%$buttonSize%' y2='%$buttonSize%' style='stroke:%$strokeColor%;stroke-width:2' /></svg>\")"))))}),jb.component("editableBoolean.mdcSlideToggle",{type:"editable-boolean.style",params:[{id:"width",as:"string",defaultValue:80}],impl:customStyle({template:({},{databind:e,fieldId:t,toggleText:a},n)=>n("div.mdc-switch",{class:e?"mdc-switch--checked":""},[n("div.mdc-switch__track"),n("div.mdc-switch__thumb-underlay",{},n("div.mdc-switch__thumb",{},n("input.mdc-switch__native-control",{type:"checkbox",role:"switch",id:"switch_"+t,"aria-checked":"false",...e&&{checked:"","aria-checked":"true"},onchange:"toggle",onkeyup:"toggleByKey"}))),n("label",{for:"switch_"+t},a)]),css:e=>jb.ui.propWithUnits("width",e.params.width),features:[field.databind(),mdcStyle.initDynamic()]})}),jb.component("editableBoolean.mdcCheckBox",{type:"editable-boolean.style",params:[{id:"width",as:"string",defaultValue:80}],impl:customStyle({template:(e,{databind:t,fieldId:a,title:n},i)=>i("div.mdc-form-field",{},[i("div.mdc-checkbox",{},[i("input.mdc-checkbox__native-control",{type:"checkbox",id:"checkbox_"+a,...t&&{checked:""},onchange:"toggle",onkeyup:"toggleByKey"}),i("div.mdc-checkbox__background",{},[i("svg.mdc-checkbox__checkmark",{viewBox:"0 0 24 24"},i("path.mdc-checkbox__checkmark-path",{fill:"none",d:"M1.73,12.91 8.1,19.28 22.79,4.59"})),i("div.mdc-checkbox__mixedmark")]),i("div.mdc-checkbox__ripple")]),i("label",{for:"checkbox_"+a},n())]),css:e=>jb.ui.propWithUnits("width",e.params.width),features:[field.databind(),css("~ .mdc-checkbox__checkmark { top: -9px}")]})}),jb.component("editableBoolean.picklist",{type:"editable-boolean.style",params:[{id:"picklistStyle",type:"picklist.style",defaultValue:picklist.native(),dynamic:!0}],impl:styleByControl(picklist({databind:"%$editableBooleanModel/databind%",options:list(obj(prop("text","%$editableBooleanModel/textForTrue()%"),prop("code",!0)),obj(prop("text","%$editableBooleanModel/textForFalse()%"),prop("code",!1))),style:call("picklistStyle"),features:picklist.onChange(writeValue("%$editableBooleanModel/databind()%",If("%%==true",!0,!1)))}),"editableBooleanModel")}),jb.component("prettyPrint",{params:[{id:"profile",defaultValue:"%%"},{id:"forceFlat",as:"boolean",type:"boolean"}],impl:(e,t)=>jb.prettyPrint(jb.val(t),{...e.params,comps:jb.studio.previewjb.comps})}),jb.prettyPrintComp=function(e,t,a={}){if(t)return`jb.component('${e}', ${jb.prettyPrint(t,{initialPath:e,...a})})`},jb.prettyPrint=function(e,t={}){return null==e?"":jb.prettyPrintWithPositions(e,t).text},jb.prettyPrint.advanceLineCol=function({line:e,col:t},a){const n=(a.match(/\n/g)||"").length;return{line:e+n,col:n?a.match(/\n(.*)$/)[1].length:t+a.length}},jb.prettyPrint.spaces=Array.from(new Array(200)).map(e=>" ").join(""),jb.prettyPrintWithPositions=function(e,{colWidth:t=120,tabSize:a=2,initialPath:n="",noMacros:i,comps:r,forceFlat:o}={}){if(r=r||jb.comps,!e||"object"!=typeof e)return{text:null!=e&&e.toString?e.toString():JSON.stringify(e),map:{}};const s=d({path:n,line:0,col:0,depth:1},e);return s.text=s.text.replace(/__fixedNL__/g,"\n"),s;function l(e,t){const a=t.reduce((t,{prop:a,item:n})=>{const i="function"==typeof n?n(t):n,r=i.text||i,o=i.map||{},s=i.path||e.path,l=jb.prettyPrint.advanceLineCol(t,""),c=jb.prettyPrint.advanceLineCol(t,r),d={...t.map,...o,[[s,a].join("~")]:[l.line,l.col,c.line,c.col]};return{text:t.text+r,map:d,unflat:t.unflat||i.unflat,...c}},{text:"",map:{},...e});return{...e,...a}}function c(e,n,i,r,s,p){const{path:m,depth:u}=e,b=l(e,[..."string"==typeof i?[{prop:"!open",item:i}]:i,{prop:"!open-newline",item:()=>j()}]),f=p?"array":"obj",y=n.reduce((e,{innerPath:t,val:a},i)=>l(e,[{prop:`!${f}-prefix-${i}`,item:p?"":x(t)+": "},{prop:"!value",item:e=>{const n={...e,path:[m,t].join("~"),depth:u+1};return{...n,...d(n,a,s)}}},{prop:`!${f}-separator-${i}`,item:()=>i===n.length-1?"":","+(s?" ":j())}]),{...b,unflat:!1}),h=l(y,[{prop:"!close-newline",item:()=>j(-1)},..."string"==typeof r?[{prop:"!close",item:r}]:r]),g=function(e){const a=e.text.replace(/\n\s*/g,"").split("__fixedNL__")[0].length>t;if(!jb.studio.valOfPath)return e.unflat||a;const i=jb.studio.valOfPath(m),r=m.match(/~params~[0-9]+$/),o=m.match(/~params$/),s=m.match(/~controls$/)&&Array.isArray(i),l=jb.studio.compNameOfPath&&"customStyle"===jb.studio.compNameOfPath(m),c=n.length>2&&!p,d=!m.match(/~/g);return!r&&(e.unflat||o||l||c||d||s||a)}(h);return!o&&g||s?{...h,unflat:g}:c(e,n,i,r,!0,p);function j(e=0){return s?"":"\n"+jb.prettyPrint.spaces.slice(0,(u+e)*a)}function x(e){return e.match(/^[a-zA-Z_][a-zA-Z0-9_]*$/)?e:`'${e}'`}}function d({path:e,line:t,col:a,depth:n},o,s){const d={path:e,line:t,col:a,depth:n};let p=function(){if(Array.isArray(o))return function(e,t,a){const n=t.map((e,t)=>({innerPath:t,val:e}));return c(e,n,[{prop:"!open-array",item:"["}],[{prop:"!close-array",item:"]"}],a,!0)}(d,o,s);if(null===o)return"null";if(void 0===o)return"undefined";if("object"==typeof o)return function(e,t,a){const n=[jb.compName(t)].map(e=>"var"==e?"variable":e)[0],o=r[n];if(o&&jb.fixMacroByValue(t,o),i||!n||!o||-1!=",object,var,".indexOf(`,${n},`)){const n=Object.keys(t);return n.indexOf("$")>0&&(n.splice(n.indexOf("$"),1),n.unshift("$")),c(e,n.map(e=>({innerPath:e,val:t[e]})),"{","}",a,!1)}const s=jb.macroName(n),l=o.params||[],d=1==l.length&&-1!=(l[0]&&l[0].type||"").indexOf("[]"),p=(t.$vars||[]).map(({name:e,val:t},a)=>({innerPath:`$vars~${a}`,val:{$:"Var",name:e,val:t}})),m=t.remark?[{innerPath:"remark",val:{$remark:t.remark}}]:[],u=p.concat(m),b=[{prop:"!profile",item:s},{prop:"!open-by-value",item:"("}],f=[{prop:"!close-by-value",item:")"}],y=[{prop:"!profile",item:s},{prop:"!open-sugar",item:"("}],h=[{prop:"!close-sugar",item:")"}],g=[{prop:"!profile",item:s},{prop:"!open-profile",item:"({"}];if(d){return c(e,(t.$vars||[]).map(({name:e,val:t})=>({$:"Var",name:e,val:t})).concat(jb.asArray(t[l[0].id])).map((e,t)=>({innerPath:l[0].id+"~"+t,val:e})),y,h,a,!0)}const j=Object.keys(t).filter(e=>"$"!=e),x=1===j.length&&l[0]&&l[0].id==j[0],v=2==j.length&&l.length>=2&&t[l[0].id]&&t[l[1].id];if(l.length<3&&!1!==o.macroByValue||o.macroByValue||x||v){const t=u.concat(l.map(e=>({innerPath:e.id,val:w(e.id)})));for(let e=0;e<5;e++)!t.length||t[t.length-1]&&void 0!==t[t.length-1].val||t.pop();return c(e,t,b,f,a,!0)}const $=(t.remark?[{innerPath:"remark",val:t.remark}]:[]).concat(p.length?[{innerPath:"vars",val:p.map(e=>e.val)}]:[]).concat(l.filter(e=>void 0!==w(e.id)).map(e=>({innerPath:e.id,val:w(e.id)})));return c(e,$,$.length?g:b,$.length?[{prop:"!close-profile",item:"})"}]:f,a,!1);function w(e){return l[0]&&l[0].id==e&&t["$"+n]||t[e]}}(d,o,s);if("function"==typeof o)return o.toString().replace(/\n/g,"__fixedNL__");return"string"==typeof o&&-1==o.indexOf("'")&&-1==o.indexOf("\n")?l(d,[{prop:"!value-text-start",item:"'"},{prop:"!value-text",item:JSON.stringify(o).slice(1,-1)},{prop:"!value-text-end",item:"'"}]):"string"==typeof o&&-1!=o.indexOf("\n")?l(d,[{prop:"!value-text-start",item:"`"},{prop:"!value-text",item:o.replace(/`/g,"\\`")},{prop:"!value-text-end",item:"`"}]):JSON.stringify(o)}();return"string"==typeof p&&(p={text:p,map:{}}),p}},function(){var{tree:e}=jb.ns("tree");jb.component("tree",{type:"control",params:[{id:"title",as:"string"},{id:"nodeModel",type:"tree.node-model",dynamic:!0,mandatory:!0},{id:"style",type:"tree.style",defaultValue:e.expandBox(),dynamic:!0},{id:"features",type:"feature[]",dynamic:!0,as:"array"}],impl:e=>jb.ui.ctrl(e)}),jb.component("tree.noHead",{type:"feature",impl:features(calcProp("noHead",!0))}),jb.component("tree.initTree",{type:"feature",impl:features(variable("treeCmp","%$cmp%"),calcProp("model","%$$model/nodeModel()%"),method("flipExpandCollapse",runActions(({},{$state:e,ev:t})=>e.expanded[t.path]=!e.expanded[t.path],action.refreshCmp("%$$state%"))),userStateProp("expanded",({},{$state:e,$props:t})=>({...e.expanded,...!e.refresh&&{[t.model.rootPath]:!0}})),frontEnd.enrichUserEvent(({},{cmp:e,ev:t})=>{const a=jb.ui.find(t.target,".selected")[0]||t.target,n=jb.ui.find(a,".treenode-label")[0]||a;return t.fixedTarget=n,{path:e.elemToPath(a)}}),frontEnd.prop("elemToPath",()=>e=>e&&(e.getAttribute("path")||jb.ui.closest(e,".treenode")&&jb.ui.closest(e,".treenode").getAttribute("path"))),css("{user-select: none}"))}),jb.component("tree.expandPath",{type:"feature",params:[{id:"paths",as:"array",descrition:"array of paths to be expanded"}],impl:feature.init(({},{$state:e},{paths:t})=>{e.expanded=e.expanded||{},(t||[]).forEach(t=>t.split("~").reduce((t,a,n)=>{const i=n?t+"~"+a:a;return e.expanded[i]=!0,i},""))})}),jb.component("tree.plain",{type:"tree.style",params:[{id:"showIcon",as:"boolean",type:"boolean"}],impl:customStyle({template:(e,{showIcon:a,noHead:n,expanded:i,model:r,selected:o},s)=>{return new t({model:r,expanded:i,h:s,showIcon:a,noHead:n,renderLine:function(e){const t=r.icon(e)||"radio_button_unchecked";return s("div",{class:"treenode-line"},[r.isArray(e)?s("i.material-icons noselect flip-icon",{onclick:"flipExpandCollapse",path:e},i[e]?"keyboard_arrow_down":"keyboard_arrow_right"):s("span",{class:"no-children-holder"}),...a?[s("i",{class:"material-icons treenode-icon"},t)]:[],s("span",{class:"treenode-label"},r.title(e,!i[e]))])},selected:o}).renderTree(e.renderProps.model.rootPath)},css:"|>.treenode-children { padding-left: 10px; min-height: 7px }\n\t|>.treenode-label { margin-top: -1px }\n\n\t|>.treenode-label .treenode-val { color: var(--jb-tree-value); padding-left: 4px; display: inline-block;}\n\t|>.treenode-line { display: flex; box-orient: horizontal; padding-bottom: 3px; align-items: center }\n\n\t|>.treenode { display: block }\n\t|>.flip-icon { font-size: 16px; margin-right: 2px;}\n\t|>.treenode-icon { font-size: 16px; margin-right: 2px; }\n\n\t|>.treenode.selected>*>.treenode-label,.treenode.selected>*>.treenode-label  { \n\t\tcolor: var(--jb-menu-selection-fg); background: var(--jb-menu-selection-bg)}\n\t",features:e.initTree()})}),jb.component("tree.expandBox",{type:"tree.style",params:[{id:"showIcon",as:"boolean",type:"boolean"},{id:"lineWidth",as:"string",defaultValue:"300px"}],impl:customStyle({template:(e,{showIcon:a,noHead:n,expanded:i,model:r,selected:o},s)=>{return new t({model:r,expanded:i,h:s,showIcon:a,noHead:n,renderLine:function(e){const t=r.icon(e)||"radio_button_unchecked",n=r.isArray(e)?"":" nochildren",o=i[e]?"":" collapsed";return s("div",{class:`treenode-line${o}`},[s("button",{class:`treenode-expandbox${n}${a?" showIcon":""}`,onclick:"flipExpandCollapse",path:e},[s("div.frame"),s("div.line-lr"),s("div.line-tb")]),...a?[s("i.material-icons treenode-icon",{},t)]:[],s("span.treenode-label",{},r.title(e,!i[e]))])},selected:o}).renderTree(e.renderProps.model.rootPath)},css:({},{},{lineWidth:e})=>`|>.treenode-children { padding-left: 10px; min-height: 7px }\n\t|>.treenode-label { margin-top: -2px }\n\t|>.treenode-label .treenode-val { color: var(--jb-tree-value); padding-left: 4px; display: inline-block;}\n\t|>.treenode-line { display: flex; box-orient: horizontal; width: ${e}; padding-bottom: 3px;}\n\n\t|>.treenode { display: block }\n\t|>.treenode.selected>*>.treenode-label,.treenode.selected>*>.treenode-label  \n\t\t{ color: var(--jb-menu-selection-fg); background: var(--jb-menu-selection-bg)}\n\n\t|>.treenode-icon { font-size: 16px; margin-right: 2px; }\n\t|>.treenode-expandbox { border: none; background: none; position: relative; width:9px; height:9px; padding: 0; vertical-align: top;\n\t\tmargin-top: 5px;  margin-right: 5px;  cursor: pointer;}\n\t|>.treenode-expandbox.showIcon { margin-top: 3px }\n\t|>.treenode-expandbox div { position: absolute; }\n\t|>.treenode-expandbox .frame { background: var(--jb-menu-bg); border-radius: 3px; border: 1px solid var(--jb-expandbox-bg); top: 0; left: 0; right: 0; bottom: 0; }\n\t|>.treenode-expandbox .line-lr { background: var(--jb-expandbox-bg); top: 4px; left: 2px; width: 5px; height: 1px; }\n\t|>.treenode-expandbox .line-tb { background: var(--jb-expandbox-bg); left: 4px; top: 2px; height: 5px; width: 1px; display: none;}\n\t|>.treenode-line.collapsed .line-tb { display: block; }\n\t|>.treenode.collapsed .line-tb { display: block; }\n\t|>.treenode-expandbox.nochildren .frame { display: none; }\n\t|>.treenode-expandbox.nochildren .line-lr { display: none; }\n\t|>.treenode-expandbox.nochildren .line-tb { display: none;}`,features:e.initTree()})});class t{constructor(e){Object.assign(this,e)}renderTree(){const{model:e,h:t}=this;return this.noHead?t("div",{},e.children(e.rootPath).map(e=>this.renderNode(e))):this.renderNode(e.rootPath)}renderNode(e){const{expanded:t,model:a,h:n}=this,i=a.disabled&&a.disabled(e)?"jb-disabled":"",r=e==this.selected?"selected":"",o=["treenode",a.isArray(e)?"jb-array-node":"",i,r].filter(e=>e).join(" "),s=t[e]&&a.children(e).length?[n("div.treenode-children",{},a.children(e).map(e=>this.renderNode(e)))]:[];return n("div",{class:o,path:e,...t[e]?{expanded:!0}:{}},[this.renderLine(e),...s])}}jb.component("tree.selection",{type:"feature",params:[{id:"databind",as:"ref",dynamic:!0},{id:"onSelection",type:"action",dynamic:!0},{id:"onRightClick",type:"action",dynamic:!0},{id:"autoSelectFirst",type:"boolean"}],impl:features(e.expandPath(e.parentPath("%$databind()%")),method("onSelection",runActions(If(isRef("%$databind()%"),writeValue("%$databind()%","%%")),call("onSelection"))),method("onRightClick",runActions(If(isRef("%$databind()%"),writeValue("%$databind()%","%%")),call("onRightClick"))),userStateProp({id:"selected",phase:20,value:(e,{$props:t,$state:a},{databind:n,autoSelectFirst:i})=>jb.val(n())||a.selected||(i&&t.noHead?t.model.children(t.model.rootPath)[0]:t.model.rootPath)}),followUp.flow(source.data("%$$props/selected%"),rx.filter(and("%$autoSelectFirst%",not("%$$state/refresh%"))),sink.BEMethod("onSelection")),frontEnd.method("applyState",({},{cmp:e})=>{Array.from(jb.ui.findIncludeSelf(e.base,".treenode.selected")).forEach(e=>e.classList.remove("selected")),Array.from(jb.ui.findIncludeSelf(e.base,".treenode")).filter(t=>t.getAttribute("path")==e.state.selected).forEach(e=>{e.classList.add("selected"),e.scrollIntoViewIfNeeded()})}),frontEnd.method("setSelected",({data:e},{cmp:t})=>{t.base.state.selected=t.state.selected=e,t.runFEMethod("applyState")}),frontEnd.prop("selectionEmitter",rx.subject()),frontEnd.flow(source.frontEndEvent("contextmenu"),rx.map(e.pathOfElem("%target%")),rx.filter("%%"),sink.action(runActions(action.runFEMethod("setSelected"),action.runBEMethod("onDoubleClick")))),frontEnd.flow(rx.merge(rx.pipe(source.frontEndEvent("click"),rx.map(e.pathOfElem("%target%")),rx.filter("%%")),source.subject("%$cmp.selectionEmitter%")),rx.filter("%%"),rx.filter(({data:e},{cmp:t})=>t.state.selected!=e),rx.distinctUntilChanged(),sink.action(runActions(action.runFEMethod("setSelected"),action.runBEMethod("onSelection")))))}),jb.component("tree.keyboardSelection",{type:"feature",macroByValue:!1,params:[{id:"onKeyboardSelection",type:"action",dynamic:!0},{id:"onEnter",type:"action",dynamic:!0},{id:"onRightClickOfExpanded",type:"action",dynamic:!0},{id:"autoFocus",type:"boolean"},{id:"applyMenuShortcuts",type:"menu.option",dynamic:!0}],impl:features(htmlAttribute("tabIndex",0),method("onEnter",call("onEnter")),method("runShortcut",(e,{path:t},{applyMenuShortcuts:a})=>{const n=a(e.setData(t));n&&n.runShortcut(e.data)}),method("expand",(e,{cmp:t,$props:a,$state:n},{onRightClickOfExpanded:i})=>{const{expanded:r}=n,o=e.data;n.selected=o,a.model.isArray(o)&&!r[o]?(r[o]=!0,t.refresh(n)):i(e.setData(o))}),method("collapse",({data:e},{cmp:t,$state:a})=>{const{expanded:n}=a,i=e;a.selected=i,n[i]&&(delete n[i],t.refresh(a))}),frontEnd.prop("onkeydown",rx.pipe(source.frontEndEvent("keydown"),rx.filter(not("%ctrlKey%")),rx.filter(not("%altKey%")),frontEnd.addUserEvent())),frontEnd.flow("%$cmp.onkeydown%",rx.filter("%keyCode%==13"),rx.filter("%$cmp.state.selected%"),sink.BEMethod("onEnter","%$cmp.state.selected%")),frontEnd.flow("%$cmp.onkeydown%",rx.filter(inGroup(list(38,40),"%keyCode%")),rx.map(e.nextSelected(If("%keyCode%==40",1,-1))),sink.subjectNext("%$cmp.selectionEmitter%")),frontEnd.flow("%$cmp.onkeydown%",rx.filter("%keyCode%==39"),sink.BEMethod("expand","%$cmp.state.selected%")),frontEnd.flow("%$cmp.onkeydown%",rx.filter("%keyCode%==37"),sink.BEMethod("collapse","%$cmp.state.selected%")),frontEnd.flow(source.callbag(({},{cmp:e})=>jb.callbag.create(t=>e.base.onkeydown=e=>(t(e),!1))),rx.filter(({data:e})=>(e.ctrlKey||e.altKey||46==e.keyCode)&&17!=e.keyCode&&18!=e.keyCode),frontEnd.addUserEvent(),sink.BEMethod("runShortcut","%$ev%",obj(prop("path","%$cmp.state.selected%")))),frontEnd.flow(source.frontEndEvent("click"),sink.FEMethod("regainFocus")),frontEnd.method("regainFocus",action.focusOnCmp("tree regain focus")),frontEnd.var("autoFocus","%$autoFocus%"),frontEnd.init(If("%$autoFocus%",action.focusOnCmp("tree autofocus"))))}),jb.component("tree.dragAndDrop",{type:"feature",impl:features(htmlAttribute("tabIndex",0),method("moveItem",e.moveItem("%from%","%to%")),frontEnd.flow(source.frontEndEvent("keydown"),rx.filter("%ctrlKey%"),rx.filter(inGroup(list(38,40),"%keyCode%")),rx.map(obj(prop("from",e.nextSelected(0)),prop("to",e.nextSelected(If("%keyCode%==40",1,-1))))),rx.filter(e.sameParent("%from%","%to%")),sink.BEMethod("moveItem","%%")),frontEnd.onRefresh((e,{cmp:t})=>t.drake.containers=jb.ui.find(t.base,".jb-array-node>.treenode-children")),frontEnd.init((e,{cmp:t})=>{const a=t.drake=dragula([],{moves:e=>jb.ui.matches(e,".jb-array-node>.treenode-children>div")});a.containers=jb.ui.find(t.base,".jb-array-node>.treenode-children"),a.on("drag",(function(e){const a=t.elemToPath(e.firstElementChild);e.dragged={path:a,expanded:t.state.expanded[a]},delete t.state.expanded[a]})),a.on("drop",(a,n,i,r)=>{if(!a.dragged)return;a.parentNode.removeChild(a),t.state.expanded[a.dragged.path]=a.dragged.expanded;const o=r;let s=o?t.elemToPath(o):n.lastElementChild?d(t.elemToPath(n.lastElementChild),1):t.elemToPath(n);const l=Number(a.dragged.path.split("~").pop()),c=Number(s.split("~").pop())||0;function d(e,t){if(isNaN(Number(e.slice(-1))))return e;const a=Number(e.slice(-1))+t;return e.split("~").slice(0,-1).concat([a]).join("~")}n===i&&c>l&&(s=d(s,-1)),e.run(action.runBEMethod("moveItem",()=>({from:a.dragged.path,to:s})))})}))}),jb.component("tree.nextSelected",{type:"data:0",descrition:"FE action",params:[{id:"diff",as:"number"}],impl:(e,t)=>{const{cmp:a}=e.vars,n=jb.ui.findIncludeSelf(a.base,".treenode"),i=jb.ui.findIncludeSelf(a.base,".treenode.selected")[0];return a.elemToPath(n[n.indexOf(i)+t])}}),jb.component("tree.pathOfInteractiveItem",{type:"data",descrition:"path of the clicked/dragged item using event.target",impl:e.pathOfElem("%$ev/target%")}),jb.component("tree.pathOfElem",{type:"data:0",descrition:"FE action",params:[{id:"elem"}],impl:(e,t)=>e.vars.cmp&&e.vars.cmp.elemToPath&&e.vars.cmp.elemToPath(t)}),jb.component("tree.parentPath",{params:[{id:"path",as:"string",defaultValue:"%%"}],impl:(e,t)=>t.split("~").slice(0,-1).join("~")}),jb.component("tree.lastPathElement",{params:[{id:"path",as:"string",defaultValue:"%%"}],impl:(e,t)=>t.split("~").pop()}),jb.component("tree.sameParent",{descrition:"check if two paths have the same parent",type:"boolean",params:[{id:"path1",as:"string"},{id:"path2",as:"string"}],impl:(e,t,a)=>(t.match(/(.*?)~[0-9]*$/)||[])[1]==(a.match(/(.*?)~[0-9]*$/)||[])[1]}),jb.component("tree.regainFocus",{type:"action",impl:action.focusOnCmp("regain focus","%$treeCmp/cmpId%")}),jb.component("tree.redraw",{type:"action",params:[{id:"strong",type:"boolean",as:"boolean"}],impl:(e,t)=>(jb.log("tree redraw",{cmpId:jb.path(e.vars,"$tree.cmpId"),ctx:e,strong:t}),e.vars.$tree&&e.vars.$tree.redraw&&e.vars.$tree.redraw(t))}),jb.component("tree.moveItem",{type:"action",descrition:"move item in backend, changing also the state of selected and expanded",params:[{id:"from",as:"string"},{id:"to",as:"string"}],impl:(e,t,a)=>{const{cmp:n,$state:i}=e.vars,r=n.renderProps.model,o=function({selected:e,expanded:t}){return{selected:l(e),expanded:jb.entries(t).filter(e=>e[1]).map(e=>l(e[0]))}}(i);r.move(t,a,e);const s=function({selected:e,expanded:t}){return{selected:c(e),expanded:jb.objFromEntries(t.map(e=>[c(e),!0]))}}(o);function l(e){return e&&r.refHandler&&r.refHandler.refOfPath(e.split("~"))}function c(e){return e&&e.path?e.path().join("~"):""}n.refresh(s)}})}();var{tableTree:tableTree,tree:tree}=jb.ns("tableTree,tree");jb.component("tableTree",{type:"control",params:[{id:"title",as:"string"},{id:"treeModel",type:"tree.node-model",dynamic:!0,mandatory:!0},{id:"leafFields",type:"control[]",dynamic:!0},{id:"commonFields",type:"control[]",dynamic:!0,as:"array"},{id:"chapterHeadline",type:"control",dynamic:!0,defaultValue:text(""),description:"$collapsed as parameter"},{id:"style",type:"table-tree.style",defaultValue:tableTree.plain({}),dynamic:!0},{id:"features",type:"feature[]",dynamic:!0,as:"array"}],impl:e=>jb.ui.ctrl(e)}),jb.component("tree.modelFilter",{type:"tree.node-model",description:"filters a model by path filter predicate",params:[{id:"model",type:"tree.node-model",mandatory:!0},{id:"pathFilter",type:"boolean",dynamic:!0,mandatory:!0,description:"input is path. e.g a~b~c"}],impl:(e,t,a)=>Object.assign(Object.create(t),{children:n=>t.children(n).filter(t=>a(e.setData(t)))})}),jb.component("tableTree.init",{type:"feature",impl:features(calcProp("model","%$$model/treeModel()%"),method("flip",runActions(({},{$state:e,ev:t})=>{e.expanded=e.expanded||{},e.expanded[t.path]=!e.expanded[t.path]},action.refreshCmp("%$$state%"))),calcProp("expanded",({},{$state:e,$props:t})=>({...e.expanded,...t.expanded,[t.model.rootPath]:!0})),frontEnd.prop("elemToPath",()=>e=>e&&(e.getAttribute("path")||jb.ui.closest(e,".jb-item")&&jb.ui.closest(e,".jb-item").getAttribute("path"))),frontEnd.enrichUserEvent(({},{cmp:e,ev:t})=>({path:e.elemToPath(t.target)})),calcProp({id:"itemsCtxs",value:(e,{$props:t,$model:a})=>{const n=t.model.rootPath,i=t.expanded,r=t.model,o=(a.includeRoot?s(n,0):s(n,-1).filter(e=>e.depth>-1)).map((a,n)=>((a,n)=>e.setData({path:a.path,val:t.model.val(a.path)}).setVars({index:n,item:a}))(a,n));return o.forEach(e=>jb.ui.preserveCtx(e)),o;function s(e,t){const a=[{path:e,depth:t,val:r.val(e),expanded:i[e]}];return i[e]?r.children(e).reduce((e,a)=>t>=r.maxDepth?e:e=e.concat(s(a,t+1)),a):a}}}),calcProp("maxDepth",firstSucceeding("%$$model/maxDepth%",5)),calcProp("headerFields",list("%$$model/leafFields()/field()%","%$$model/commonFields()/field()%")),calcProp("ctrlsMatrix",(e,{$model:t,$props:a})=>{const n=a.model,i=a.maxDepth,r=Array.from(new Array(i)),o=e=>{const t=(e.match(/~/g)||[]).length-(n.rootPath.match(/~/g)||[]).length-1;return r.filter((e,a)=>a<t+3).map((r,o)=>o<t||o==t&&!n.isArray(e)?{empty:!0}:o==t?{expanded:a.expanded[e],toggle:!0}:o==t+1?{headline:!0,colSpan:i-o+1}:o==t+2?{resizer:!0}:void 0)};return a.itemsCtxs.map(e=>({headlineCtrl:t.chapterHeadline(e),expandingFields:o(e.data.path),ctrls:[...a.model.isArray(e.data.path)?[]:t.leafFields(e),...t.commonFields(e)]}))}))}),jb.component("tableTree.expandFirstLevel",{type:"feature",impl:calcProp({phase:5,id:"before calcProps",value:({},{$state:e,$props:t})=>{if(e.refresh)return;const a=jb.objFromEntries(t.model.children(t.model.rootPath)||[]).map(e=>[e,!0]);t.expanded=Object.assign(t.expanded||{},a)}})}),jb.component("tableTree.plain",{type:"table-tree.style",params:[{id:"hideHeaders",as:"boolean",type:"boolean"},{id:"gapWidth",as:"number",defaultValue:30},{id:"expColWidth",as:"number",defaultValue:16},{id:"noItemsCtrl",type:"control",dynamic:!0,defaultValue:text("no items")}],impl:customStyle({template:(e,{headerFields:t,ctrlsMatrix:a,itemsCtxs:n,expanded:i,maxDepth:r,hideHeaders:o,gapWidth:s,expColWidth:l,noItemsCtrl:c},d)=>d("table",{},[...Array.from(new Array(r)).map(()=>d("col",{width:l+"px"})),d("col.gapCol",{width:s+"px"}),d("col.resizerCol",{width:"5px"}),...t.map(e=>d("col",{width:e.width||"200px"})),...o?[]:[d("thead",{},d("tr",{},[...Array.from(new Array(r+2)).map(e=>d("th.th-expand-collapse",{})),...t.map(t=>d("th",{"jb-ctx":t.ctxId},jb.ui.fieldTitle(e,t,d)))]))],d("tbody.jb-items-parent",{},n.map((e,t)=>d("tr.jb-item",{path:e.data.path,expanded:i[e.data.path]},[...a[t].expandingFields.map(e=>d("td.drag-handle",e.empty?{class:"empty-expand-collapse"}:e.resizer?{class:"tt-resizer"}:e.toggle?{class:"expandbox"}:{class:"headline",colSpan:e.colSpan,onclick:"flip"},e.empty||e.resizer?"":e.toggle?d("span",{},d("i",{class:"material-icons noselect",onclick:"flip"},e.expanded?"keyboard_arrow_down":"keyboard_arrow_right")):d(a[t].headlineCtrl))),...a[t].ctrls.map(a=>d("td.tree-field",{"jb-ctx":e.id},d(a,{index:t})))]))),0==n.length?d(c()):""]),css:"{border-spacing: 0; text-align: left;width: 100%; table-layout:fixed;}\n      >tbody>tr>td { vertical-align: bottom; height: 30px; }\n      >tbody>tr>td>span { font-size:16px; cursor: pointer; border: 1px solid transparent }\n      >tbody>tr>td>span>i { font-size: 16px; vertical-align: middle;}\n      ",features:tableTree.init()})}),jb.component("tableTree.expandPath",{type:"feature",params:[{id:"paths",as:"array",descrition:"array of paths to be expanded"}],impl:tree.expandPath("%$paths%")}),jb.component("tableTree.resizer",{type:"feature",impl:features(css(">tbody>tr>td.tt-resizer { cursor: col-resize }"),frontEnd.method("setSize",({data:e},{el:t})=>t.querySelector(".gapCol").width=e+"px"),frontEnd.flow(source.frontEndEvent("mousedown"),rx.filter(e=>jb.ui.hasClass(e.data.target,"tt-resizer")),rx.var("offset",({data:e},{el:t})=>e.clientX-+t.querySelector(".gapCol").width.slice(0,-2)),rx.flatMap(rx.pipe(source.frontEndEvent("mousemove"),rx.takeWhile("%buttons%!=0"),rx.map(({data:e},{offset:t})=>Math.max(0,e.clientX-t)))),sink.FEMethod("setSize")))}),jb.component("tableTree.dragAndDrop",{type:"feature",impl:features(frontEnd.onRefresh((e,{cmp:t})=>t.drake.containers=jb.ui.find(t.base,".jb-items-parent")),method("moveItem",(e,{$props:t})=>t.model.move(e.data.from,e.data.to,e)),frontEnd.init((e,{cmp:t})=>{const a=t.drake=dragula([],{moves:(e,t,a)=>jb.ui.parents(a,{includeSelf:!0}).some(e=>jb.ui.hasClass(e,"drag-handle"))&&(e.getAttribute("path")||"").match(/[0-9]$/)});a.containers=jb.ui.find(t.base,".jb-items-parent"),a.on("drag",(function(e,a){const n=t.elemToPath(e);e.dragged={path:n,expanded:t.state.expanded[n]},delete t.state.expanded[n]})),a.on("drop",(a,n,i,r)=>{if(!a.dragged)return;a.parentNode.removeChild(a),t.state.expanded[a.dragged.path]=a.dragged.expanded;const o=r;let s=o?t.elemToPath(o):n.lastElementChild?addToIndex(t.elemToPath(n.lastElementChild),1):t.elemToPath(n);const l=Number(a.dragged.path.split("~").pop()),c=Number(s.split("~").pop())||0;n===i&&c>l&&(s=addToIndex(s,-1));const d=a.dragged.path,p=a.dragged.path.split("~").slice(0,-1).join("~")==s.split("~").slice(0,-1).join("~");a.dragged=null,p&&e.run(action.runBEMethod("moveItem",()=>({from:d,to:s})))})}))}),function(){jb.component("tree.jsonReadOnly",{type:"tree.node-model",params:[{id:"object",as:"single",mandatory:!0},{id:"rootPath",as:"string"}],impl:(t,a,n)=>new e(a,n)});class e{constructor(e,t){this.json=e,this.rootPath=t}children(e){const t=this.val(e);return("object"==typeof t?Object.keys(t||{}):[]).filter(e=>0!=e.indexOf("$jb_")).map(t=>e+"~"+t)}val(e){return-1==e.indexOf("~")?jb.val(this.json):jb.val(e.split("~").slice(1).reduce((e,t)=>e[t],this.json))}isArray(e){const t=this.val(e);return"object"==typeof t&&null!==t}icon(){return""}title(e,t){const a=this.val(e),n=e.split("~").pop(),i=jb.ui.h;return i("div",{},null==a?n+": null":t||"object"!=typeof a?"object"!=typeof a?[n+": ",i("span",{class:"treenode-val",title:""+a},jb.ui.limitStringLength(""+a,20))]:[i("span",{},n+": ")].concat(Object.keys(a).filter(e=>0!=e.indexOf("$jb_")).filter(e=>-1!=["string","boolean","number"].indexOf(typeof a[e])).map(e=>i("span",{class:"treenode-val",title:""+a[e]},jb.ui.limitStringLength(""+a[e],20)))):n)}}jb.component("tree.json",{type:"tree.node-model",params:[{id:"object",as:"ref",mandatory:!0},{id:"rootPath",as:"string"}],impl:(e,a,n)=>new t(a,n)});class t{constructor(e,t){this.json=e,this.rootPath=t,this.refHandler=jb.refHandler(e)}children(e){const t=this.val(e);return("object"==typeof t?Object.keys(t||{}):[]).filter(e=>0!=e.indexOf("$jb_")).map(t=>e+"~"+t)}val(e){return-1==e.indexOf("~")?jb.val(this.json):jb.val(e.split("~").slice(1).reduce((e,t)=>e[t],jb.val(this.json)))}isArray(e){var t=this.val(e);return"object"==typeof t&&null!==t}icon(){return""}title(e,t){var a=this.val(e),n=e.split("~").pop(),i=jb.ui.h;return null==a?n+": null":t||"object"!=typeof a?i("div",{},"object"!=typeof a?[n+": ",i("span",{class:"treenode-val",title:a},jb.ui.limitStringLength(a,20))]:[i("span",{},n+": ")].concat(Object.keys(a).filter(e=>"string"==typeof a[e]||"number"==typeof a[e]||"boolean"==typeof a[e]).map(e=>i("span",{class:"treenode-val",title:""+a[e]},jb.ui.limitStringLength(""+a[e],20))))):n}modify(e,t,a,n){e.call(this,t,a)}move(e,t,a){const n=this.val(e.split("~").slice(0,-1).join("~")),i=isNaN(Number(t.split("~").slice(-1)))?t+"~0":t,r=this.val(i.split("~").slice(0,-1).join("~"));Array.isArray(n)&&Array.isArray(r)&&jb.move(jb.asRef(this.val(e)),this.val(i)?jb.asRef(this.val(i)):this.extraArrayRef(i),a)}extraArrayRef(e){const t=this.val(e.split("~").slice(0,-1).join("~")),a=jb.asRef(t),n=a.handler;return n&&n.refOfPath(n.pathOfRef(a).concat(e.split("~").slice(-1)))}}}(),jb.remoteCtx={stripCtx(e){if(!e)return null;const t="function"==typeof e.profile,a=jb.prettyPrint(e.profile),n=jb.objFromEntries(jb.entries(e.vars).filter(e=>"$disableLog"==e[0]||a.match(new RegExp(`\\b${e[0]}\\b`))).map(e=>[e[0],this.stripData(e[1])])),i=jb.objFromEntries(jb.entries(t?e.params:jb.entries(jb.path(e.cmpCtx,"params"))).filter(e=>a.match(new RegExp(`\\b${e[0]}\\b`))).map(e=>[e[0],this.stripData(e[1])]));return Object.assign({id:e.id,path:e.path,profile:e.profile,vars:n},t?{params:i,vars:n}:Object.keys(i).length?{cmpCtx:{params:i}}:{})},stripData(e){if(null!=e)return-1!=["string","boolean","number"].indexOf(typeof e)?e:"function"==typeof e?this.stripFunction(e):e instanceof jb.jbCtx?this.stripCtx(e):Array.isArray(e)?e.map(e=>this.stripData(e)):"object"==typeof e&&-1==["VNode","Object","Array"].indexOf(e.constructor.name)?{$$:e.constructor.name}:"object"==typeof e?jb.objFromEntries(jb.entries(e).map(e=>[e[0],this.stripData(e[1])])):void 0},stripFunction({profile:e,runCtx:t,path:a,forcePath:n,param:i}){if(!e||!t)return;const r=jb.prettyPrint(e),o=this.stripJSFromProfile(e),s=jb.objFromEntries(jb.entries(t.vars).filter(e=>r.match(new RegExp(`\\b${e[0]}\\b`))).map(e=>[e[0],this.stripData(e[1])])),l=jb.objFromEntries(jb.entries(jb.path(t.cmpCtx,"params")).filter(e=>r.match(new RegExp(`\\b${e[0]}\\b`))).map(e=>[e[0],this.stripData(e[1])]));return Object.assign({$:"runCtx",id:t.id,path:a,forcePath:n,param:i,profile:o,vars:s},Object.keys(l).length?{cmpCtx:{params:l}}:{})},serailizeCtx(e){return JSON.stringify(this.stripCtx(e))},deStrip(data){if("string"==typeof data&&data.match(/^__JBART_FUNC:/))return eval(data.slice(14));const stripedObj="object"==typeof data&&jb.objFromEntries(jb.entries(data).map(e=>[e[0],this.deStrip(e[1])]));return stripedObj&&"runCtx"==data.$?(e,t)=>(new jb.jbCtx).ctx({...stripedObj}).extendVars(e,t).runItself():Array.isArray(data)?data.map(e=>this.deStrip(e)):stripedObj||data},stripCBVars(e){const t=jb.remoteCtx.stripData(e);return t&&t.vars&&(t.vars=jb.objFromEntries(jb.entries(t.vars).filter(e=>0!=e[0].indexOf("$")))),t},stripJSFromProfile(e){return"object"==typeof e?jb.objFromEntries(jb.entries(e).map(([e,t])=>[e,"function"==typeof t?`__JBART_FUNC: ${t.toString()}`:this.stripData(t)])):e}};var{remote:remote,waitFor:waitFor}=jb.ns("remote");jb.remote={servers:{},pathOfDistFolder(){const e=jb.path(jb.studio,"studiojb.studio.host.pathOfDistFolder"),t=jb.path(jb.studio,"studioWindow.location")||jb.path(jb.frame,"location");return e&&e()||t&&t.href.match(/^[^:]*/)[0]+`://${t.host}/dist`},cbPortFromFrame(e,t,a){return this.extendPortWithCbHandler(this.portFromFrame(e,t,a)).initCommandListener()},portFromFrame(e,t,a){const n={from:t,to:a,postMessage:n=>{jb.log(`remote sent from ${t} to ${a}`,{m:n}),e.postMessage({from:t,to:a,...n})},onMessage:{addListener:n=>e.addEventListener("message",e=>{e.data.to==t&&e.data.from==a&&(jb.log(`remote received at ${t} from ${e.data.from} to ${e.data.to}`,{m:e.data}),n(e.data))})},onDisconnect:{addListener:e=>{n.disconnectHandler=e}}};return n},extendPortWithCbHandler:e=>Object.assign(e,{cbHandler:{counter:0,map:{},newId(){return e.from+":"+this.counter++},get(e){return this.map[e]},getAsPromise(e,t){return jb.exec(waitFor({check:()=>this.map[e],interval:5,times:10})).catch(t=>jb.logError("cbLookUp - can not find cb",{id:e})).then(a=>(2==t&&this.removeEntry(e),a))},addToLookup(e){const t=this.newId();return this.map[t]=e,t},removeEntry(e){jb.delay(1e3).then(()=>jb.asArray(e).filter(e=>e).forEach(e=>delete this.map[e]))},inboundMsg({cbId:e,t:t,d:a}){return 2==t&&this.removeEntry(e),this.getAsPromise(e,t).then(n=>n&&n(t,0==t?this.remoteCB(a,e):a))},outboundMsg({cbId:t,t:a,d:n}){e.postMessage({$:"CB",cbId:t,t:a,d:0==a?this.addToLookup(n):n})},remoteCB(t,a){let n;return(i,r)=>{2==i&&this.removeEntry([a,n]),e.postMessage({$:"CB",cbId:t,t:i,d:0==i?n=this.addToLookup(r):jb.remoteCtx.stripCBVars(r)})}},handleCBCommnad(e){const{$:t,sourceId:a,cbId:n}=e,i=jb.remoteCtx.deStrip(e.remoteRun)();"CB.createSource"==t?this.map[n]=i:"CB.createOperator"==t&&(this.map[n]=i(this.remoteCB(a,n)))}},initCommandListener(){return this.onMessage.addListener(e=>{0==(e.$||"").indexOf("CB.")?this.cbHandler.handleCBCommnad(e):"CB"==e.$&&this.cbHandler.inboundMsg(e)}),this},createRemoteSource(e){const t=this.cbHandler.newId();return this.postMessage({$:"CB.createSource",remoteRun:e,cbId:t}),(e,a)=>this.cbHandler.outboundMsg({cbId:t,t:e,d:a})},createRemoteOperator(e){return t=>{const a=this.cbHandler.addToLookup(t),n=this.cbHandler.newId();return this.postMessage({$:"CB.createOperator",remoteRun:e,sourceId:a,cbId:n}),(e,t)=>{2==e&&console.log("send 2",n,a),this.cbHandler.outboundMsg({cbId:n,t:e,d:t})}}}})},jb.component("remote.worker",{type:"remote",params:[{id:"id",as:"string",defaultValue:"1"},{id:"libs",as:"array",defaultValue:["common","remote","rx"]}],impl:(e,t,a)=>{const n=`${jb.frame.jbUri?`${jb.frame.jbUri}→`:""}worker-${t}`;if(jb.remote.servers[n])return jb.remote.servers[n];const i=jb.remote.pathOfDistFolder(),r=((jb.path(jb.frame,"location.href")||"").match("[?&]spy=([^&]+)")||["",""])[1],o=[...a.map(e=>`importScripts('${i}/!${n}!${e}.js')`),`\n                //jb.cbLogByPath = {}\n                jbUri = '${n}'\n                spy = jb.initSpy({spyParam: '${r}'})\n                portToMaster = jb.remote.cbPortFromFrame(self,'${n}','master')\n            `].join("\n"),s=jb.remote.servers[n]=new Worker(URL.createObjectURL(new Blob([o],{name:t,type:"application/javascript"})));return s.port=jb.remote.cbPortFromFrame(s,"master",n),s.jbUri=n,s}}),jb.component("remote.local",{type:"remote",impl:()=>({uri:"local"})}),jb.component("source.remote",{type:"rx",macroByValue:!0,params:[{id:"rx",type:"rx",dynamic:!0},{id:"remote",type:"remote",defaultValue:remote.local()}],impl:(e,t,a)=>a.port?a.port.createRemoteSource(jb.remoteCtx.stripFunction(t)):t()}),jb.component("remote.operator",{type:"rx",params:[{id:"rx",type:"rx",dynamic:!0},{id:"remote",type:"remote",defaultValue:remote.local()}],impl:(e,t,a)=>a.port?a.port.createRemoteOperator(jb.remoteCtx.stripFunction(t)):t()})}).call(this,__webpack_require__(1))},function(e,t){var a;a=function(){return this}();try{a=a||new Function("return this")()}catch(e){"object"==typeof window&&(a=window)}e.exports=a}]);