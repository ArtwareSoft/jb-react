!function(e){var t={};function a(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=t,a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(i,n,function(t){return e[t]}.bind(null,n));return i},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(module,exports,__webpack_require__){(function(global){const frame="object"==typeof self?self:"object"==typeof global?global:{},jb=function(){function e(i,n,l){if(g("req",[i,n,l]),i.probe&&i.probe.outOfTime)return;jb.ctxByPath&&(jb.ctxByPath[i.path]=i);const c=function(i,n,l){try{const l=i.profile;if(null==l||"object"==typeof l&&l.$disabled)return s(null,n);if(l.$debugger,l.$asIs)return l.$asIs;if(n&&(n.type||"").indexOf("[]")>-1&&!n.as&&(n.as="array"),"object"==typeof l&&0==Object.getOwnPropertyNames(l).length)return;const c=function(e,t){if(!t)return e;let a=e;for(let e in t||{})a=new y(a,{vars:{[e]:a.runInner(t[e]||"%%",null,"$vars~"+e)}});return a}(i,l.$vars),d=function(i,n){const r=i.profile,o=typeof r,s=n&&n.type,l=n&&n.as,c=Array.isArray(r);if("string"===o&&"boolean"===s)return{type:"booleanExp"};if("boolean"===o||"number"===o||"asIs"==s)return{type:"asIs"};if("object"===o&&"object"===l)return{type:"object"};if("string"===o)return{type:"expression"};if("function"===o)return{type:"function"};if("object"===o&&r instanceof RegExp)return{type:"asIs"};if(null==r)return{type:"asIs"};if(c){if(!r.length)return{type:"null"};if(!n||!n.type||"data"===n.type)return{type:"list"};if("action"===s||"action[]"===s&&r.isArray)return r.sugar=!0,{type:"runActions"}}else if(r.$if)return{type:"if",ifContext:new y(i,{profile:r.$if||r.condition,path:"$if"}),IfParentParam:{type:"boolean",as:"boolean"},thenContext:new y(i,{profile:r.then||0,path:"~then"}),thenParentParam:{type:s,as:l},elseContext:new y(i,{profile:r.else||0,path:"~else"}),elseParentParam:{type:s,as:l}};const d=b(r,n);if(!d)return{type:"asIs"};const p=jb.comps[d];if(!p&&d)return x("component "+d+" is not defined",i),{type:"null"};if(!p.impl)return x("component "+d+" has no implementation",i),{type:"null"};a(r,p);const u=Object.assign(new y(i,{}),{parentParam:n,params:{}}),f=function(a,i,n,r){return t(i).filter(e=>!e.ignore).map((o,s)=>{const l=o.id,c=m(n);let d=n[l],p=l;!d&&0==s&&c&&(p=c[0],d=c[1]);const u=void 0!==d?d:void 0!==o.defaultValue?o.defaultValue:null,b=void 0===d&&void 0!==o.defaultValue&&[a,"params",t(i).indexOf(o),"defaultValue"].join("~");b&&(p="");const f=u||[],y=o.type&&o.type.indexOf("[]")>-1&&Array.isArray(f);if(o.dynamic){return{name:l,type:"function",outerFunc:t=>{let a;return a=y?(e,a)=>jb.flattenArray(f.map((i,n)=>t.extendVars(e,a).runInner(i,o,p+"~"+n))):(a,i)=>e(new jb.jbCtx(t.extendVars(a,i),{profile:u,forcePath:b,path:p}),o),Object.defineProperty(a,"name",{value:l}),a.profile=void 0!==d?d:void 0!==o.defaultValue?o.defaultValue:null,a.srcPath=r.path,a},path:p,param:o,forcePath:b}}return y?{name:l,type:"array",array:f,param:Object.assign({},o,{type:o.type.split("[")[0],as:null}),forcePath:b,path:p}:{name:l,type:"run",prof:u,param:o,forcePath:b,path:p}})}(d,p,r,u);return"function"==typeof p.impl?(Object.defineProperty(p.impl,"name",{value:d}),{type:"profile",impl:p.impl,ctx:u,preparedParams:f}):{type:"profile",ctx:new y(u,{profile:p.impl,comp:d,path:""}),preparedParams:f}}(c,n);switch(i.parentParam=n,d.type){case"booleanExp":return s(o(l,i,n),n);case"expression":return s(r(l,i,n),n);case"asIs":return l;case"function":return s(l(i,i.vars,i.componentContext&&i.componentContext.params),n);case"null":return s(null,n);case"ignore":return i.data;case"list":return l.map((e,t)=>c.runInner(e,null,t));case"runActions":return jb.comps.runActions.impl(new y(c,{profile:{actions:l},path:""}));case"if":{const t=e(d.ifContext,d.IfParentParam);return t&&t.then?t.then(t=>t?e(d.thenContext,d.thenParentParam):e(d.elseContext,d.elseParentParam)):t?e(d.thenContext,d.thenParentParam):e(d.elseContext,d.elseParentParam)}case"profile":let t;if(d.impl||(d.ctx.callerPath=i.path),d.preparedParams.forEach(t=>{switch(t.type){case"function":d.ctx.params[t.name]=t.outerFunc(d.ctx);break;case"array":d.ctx.params[t.name]=t.array.map((a,n)=>e(new y(d.ctx,{profile:a,forcePath:t.forcePath||i.path+"~"+t.path+"~"+n,path:""}),t.param));break;default:d.ctx.params[t.name]=e(new y(d.ctx,{profile:t.prof,forcePath:t.forcePath||i.path+"~"+t.path,path:""}),t.param)}}),d.impl){const e=function(e,t){if(0==t.filter(t=>{const a=e.params[t.name]||{};return jb.isDelayed(a)&&"observable"!=t.param.as}).length)return[e,...t.map(t=>e.params[t.name])];const{pipe:a,concatMap:i,fromIter:n,toPromiseArray:r}=jb.callbag;return a(n(t),i(t=>e.params[t.name]),r).then(t=>[e,...t])}(d.ctx,d.preparedParams);if(l.$debugger,e.then)return e.then(e=>s(d.impl.apply(null,e),n));t=d.impl.apply(null,e)}else t=e(new y(d.ctx,{componentContext:d.ctx}),n);return l.$log&&console.log(!0===l.$log?t:c.run(l.$log)),l.$trace&&console.log("trace: "+i.path,i,t,d),s(t,n)}}catch(e){v(e,"exception while running run",i,n,l)}}(...arguments);return i.probe&&0==i.probe.pathToTrace.indexOf(i.path)&&i.probe.record(i,c),g("res",[i,c,n,l]),c}function t(e){return e&&e.params?Array.isArray(e.params)?e.params:$(e.params).map(e=>Object.assign(e[1],{id:e[0]})):[]}function a(e,a){if(e&&e.$byValue){const i=t(a);e.$byValue.forEach((t,a)=>Object.assign(e,{[i[a].id]:t})),delete e.$byValue}}function i(e){return e?(e.$jb_parent&&(e.$jb_parent=i(e.$jb_parent)),e&&"object"==typeof e&&1==e._state?e._result:e):e}function n(e){return"ref"===e||"ref[]"===e}function r(e,t,a){let s=""+e;if("boolean"==(a&&(a.ref?"ref":a.as)))return o(s,t);if(0==s.indexOf("$debugger:")&&(s=s.split("$debugger:")[1]),0==s.indexOf("$log:")){const e=r(s.split("$log:")[1],t,a);return jb.comps.log.impl(t,e),e}return-1==s.indexOf("%")&&-1==s.indexOf("{")?s:"{%%}"==s||"%%"==s?d(""):0==s.lastIndexOf("{%")&&s.indexOf("%}")==s.length-2?d(s.substring(2,s.length-2)):(s=(s=s.replace(/{%(.*?)%}/g,(e,t)=>c(d(t,{as:"string"})))).replace(/{\?(.*?)\?}/g,(e,a)=>c(function(e){const a=e.match(/%([^%;{}\s><"']*)%/);return a&&c(d(a[1]))?r(e,t,{as:"string"}):""}(a)))).match(/^%[^%;{}\s><"']*%$/)?d(s.substring(1,s.length-1),a):s=s.replace(/%([^%;{}\s><"']*)%/g,(e,t)=>c(d(t,{as:"string"})));function d(e,r){return i(function(e,t,a){const r=a&&(a.ref?"ref":a.as),o=e.split(/[./[]/);return o.reduce((e,s,c)=>(function e(o,s,c,d){if(""==s)return o;s.match(/]$/)&&(s=s.slice(0,-1));const m=jb.objHandler(o);const u=s.match(/=([a-zA-Z]*)\(?([^)]*)\)?/);if(u&&jb.functions[u[1]])return l(jb.functions[u[1]](t,u[2]),r);if(s.match(/\(\)$/)){const a=e(o,s.slice(0,-2),c,d);return"function"==typeof a?a(t):a}if(d&&"$"==s.charAt(0)&&s.length>1)return function(e,t,a){let r;return e.componentContext&&void 0!==e.componentContext.params[t]?r=e.componentContext.params[t]:void 0!==e.vars[t]?r=e.vars[t]:e.vars.scope&&void 0!==e.vars.scope[t]?r=e.vars.scope[t]:jb.resources&&void 0!==jb.resources[t]?r=n(a)?jb.mainWatchableHandler.refOfPath([t]):jb.resource(t):jb.consts&&void 0!==jb.consts[t]&&(r=n(a)?jb.simpleValueByRefHandler.objectProperty(jb.consts,t):r=jb.consts[t]),i(r)}(t,s.substr(1),c?r:null);const b=w(o);if("length"==s&&b&&void 0!==b.length)return b.length;if(Array.isArray(b)&&isNaN(Number(s)))return[].concat.apply([],b.map(t=>e(t,s,c,!1,m)).filter(e=>null!=e));if(null!=o&&"object"==typeof o){if(null==b)return;if("function"==typeof b[s]&&(a&&a.dynamic||b[s].profile))return b[s](t);if(n(r)){if(c)return m.objectProperty(b,s,t);void 0===b[s]&&(b[s]=function(e,t,a){return jb.log("implicitlyCreateInnerObject",[...arguments]),e[t]={},a.refreshMapDown&&a.refreshMapDown(e),e[t]}(b,s,m))}return c&&r?p[r](b[s]):b[s]}})(e,s,c==o.length-1,0==c),t.data)}(e,t,r||a))}}function o(e,t,a){if(0==e.indexOf("$debugger:")&&(e=e.split("$debugger:")[1]),0==e.indexOf("$log:")){const i=r(e.split("$log:")[1],t,{as:"boolean"}),n=o(e.split("$log:")[1],t,a);return jb.comps.log.impl(t,i+":"+n),n}if(0==e.indexOf("!"))return!o(e.substring(1),t);const i=e.match(/(.+)(==|!=|<|>|>=|<=|\^=|\$=)(.+)/);if(!i){const i=r(e,t,a);if(jb.isRef(i))return i;const n=jb.tostring(i);if("boolean"==typeof n)return n;const o=c(n);return!!o&&"false"!=o}if(4!=i.length)return x("invalid boolean expression: "+e,t);const n=i[2].trim();if("=="==n||"!="==n||"$="==n||"^="==n){const e=c(r(p(i[1]),t,{as:"string"}));let a=c(r(p(i[3]),t,{as:"string"}));if(a=(a.match(/^["'](.*)["']/)||["",a])[1],"=="==n)return e==a;if("!="==n)return e!=a;if("^="==n)return 0==e.lastIndexOf(a,0);if("$="==n)return-1!==e.indexOf(a,e.length-a.length)}const s=d(r(i[1].trim(),t)),l=d(r(i[3].trim(),t));if(">"==n)return s>l;if("<"==n)return s<l;if(">="==n)return s>=l;if("<="==n)return s<=l;function p(e){return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}}function s(e,t){return l(e,t?t.as:null)}function l(e,t){return t?(p[t],p[t](e)):e}const c=e=>l(e,"string"),d=e=>l(e,"number"),p={asIs:e=>e,object:e=>(Array.isArray(e)&&(e=e[0]),e&&"object"==typeof e?w(e):{}),string:e=>(Array.isArray(e)&&(e=e[0]),null==e?"":void 0===(e=w(e))?"":""+e),number(e){if(Array.isArray(e)&&(e=e[0]),null==e||null==e)return null;const t=Number(w(e),!0);return isNaN(t)?null:t},array:e=>("function"==typeof e&&e.profile&&(e=e()),e=w(e),Array.isArray(e)?e:null==e?[]:[e]),boolean:e=>(Array.isArray(e)&&(e=e[0]),!(!(e=w(e))||"false"==e)),single:e=>(Array.isArray(e)&&(e=e[0]),w(e)),ref:e=>(Array.isArray(e)&&(e=e[0]),jb.asRef(e)),"ref[]":function(e){return jb.asRef(e)},value:e=>w(e)};function m(e){return $(e).filter(e=>0==e[0].indexOf("$")&&e[0].length>1).filter(e=>0!=e[0].indexOf("$jb_")).filter(e=>-1==["$vars","$debugger","$log"].indexOf(e[0]))[0]}function u(e,t){const a=t&&t.type&&t.type.split("[")[0];return a&&jb.comps[a]&&jb.comps[a].singleInType&&a}function b(e,t){if(!e||Array.isArray(e))return;if(e.$)return e.$;const a=m(e);return a&&a[0].slice(1)||u(0,t)}let f=0;class y{constructor(e,t){this.id=f++,this._parent=e,void 0===e?(this.vars={},this.params={}):(t.profile&&null==t.path&&(t.path="?"),this.profile=void 0!==t.profile?t.profile:e.profile,this.path=(e.path||"")+(t.path?"~"+t.path:""),t.forcePath&&(this.path=this.forcePath=t.forcePath),t.comp&&(this.path=t.comp+"~impl"),this.data=void 0!==t.data?t.data:e.data,this.vars=t.vars?Object.assign({},e.vars,t.vars):e.vars,this.params=t.params||e.params,this.componentContext=void 0!==t.componentContext?t.componentContext:e.componentContext,this.probe=e.probe)}run(t,a){return e(new y(this,{profile:t,comp:t.$,path:""}),a)}exp(e,t){return r(e,this,{as:t})}setVars(e){return new y(this,{vars:e})}setVar(e,t){return e?new y(this,{vars:{[e]:t}}):this}setData(e){return new y(this,{data:e})}runInner(t,a,i){return e(new y(this,{profile:t,path:i}),a)}bool(e){return this.run(e,{as:"boolean"})}ctx(e){return new y(this,e)}frame(){return frame}extendVars(e,t){return null==e&&null==t?this:new y(this,{vars:e?e.vars:null,data:null==t?e.data:t,forcePath:e&&e.forcePath?e.forcePath:null})}runItself(t,a){return e(this,t,a)}callStack(){const e=[];for(let t=this;t;t=t.componentContext)e.push(t);return e.map(e=>e.callerPath)}}const h=e=>e.reduce((e,t)=>e&&e[t],jb.comps)||{},g=(e,t,a)=>jb.spy&&jb.spy.log(e,t,{modifier:e=>{e[1]instanceof y&&e.splice(1,0,j(e[1].path)),e[0]instanceof y&&e.splice(0,0,j(e[0].path))},...a});function j(e){if(!e)return"";const t=e.split("~");for(;!jb.compName(h(t))&&t.length>0;)t.pop();return jb.compName(h(t))+": "+e}function x(){frame.console&&frame.console.log("%c Error: ","color: red",...arguments),g("error",[...arguments])}function v(e,t,a,...i){frame.console&&frame.console.log("%c Exception: ","color: red",...arguments),g("exception",[e.stack||"",a,t&&j(a&&a.path),e,...i])}function w(e){if(null==e||"object"!=typeof e)return e;const t=jb.refHandler(e);return t?t.val(e):e}function $(e){if(!e||"object"!=typeof e)return[];let t=[];for(let a in e)e.hasOwnProperty(a)&&0!=a.indexOf("$jb_")&&t.push([a,e[a]]);return t}return{run:e,jbCtx:y,expression:r,bool_expression:o,profileType:function(e){if(!e)return"";if("string"==typeof e)return"data";const t=b(e);return jb.comps[t]&&jb.comps[t].type||""},compName:b,pathSummary:j,logs:{},logError:x,log:g,logException:v,tojstype:l,jstypes:p,tostring:c,toarray:e=>l(e,"array"),toboolean:e=>l(e,"boolean"),tosingle:e=>l(e,"single"),tonumber:d,types:{},ui:{},rx:{},ctxDictionary:{},testers:{},compParams:t,singleInType:u,val:w,entries:$,objFromEntries:function(e){const t={};return e.forEach(e=>t[e[0]]=e[1]),t},frame:frame,fixByValue:a,ctxCounter:e=>f,simpleValueByRefHandler:{val:e=>e&&e.$jb_val?e.$jb_val():e&&e.$jb_parent?e.$jb_parent[e.$jb_property]:e,writeValue(e,t,a){if(jb.log("writeValue",["valueByRefWithjbParent",t,e,a]),e)return e.$jb_val?e.$jb_val(this.val(t)):e.$jb_parent&&(e.$jb_parent[e.$jb_property]=this.val(t)),e},push(e,t){const a=jb.asArray(jb.val(e));jb.toarray(t).forEach(e=>a.push(e))},asRef:e=>e,isRef:e=>e&&(e.$jb_parent||e.$jb_val||e.$jb_obj),objectProperty(e,t){return this.isRef(e[t])?e[t]:{$jb_parent:e,$jb_property:t}}}}}();Object.assign(jb,{comps:{},resources:{},consts:{},location:Symbol.for("location"),studio:{previewjb:jb},removeDataResourcePrefix:e=>0==e.indexOf("dataResource.")?e.slice("dataResource.".length):e,addDataResourcePrefix:e=>0==e.indexOf("dataResource.")?e:"dataResource."+e,component:(e,t)=>{const a=jb.macroName(e);try{const e=(new Error).stack.split(/\r|\n/).filter(e=>e&&!e.match(/\)<anonymous>|about:blank|tgp-pretty.js|internal\/modules\/cjs/)).pop();if(t[jb.location]=(e.match(/\\?([^:]+):([^:]+):[^:]+$/)||["","","",""]).slice(1,3),void 0!==t.watchableData)return jb.comps[jb.addDataResourcePrefix(a)]=t,jb.resource(jb.removeDataResourcePrefix(a),t.watchableData);if(void 0!==t.passiveData)return jb.comps[jb.addDataResourcePrefix(a)]=t,jb.const(jb.removeDataResourcePrefix(a),t.passiveData)}catch(e){console.log(e)}jb.comps[a]=t,(t.params||[]).forEach(e=>{"boolean"==e.as&&-1==["boolean","ref"].indexOf(e.type)&&(e.type="boolean")}),jb.registerMacro&&jb.registerMacro(a,t)},type:(e,t)=>jb.types[e]=t||{},resource:(e,t)=>(void 0!==t&&(jb.resources[e]=t),jb.mainWatchableHandler&&jb.mainWatchableHandler.resourceReferred(e),jb.resources[e]),const:(e,t)=>void 0===t?jb.consts[e]:jb.consts[e]=t||{},functionDef:(e,t)=>jb.functions[e]=t,path:(e,t,a)=>{let i=e;if("string"==typeof t&&(t=t.split(".")),t=jb.asArray(t),void 0===a)return t.reduce((e,t)=>e&&e[t],e);for(let e=0;e<t.length;e++)e==t.length-1?i[t[e]]=a:i=i[t[e]]=i[t[e]]||{};return a},compareArrays:(e,t)=>{if(e===t)return!0;if(!Array.isArray(e)&&!Array.isArray(t))return e===t;if(!e||!t||e.length!=t.length)return!1;for(let a=0;a<e.length;a++){const i=(e[a]||{}).key,n=(t[a]||{}).key;if((!i||!n||i!==n||e[a].val!==t[a].val)&&e[a]!==t[a])return!1}return!0},range:(e,t)=>Array.apply(0,Array(t)).map((t,a)=>a+e),flattenArray:e=>{let t=[];return e.filter(e=>e).forEach((function(e){Array.isArray(e)?t=t.concat(e):t.push(e)})),t},isDelayed:e=>{if(e&&e.constructor!=={}.constructor)return"object"==typeof e?"[object Promise]"===Object.prototype.toString.call(e):"function"==typeof e?jb.callbag.isCallbag(e):void 0},toSynchArray:e=>{const t=jb.asArray(e);if(0==t.filter(e=>jb.isDelayed(e)).length)return t;const{pipe:a,fromIter:i,toPromiseArray:n,concatMap:r,flatMap:o}=jb.callbag;return a(i(t),r(e=>e),o(e=>Array.isArray(e)?e:[e]),n)},subscribe:(e,t)=>jb.callbag.subscribe(t)(e),unique:(e,t)=>{t=t||(e=>e);let a={},i=[];return e.forEach(e=>{a[t(e)]||(a[t(e)]=!0,i.push(e))}),i},isEmpty:e=>0===Object.keys(e).length,isObject:e=>null!=e&&"object"==typeof e,asArray:e=>null==e?[]:Array.isArray(e)?e:[e],filterEmpty:e=>Object.entries(e).reduce((e,[t,a])=>null==a?e:{...e,[t]:a},{}),equals:(e,t)=>e==t||jb.val(e)==jb.val(t),delay:e=>new Promise(t=>{setTimeout(t,e)}),extraWatchableHandlers:[],extraWatchableHandler:(e,t)=>{jb.extraWatchableHandlers.push(e);const a=jb.extraWatchableHandlers.indexOf(t);return-1!=a&&jb.extraWatchableHandlers.splice(a,1),jb.watchableHandlers=[jb.mainWatchableHandler,...jb.extraWatchableHandlers].map(e=>e),e},setMainWatchableHandler:e=>{jb.mainWatchableHandler=e,jb.watchableHandlers=[jb.mainWatchableHandler,...jb.extraWatchableHandlers].map(e=>e)},watchableHandlers:[],safeRefCall:(e,t)=>{const a=jb.refHandler(e);return a&&a.isRef(e)?t(a):jb.logError("invalid ref",e)},refHandler:e=>e&&e.handler?e.handler:jb.simpleValueByRefHandler.isRef(e)?jb.simpleValueByRefHandler:jb.watchableHandlers.find(t=>t.isRef(e)),objHandler:e=>e&&jb.refHandler(e)||jb.watchableHandlers.find(t=>t.watchable(e))||jb.simpleValueByRefHandler,asRef:e=>{const t=jb.watchableHandlers.find(t=>t.watchable(e)||t.isRef(e));return t?t.asRef(e):jb.simpleValueByRefHandler.asRef(e)},writeValue:(e,t,a)=>!a.probe&&jb.safeRefCall(e,i=>i.writeValue(e,t,a)),objectProperty:(e,t,a)=>jb.objHandler(e).objectProperty(e,t,a),splice:(e,t,a)=>!a.probe&&jb.safeRefCall(e,i=>i.splice(e,t,a)),move:(e,t,a)=>!a.probe&&jb.safeRefCall(e,i=>i.move(e,t,a)),push:(e,t,a)=>!a.probe&&jb.safeRefCall(e,i=>i.push(e,t,a)),isRef:e=>jb.refHandler(e),isWatchable:()=>!1,isValid:e=>jb.safeRefCall(e,t=>t.isValid(e)),refreshRef:e=>jb.safeRefCall(e,t=>t.refresh(e))}),"undefined"!=typeof self&&(self.jb=jb),module.exports=jb,Object.assign(jb,{macroDef:Symbol("macroDef"),macroNs:{},macroName:e=>e.replace(/[_-]([a-zA-Z])/g,(e,t)=>t.toUpperCase()),ns:e=>e.split(",").forEach(e=>jb.registerMacro(e+".$dummyComp",{})),registerMacro:(e,t)=>{const a=jb.macroName(e).replace(/\./g,"_"),i=-1!=e.indexOf(".")&&jb.macroName(e.split(".")[0]);function n(a){jb.frame[a]=new Proxy(()=>0,{get:(e,t)=>"symbol"==typeof t||(jb.frame[a+"_"+t]||function(e,t){return(...a)=>{const{args:i,system:n}=r(a),o={$:`${e}.${t}`};return 1!=i.length||"object"!=typeof i[0]||jb.compName(i[0])?Object.assign(o,{$byValue:i}):Object.assign(o,i[0]),Object.assign(o,n)}}(a,t)),apply:function(a,i,n){const{args:o,system:s}=r(n);return Object.assign(function(a){if(0==a.length)return{$:e};const i=t.params||[],n=-1!=(i[0]&&i[0].type||"").indexOf("[]");if(1==i.length&&n)return{$:e,[i[0].id]:a};const r=1==a.length&&"object"==typeof a[0]&&(i[0]&&a[0][i[0].id]||i[1]&&a[0][i[1].id]);if((t.macroByValue||i.length<3)&&!1!==t.macroByValue&&!r)return{$:e,...jb.objFromEntries(a.filter((e,t)=>i[t]).map((e,t)=>[i[t].id,e]))};if(1==a.length&&!Array.isArray(a[0])&&"object"==typeof a[0]&&!a[0].$)return{$:e,...a[0]};if(1==a.length&&i.length)return{$:e,[i[0].id]:a[0]};if(2==a.length&&i.length>1)return{$:e,[i[0].id]:a[0],[i[1].id]:a[1]}}(o),s)}})}function r(e){const t=[],a={};return e.forEach(e=>{e&&"object"==typeof e&&(jb.comps[e.$]||{}).isSystem?jb.comps[e.$].macro(a,e):t.push(e)}),1==t.length&&"object"==typeof t[0]&&(jb.asArray(t[0].vars).forEach(e=>jb.comps[e.$].macro(a,e)),t[0].remark&&jb.comps.remark.macro(a,t[0])),{args:t,system:a}}function o(t,a){return jb.frame[t]&&!jb.frame[t][jb.macroDef]?(jb.logError(t+" is reserved by system or libs. please use a different name"),!1):(void 0===jb.frame[t]||a||jb.macroNs[t]||t.match(/_\$dummyComp$/)||jb.logError(t.replace(/_/g,".")+" is defined more than once, using last definition "+e),!0)}o(a)&&n(a),i&&o(i,!0)&&!jb.frame[i]&&(n(i),jb.macroNs[i]=!0)}}),jb.component("call",{type:"any",params:[{id:"param",as:"string"}],impl:function(e,t){const a=e.componentContext&&e.componentContext.params[t];return"function"==typeof a?a(new jb.jbCtx(e,{data:e.data,vars:e.vars,componentContext:e.componentContext.componentContext,forcePath:a.srcPath})):a}}),jb.pipe=function(e,t){const a=[jb.toarray(e.data)[0]];if("string"==typeof e.profile.items)return e.runInner(e.profile.items,null,"items");const i=jb.asArray(e.profile.items||e.profile[t]),n=e.profile.items&&e.profile.items.sugar?"":e.profile[t]?t+"~":"items~";return"$pipe"==t?i.reduce((e,t,a)=>e.then(e=>jb.toSynchArray(e)).then(e=>r(t,a,e)),Promise.resolve(a)).then(e=>jb.toSynchArray(e)):i.reduce((e,t,a)=>r(t,a,e),a);function r(t,a,r){if(!t||t.$disabled)return r;const o=a<i.length-1?{as:"array"}:e.parentParam||{};return"aggregator"==jb.profileType(t)?jb.run(new jb.jbCtx(e,{data:r,profile:t,path:n+a}),o):[].concat.apply([],r.map(i=>jb.run(new jb.jbCtx(e,{data:i,profile:t,path:n+a}),o)).filter(e=>null!=e).map(e=>Array.isArray(jb.val(e))?jb.val(e):e))}},jb.component("pipeline",{type:"data",description:"map data arrays one after the other",params:[{id:"items",type:"data,aggregator[]",ignore:!0,mandatory:!0,composite:!0,description:'click "=" for functions list'}],impl:e=>jb.pipe(e,"$pipeline")}),jb.component("pipe",{type:"data",description:"map asynch data arrays",params:[{id:"items",type:"data,aggregator[]",ignore:!0,mandatory:!0,composite:!0}],impl:e=>jb.pipe(e,"$pipe")}),jb.component("data.if",{type:"data",macroByValue:!0,params:[{id:"condition",as:"boolean",mandatory:!0,dynamic:!0,type:"boolean"},{id:"then",mandatory:!0,dynamic:!0},{id:"else",dynamic:!0,defaultValue:"%%"}],impl:(e,t,a,i)=>t()?a():i()}),jb.component("action.if",{type:"action",description:"if then else",macroByValue:!0,params:[{id:"condition",type:"boolean",as:"boolean",mandatory:!0},{id:"then",type:"action",mandatory:!0,dynamic:!0},{id:"else",type:"action",dynamic:!0}],impl:(e,t,a,i)=>t?a():i()}),jb.component("jbRun",{type:"action",params:[{id:"profile",as:"string",mandatory:!0,description:"profile name"},{id:"params",as:"single"}],impl:(e,t,a)=>e.run(Object.assign({$:t},a||{}))}),jb.component("list",{type:"data",description:"also flatten arrays",params:[{id:"items",type:"data[]",as:"array",composite:!0}],impl:function(e,t){let a=[];return t.forEach(e=>{Array.isArray(e)?a=a.concat(e):a.push(e)}),a}}),jb.component("firstSucceeding",{type:"data",params:[{id:"items",type:"data[]",as:"array",composite:!0}],impl:function(e,t,a){for(let e=0;e<t.length;e++){const i=jb.val(t[e]),n="number"==typeof i;if((a||""!==i)&&null!=i&&(!n||!isNaN(i)&&i!==1/0&&i!==-1/0))return t[e]}const i=t.slice(-1)[0];return null!=i&&jb.val(i)}}),jb.component("keys",{type:"data",description:"Object.keys",params:[{id:"obj",defaultValue:"%%",as:"single"}],impl:(e,t)=>Object.keys(t&&"object"==typeof t?t:{})}),jb.component("properties",{description:"object entries as id,val",type:"data",params:[{id:"obj",defaultValue:"%%",as:"single"}],impl:(e,t)=>Object.keys(t).filter(e=>0!=e.indexOf("$jb_")).map((e,a)=>({id:e,val:t[e],index:a}))}),jb.component("entries",{description:"object entries as array 0/1",type:"data",params:[{id:"obj",defaultValue:"%%",as:"single"}],impl:(e,t)=>jb.entries(t)}),jb.component("aggregate",{type:"aggregator",description:"calc function on all items, rather then one by one",params:[{id:"aggregator",type:"aggregator",mandatory:!0,dynamic:!0}],impl:(e,t)=>t()}),jb.ns("math"),jb.component("math.max",{type:"aggregator",impl:e=>Math.max.apply(0,e.data)}),jb.component("math.min",{type:"aggregator",impl:e=>Math.max.apply(0,e.data)}),jb.component("math.sum",{type:"aggregator",impl:e=>e.data.reduce((e,t)=>+t+e,0)}),"abs,acos,acosh,asin,asinh,atan,atan2,atanh,cbrt,ceil,clz32,cos,cosh,exp,expm1,floor,fround,hypot,log2,random,round,sign,sin,sinh,sqrt,tan,tanh,trunc".split(",").forEach(e=>jb.component(`math.${e}`,{impl:t=>Math[e](t.data)})),jb.component("objFromEntries",{description:"object from entries",type:"aggregator",params:[{id:"entries",defaultValue:"%%",as:"array"}],impl:(e,t)=>jb.objFromEntries(t)}),jb.component("evalExpression",{description:"evaluate javascript expression",type:"data",params:[{id:"expression",as:"string",defaultValue:"%%",expression:"e.g. 1+2"}],impl:(ctx,expression)=>{try{return eval("("+expression+")")}catch(e){}}}),jb.component("prefix",{type:"data",params:[{id:"separator",as:"string",mandatory:!0},{id:"text",as:"string",defaultValue:"%%"}],impl:(e,t,a)=>(a||"").substring(0,a.indexOf(t))}),jb.component("suffix",{type:"data",params:[{id:"separator",as:"string",mandatory:!0},{id:"text",as:"string",defaultValue:"%%"}],impl:(e,t,a)=>(a||"").substring(a.lastIndexOf(t)+t.length)}),jb.component("removePrefix",{type:"data",params:[{id:"separator",as:"string",mandatory:!0},{id:"text",as:"string",defaultValue:"%%"}],impl:(e,t,a)=>-1==a.indexOf(t)?a:a.substring(a.indexOf(t)+t.length)}),jb.component("removeSuffix",{type:"data",params:[{id:"separator",as:"string",mandatory:!0},{id:"text",as:"string",defaultValue:"%%"}],impl:(e,t,a)=>-1==a.lastIndexOf(t)?a:a.substring(0,a.lastIndexOf(t))}),jb.component("removeSuffixRegex",{type:"data",params:[{id:"suffix",as:"string",mandatory:!0,description:"regular expression. e.g [0-9]*"},{id:"text",as:"string",defaultValue:"%%"}],impl:function(e,t,a){e.profile.prefixRegexp=e.profile.prefixRegexp||new RegExp(t+"$");const i=(a||"").match(e.profile.prefixRegexp);return i&&(a||"").substring(i.index+1)||a}}),jb.component("writeValue",{type:"action",params:[{id:"to",as:"ref",mandatory:!0},{id:"value",mandatory:!0}],impl:(e,t,a)=>{const i=jb.val(a);if(jb.isDelayed(i))return Promise.resolve().then(a=>jb.writeValue(t,a,e));jb.writeValue(t,i,e)}}),jb.component("property",{description:"navigate/select/path property of object",params:[{id:"prop",as:"string",mandatory:!0},{id:"obj",defaultValue:"%%"}],impl:(e,t,a)=>jb.objectProperty(a,t,e)}),jb.component("indexOf",{params:[{id:"array",as:"array",mandatory:!0},{id:"item",as:"single",mandatory:!0}],impl:(e,t,a)=>t.indexOf(a)}),jb.component("addToArray",{type:"action",params:[{id:"array",as:"ref",mandatory:!0},{id:"toAdd",as:"array",mandatory:!0}],impl:(e,t,a)=>jb.push(t,JSON.parse(JSON.stringify(a)),e)}),jb.component("splice",{type:"action",params:[{id:"array",as:"ref",mandatory:!0},{id:"fromIndex",as:"number",mandatory:!0},{id:"noOfItemsToRemove",as:"number",defaultValue:0},{id:"itemsToAdd",as:"array",defaultValue:[]}],impl:(e,t,a,i,n)=>jb.splice(t,[[a,i,...n]],e)}),jb.component("removeFromArray",{type:"action",params:[{id:"array",as:"ref",mandatory:!0},{id:"itemToRemove",as:"single",description:"choose item or index"},{id:"index",as:"number",description:"choose item or index"}],impl:(e,t,a,i)=>{const n=a?jb.toarray(t).indexOf(a):i;-1!=n&&jb.splice(t,[[n,1]],e)}}),jb.component("toggleBooleanValue",{type:"action",params:[{id:"of",as:"ref"}],impl:(e,t)=>jb.writeValue(t,!jb.val(t),e)}),jb.component("slice",{type:"aggregator",params:[{id:"start",as:"number",defaultValue:0,description:"0-based index",mandatory:!0},{id:"end",as:"number",mandatory:!0,description:"0-based index of where to end the selection (not including itself)"}],impl:function({data:e},t,a){return e&&e.slice?a?e.slice(t,a):e.slice(t):null}}),jb.component("sort",{type:"aggregator",params:[{id:"propertyName",as:"string",description:"sort by property inside object"},{id:"lexical",as:"boolean",type:"boolean"},{id:"ascending",as:"boolean",type:"boolean"}],impl:({data:e},t,a,i)=>{if(!e||!Array.isArray(e))return null;let n;const r=jb.entries(e[0]||{})[0][1];return n=a||isNaN(r)?t?(e,a)=>e[t]==a[t]?0:e[t]<a[t]?-1:1:(e,t)=>e==t?0:e<t?-1:1:t?(e,a)=>e[t]-a[t]:(e,t)=>e-t,i?e.slice(0).sort((e,t)=>n(e,t)):e.slice(0).sort((e,t)=>n(t,e))}}),jb.component("first",{type:"aggregator",params:[{id:"items",as:"array",defaultValue:"%%"}],impl:(e,t)=>t[0]}),jb.component("last",{type:"aggregator",params:[{id:"items",as:"array",defaultValue:"%%"}],impl:(e,t)=>t.slice(-1)[0]}),jb.component("count",{type:"aggregator",description:"length, size of array",params:[{id:"items",as:"array",defaultValue:"%%"}],impl:(e,t)=>t.length}),jb.component("reverse",{type:"aggregator",params:[{id:"items",as:"array",defaultValue:"%%"}],impl:(e,t)=>t.reverse()}),jb.component("sample",{type:"aggregator",params:[{id:"size",as:"number",defaultValue:300},{id:"items",as:"array",defaultValue:"%%"}],impl:(e,t,a)=>a.filter((e,i)=>i%(Math.floor(a.length/t)||1)==0)}),jb.component("obj",{description:"build object (dictionary) from props",params:[{id:"props",type:"prop[]",mandatory:!0,sugar:!0}],impl:(e,t)=>jb.objFromEntries(t.map(t=>[t.title,jb.tojstype(t.val(e),t.type)]))}),jb.component("extend",{description:"assign and extend with calculated properties",params:[{id:"props",type:"prop[]",mandatory:!0,defaultValue:[]}],impl:(e,t)=>Object.assign({},e.data,jb.objFromEntries(t.map(t=>[t.title,jb.tojstype(t.val(e),t.type)])))}),jb.component("assign",jb.comps.extend),jb.component("extendWithIndex",{type:"aggregator",description:"extend with calculated properties. %$index% is available ",params:[{id:"props",type:"prop[]",mandatory:!0,defaultValue:[]}],impl:(e,t)=>jb.toarray(e.data).map((a,i)=>Object.assign({},a,jb.objFromEntries(t.map(t=>[t.title,jb.tojstype(t.val(e.setData(a).setVars({index:i})),t.type)]))))}),jb.component("prop",{type:"prop",macroByValue:!0,params:[{id:"title",as:"string",mandatory:!0},{id:"val",dynamic:!0,type:"data",mandatory:!0,defaultValue:""},{id:"type",as:"string",options:"string,number,boolean,object,array",defaultValue:"string"}],impl:e=>e.params}),jb.component("refProp",{type:"prop",description:"value by reference allows to change or watch the value",params:[{id:"title",as:"string",mandatory:!0},{id:"val",dynamic:!0,as:"ref",mandatory:!0}],impl:e=>({...e.params,type:"ref"})}),jb.component("pipeline.var",{type:"aggregator",params:[{id:"name",as:"string",mandatory:!0},{id:"val",mandatory:!0,dynamic:!0,defaultValue:"%%"}],impl:e=>({[Symbol.for("Var")]:!0,...e.params})}),jb.component("Var",{type:"var,system",isSystem:!0,params:[{id:"name",as:"string",mandatory:!0},{id:"val",dynamic:!0,type:"data",mandatory:!0,defaultValue:"%%"}],macro:(e,t)=>Object.assign(e,{$vars:Object.assign(e.$vars||{},{[t.name]:t.val})})}),jb.component("remark",{type:"system",isSystem:!0,params:[{id:"remark",as:"string",mandatory:!0}],macro:(e,t)=>Object.assign(e,{remark:t.remark})}),jb.component("If",{macroByValue:!0,params:[{id:"condition",as:"boolean",mandatory:!0,dynamic:!0,type:"boolean"},{id:"then",dynamic:!0},{id:"Else",dynamic:!0}],impl:(e,t,a,i)=>t()?a():i()}),jb.component("not",{type:"boolean",params:[{id:"of",type:"boolean",as:"boolean",mandatory:!0,composite:!0}],impl:(e,t)=>!t}),jb.component("and",{description:"logical and",type:"boolean",params:[{id:"items",type:"boolean[]",ignore:!0,mandatory:!0,composite:!0}],impl:function(e){const t=e.profile.$and||e.profile.items||[],a=e.profile.$and?"$and~":"items~";for(let i=0;i<t.length;i++)if(!e.runInner(t[i],{type:"boolean"},a+i))return!1;return!0}}),jb.component("or",{description:"logical or",type:"boolean",params:[{id:"items",type:"boolean[]",ignore:!0,mandatory:!0,composite:!0}],impl:function(e){const t=e.profile.$or||e.profile.items||[],a=e.profile.$or?"$or~":"items~";for(let i=0;i<t.length;i++)if(e.runInner(t[i],{type:"boolean"},a+i))return!0;return!1}}),jb.component("between",{description:"checks if number is in range",type:"boolean",params:[{id:"from",as:"number",mandatory:!0},{id:"to",as:"number",mandatory:!0},{id:"val",as:"number",defaultValue:"%%"}],impl:(e,t,a,i)=>i>=t&&i<=a}),jb.component("contains",{type:"boolean",params:[{id:"text",type:"data[]",as:"array",mandatory:!0},{id:"allText",defaultValue:"%%",as:"string"},{id:"inOrder",defaultValue:!0,as:"boolean",type:"boolean"}],impl:function(e,t,a,i){let n=-1;for(let e=0;e<t.length;e++){const r=a.indexOf(jb.tostring(t[e]),n+1);if(-1==r)return!1;n=i?r:-1}return!0}}),jb.component("notContains",{type:"boolean",params:[{id:"text",type:"data[]",as:"array",mandatory:!0},{id:"allText",defaultValue:"%%",as:"array"}],impl:not(contains({text:"%$text%",allText:"%$allText%"}))}),jb.component("startsWith",{description:"begins with, includes, contains",type:"boolean",params:[{id:"startsWith",as:"string",mandatory:!0},{id:"text",defaultValue:"%%",as:"string"}],impl:(e,t,a)=>0==a.indexOf(t)}),jb.component("endsWith",{description:"includes, contains",type:"boolean",params:[{id:"endsWith",as:"string",mandatory:!0},{id:"text",defaultValue:"%%",as:"string"}],impl:(e,t,a)=>-1!==a.indexOf(t,a.length-t.length)}),jb.component("filter",{type:"aggregator",params:[{id:"filter",type:"boolean",as:"boolean",dynamic:!0,mandatory:!0}],impl:(e,t)=>jb.toarray(e.data).filter(a=>t(e,a))}),jb.component("matchRegex",{description:"validation with regular expression",type:"boolean",params:[{id:"regex",as:"string",mandatory:!0,description:"e.g: [a-zA-Z]*"},{id:"text",as:"string",defaultValue:"%%"}],impl:(e,t,a)=>a.match(new RegExp(t))}),jb.component("toUpperCase",{params:[{id:"text",as:"string",defaultValue:"%%"}],impl:(e,t)=>t.toUpperCase()}),jb.component("toLowerCase",{params:[{id:"text",as:"string",defaultValue:"%%"}],impl:(e,t)=>t.toLowerCase()}),jb.component("capitalize",{params:[{id:"text",as:"string",defaultValue:"%%"}],impl:(e,t)=>t.charAt(0).toUpperCase()+t.slice(1)}),jb.component("join",{params:[{id:"separator",as:"string",defaultValue:",",mandatory:!0},{id:"prefix",as:"string"},{id:"suffix",as:"string"},{id:"items",as:"array",defaultValue:"%%"},{id:"itemText",as:"string",dynamic:!0,defaultValue:"%%"}],type:"aggregator",impl:(e,t,a,i,n,r)=>{const o=e.profile.itemText?t=>r(e.setData(t)):e=>jb.tostring(e);return a+n.map(o).join(t)+i}}),jb.component("unique",{params:[{id:"id",as:"string",dynamic:!0,defaultValue:"%%"},{id:"items",as:"array",defaultValue:"%%"}],type:"aggregator",impl:(e,t,a)=>{const i="%%"==t.profile?e=>e:a=>t(e.setData(a));return jb.unique(a,i)}}),jb.component("log",{params:[{id:"obj",as:"single",defaultValue:"%%"}],impl:function(e,t){let a=t;return"undefined"!=typeof GLOBAL&&"object"==typeof t&&(a=JSON.stringify(t,null," ")),"undefined"!=typeof window?(window.parent||window).console.log(a):console.log(a),a}}),jb.component("asIs",{params:[{id:"$asIs",ignore:!0}],impl:e=>context.profile.$asIs}),jb.component("object",{impl:function(e){let t={};const a=e.profile.$object||e.profile;if(Array.isArray(a))return a;for(let i in a)"$"==i&&"object"==a[i]||null==a[i]||(t[i]=e.runInner(a[i],null,i));return t}}),jb.component("json.stringify",{params:[{id:"value",defaultValue:"%%"},{id:"space",as:"string",description:"use space or tab to make pretty output"}],impl:(e,t,a)=>JSON.stringify(jb.val(t),null,a)}),jb.component("json.parse",{params:[{id:"text",as:"string"}],impl:(e,t)=>{try{return JSON.parse(t)}catch(t){jb.logException(t,"json parse",e)}}}),jb.component("split",{description:"breaks string using separator",type:"data",params:[{id:"separator",as:"string",defaultValue:",",description:'E.g., "," or "<a>"'},{id:"text",as:"string",defaultValue:"%%"},{id:"part",options:",first,second,last,but first,but last"}],impl:function(e,t,a,i){const n=a.split(t.replace(/\\r\\n/g,"\n").replace(/\\n/g,"\n"));switch(i){case"first":return n[0];case"second":return n[1];case"last":return n.pop();case"but first":return n.slice(1);case"but last":return n.slice(0,-1);default:return n}}}),jb.component("replace",{type:"data",params:[{id:"find",as:"string",mandatory:!0},{id:"replace",as:"string",mandatory:!0},{id:"text",as:"string",defaultValue:"%%"},{id:"useRegex",type:"boolean",as:"boolean",defaultValue:!0},{id:"regexFlags",as:"string",defaultValue:"g",description:"g,i,m"}],impl:function(e,t,a,i,n,r){return n?i.replace(new RegExp(t,r),a):i.replace(t,a)}}),jb.component("touch",{description:"change the value of a watchable variable to acticate its watchers",type:"action",params:[{id:"data",as:"ref"}],impl:function(e,t){const a=Number(jb.val(t));jb.writeValue(t,a?a+1:1,ctx)}}),jb.component("isNull",{description:"is null or undefined",type:"boolean",params:[{id:"obj",defaultValue:"%%"}],impl:(e,t)=>null==jb.val(t)}),jb.component("isEmpty",{type:"boolean",params:[{id:"item",as:"single",defaultValue:"%%"}],impl:(e,t)=>!t||Array.isArray(t)&&0==t.length}),jb.component("notEmpty",{type:"boolean",params:[{id:"item",as:"single",defaultValue:"%%"}],impl:(e,t)=>t&&!(Array.isArray(t)&&0==t.length)}),jb.component("equals",{type:"boolean",params:[{id:"item1",as:"single",mandatory:!0},{id:"item2",defaultValue:"%%",as:"single"}],impl:(e,t,a)=>t==a}),jb.component("notEquals",{type:"boolean",params:[{id:"item1",as:"single",mandatory:!0},{id:"item2",defaultValue:"%%",as:"single"}],impl:(e,t,a)=>t!=a}),jb.component("runActions",{type:"action",params:[{id:"actions",type:"action[]",ignore:!0,composite:!0,mandatory:!0}],impl:e=>{e.profile;const t=jb.asArray(e.profile.actions||e.profile.$runActions).filter(e=>e),a=e.profile.actions&&e.profile.actions.sugar?"":e.profile.$runActions?"$runActions~":"items~";return t.reduce((t,i,n)=>t.then(t=>e.runInner(i,{as:"single"},a+n)),Promise.resolve())}}),jb.component("runActionOnItems",{type:"action",macroByValue:!0,params:[{id:"items",as:"ref[]",mandatory:!0},{id:"action",type:"action",dynamic:!0,mandatory:!0},{id:"notifications",as:"string",options:"wait for all actions,no notifications",description:"notification for watch-ref, default behavior is after each action"},{id:"indexVariable",as:"string"}],impl:(e,t,a,i,n)=>(i&&jb.mainWatchableHandler&&jb.mainWatchableHandler.startTransaction(),jb.val(t).reduce((t,i,r)=>t.then(t=>a(e.setVar(n,r).setData(i))),Promise.resolve()).catch(t=>jb.logException(t,e)).then(()=>i&&jb.mainWatchableHandler&&jb.mainWatchableHandler.endTransaction("no notifications"===i)))}),jb.component("delay",{type:"action,data",params:[{id:"mSec",as:"number",defaultValue:1}],impl:(e,t)=>jb.delay(t).then(()=>e.data)}),jb.component("onNextTimer",{description:"run action after delay",type:"action",params:[{id:"action",type:"action",dynamic:!0,mandatory:!0},{id:"delay",type:"number",defaultValue:1}],impl:(e,t,a)=>jb.delay(a,e).then(()=>t())}),jb.component("extractPrefix",{type:"data",params:[{id:"separator",as:"string",description:"/w- alphnumberic, /s- whitespace, ^- beginline, $-endline"},{id:"text",as:"string",defaultValue:"%%"},{id:"regex",type:"boolean",as:"boolean",description:"separator is regex"},{id:"keepSeparator",type:"boolean",as:"boolean"}],impl:function(e,t,a,i,n){if(!i)return a.substring(0,a.indexOf(t))+(n?t:"");{const e=a.match(t);if(e)return a.substring(0,e.index)+(n?e[0]:"")}}}),jb.component("extractSuffix",{type:"data",params:[{id:"separator",as:"string",description:"/w- alphnumberic, /s- whitespace, ^- beginline, $-endline"},{id:"text",as:"string",defaultValue:"%%"},{id:"regex",type:"boolean",as:"boolean",description:"separator is regex"},{id:"keepSeparator",type:"boolean",as:"boolean"}],impl:function(e,t,a,i,n){if(!i)return a.substring(a.lastIndexOf(t)+(n?0:t.length));{const e=a.match(t+"(?![\\s\\S]*"+t+")");if(e)return a.substring(e.index+(n?0:e[0].length))}}}),jb.component("range",{description:"returns a range of number, generator, numerator, numbers, index",type:"data",params:[{id:"from",as:"number",defaultValue:1},{id:"to",as:"number",defaultValue:10}],impl:(e,t,a)=>Array.from(Array(a-t+1).keys()).map(e=>e+t)}),jb.component("typeOf",{type:"data",params:[{id:"obj",defaultValue:"%%"}],impl:(e,t)=>{const a=jb.val(t);return Array.isArray(a)?"array":typeof a}}),jb.component("className",{type:"data",params:[{id:"obj",defaultValue:"%%"}],impl:(e,t)=>{const a=jb.val(t);return a&&a.constructor&&a.constructor.name}}),jb.component("isOfType",{type:"boolean",params:[{id:"type",as:"string",mandatory:!0,description:"e.g., string,boolean,array"},{id:"obj",defaultValue:"%%"}],impl:(e,t,a)=>{const i=jb.val(a),n=Array.isArray(i)?"array":typeof i;return-1!=t.split(",").indexOf(n)}}),jb.component("inGroup",{description:"is in list, contains in array",type:"boolean",params:[{id:"group",as:"array",mandatory:!0},{id:"item",as:"single",defaultValue:"%%"}],impl:(e,t,a)=>-1!=t.indexOf(a)}),jb.urlProxy=("undefined"!=typeof window&&location.href.match(/^[^:]*/)[0]||"http")+"://jbartdb.appspot.com/jbart_db.js?op=proxy&url=",jb.cacheKiller=0,jb.component("http.get",{type:"data,action",description:"fetch data from external url",params:[{id:"url",as:"string"},{id:"json",as:"boolean",description:"convert result to json",type:"boolean"},{id:"useProxy",as:"string",options:",localhost-server,cloud"}],impl:(e,t,a,i)=>{if(e.probe)return jb.http_get_cache[t];const n=a||t.match(/json$/);let r=t;return"localhost-server"==i?r=`/?op=fetch&req=${JSON.stringify({url:r})}&cacheKiller=${jb.cacheKiller++}`:"cloud"==i&&(r=`//jbart5-server.appspot.com/?op=fetch&req={url:"${r}"}&cacheKiller=${jb.cacheKiller++}`),fetch(r,{mode:"cors"}).then(e=>n?e.json():e.text()).then(e=>jb.http_get_cache?jb.http_get_cache[r]=e:e).catch(t=>jb.logException(t,"http.get",e)||[])}}),jb.component("http.fetch",{type:"data,action",description:"fetch, get or post data from external url",params:[{id:"url",as:"string",mandatory:!0},{id:"method",as:"string",options:"GET,POST",defaultValue:"GET"},{id:"headers",as:"single",templateValue:obj(prop("Content-Type","application/json; charset=UTF-8"))},{id:"body",as:"single"},{id:"json",as:"boolean",description:"convert result to json",type:"boolean"},{id:"useProxy",as:"string",options:",localhost-server,cloud,cloud-test-local"}],impl:(e,t,a,i,n,r,o)=>{const s={url:t,method:a,headers:i||{},mode:"cors",body:"string"==typeof n||null==n?n:JSON.stringify(n)},l=encodeURIComponent(JSON.stringify(s));return e.probe?jb.http_get_cache[l]:("localhost-server"==o?s.url=`/?op=fetch&req=${l}&cacheKiller=${jb.cacheKiller++}`:"cloud"==o?s.url=`//jbart5-server.appspot.com/fetch?req=${l}&cacheKiller=${jb.cacheKiller++}`:"cloud-test-local"==o&&(s.url=`http://localhost:8080/fetch?req=${l}&cacheKiller=${jb.cacheKiller++}`),fetch(s.url,o?{mode:"cors"}:s).then(e=>r?e.json():e.text()).then(e=>jb.http_get_cache?jb.http_get_cache[l]=e:e).catch(t=>jb.logException(t,"http.fetch",e)||[]))}}),jb.component("isRef",{params:[{id:"obj",mandatory:!0}],impl:(e,t)=>jb.isRef(t)}),jb.component("asRef",{params:[{id:"obj",mandatory:!0}],impl:(e,t)=>jb.asRef(t)}),jb.component("data.switch",{macroByValue:!1,params:[{id:"cases",type:"data.switch-case[]",as:"array",mandatory:!0,defaultValue:[]},{id:"default",dynamic:!0}],impl:(e,t,a)=>{for(let a=0;a<t.length;a++)if(t[a].condition(e))return t[a].value(e);return a(e)}}),jb.component("data.case",{type:"data.switch-case",singleInType:!0,params:[{id:"condition",type:"boolean",mandatory:!0,dynamic:!0},{id:"value",mandatory:!0,dynamic:!0}],impl:e=>e.params}),jb.component("action.switch",{type:"action",params:[{id:"cases",type:"action.switch-case[]",as:"array",mandatory:!0,defaultValue:[]},{id:"defaultAction",type:"action",dynamic:!0}],impl:(e,t,a)=>{for(let a=0;a<t.length;a++)if(t[a].condition(e))return t[a].action(e);return a(e)}}),jb.component("action.switchCase",{type:"action.switch-case",singleInType:!0,params:[{id:"condition",type:"boolean",as:"boolean",mandatory:!0,dynamic:!0},{id:"action",type:"action",mandatory:!0,dynamic:!0}],impl:e=>e.params}),jb.component("formatDate",{description:"using toLocaleDateString",params:[{id:"date",defaultValue:"%%",description:"Date value"},{id:"dateStyle",as:"string",options:"full,long,medium,short"},{id:"timeStyle",as:"string",options:"full,long,medium,short"},{id:"weekday",as:"string",options:"long,short,narrow"},{id:"year",as:"string",options:"numeric,2-digit"},{id:"month",as:"string",options:"numeric,2-digit,long,short,narrow"},{id:"day",as:"string",options:"numeric,2-digit"},{id:"hour",as:"string",options:"numeric,2-digit"},{id:"minute",as:"string",options:"numeric,2-digit"},{id:"second",as:"string",options:"numeric,2-digit"},{id:"timeZoneName",as:"string",options:"long,short"}],impl:(e,t)=>new Date(t).toLocaleDateString(void 0,jb.objFromEntries(jb.entries(e.params).filter(e=>e[1])))}),jb.exec=(...e)=>(new jb.jbCtx).run(...e),jb.execInStudio=(...e)=>jb.studio.studioWindow&&(new jb.studio.studioWindow.jb.jbCtx).run(...e),jb.exp=(...e)=>(new jb.jbCtx).exp(...e),function(){const e={moreLogs:"req,res,focus,apply,check,suggestions,writeValue,render,createReactClass,renderResult,probe,setState,immutable,pathOfObject,refObservable,scriptChange,resLog,setGridAreaVals,dragableGridItemThumb",groups:{watchable:"doOp,writeValue,removeCmpObservable,registerCmpObservable,notifyCmpObservable,notifyObservableElems,notifyObservableElem,scriptChange",react:"applyDeltaTop,applyDelta,unmount,render,initCmp,refreshReq,refreshElem,childDiffRes,htmlChange,appendChild,removeChild,replaceTop",dialog:"addDialog,closeDialog,refreshDialogs"},includeLogs:"exception,error",stackFilter:/spy|jb_spy|Object.log|node_modules/i,extraIgnoredEvents:[],MAX_LOG_SIZE:1e4},t=jb.frame;jb.spySettings=e,jb.initSpy=function({Error:a,settings:i,spyParam:n,memoryUsage:r,resetSpyToNull:o}){a=a||t.Error,r=r||(()=>t.performance&&performance.memory&&performance.memory.usedJSHeapSize),i=Object.assign(i||{},e);const s=["index","time","_time","mem","source"];return jb.spy=o?null:{logs:{},spyParam:n,otherSpies:[],observable(){const e=jb.path(jb,"studio.studiojb")||jb;return this._obs=this._obs||e.callbag.subject(),this._obs},enabled:()=>!0,log(e,t,{takeFrom:a,funcTitle:n,modifier:o}={}){if((()=>{if(!this.initialized){const e=(this.spyParam||"").split(",").filter(e=>"-"!==e[0]).filter(e=>e).flatMap(e=>-1==Object.keys(i.groups).indexOf(e)?[e]:i.groups[e].split(",")),t=(this.spyParam||"").split(",").filter(e=>"-"===e[0]).map(e=>e.slice(1));this.includeLogs=i.includeLogs.split(",").concat(e).filter(e=>-1===t.indexOf(e)).reduce((e,t)=>(e[t]=!0,e),{})}this.initialized=!0})(),this.logs[e]=this.logs[e]||[],this.logs.$counters=this.logs.$counters||{},this.logs.$counters[e]=this.logs.$counters[e]||0,this.logs.$counters[e]++,!((e,t)=>"all"===this.spyParam||Array.isArray(t)&&this.includeLogs[e]&&!i.extraIgnoredEvents.includes(t[0]))(e,t))return;this.logs.$index=this.logs.$index||0,t.index=this.logs.$index++,t.source=this.source(a);const s=new Date;t._time=`${s.getSeconds()}:${s.getMilliseconds()}`,t.time=s.getTime(),t.mem=r()/1e6,this.logs[e].length>i.MAX_LOG_SIZE&&(this.logs[e]=this.logs[e].slice(-1*Math.floor(i.MAX_LOG_SIZE/2))),t[0]||"function"!=typeof n||(t[0]=n()),!t[0]&&t.source&&(t[0]=t.source[0]),"function"==typeof o&&o(t),this.logs[e].push(t),this._obs&&this._obs.next({logName:e,record:t})},source(e){a.stackTraceLimit=50;const n=[t];for(;n[0].parent&&n[0]!==n[0].parent;)n.unshift(n[0].parent);let r=n.reverse().map(e=>(new e.Error).stack).join("\n").split(/\r|\n/).map(e=>e.trim()).slice(4).filter(e=>"Error"!==e).filter(e=>!i.stackFilter.test(e));if(e){const t=r.findIndex(t=>-1!==t.indexOf(e));r=r.slice(t+1)}const o=r[0]||"";return[o.split(/at |as /).pop().split(/ |]/)[0],o.split("/").pop().slice(0,-1).trim(),...r]},resetParam:e=>{this.spyParam=e,this.includeLogs=null},setLogs(e){"all"===e&&(this.spyParam="all"),this.includeLogs=(e||"").split(",").reduce((e,t)=>(e[t]=!0,e),{})},clear(){Object.keys(this.logs).forEach(e=>delete this.logs[e])},search(e){return(e=>"[object RegExp]"===Object.prototype.toString.call(e))(e)?this.all(t=>e.test(t.join(" "))):(e=>"string"==typeof e||e instanceof String)(e)?this.all(t=>-1!==t.join(" ").indexOf(e)):Number.isInteger(e)?this.all().slice(-1*e):void 0},all(e){return[].concat.apply([],Object.keys(this.logs).filter(e=>Array.isArray(this.logs[e])).map(e=>this.logs[e].map(t=>{const a=[t.index,e,...t];return s.forEach(e=>{a[e]=t[e]}),a}))).filter((t,a,i)=>!e||e(t,a,i)).sort((e,t)=>e.index-t.index)}}},function(){const e=e=>(e.match("[?&]spy=([^&]+)")||["",""])[1],a=e((()=>{try{return t.parent&&t.parent.location.href}catch(e){}})()||"")||e((()=>{try{return t.location.href}catch(e){}})()||"");a&&jb.initSpy({spyParam:a}),jb.frame&&(jb.frame.spy=jb.spy)}()}(),function(e){var t={};function a(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=t,a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(i,n,function(t){return e[t]}.bind(null,n));return i},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s="./src/ui/pack-immutable.js")}({"./node_modules/immutability-helper/index.js":
/*!***************************************************!*\
  !*** ./node_modules/immutability-helper/index.js ***!
  \***************************************************/
/*! no static exports found */function(module,exports,__webpack_require__){eval("var invariant = __webpack_require__(/*! invariant */ \"./node_modules/invariant/browser.js\");\n\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar splice = Array.prototype.splice;\n\nvar toString = Object.prototype.toString\nvar type = function(obj) {\n  return toString.call(obj).slice(8, -1);\n}\n\nvar assign = Object.assign || /* istanbul ignore next */ function assign(target, source) {\n  getAllKeys(source).forEach(function(key) {\n    if (hasOwnProperty.call(source, key)) {\n      target[key] = source[key];\n    }\n  });\n  return target;\n};\n\nvar getAllKeys = typeof Object.getOwnPropertySymbols === 'function' ?\n  function(obj) { return Object.keys(obj).concat(Object.getOwnPropertySymbols(obj)) } :\n  /* istanbul ignore next */ function(obj) { return Object.keys(obj) };\n\n/* istanbul ignore next */\nfunction copy(object) {\n  if (Array.isArray(object)) {\n    return assign(object.constructor(object.length), object)\n  } else if (type(object) === 'Map') {\n    return new Map(object)\n  } else if (type(object) === 'Set') {\n    return new Set(object)\n  } else if (object && typeof object === 'object') {\n    var prototype = Object.getPrototypeOf(object);\n    return assign(Object.create(prototype), object);\n  } else {\n    return object;\n  }\n}\n\nfunction newContext() {\n  var commands = assign({}, defaultCommands);\n  update.extend = function(directive, fn) {\n    commands[directive] = fn;\n  };\n  update.isEquals = function(a, b) { return a === b; };\n\n  return update;\n\n  function update(object, spec) {\n    if (typeof spec === 'function') {\n      spec = { $apply: spec };\n    }\n\n    if (!(Array.isArray(object) && Array.isArray(spec))) {\n      invariant(\n        !Array.isArray(spec),\n        'update(): You provided an invalid spec to update(). The spec may ' +\n        'not contain an array except as the value of $set, $push, $unshift, ' +\n        '$splice or any custom command allowing an array value.'\n      );\n    }\n\n    invariant(\n      typeof spec === 'object' && spec !== null,\n      'update(): You provided an invalid spec to update(). The spec and ' +\n      'every included key path must be plain objects containing one of the ' +\n      'following commands: %s.',\n      Object.keys(commands).join(', ')\n    );\n\n    var nextObject = object;\n    var index, key;\n    getAllKeys(spec).forEach(function(key) {\n      if (hasOwnProperty.call(commands, key)) {\n        var objectWasNextObject = object === nextObject;\n        nextObject = commands[key](spec[key], nextObject, spec, object);\n        if (objectWasNextObject && update.isEquals(nextObject, object)) {\n          nextObject = object;\n        }\n      } else {\n        var nextValueForKey =\n          type(object) === 'Map'\n            ? update(object.get(key), spec[key])\n            : update(object[key], spec[key]);\n        var nextObjectValue =\n          type(nextObject) === 'Map'\n              ? nextObject.get(key)\n              : nextObject[key];\n        if (!update.isEquals(nextValueForKey, nextObjectValue) || typeof nextValueForKey === 'undefined' && !hasOwnProperty.call(object, key)) {\n          if (nextObject === object) {\n            nextObject = copy(object);\n          }\n          if (type(nextObject) === 'Map') {\n            nextObject.set(key, nextValueForKey);\n          } else {\n            nextObject[key] = nextValueForKey;\n          }\n        }\n      }\n    })\n    return nextObject;\n  }\n\n}\n\nvar defaultCommands = {\n  $push: function(value, nextObject, spec) {\n    invariantPushAndUnshift(nextObject, spec, '$push');\n    return value.length ? nextObject.concat(value) : nextObject;\n  },\n  $unshift: function(value, nextObject, spec) {\n    invariantPushAndUnshift(nextObject, spec, '$unshift');\n    return value.length ? value.concat(nextObject) : nextObject;\n  },\n  $splice: function(value, nextObject, spec, originalObject) {\n    invariantSplices(nextObject, spec);\n    value.forEach(function(args) {\n      invariantSplice(args);\n      if (nextObject === originalObject && args.length) nextObject = copy(originalObject);\n      splice.apply(nextObject, args);\n    });\n    return nextObject;\n  },\n  $set: function(value, nextObject, spec) {\n    invariantSet(spec);\n    return value;\n  },\n  $toggle: function(targets, nextObject) {\n    invariantSpecArray(targets, '$toggle');\n    var nextObjectCopy = targets.length ? copy(nextObject) : nextObject;\n\n    targets.forEach(function(target) {\n      nextObjectCopy[target] = !nextObject[target];\n    });\n\n    return nextObjectCopy;\n  },\n  $unset: function(value, nextObject, spec, originalObject) {\n    invariantSpecArray(value, '$unset');\n    value.forEach(function(key) {\n      if (Object.hasOwnProperty.call(nextObject, key)) {\n        if (nextObject === originalObject) nextObject = copy(originalObject);\n        delete nextObject[key];\n      }\n    });\n    return nextObject;\n  },\n  $add: function(value, nextObject, spec, originalObject) {\n    invariantMapOrSet(nextObject, '$add');\n    invariantSpecArray(value, '$add');\n    if (type(nextObject) === 'Map') {\n      value.forEach(function(pair) {\n        var key = pair[0];\n        var value = pair[1];\n        if (nextObject === originalObject && nextObject.get(key) !== value) nextObject = copy(originalObject);\n        nextObject.set(key, value);\n      });\n    } else {\n      value.forEach(function(value) {\n        if (nextObject === originalObject && !nextObject.has(value)) nextObject = copy(originalObject);\n        nextObject.add(value);\n      });\n    }\n    return nextObject;\n  },\n  $remove: function(value, nextObject, spec, originalObject) {\n    invariantMapOrSet(nextObject, '$remove');\n    invariantSpecArray(value, '$remove');\n    value.forEach(function(key) {\n      if (nextObject === originalObject && nextObject.has(key)) nextObject = copy(originalObject);\n      nextObject.delete(key);\n    });\n    return nextObject;\n  },\n  $merge: function(value, nextObject, spec, originalObject) {\n    invariantMerge(nextObject, value);\n    getAllKeys(value).forEach(function(key) {\n      if (value[key] !== nextObject[key]) {\n        if (nextObject === originalObject) nextObject = copy(originalObject);\n        nextObject[key] = value[key];\n      }\n    });\n    return nextObject;\n  },\n  $apply: function(value, original) {\n    invariantApply(value);\n    return value(original);\n  }\n};\n\nvar contextForExport = newContext();\n\nmodule.exports = contextForExport;\nmodule.exports.default = contextForExport;\nmodule.exports.newContext = newContext;\n\n// invariants\n\nfunction invariantPushAndUnshift(value, spec, command) {\n  invariant(\n    Array.isArray(value),\n    'update(): expected target of %s to be an array; got %s.',\n    command,\n    value\n  );\n  invariantSpecArray(spec[command], command)\n}\n\nfunction invariantSpecArray(spec, command) {\n  invariant(\n    Array.isArray(spec),\n    'update(): expected spec of %s to be an array; got %s. ' +\n    'Did you forget to wrap your parameter in an array?',\n    command,\n    spec\n  );\n}\n\nfunction invariantSplices(value, spec) {\n  invariant(\n    Array.isArray(value),\n    'Expected $splice target to be an array; got %s',\n    value\n  );\n  invariantSplice(spec['$splice']);\n}\n\nfunction invariantSplice(value) {\n  invariant(\n    Array.isArray(value),\n    'update(): expected spec of $splice to be an array of arrays; got %s. ' +\n    'Did you forget to wrap your parameters in an array?',\n    value\n  );\n}\n\nfunction invariantApply(fn) {\n  invariant(\n    typeof fn === 'function',\n    'update(): expected spec of $apply to be a function; got %s.',\n    fn\n  );\n}\n\nfunction invariantSet(spec) {\n  invariant(\n    Object.keys(spec).length === 1,\n    'Cannot have more than one key in an object with $set'\n  );\n}\n\nfunction invariantMerge(target, specValue) {\n  invariant(\n    specValue && typeof specValue === 'object',\n    'update(): $merge expects a spec of type \\'object\\'; got %s',\n    specValue\n  );\n  invariant(\n    target && typeof target === 'object',\n    'update(): $merge expects a target of type \\'object\\'; got %s',\n    target\n  );\n}\n\nfunction invariantMapOrSet(target, command) {\n  var typeOfTarget = type(target);\n  invariant(\n    typeOfTarget === 'Map' || typeOfTarget === 'Set',\n    'update(): %s expects a target of type Set or Map; got %s',\n    command,\n    typeOfTarget\n  );\n}\n\n\n//# sourceURL=webpack:///./node_modules/immutability-helper/index.js?")},"./node_modules/invariant/browser.js":
/*!*******************************************!*\
  !*** ./node_modules/invariant/browser.js ***!
  \*******************************************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval("/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n\n\n/**\n * Use invariant() to assert state which your program assumes to be true.\n *\n * Provide sprintf-style format (only %s is supported) and arguments\n * to provide information about what broke and what you were\n * expecting.\n *\n * The invariant message will be stripped in production, but the invariant\n * will remain to ensure logic does not differ in production.\n */\n\nvar invariant = function(condition, format, a, b, c, d, e, f) {\n  if (true) {\n    if (format === undefined) {\n      throw new Error('invariant requires an error message argument');\n    }\n  }\n\n  if (!condition) {\n    var error;\n    if (format === undefined) {\n      error = new Error(\n        'Minified exception occurred; use the non-minified dev environment ' +\n        'for the full error message and additional helpful warnings.'\n      );\n    } else {\n      var args = [a, b, c, d, e, f];\n      var argIndex = 0;\n      error = new Error(\n        format.replace(/%s/g, function() { return args[argIndex++]; })\n      );\n      error.name = 'Invariant Violation';\n    }\n\n    error.framesToPop = 1; // we don't care about invariant's own frame\n    throw error;\n  }\n};\n\nmodule.exports = invariant;\n\n\n//# sourceURL=webpack:///./node_modules/invariant/browser.js?")},"./src/ui/pack-immutable.js":
/*!**********************************!*\
  !*** ./src/ui/pack-immutable.js ***!
  \**********************************/
/*! no exports provided */function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var immutability_helper__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! immutability-helper */ "./node_modules/immutability-helper/index.js");\n/* harmony import */ var immutability_helper__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(immutability_helper__WEBPACK_IMPORTED_MODULE_0__);\n\r\n\r\njb.ui.update = immutability_helper__WEBPACK_IMPORTED_MODULE_0___default.a;\r\n\n\n//# sourceURL=webpack:///./src/ui/pack-immutable.js?')}}),function(){const e=(e,t)=>e===t,t={},a=()=>!0,i=e=>e;jb.callbag={forEach:e=>t=>{let a;t(0,(t,i)=>{0===t&&(a=i),1===t&&e(i),1!==t&&0!==t||a(1)})},fromIter:e=>(t,a)=>{if(0!==t)return;const i="undefined"!=typeof Symbol&&e[Symbol.iterator]?e[Symbol.iterator]():e;let n,r=!1,o=!1;a(0,(e,t)=>{1===e&&(o=!0,r||n&&n.done||function(){for(r=!0;o;)o=!1,(n=i.next()).done?a(2):a(1,n.value);r=!1}())})},Do:e=>t=>(a,i)=>{0===a&&t(0,(t,a)=>{1==t&&e(a),i(t,a)})},filter:e=>t=>(a,i)=>{if(0!==a)return;let n;t(0,(t,a)=>{0===t?(n=a,i(t,a)):1===t?e(a)?i(t,a):n(1):i(t,a)})},map:e=>t=>(a,i)=>{0===a&&t(0,(t,a)=>{i(t,1===t?e(a):a)})},pipe(...e){const t=e.filter(e=>e);if(!t[0])return;let a=t[0];for(let e=1,i=t.length;e<i;e++)a=t[e](a);return a},distinctUntilChanged:(t=e)=>e=>(a,i)=>{if(0!==a)return;let n,r,o=!1;e(0,(e,a)=>{0===e&&(r=a),1===e?o&&t(n,a)?r(1):(o=!0,n=a,i(1,a)):i(e,a)})},takeUntil:e=>("[object Promise]"===Object.prototype.toString.call(e)&&(e=jb.callbag.fromPromise(e)),a=>(i,n)=>{if(0!==i)return;let r,o,s=!1,l=t;a(0,(a,i)=>{if(0===a)return r=i,e(0,(e,t)=>{if(0!==e)return 1===e?(l=void 0,o(2),r(2),void(s&&n(2))):void(2===e&&(o=null,l=t,null!=t&&(r(2),s&&n(e,t))));(o=t)(1)}),s=!0,n(0,(e,a)=>{l===t&&(2===e&&o&&o(2),r(e,a))}),void(l!==t&&n(2,l));2===a&&o(2),l===t&&n(a,i)})}),flatMap:(e,t)=>a=>(i,n)=>{if(0!==i)return;t||(t=(e,t)=>t);let r=0,o={},s=!1,l=null,c=(e,t)=>{var a=Object.values(o).pop();1===e&&(a?a(1):s?n(2):l(1)),2===e&&(a&&a(2),l(2))},d=e=>{s&&0===Object.keys(o).length?n(2,e):l(1)};a(0,(a,i)=>{0===a&&(l=i,n(0,c)),1===a&&((...t)=>jb.callbag.fromAny(e(...t)))(i)(0,((e,a,i)=>(r,o)=>{0===r&&(i[e]=o,i[e](1)),1===r&&n(1,t(a,o)),2===r&&(delete i[e],d(o))})(r++,i,o)),2===a&&(s=!0,d(i))})},merge(...e){const t=e.filter(e=>e).filter(e=>jb.callbag.fromAny(e));return(e,a)=>{if(0!==e)return;const i=t.length,n=new Array(i);let r=0,o=0,s=!1;const l=(e,t)=>{2===e&&(s=!0);for(let a=0;a<i;a++)n[a]&&n[a](e,t)};for(let e=0;e<i;e++){if(s)return;t[e](0,(t,c)=>{if(0===t)n[e]=c,1==++r&&a(0,l);else if(2===t&&c){s=!0;for(let t=0;t<i;t++)t!==e&&n[t]&&n[t](2);a(2,c)}else 2===t?(n[e]=void 0,++o===i&&a(2)):a(t,c)})}}},fromEvent:(e,t,a)=>(i,n)=>{if(0!==i)return;let r=!1;const o=e=>n(1,e);if(n(0,(i,n)=>{if(2===i)if(r=!0,e.removeEventListener)e.removeEventListener(t,o,a);else{if(!e.removeListener)throw new Error("cannot remove listener from node. No method found.");e.removeListener(t,o)}}),!r)if(e.addEventListener)e.addEventListener(t,o,a);else{if(!e.addListener)throw new Error("cannot add listener to node. No method found.");e.addListener(t,o)}},fromPromise:e=>(t,a)=>{if(0!==t)return;let i=!1;e.then(e=>{i||(a(1,e),i||a(2))},(e=new Error)=>{i||a(2,e)}),a(0,(e,t)=>{2===e&&(i=!0)})},subject(){let e=[];const t=(t,a)=>{if(0===t){const t=a;e.push(t),t(0,a=>{if(2===a){const a=e.indexOf(t);a>-1&&e.splice(a,1)}})}else{const i=e.slice(0);for(let n,r=0,o=i.length;r<o;r++)n=i[r],e.indexOf(n)>-1&&n(t,a)}};return t.next=e=>t(1,e),t.complete=()=>t(2),t.error=e=>t(2,e),t},catchError:e=>t=>(a,i)=>{0===a&&t(0,(t,a)=>2===t&&void 0!==a?e(a):i(t,a))},concatMap(e){const t=(...t)=>jb.callbag.fromAny(e(...t));return e=>(a,i)=>{if(0!==a)return;const n=[];let r,o=null;const s=(e,a)=>{if(0===e)(o=a)(1);else if(1===e)i(1,a),o(1);else if(2===e){if(o=null,0===n.length)return;t(n.shift())(0,s)}},l=(e,t)=>{2===e&&null!==o&&o(2,t),r(e,t)};e(0,(e,a)=>{if(0===e)return r=a,void i(0,l);1===e?null!==o?n.push(a):t(a)(0,s):2===e&&(i(2,a),null!==o&&o(2,a))})}},create:e=>(t,a)=>{if(0!==t)return;if("function"!=typeof e)return a(0,()=>{}),void a(2);let i,n=!1;a(0,e=>{n||(n=2===e)&&"function"==typeof i&&i()}),n||(i=e(e=>{n||a(1,e)},e=>{n||void 0===e||(n=!0,a(2,e))},()=>{n||(n=!0,a(2))}))},debounceTime:e=>t=>(a,i)=>{if(0!==a)return;let n;t(0,(t,a)=>{n&&clearTimeout(n),1===t?n=setTimeout(()=>i(1,a),"function"==typeof e?e():e):i(t,a)})},take:e=>t=>(a,i)=>{if(0!==a)return;let n,r,o=0;function s(t,a){2===t?(r=!0,n(t,a)):o<e&&n(t,a)}t(0,(t,a)=>{0===t?(n=a,i(0,s)):1===t?o<e&&(o++,i(t,a),o!==e||r||(r=!0,n(2),i(2))):i(t,a)})},last:(e=a,t=i)=>a=>(i,n)=>{if(0!==i)return;let r,o,s=!1;a(0,(a,i)=>{0===a?(r=i,n(a,i)):1===a?(e(i)&&(o=i,s=!0),r(1)):2===a?(s&&n(1,t(o)),n(2)):n(a,i)})},subscribe:(e={})=>t=>{"function"==typeof e&&(e={next:e});let a,{next:i,error:n,complete:r}=e;return t(0,(t,o)=>{0===t&&(a=o),1===t&&i&&i(o),1!==t&&0!==t||a(1),2===t&&!o&&r&&r(),2===t&&o&&n&&n(o),2===t&&e.finally&&e.finally(o)}),()=>a&&a(2)},toPromise:e=>new Promise((t,a)=>{jb.callbag.subscribe({next:t,error:a,complete:()=>{const e=new Error("No elements in sequence.");e.code="NO_ELEMENTS",a(e)}})(jb.callbag.last(e))}),toPromiseArray(e){const t=[];let a;return new Promise((i,n)=>{e(0,(e,r)=>{0===e&&(a=r),1===e&&t.push(r),1!==e&&0!==e||a(1),2!==e||r||i(t),2===e&&r&&n(r)})})},startWith:(...e)=>t=>(a,i)=>{if(0!==a)return;let n,r,o=!1,s=!1;for(i(0,(t,a)=>{s&&1===t&&(r=[1,a]),2===t&&(o=!0,e.length=0),n&&n(t,a)});0!==e.length;)1===e.length&&(s=!0),i(1,e.shift());o||t(0,(e,t)=>{if(0===e)return n=t,s=!1,void(r&&(n(...r),r=null));i(e,t)})},delay:e=>t=>(a,i)=>{0===a&&t(0,(t,a)=>{if(1!==t)return i(t,a);let n=setTimeout(()=>{clearTimeout(n),i(1,a)},e)})},skip:e=>t=>(a,i)=>{if(0!==a)return;let n,r=0;t(0,(t,a)=>{0===t?(n=a,i(t,a)):1===t&&r<e?(r++,n(1)):i(t,a)})},fromCallBag:e=>e,fromAny:(e,t,a)=>{const i=e&&"from"+("[object Promise]"===Object.prototype.toString.call(e)?"Promise":e.addEventListener?"Event":"function"==typeof e[Symbol.iterator]?"Iter":"");return jb.callbag[i]?jb.callbag[i](e,t,a):jb.callbag.isCallbag(e)?e:jb.callbag.fromIter([e])},isCallbag:e=>e.toString().split("=>")[0].replace(/\s/g,"").match(/start,sink|t,d/)}}(),function(){const e=Symbol.for("isProxy"),t=Symbol.for("originalVal"),a=Symbol.for("targetVal"),i=Symbol("jbId");class n{constructor(e){this.resources=e,this.objToPath=new Map,this.idCounter=1,this.allowedTypes=[Object.getPrototypeOf({}),Object.getPrototypeOf([])],this.resourceChange=jb.callbag.subject(),this.observables=[],this.primitiveArraysDeltas={},jb.ui.originalResources=jb.resources;const t=e();t[i]=this.idCounter++,this.objToPath.set(t[i],[]),this.propagateResourceChangeToObservables()}doOp(t,a,n){try{const r=a.$set||a.$merge||a.$push||a.$splice;this.isRef(t)||(t=this.asRef(t));const o=this.removeLinksFromPath(this.pathOfRef(t)),s={},l=this.valOfPath(o);if(!o||t.$jb_val)return;if(void 0!==a.$set&&a.$set===l)return;a.$push&&(a.$push=jb.asArray(a.$push)),this.addJbId(o),jb.path(s,o,a);const c=jb.path(a.$splice,[0,2])&&jb.path(a.$splice,[0,0]),d=null!=c&&o.concat(c),p={op:a,path:[...o],insertedPath:d,ref:t,srcCtx:n,oldVal:l,opVal:r,timeStamp:(new Date).getTime()};this.resources(jb.ui.update(this.resources(),s),p);const m=null!=r&&r[e]?r:this.valOfPath(o);return a.$push?(a.$push.forEach((e,t)=>this.addObjToMap(e,[...o,l.length+t])),m[i]=l[i],p.path.push(l.length),p.ref=this.refOfPath(p.path)):null===a.$set&&"object"==typeof l?(this.removeObjFromMap(l),this.addObjToMap(m,o),p.ref.$jb_path=()=>o):a.$splice?(a.$splice.forEach(e=>{l.slice(e[0],e[0]+e[1]).forEach(e=>this.removeObjFromMap(e)),jb.asArray(e[2]).forEach(e=>this.addObjToMap(e,o.concat(m.indexOf(e))))}),this.fixSplicedPaths(o,a.$splice)):(this.removeObjFromMap(l),this.addObjToMap(m,o)),a.$splice&&(this.primitiveArraysDeltas[t.$jb_obj[i]]=this.primitiveArraysDeltas[t.$jb_obj[i]]||[],this.primitiveArraysDeltas[t.$jb_obj[i]].push(a.$splice)),p.newVal=m,jb.log("doOp",[p,...arguments]),this.transactionEventsLog?this.transactionEventsLog.push(p):this.resourceChange.next(p),p}catch(e){jb.logException(e,"doOp",n,...arguments)}}resourceReferred(e){const t=this.resources()[e];this.objToPath.has(t)||this.addObjToMap(t,[e])}addJbId(e){for(let t=0;t<e.length;t++){const a=e.slice(0,t+1),n=this.valOfPath(a,!0);n&&"object"==typeof n&&!n[i]&&(n[i]=this.idCounter++,this.addObjToMap(n,a))}}addObjToMap(t,a){!t||t[e]||t.$jb_val||"object"!=typeof t||-1==this.allowedTypes.indexOf(Object.getPrototypeOf(t))||(t[i]?(this.objToPath.set(t[i],a),this.objToPath.delete(t)):this.objToPath.set(t,a),Object.keys(t).filter(e=>"object"==typeof t[e]&&0!=e.indexOf("$jb_")).forEach(e=>this.addObjToMap(t[e],[...a,e])))}removeObjFromMap(e,t){e&&"object"==typeof e&&-1!=this.allowedTypes.indexOf(Object.getPrototypeOf(e))&&(this.objToPath.delete(e),e[i]&&t&&this.objToPath.delete(e[i]),Object.keys(e).filter(t=>t=>"object"==typeof e[t]&&0!=t.indexOf("$jb_")).forEach(t=>this.removeObjFromMap(e[t],!0)))}fixSplicedPaths(e,t){const a=e.length;Array.from(this.objToPath.keys()).filter(t=>(function(t){if(t.length<=a)return;for(let i=0;i<a;i++)if(t[i]!=e[i])return;return!0})(this.objToPath.get(t))).forEach(e=>{const i=this.objToPath.get(e);i[a]=function(e){return e+t.reduce((t,a)=>e<a[0]?0:jb.asArray(a[2]).length-a[1],0)}(+i[a]),i[a]>=0&&this.objToPath.set(e,i)})}pathOfRef(e){if(e.$jb_path)return e.$jb_path();const t=this.isRef(e)&&(this.objToPath.get(e.$jb_obj)||this.objToPath.get(e.$jb_obj[i]));return t&&void 0!==e.$jb_childProp?(this.refreshPrimitiveArrayRef(e),[...t,e.$jb_childProp]):t}urlOfRef(e){const t=this.pathOfRef(e);this.addJbId(t);const a=[e.$jb_obj[i],e.$jb_childProp].filter(e=>null!=e).map(e=>(""+e).replace(/~|;|,/g,"")).join("~"),n=t.map(e=>(""+e).replace(/~|;|,/g,"")).join("~");return`${this.resources.id}://${a};${n}`}refOfUrl(e){const t=e.split(";")[0].split("~");return{handler:this,$jb_obj:{[i]:+t[0]},...t[1]?{$jb_childProp:t[1]}:{}}}asRef(t,n){if(this.isRef(t))return t;if(!t||"object"!=typeof t)return t;const r=t[e]?t[a]:t,o=this.objToPath.get(r)||this.objToPath.get(r[i]);return o?{$jb_obj:this.valOfPath(o),handler:this,path:function(){return this.handler.pathOfRef(this)}}:(n||jb.logError("asRef can not make a watchable ref of obj",t),null)}valOfPath(e){return e.reduce((e,t)=>this.noProxy(e&&e[t]),this.resources())}noProxy(a){return a&&a[e]&&a[t]||a}hasLinksInPath(t){let a=this.resources();for(let i=0;i<t.length;i++){if(a&&a[e])return!0;a=a&&a[t[i]]}}removeLinksFromPath(a){if(Array.isArray(a))return this.hasLinksInPath(a)?a.reduce(({val:a,path:n},r)=>{const o=a&&a[e],s=o?a[t]:a,l=o?this.objToPath.get(s)||this.objToPath.get(s[i]):n;return{val:s&&s[r],path:[l,r].join("~")}},{val:this.resources(),path:""}).path:a}refOfPath(e){const t=this.valOfPath(e);if(!t||"object"!=typeof t&&e.length>0){const t=this.asRef(this.valOfPath(e.slice(0,-1)),!0);return 1==e.length?{$jb_obj:this.resources(),$jb_childProp:e[0],handler:this,$jb_path:()=>e}:this.objectProperty(t,e.slice(-1)[0])}return this.asRef(t)}asStr(e){return this.pathOfRef(e).join("~")}isValid(e){return this.isRef(e)&&this.pathOfRef(e)}val(e){if(null==e)return e;if(e.$jb_val)return e.$jb_val();if(!e.$jb_obj)return e;if(e.handler!=this)return e.handler.val,e.handler.val(e);this.refreshPrimitiveArrayRef(e);const t=this.pathOfRef(e);return t||this.pathOfRef(e),this.valOfPath(t)}watchable(e){return this.resources()===e||this.objToPath.get(e)||e&&this.objToPath.get(e[i])}isRef(e){return e&&e.$jb_obj&&this.watchable(e.$jb_obj)}objectProperty(e,t,a){if(jb.log("objectProperty",[...arguments]),!e)return jb.logError("objectProperty: null obj",a);var n=this.asRef(e);if(n&&n.$jb_obj){const e={$jb_obj:n.$jb_obj,$jb_childProp:t,handler:this,path:function(){return this.handler.pathOfRef(this)}};return this.isPrimitiveArray(n.$jb_obj)&&(e.$jb_delta_version=(this.primitiveArraysDeltas[n.$jb_obj[i]]||[]).length,e.$jb_childProp=+t),e}return e[t]}writeValue(e,t,a){return e&&this.isRef(e)&&this.pathOfRef(e)?(jb.log("writeValue",["watchable",this.asStr(e),t,e,a]),e.$jb_val?e.$jb_val(t):this.val(e)!==t?this.doOp(e,{$set:this.createSecondaryLink(t)},a):void 0):jb.logError("writeValue: err in ref",a,e,t)}createSecondaryLink(i){if(i&&"object"==typeof i&&!i[e]){const n=this.asRef(i,!0);if(n&&n.$jb_obj)return new Proxy(i,{get:(n,r)=>r===a?n:r===e||(r===t?i:jb.val(this.asRef(i))[r]),set:(e,t,a)=>e[t]=a})}return i}splice(e,t,a){return this.doOp(e,{$splice:t},a)}move(e,t,a){const i=this.pathOfRef(e),n=this.pathOfRef(t),r=i.slice(0,-1).join("~")==n.slice(0,-1).join("~"),o=Number(i.slice(-1));let s=Number(n.slice(-1));const l=this.refOfPath(i.slice(0,-1)),c=this.refOfPath(n.slice(0,-1));if(isNaN(o)||isNaN(s))return jb.logError("move: not array element",a,e,t);var d=jb.val(e);if(r){const e=[[o,1],[s,0,d]];return e.fromIndex=o,e.toIndex=s,this.doOp(l,{$splice:e},a)}this.startTransaction();const p=[[o,1]];p.fromIndex=o,p.toIndex=s,p.toArray=c,this.doOp(l,{$splice:p},a),this.doOp(c,{$splice:[[s,0,d]]},a),this.endTransaction()}isPrimitiveArray(e){return Array.isArray(e)&&e.some(e=>null!=e&&"object"!=typeof e)}refreshPrimitiveArrayRef(e){if(!this.isPrimitiveArray(e.$jb_obj))return;const t=e.$jb_obj[i],a=this.primitiveArraysDeltas[t]||[];a.slice(e.$jb_delta_version).forEach(t=>{if(null!=t.fromIndex&&t.fromIndex===e.$jb_childProp)return e.$jb_childProp=t.toIndex,void(t.toArray&&(e.$jb_obj=t.toArray.$jb_obj));t.forEach(([t,a,i])=>{-1!=e.$jb_childProp&&(e.$jb_childProp>=t&&e.$jb_childProp<t+a?e.$jb_childProp=-1:e.$jb_childProp>=t&&(e.$jb_childProp=e.$jb_childProp-a+(null!=i)?1:0))})}),e.$jb_delta_version=a.length}startTransaction(){this.transactionEventsLog=[]}endTransaction(e){e||(this.transactionEventsLog||[]).forEach(e=>this.resourceChange.next(e)),delete this.transactionEventsLog}push(e,t,a){return this.doOp(e,{$push:this.createSecondaryLink(t)},a)}merge(e,t,a){return this.doOp(e,{$merge:this.createSecondaryLink(t)},a)}getOrCreateObservable(e){const t=jb.callbag.subject();e.srcCtx=e.srcCtx||{path:""};const a=e.cmpOrElem.ctx||jb.ui.ctxOfElem(e.cmpOrElem),i=this.pathOfRef(e.ref).join("~")+" : "+a.path,n=e.cmpOrElem.getAttribute&&+(e.cmpOrElem.getAttribute("recycleCounter")||0),r={...e,subject:t,key:i,recycleCounter:n,ctx:a};return this.observables.push(r),this.observables.sort((e,t)=>jb.ui.comparePaths(e.ctx.path,t.ctx.path)),jb.log("registerCmpObservable",[r]),t}frame(){return this.resources.frame||jb.frame}propagateResourceChangeToObservables(){jb.subscribe(this.resourceChange,e=>{const t=this.observables.slice(0),a=this.removeLinksFromPath(this.pathOfRef(e.ref));a&&t.forEach(t=>{const i=t.cmpOrElem.NodeType&&+t.cmpOrElem.getAttribute("recycleCounter")>t.recycleCounter;t.cmpOrElem._destroyed||i?-1!=this.observables.indexOf(t)&&(jb.log("removeCmpObservable",[t]),this.observables.splice(this.observables.indexOf(t),1)):this.notifyOneObserver(e,t,a)})})}notifyOneObserver(e,t,a){let i=jb.refHandler(t.ref).pathOfRef(t.ref);if(!(i=i&&this.removeLinksFromPath(i)))return jb.logError("observer ref path is empty",t,e);const n=jb.ui.comparePaths(a,i),r=1==n,o=r&&("yes"===t.includeChildren||!0===t.includeChildren),s=r&&"structure"===t.includeChildren&&("object"==typeof e.oldVal||"object"==typeof e.newVal);(-1==n||0==n||o||s)&&(jb.log("notifyCmpObservable",["notify change",e.srcCtx,t,e]),t.subject.next(e))}dispose(){this.resourceChange.complete()}}function r(e){if(void 0===e)return jb.resources;jb.resources=e}jb.ui.comparePaths=function(e,t){e=e||"",t=t||"";let a=0;for(;e[a]===t[a]&&a<e.length;)a++;return a==e.length&&a==t.length?0:a==e.length&&a<t.length?-1:a==t.length&&a<e.length?1:e[a]<t[a]?-2:2},r.id="resources",jb.setMainWatchableHandler(new n(r)),jb.rebuildRefHandler=()=>{jb.mainWatchableHandler&&jb.mainWatchableHandler.dispose(),jb.setMainWatchableHandler(new n(r))},jb.isWatchable=e=>jb.refHandler(e)instanceof n||e&&e.$jb_observable,jb.ui.refObservable=(e,t,a={})=>e&&e.$jb_observable?e.$jb_observable(t):jb.isWatchable(e)?jb.refHandler(e).getOrCreateObservable({ref:e,cmpOrElem:t,...a}):(jb.logError("ref is not watchable",e),jb.callbag.fromIter([])),jb.ui.extraWatchableHandler=(e,t)=>{const a=jb.extraWatchableHandler(new n(e),t);return jb.ui.subscribeToRefChange(a),a},jb.ui.resourceChange=()=>jb.mainWatchableHandler.resourceChange,jb.component("runTransaction",{type:"action",params:[{id:"actions",type:"action[]",ignore:!0,composite:!0,mandatory:!0},{id:"disableNotifications",as:"boolean",type:"boolean"}],impl:e=>{const t=jb.asArray(e.profile.actions||e.profile.$runActions||[]).filter(e=>e),a=e.profile.actions&&e.profile.actions.sugar?"":e.profile.$runActions?"$runActions~":"items~";return jb.mainWatchableHandler.startTransaction(),t.reduce((t,i,n)=>t.then(t=>e.runInner(i,{as:"single"},a+n)),Promise.resolve()).catch(t=>jb.logException(t,e)).then(()=>jb.mainWatchableHandler.endTransaction(e.params.disableNotifications))}})}();class VNode{constructor(e,t,a){const i=jb.objFromEntries(jb.entries(t).map(e=>[e[0].toLowerCase(),e[1]]));let n=""===a?null:a;-1!==["string","boolean","number"].indexOf(typeof n)&&(i.$text=n,n=null),n&&"function"==typeof n.then&&(i.$text="...",n=null),null==n||Array.isArray(n)||(n=[n]),null!=n&&(n=n.filter(e=>e).map(e=>"string"==typeof e?jb.ui.h("span",{$text:e}):e)),this.attributes=i,"string"==typeof e&&-1!=e.indexOf("#")&&(this.addClass(e.split("#").pop()),e=e.split("#")[0]),Object.assign(this,{["string"==typeof e?"tag":"cmp"]:e,children:n})}getAttribute(e){return(this.attributes||{})[e]}setAttribute(e,t){return this.attributes=this.attributes||{},this.attributes[e]=t,this}addClass(e){return-1!=e.indexOf(" ")?(e.split(" ").filter(e=>e).forEach(e=>this.addClass(e)),this):(this.attributes=this.attributes||{},void 0===this.attributes.class&&(this.attributes.class=""),e&&-1==this.attributes.class.split(" ").indexOf(e)&&(this.attributes.class=[this.attributes.class,e].filter(e=>e).join(" ")),this)}hasClass(e){return-1!=(jb.path(this,"attributes.class")||"").split(" ").indexOf(e)}querySelectorAll(e,{includeSelf:t}={}){const a=e.match(/^\[([a-zA-Z0-9_\-]+)\]$/),i=e.match(/^\[([a-zA-Z0-9_\-]+)="([a-zA-Z0-9_\-]+)"\]$/),n=e.match(/^\.([a-zA-Z0-9_\-]+)$/),r=e.match(/^[a-zA-Z0-9_\-]+$/),o=a?e=>e.attributes&&e.attributes[a[1]]:n?e=>e.hasClass(n[1]):r?e=>e.tag===r[0]:i?e=>e.attributes&&e.attributes[i[1]]==i[2]:null;return o&&function e(t,a,i){return[...!i&&a(t)?[t]:[],...(t.children||[]).flatMap(t=>e(t,a))]}(this,o,!t)}}function toVdomOrStr(e){if(jb.isDelayed(e))return jb.toSynchArray(e).then(e=>jb.ui.toVdomOrStr(e[0]));const t=Array.isArray(e)?e.map(e=>jb.val(e)):e;let a=jb.val(Array.isArray(t)&&1==t.length?t[0]:t);return a&&a instanceof VNode||Array.isArray(a)?a:("boolean"==typeof a||"object"==typeof a?a=""+a:"string"==typeof a&&(a=a.slice(0,1e3)),a)}function cloneVNode(e){return function e(t){Object.setPrototypeOf(t,VNode.prototype);(t.children||[]).forEach(t=>e(t));return t}(JSON.parse(JSON.stringify(e)))}Object.assign(jb.ui,{VNode:VNode,cloneVNode:cloneVNode,toVdomOrStr:toVdomOrStr}),function(){const e=jb.ui,t=(e,t)=>{try{return e()}catch(e){jb.logException(e,t,this.ctx)}};function a(t,a,i){return t instanceof e.VNode?t:t&&t.renderVdom?t.renderVdom():new jb.ui.VNode(t,a,i)}function i(e,t){const a=jb.objectDiff(t.attributes||{},e.attributes||{});null==a.style&&delete a.style;const r=function(e,t){if(0==e.length&&0==t.length)return;if(1==t.length&&1==e.length&&t[0].tag==e[0].tag)return{0:{...i(e[0],t[0]),__afterIndex:0},length:1};jb.log("childDiff",[...arguments]);const a=e.map((e,t)=>({i:t,...e}));let r=a.slice(0);const o=t.map(e=>(function(e,t){const a=t.findIndex(t=>n(t,e));if(-1!=a)return t.splice(a,1)[0]})(e,r));t.forEach((e,t)=>o[t]=o[t]||function(e,t,a){const i=a.findIndex(a=>a.tag&&a.i==t&&a.tag===e.tag);if(-1!=i){const t=a.splice(i,1)[0];return t.attributes.ctxId&&!n(t,e)&&(t.$remount=!0),t}}(e,t,r));const s=[],l={length:a.length};return a.forEach((e,a)=>{const n=o.indexOf(e);-1==n?l[a]={$:"delete",__afterIndex:n}:(s[n]=!0,l[a]={__afterIndex:n,...i(e,t[n]),...e.$remount?{remount:!0}:{}})}),l.toAppend=t.flatMap((e,t)=>s[t]?[]:[{...i({},e),__afterIndex:t}]),jb.log("childDiffRes",[l,...arguments]),l.length||l.toAppend.length?l:null}(e.children||[],t.children||[]);return{...Object.keys(a).length?{attributes:a}:{},...r?{children:r}:{},...t.tag!=e.tag?{tag:t.tag}:{}}}function n(e,t){if(e.cmp&&e.cmp===t.cmp)return!0;const a=e.attributes||{},i=t.attributes||{};return!!(a.cmpId&&a.cmpId===i.cmpId||a.ctxId&&a.ctxId===i.ctxId)||(!(!r("path",a,i)||!r("data",a,i))||(!!function(e,t,a){for(let i=0;i<e.length;i++)if(t[e[i]]&&t[e[i]]==a[e[i]])return!0}(["id","path","name"],a,i)||void 0))}function r(e,t,a){const i=t.ctxId&&jb.path(jb.ui.ctxDictionary[t.ctxId],e),n=a.ctxId&&jb.path(jb.ui.ctxDictionary[a.ctxId],e);return i&&n&&i==n}function o(t,a,{strongRefresh:n,ctx:r}={}){jb.log("applyDeltaTop",["start",...arguments]);const o=t instanceof e.VNode?t:s(t),c=i(o,a);if(t instanceof e.VNode){const e=t.getAttribute("cmp-id"),i=t.getAttribute("id");return t!=a&&(Object.keys(t).forEach(e=>delete t[e]),Object.assign(t,a)),jb.ui.updateRenderer(c,i,e,r&&r.vars.widgetId)}const m=jb.ui.activeElement()===t;if(jb.log("applyDeltaTop",["apply",o,a,c,m,...arguments],{modifier:e=>e.push(function(e){return(e=>({attributes:jb.objFromEntries(jb.entries(e.attributes).filter(e=>-1==["jb-ctx","cmp-id","originators","__afterIndex","mount-ctx","interactive"].indexOf(e[0]))),children:e.children}))(e)}(c))}),c.tag||n){d(t);const e=p(a,t.parentElement);t.parentElement.replaceChild(e,t),jb.log("replaceTop",[e,t,c]),t=e}else l(t,c);e.findIncludeSelf(t,"[interactive]").forEach(e=>e._component?e._component.recalcPropsFromElem():u(e)),m&&jb.ui.focus(t,"apply Vdom diff",r),e.garbageCollectCtxDictionary(t)}function s(e){return{tag:e.tagName.toLowerCase(),attributes:jb.objFromEntries([...Array.from(e.attributes).map(e=>[e.name,e.value]),..."#text"==jb.path(e,"firstChild.nodeName")?[["$text",e.firstChild.nodeValue]]:[]]),...e.childElementCount&&!e.getAttribute("jb_external")?{children:Array.from(e.children).map(e=>s(e))}:{}}}function l(e,t){jb.log("applyDelta",[...arguments]);const a=t.children;if(t.children){const i=t.children.length?Array.from(Array(t.children.length).keys()).map(e=>a[e]):[],n=Array.from(e.children),r=t.children.toAppend||[],o=i.reduce((e,t,a)=>e&&t.__afterIndex==a,!0)&&!r.length||!i.length&&r.reduce((e,t,a)=>e&&t.__afterIndex==a,!0);i.forEach((a,i)=>{"delete"==a.$?(d(n[i]),e.removeChild(n[i]),jb.log("removeChild",[n[i],a,e,t])):(l(n[i],a),!o&&n[i].setAttribute("__afterIndex",a.__afterIndex))}),r.forEach(a=>{const i=m(e.ownerDocument,a.tag);e.appendChild(i),l(i,a),jb.log("appendChild",[i,a,e,t]),!o&&i.setAttribute("__afterIndex",a.__afterIndex)}),o||Array.from(e.children).sort((e,t)=>Number(e.getAttribute("__afterIndex"))-Number(t.getAttribute("__afterIndex"))).forEach(t=>{const a=Number(t.getAttribute("__afterIndex"));e.children[a]!=t&&e.insertBefore(t,e.children[a]),t.removeAttribute("__afterIndex")}),e.childElementCount&&Array.from(e.childNodes).filter(e=>"#text"==e.nodeName).forEach(a=>{e.removeChild(a),jb.log("removeChild",["remove leftover",a,e,t])})}jb.entries(t.attributes).filter(t=>!("$text"===t[0]&&e.firstElementChild)).forEach(t=>c(e,t[0],t[1]))}function c(e,t,a){if("$"!==t[0]&&null==a)e.removeAttribute(t),jb.log("htmlChange",["remove",...arguments]);else if("checked"===t&&"input"===e.tagName.toLowerCase())e.checked=!!a,jb.log("htmlChange",["checked",...arguments]);else if("$text"===t)e.innerText=a||"",jb.log("htmlChange",["text",...arguments]);else if("$html"===t)e.innerHTML=a||"",jb.log("htmlChange",["html",...arguments]);else if("style"===t&&"object"==typeof a)e.setAttribute(t,jb.entries(a).map(e=>`${e[0]}:${e[1]}`).join(";")),jb.log("htmlChange",["setAtt",...arguments]);else if("value"==t&&e.tagName.match(/select|input|textarea/i)){const t=document.activeElement===e;if(e.value==a)return;e.value=a,t&&e.focus(),jb.log("htmlChange",["setAtt",...arguments])}else e.setAttribute(t,a),jb.log("htmlChange",["setAtt",...arguments])}function d(e){jb.log("unmount",[...arguments]),e&&e.setAttribute&&jb.ui.findIncludeSelf(e,"[interactive]").forEach(e=>e._component&&e._component.destroy())}function p(t,a){jb.log("render",[...arguments]);const i=function e(t,a){jb.log("htmlChange",["createElement",...arguments]);const i=m(a.ownerDocument,t.tag);return jb.entries(t.attributes).forEach(e=>c(i,e[0],e[1])),jb.asArray(t.children).map(t=>e(t,i)).forEach(e=>i.appendChild(e)),a.appendChild(i),i}(t,a);return e.findIncludeSelf(i,"[interactive]").forEach(e=>u(e)),e.garbageCollectCtxDictionary(a),i}function m(e,t){return-1!=["svg","circle","ellipse","image","line","mesh","path","polygon","polyline","rect","text"].indexOf(t)?e.createElementNS("http://www.w3.org/2000/svg",t):e.createElement(t)}function u(a,i){const n=jb.ui.ctxOfElem(a,"mount-ctx");if(!n)return jb.logError("no ctx for elem",[a]);const r="openDialog"==n.profile.$?jb.ui.dialogs.buildComp(n):n.runItself(),o={state:{...i&&jb.path(a._component,"state")},base:a,refresh(i,n){jb.log("refreshReq",[...arguments]),this._deleted||(Object.assign(this.state,i),e.refreshElem(a,{...this.state,...i},n),(this.componentDidUpdateFuncs||[]).forEach(e=>t(()=>e(this),"componentDidUpdate")))},destroy(){this._deleted=!0,this.resolveDestroyed(),(r.destroyFuncs||[]).forEach(e=>t(()=>e(this),"destroy"))},status:"initializing",recalcPropsFromElem(){a.getAttribute("worker")||(this.ctx=jb.ui.ctxOfElem(a,"mount-ctx").setVar("cmp",this),this.cmpId=a.getAttribute("cmp-id"),(a.getAttribute("interactive")||"").split(",").filter(e=>e).forEach(e=>{[id,ctxId]=e.split("-");const t=jb.ui.ctxDictOfElem(a)[ctxId];this[id]=jb.val(t.setVar("state",this.state).setVar("cmp",this).runInner(t.profile.value,"value","value"))}),this.doRefresh&&this.doRefresh())},componentDidUpdateFuncs:r.componentDidUpdateFuncs};o.destroyed=new Promise(e=>o.resolveDestroyed=e),a._component=o,o.recalcPropsFromElem(),jb.unique(r.eventObservables||[]).forEach(e=>o[e]=jb.ui.fromEvent(o,e.slice(2),a)),(r.componentDidMountFuncs||[]).forEach(e=>t(()=>e(o),"componentDidMount")),o.status="ready"}Object.assign(jb.ui,{h:a,render:p,unmount:d,applyVdomDiff:o,applyDeltaToDom:l,elemToVdom:s,mountInteractive:u,compareVdom:i,appendItems:function(t,a,i){if(t instanceof e.VNode){const e=t.getAttribute("cmp-id"),n=t.getAttribute("id");return jb.ui.updateRenderer(a,n,e,i&&i.vars.widgetId)}(a.children||[]).forEach(e=>p(e,t))},handleCmpEvent(t,a){a="undefined"!=typeof event?event:a;const i=jb.ui.parents(a.currentTarget,{includeSelf:!0}).find(e=>e.getAttribute&&null!=e.getAttribute("jb-ctx"));if(!i)return;if("scroll"==a.type&&(a.scrollPercentFromTop=a.scrollPercentFromTop||(i.scrollTop+jb.ui.offset(i).height)/i.scrollHeight),i.getAttribute("worker"))return jb.ui.workers[i.getAttribute("worker")].handleBrowserEvent(i,a,t);const n=i._component,r=t||`on${a.type}Handler`;return n&&n[r]?n[r](a):e.runActionOfElem(i,r,a)},runActionOfElem(e,t,a){if(e.getAttribute("contenteditable"))return;a="undefined"!=typeof event?event:a;const i=(e.getAttribute("handlers")||"").split(",").filter(e=>0==e.indexOf(t+"-")).map(t=>jb.ui.ctxDictOfElem(e)[t.split("-")[1]]).filter(e=>e).map(t=>t.setVar("cmp",e._component).setVars({ev:a}))[0];return i&&i.runInner(i.profile.action,"action","action")},ctrl(t,a){const i=t.vars.$refreshElemCall?t.vars.$state:{},n=t.setVars({$model:{ctx:t,...t.params},$state:i,$refreshElemCall:void 0}),r=function(e){const a=t.profile,i="$theme."+(a.$||"");return!a.style&&t.vars[i]?e.run({$:t.vars[i]}):t.params.style?t.params.style(e):{}}(n)||{};return r instanceof e.JbComponent?r.orig(n).jbExtend(a,n).applyParamFeatures(n):new e.JbComponent(n).jbExtend(a,n).jbExtend(r,n).applyParamFeatures(n)},garbageCollectCtxDictionary(t,a){if(!t.ownerDocument.contains(t))return;const i=(new Date).getTime();e.ctxDictionaryLastCleanUp=e.ctxDictionaryLastCleanUp||i;const n=i-e.ctxDictionaryLastCleanUp;if(!a&&n<1e4)return;e.ctxDictionaryLastCleanUp=i;const r="jb-ctx,mount-ctx,pick-ctx,props-ctx,handlers,interactive,originators".split(",").flatMap(e=>Array.from(document.querySelectorAll(`[${e}]`)).flatMap(t=>t.getAttribute(e).split(",").map(e=>Number(e.split("-").pop())))).sort((e,t)=>e-t),o=Object.keys(jb.ctxDictionary).map(e=>Number(e)).sort((e,t)=>e-t);let s=0;const l=[],c=[];for(let e=0;e<o.length;e++){for(;r[s]<o[e];)s++;r[s]!=o[e]&&(l.push(e),delete jb.ctxDictionary[""+o[e]])}const d=jb.unique(r.map(e=>jb.ctxDictionary[""+e]).filter(e=>e).map(e=>(e=>Object.values(e.vars).filter(e=>jb.isWatchable(e)).map(e=>jb.asRef(e)).map(e=>jb.refHandler(e).pathOfRef(e)).flat())(e)).flat());Object.keys(jb.resources).filter(e=>-1!=e.indexOf(":")).filter(e=>-1==d.indexOf(e)).forEach(e=>{c.push(e),delete jb.resources[e]}),jb.log("garbageCollect",[l,c])},refreshElem(t,i,n){if("initializing"==jb.path(t,"_component.status"))return jb.logError("circular refresh",[...arguments]);const r=e.ctxOfElem(t);if(!r)return jb.logError("refreshElem - no ctx for elem",t);const s=jb.path(n,"strongRefresh");let l=r.setVar("$state",s?{}:i||{});n&&n.extendCtx&&(l=n.extendCtx(l)),l=l.setVar("$refreshElemCall",!0),jb.ui.inStudio()&&(l.profile=jb.execInStudio({$:"studio.val",path:l.path}));const c="openDialog"==l.profile.$?jb.ui.dialogs.buildComp(l):l.runItself();if(jb.log("refreshElem",[l,c,...arguments]),jb.path(n,"cssOnly")){const e=(t.className.match(/(w|jb-)[0-9]+/)||[""])[0],a=Array.from(document.querySelectorAll("style")).map(e=>({el:e,txt:e.innerText})).filter(t=>-1!=t.txt.indexOf(e+" "))[0].el;return jb.log("refreshElem",["hashCss",c.cssLines,l,c,...arguments]),jb.ui.hashCss(c.cssLines,c.ctx,{existingClass:e,cssStyleElem:a})}const d=c.init();if(null!=d&&d==t.getAttribute("cmpHash"))return jb.log("refreshElem",["stopped by hash",d,...arguments]);c&&o(t,a(c),{strongRefresh:s,ctx:l})},subscribeToRefChange:t=>jb.subscribe(t.resourceChange,a=>{const i=t.removeLinksFromPath(t.pathOfRef(a.ref)),n=jb.path(a,"srcCtx.vars.widgetId")||jb.path(a,"srcCtx.vars.elemToTest")?a.srcCtx:jb.frame.document,r=jb.ui.find(n,"[observe]"),o=r.map(e=>e.getAttribute("jb-ctx"));jb.log("notifyObservableElems",["elemsToCheck",r,a]),r.forEach((n,r)=>{if(o[r]!=n.getAttribute("jb-ctx"))return;let s=!1,l=!1,c=!0;n.getAttribute("observe").split(",").map(e=>(function(e){const a=e.split("://"),i=a[1].split(";"),n=((i[2]||"").match(/includeChildren=([a-z]+)/)||["",""])[1],r=-1!=i.indexOf("strongRefresh"),o=-1!=i.indexOf("cssOnly"),s=-1!=i.indexOf("allowSelfRefresh");return a[0]==t.resources.id&&{ref:t.refOfUrl(i[0]),includeChildren:n,strongRefresh:r,cssOnly:o,allowSelfRefresh:s}})(e)).filter(e=>e).forEach(r=>{if(!r.allowSelfRefresh&&n==jb.path(a.srcCtx,"vars.cmp.base"))return jb.log("notifyObservableElems",["blocking self refresh",n,r,a]);const o=t.removeLinksFromPath(t.pathOfRef(r.ref));if(!o)return jb.logError("observer ref path is empty",r,a);l=l||r.strongRefresh,c=c&&r.cssOnly;const d=e.comparePaths(i,o),p=1==d,m=p&&("yes"===r.includeChildren||!0===r.includeChildren),u=p&&"structure"===r.includeChildren&&("object"==typeof a.oldVal||"object"==typeof a.newVal);(-1==d||0==d||m||u)&&(jb.log("notifyObservableElem",["notify refresh",n,a.srcCtx,r,a]),s=!0)}),s&&e.refreshElem(n,null,{srcCtx:a.srcCtx,strongRefresh:l,cssOnly:c})})})}),e.subscribeToRefChange(jb.mainWatchableHandler)}(),function(){const e=jb.ui;let t=0;e.propCounter=0;const a=(e,t)=>{try{return e()}catch(e){jb.logException(e,t,this.ctx)}},i=new Set("init,componentDidMount,componentWillUpdate,componentDidUpdate,destroy,extendCtx,templateModifier,extendItem".split(",")),n=new Set("enrichField,icon,watchAndCalcModelProp,cssLines,defHandler,interactiveProp,calcProp".split(",")),r=new Set("template,calcRenderProps,toolbar,styleCtx,calcHash,ctxForPick".split(","));Object.assign(jb.ui,{cssHashCounter:0,cssHashMap:{},hashCss(t,a,{existingClass:i,cssStyleElem:n}={}){const r=(t||[]).filter(e=>e),o=r.join("\n");if(!o)return"";const s=jb.frame.workerId&&jb.frame.workerId(a),l=s?"w"+s:"jb-";if(!this.cssHashMap[o]){if(i){const e=Object.keys(this.cssHashMap).filter(e=>this.cssHashMap[e].classId==i)[0];e&&delete this.cssHashMap[e]}else this.cssHashCounter++;const t=i||`${l}${this.cssHashCounter}`;this.cssHashMap[o]={classId:t,paths:{[a.path]:!0}};const c=function(e){const t=r.map(t=>{return t.split("{")[0].split(",").map(e=>e.trim().replace("|>"," ")).map(t=>-1==t.indexOf("~")?`.${e}${t}`:t.replace("~",`.${e}`))+" { "+t.split("{")[1]}).join("\n");return`/*style: ${a.profile.style&&a.profile.style.$}, path: ${a.path}*/\n`+t}(t);n?n.innerText=c:e.addStyleElem(c,s)}return Object.assign(this.cssHashMap[o].paths,{[a.path]:!0}),this.cssHashMap[o].classId}});class o{constructor(e){this.ctx=e,this.cmpId=t++,this.eventObservables=[],this.cssLines=[],this.contexts=[],this.originators=[e]}init(){return jb.log("initCmp",[this]),this.ctx=(this.extendCtxFuncs||[]).reduce((e,t)=>a(()=>t(e,this),"extendCtx"),this.ctx.setVar("cmpId",this.cmpId)),this.renderProps={},this.state=this.ctx.vars.$state,this.calcCtx=this.ctx.setVar("$props",this.renderProps).setVar("cmp",this),this.renderProps.cmpHash=this.calcHash&&a(()=>this.calcHash(this.calcCtx)),this.initialized=!0,this.renderProps.cmpHash}calcRenderProps(){return jb.log("renderVdom",[this]),this.initialized||this.init(),(this.initFuncs||[]).sort((e,t)=>e.phase-t.phase).forEach(e=>a(()=>e.action(this.calcCtx),"init")),this.toObserve=this.watchRef?this.watchRef.map(e=>({...e,ref:e.refF(this.ctx)})).filter(e=>jb.isWatchable(e.ref)):[],this.watchAndCalcModelProp&&this.watchAndCalcModelProp.forEach(e=>{const t=this.ctx.vars.$model[e.prop];if(!t)return jb.logError("calcRenderProps",`missing model prop "${e.prop}"`,this.ctx.vars.$model,this.ctx);const a=t(this.ctx);jb.isWatchable(a)&&this.toObserve.push({id:e.prop,cmp:this,ref:a,...e});const i=jb.val(a);this.renderProps[e.prop]=e.transformValue(this.ctx.setData(null==i?"":i))}),(this.calcProp||[]).filter(e=>0==this.calcProp.filter(t=>t.id==e.id&&t.priority>e.priority).length).sort((e,t)=>e.phase-t.phase||e.index-t.index).forEach(e=>{const t=jb.val(a(()=>null===e.value.profile?this.calcCtx.vars.$model[e.id]:e.value(this.calcCtx),`renderProp:${e.id}`));Object.assign(this.renderProps,{..."$props"==e.id?t:{[e.id]:t}})}),Object.assign(this.renderProps,(this.styleCtx||{}).params,this.state),jb.log("renderProps",[this.renderProps,this]),this.renderProps}renderVdom(){if(this.calcRenderProps(),this.ctx.probe&&this.ctx.probe.outOfTime)return;this.template=this.template||(()=>"");const t=a(()=>this.template(this,this.renderProps,e.h),"template")||{},i=(this.templateModifierFuncs||[]).reduce((t,i)=>t&&"object"==typeof t?a(()=>i(t,this,this.renderProps,e.h)||t,"templateModifier"):t,t),n=this.toObserve.map(e=>[e.ref.handler.urlOfRef(e.ref),e.includeChildren&&`includeChildren=${e.includeChildren}`,e.strongRefresh&&"strongRefresh",e.cssOnly&&"cssOnly",e.allowSelfRefresh&&"allowSelfRefresh",e.phase&&`phase=${e.phase}`].filter(e=>e).join(";")).join(","),r=(this.defHandler||[]).map(t=>`${t.id}-${e.preserveCtx(t.ctx)}`).join(","),o=(this.interactiveProp||[]).map(t=>`${t.id}-${e.preserveCtx(t.ctx)}`).join(","),s=this.originators.map(t=>e.preserveCtx(t)).join(","),l=jb.frame.workerId&&jb.frame.workerId(this.ctx);l?this.cmpId:Object.assign(i.attributes||{},{"jb-ctx":e.preserveCtx(this.originatingCtx()),"cmp-id":this.cmpId,"mount-ctx":e.preserveCtx(this.ctx)},n&&{observe:n},r&&{handlers:r},s&&{originators:s},this.ctxForPick&&{"pick-ctx":e.preserveCtx(this.ctxForPick)},(this.componentDidMountFuncs||o)&&{interactive:o},null!=this.renderProps.cmpHash&&{cmpHash:this.renderProps.cmpHash});return i instanceof jb.ui.VNode&&(i.addClass(this.jbCssClass()),i.attributes=Object.assign(i.attributes||{},{"jb-ctx":e.preserveCtx(this.originatingCtx()),"cmp-id":this.cmpId,"mount-ctx":e.preserveCtx(this.ctx)},n&&{observe:n},r&&{handlers:r},s&&{originators:s},this.ctxForPick&&{"pick-ctx":e.preserveCtx(this.ctxForPick)},l&&{worker:l},(this.componentDidMountFuncs||o)&&{interactive:o},null!=this.renderProps.cmpHash&&{cmpHash:this.renderProps.cmpHash})),function e(t){jb.entries(t.attributes).forEach(([e,a])=>0==e.indexOf("on")&&0!=(""+a).indexOf("jb.ui")&&(t.attributes[e]=`jb.ui.handleCmpEvent(${"string"==typeof a&&a?"'"+a+"'":""})`));(t.children||[]).forEach(t=>e(t))}(i),jb.log("renRes",[this.ctx,i,this]),i}jbCssClass(){return e.hashCss(this.cssLines,this.ctx)}originatingCtx(){return this.originators[this.originators.length-1]}field(){if(this._field)return this._field;const t=this.originatingCtx();this._field={class:"",ctxId:e.preserveCtx(t),control:(e,a,i)=>this.getOrCreateItemField(e,()=>t.setData(e).setVars({index:(a||0)+1}).runItself(),i)},this.enrichField&&this.enrichField.forEach(e=>e(this._field));let a=jb.tosingle(jb.val(t.params.title))||(()=>"");return void 0!==this._field.title&&(a=this._field.title),this._field.title="function"==typeof a?a:()=>""+a,this.itemfieldCache=new Map,this._field}getOrCreateItemField(e,t,a){return a?t():(this.itemfieldCache.get(e)||this.itemfieldCache.set(e,t()),this.itemfieldCache.get(e))}orig(e){return jb.comps[e.profile&&e.profile.$].type.split(/,|-/).indexOf("control"),this.originators.push(e),this}applyParamFeatures(e){return(e.params.features&&e.params.features(e)||[]).forEach(t=>this.jbExtend(t,e)),this}jbExtend(t,a){if(!t)return this;(a=a||this.ctx)||console.log("no ctx provided for jbExtend");const o=t.$?a.run(t):t;return Array.isArray(o)?(o.forEach(e=>this.jbExtend(e,a)),this):(o.afterViewInit&&(o.componentDidMount=o.afterViewInit),"string"==typeof o.class&&(o.templateModifier=e=>e.addClass(o.class)),Object.keys(o).forEach(e=>{i.has(e)&&(this[e+"Funcs"]=this[e+"Funcs"]||[],this[e+"Funcs"].push(o[e])),n.has(e)&&(this[e]=this[e]||[],this[e].push(o[e])),r.has(e)&&(this[e]=this[e]||o[e])}),o.watchRef&&(this.watchRef=this.watchRef||[],this.watchRef.push(Object.assign({cmp:this},o.watchRef))),this.eventObservables=this.eventObservables.concat(Object.keys(o).filter(e=>0==e.indexOf("on"))),o.css&&(this.cssLines=(this.cssLines||[]).concat(o.css.split(/}\s*/m).map(e=>e.trim()).filter(e=>e).map(e=>e+"}").map(e=>e.replace(/^!/," ")))),jb.asArray(o.featuresOptions||[]).filter(e=>e).forEach(e=>this.jbExtend(e.$?a.run(e):e,a)),jb.asArray(e.inStudio()&&o.studioFeatures).filter(e=>e).forEach(e=>this.jbExtend(a.run(e),a)),this)}}e.JbComponent=o,jb.jstypes.renderable=t=>null==t?"":t instanceof e.VNode?t:t instanceof o?e.h(t):Array.isArray(t)?e.h("div",{},t.map(e=>jb.jstypes.renderable(e))):""+jb.val(t,!0)}(),function(){const e=jb.ui;Object.assign(jb.ui,{focus(e,t,a){const i=(new Date).getTime(),n=jb.studio.lastStudioActivity||jb.path(jb,["studio","studioWindow","jb","studio","lastStudioActivity"]);jb.log("focus",["request",a,t,i-n,e,a]),jb.studio.previewjb==jb&&n&&i-n<1e3||jb.delay(1).then(i=>{jb.log("focus",["apply",a,t,e,a]),e.focus()})},wrapWithLauchingElement:(e,t,a,i={})=>n=>e(t.extendVars(n).setVars({$launchingElement:{el:a,...i}})),withUnits:e=>""===e||void 0===e?"":(""+e||"").match(/[^0-9]$/)?e:`${e}px`,propWithUnits:(e,t)=>""===t||void 0===t?"":`${e}: `+((""+t||"").match(/[^0-9]$/)?t:`${t}px`)+";",fixCssLine:e=>-1!=e.indexOf("/n")||e.match(/}\s*/)?e:`{ ${e} }`,ctxDictOfElem:e=>{const t=jb.frame.workerId&&jb.frame.workerId(),a=e.getAttribute("worker");return("preview"==a?jb.studio.previewjb:!t&&a?jb.ui.workers[e.getAttribute("worker")]:jb).ctxDictionary},ctxOfElem:(e,t)=>e&&e.getAttribute&&jb.ui.ctxDictOfElem(e)[e.getAttribute(t||"jb-ctx")],preserveCtx:e=>(jb.ctxDictionary[e.id]=e,e.id),inStudio:()=>jb.studio&&jb.studio.studioWindow,inPreview(){try{return!e.inStudio()&&jb.frame.parent.jb.studio.initPreview}catch(e){}},parentCmps(e){if(!e)return[];const t=jb.ui.parents(e),a=t[t.length-5];return(jb.ui.hasClass(a,"jb-dialog")?t.slice(0,-4).concat(jb.ui.ctxOfElem(a).exp("%$$launchingElement.el._component.base%")||[]):t).map(e=>e._component).filter(e=>e)},closestCmp(e){return e._component||this.parentCmps(e)[0]},document:e=>jb.frame.workerId&&jb.frame.workerId(e)?jb.ui.widgets[e.vars.widgetId].top:e.vars.elemToTest||e.frame().document,item:(e,t,a)=>(e.extendItemFuncs&&e.extendItemFuncs.forEach(i=>i(e,t,a)),t),fromEvent:(e,t,a)=>jb.callbag.pipe(jb.callbag.fromEvent(a||e.base,t),jb.callbag.takeUntil(jb.callbag.fromPromise(e.destroyed))),upDownEnterEscObs(e){const{pipe:t,takeUntil:a,fromPromise:i,subject:n}=jb.callbag,r=n();return e.base.onkeydown=e=>-1==[38,40,13,27].indexOf(e.keyCode)||(r.next(e),!1),t(r,a(i(e.destroyed)))}}),Object.assign(jb.ui,{outerWidth(e){const t=getComputedStyle(e);return e.offsetWidth+parseInt(t.marginLeft)+parseInt(t.marginRight)},outerHeight(e){const t=getComputedStyle(e);return e.offsetHeight+parseInt(t.marginTop)+parseInt(t.marginBottom)},offset:e=>e.getBoundingClientRect(),parents(e,{includeSelf:t}={}){const a=[];for(e=t?e:e&&e.parentNode;e;)a.push(e),e=e.parentNode;return a},closest(t,a){for(;t;){if(e.matches(t,a))return t;t=t.parentNode}},activeElement:()=>document.activeElement,find(t,a,i){return t?("jbCtx"==jb.path(t,"constructor.name")&&(t=this.document(t)),t?t instanceof jb.ui.VNode?t.querySelectorAll(a,i):[...i&&i.includeSelf&&e.matches(t,a)?[t]:[],...Array.from(t.querySelectorAll(a))]:[]):[]},findIncludeSelf:(e,t)=>jb.ui.find(e,t,{includeSelf:!0}),addClass:(e,t)=>e&&e.classList&&e.classList.add(t),removeClass:(e,t)=>e&&e.classList&&e.classList.remove(t),hasClass:(e,t)=>e&&e.classList&&e.classList.contains(t),matches:(e,t)=>e&&e.matches&&e.matches(t),index:e=>Array.from(e.parentNode.children).indexOf(e),limitStringLength:(e,t)=>"string"==typeof e&&e.length>t-3?e.substring(0,t)+"...":e,addHTML(e,t){const a=document.createElement("div");a.innerHTML=t,e.appendChild(a.firstChild)},addStyleElem(e,t){if(t)jb.ui.workerStyleElems=jb.ui.workerStyleElems||{},jb.ui.workerStyleElems[t]=jb.ui.workerStyleElems[t]||[],jb.ui.workerStyleElems[t].push(e);else{const t=document.createElement("style");t.innerHTML=e,document.head.appendChild(t)}}}),e.renderWidget=function(t,a){let i=!1;try{"undefined"!=typeof window&&window.parent.jb}catch(e){i=!0}try{!i&&"undefined"!=typeof window&&window.parent!=window&&window.parent.jb&&window.parent.jb.studio.initPreview(window,[Object.getPrototypeOf({}),Object.getPrototypeOf([])])}catch(e){return jb.logException(e)}let n=t,r=0;if(jb.studio.studioWindow){const e=jb.studio.studioWindow,t=e.jb.studio,a=e.jb.resources.studio.project,i=e.jb.resources.studio.page;a&&i&&(n={$:`${jb.macroName(a)}.${i}`});const{pipe:o,debounceTime:c,filter:d,subscribe:p}=jb.callbag;o(t.pageChange,d(({page:e})=>e!=n.$),p(({page:e})=>l(e))),o(t.scriptChange,d(e=>s(t,e.path)),p(({path:e})=>{let t=e.lastIndexOf("features");-1==t&&(t=e.lastIndexOf("layout"));const a=e.slice(0,t).join("~");Array.from(document.querySelectorAll("[jb-ctx]")).map(e=>({elem:e,ctx:jb.ctxDictionary[e.getAttribute("jb-ctx")]})).filter(e=>e.ctx&&e.ctx.path==a).forEach(e=>jb.ui.refreshElem(e.elem,null,{cssOnly:!0}))})),o(t.scriptChange,d(e=>!s(t,e.path)),d(e=>0!=(jb.path(e,"path.0")||"").indexOf("dataResource.")),c(()=>Math.min(2e3,3*r+500)),p(()=>{l(),jb.ui.dialogs.reRenderAll()}))}const o=a.ownerDocument.createElement("div");function s(e,t){const a=function(e,t){const a=t.lastIndexOf("features");if(-1==a){const e=t.lastIndexOf("layout");return-1!=e&&t.slice(0,e+1).join("~")}const i=Array.isArray(e.valOfPath(t.slice(0,a+1).join("~")));return t.slice(0,a+(i?2:1)).join("~")}(e,t);return a&&(e.compNameOfPath(a)||"").match(/^(css|layout)/)}function l(t){t&&(n={$:t});const i=(new jb.jbCtx).run(n),o=(new Date).getTime();jb.ui.unmount(a),a.innerHTML="",jb.ui.render(e.h(i),a),r=(new Date).getTime()-o}a.appendChild(o),l()},jb.objectDiff=function(e,t){if(t===e)return{};if(!jb.isObject(t)||!jb.isObject(e))return e;const a=Object.keys(t).reduce((t,a)=>e.hasOwnProperty(a)?t:{...t,[a]:jb.frame.workerId&&jb.frame.workerId()?"__undefined":void 0},{});return Object.keys(e).reduce((a,i)=>{if(!t.hasOwnProperty(i))return{...a,[i]:e[i]};const n=jb.objectDiff(e[i],t[i]);return jb.isObject(n)&&jb.isEmpty(n)?a:{...a,[i]:n}},a)},jb.component("customStyle",{typePattern:e=>/\.style$/.test(e),category:"advanced:10,all:10",params:[{id:"template",as:"single",mandatory:!0,dynamic:!0,ignore:!0},{id:"css",as:"string"},{id:"features",type:"feature[]",dynamic:!0}],impl:(e,t,a)=>({template:e.profile.template,css:t,featuresOptions:a(),styleCtx:e._parent})}),jb.component("styleByControl",{typePattern:e=>/\.style$/.test(e),category:"advanced:10,all:20",params:[{id:"control",type:"control",mandatory:!0,dynamic:!0},{id:"modelVar",as:"string",mandatory:!0}],impl:(e,t,a)=>t(e.setVar(a,e.vars.$model))}),jb.component("styleWithFeatures",{typePattern:e=>/\.style$/.test(e),description:"customize, add more features to style",category:"advanced:10,all:20",params:[{id:"style",type:"$asParent",mandatory:!0,composite:!0},{id:"features",type:"feature[]",templateValue:[],dynamic:!0,mandatory:!0}],impl:(e,t,a)=>t instanceof jb.ui.JbComponent?t.jbExtend(a(),e):t&&{...t,featuresOptions:(t.featuresOptions||[]).concat(a())}}),jb.component("controlWithFeatures",{type:"control",description:"customize, add more features to control",category:"advanced:10,all:20",params:[{id:"control",type:"control",mandatory:!0},{id:"features",type:"feature[]",templateValue:[],mandatory:!0}],impl:(e,t,a)=>t.jbExtend(a,e).orig(e)})}(),jb.component("defHandler",{type:"feature",description:"define custom event handler",params:[{id:"id",as:"string",mandatory:!0,description:'to be used in html, e.g. onclick="clicked" '},{id:"action",type:"action[]",mandatory:!0,dynamic:!0}],impl:(e,t)=>({defHandler:{id:t,ctx:e}})}),jb.component("watchAndCalcModelProp",{type:"feature",description:"Use a model property in the rendering and watch its changes (refresh on change)",params:[{id:"prop",as:"string",mandatory:!0},{id:"transformValue",dynamic:!0,defaultValue:"%%"},{id:"allowSelfRefresh",as:"boolean",description:"allow refresh originated from the components or its children"}],impl:e=>({watchAndCalcModelProp:e.params})}),jb.component("calcProp",{type:"feature",description:"define a variable to be used in the rendering calculation process",params:[{id:"id",as:"string",mandatory:!0},{id:"value",mandatory:!0,dynamic:!0,description:"when empty value is taken from model"},{id:"priority",as:"number",defaultValue:1,description:"if same prop was defined elsewhere decides who will override. range 1-1000"},{id:"phase",as:"number",defaultValue:10,description:"props from different features can use each other, phase defines the calculation order"}],impl:e=>({calcProp:{...e.params,index:jb.ui.propCounter++}})}),jb.component("interactiveProp",{type:"feature",description:"define a variable for the interactive comp",params:[{id:"id",as:"string",mandatory:!0},{id:"value",mandatory:!0,dynamic:!0}],impl:(e,t)=>({interactiveProp:{id:t.replace(/-/g,"_"),ctx:e}})}),jb.component("calcProps",{type:"feature",description:"define variables to be used in the rendering calculation process",params:[{id:"props",as:"object",mandatory:!0,description:"props as object",dynamic:!0},{id:"phase",as:"number",defaultValue:10,description:"props from different features can use each other, phase defines the calculation order"}],impl:(e,t,a)=>({calcProp:{id:"$props",value:e=>t(e),phase:a,index:jb.ui.propCounter++}})}),jb.component("feature.init",{type:"feature",category:"lifecycle",params:[{id:"action",type:"action[]",mandatory:!0,dynamic:!0},{id:"phase",as:"number",defaultValue:10,description:"init funcs from different features can use each other, phase defines the calculation order"}],impl:(e,t,a)=>({init:{action:t,phase:a}})}),jb.component("feature.destroy",{type:"feature",category:"lifecycle",params:[{id:"action",type:"action[]",mandatory:!0,dynamic:!0}],impl:e=>({destroy:t=>e.params.action(t.ctx)})}),jb.component("feature.beforeInit",{type:"feature",category:"lifecycle",params:[{id:"action",type:"action[]",mandatory:!0,dynamic:!0}],impl:feature.init("%$action%",5)}),jb.component("feature.afterLoad",{type:"feature",description:"init, onload, defines the interactive part of the component",category:"lifecycle",params:[{id:"action",type:"action[]",mandatory:!0,dynamic:!0}],impl:e=>({afterViewInit:t=>e.params.action(t.ctx)})}),jb.component("interactive",jb.comps["feature.afterLoad"]),jb.component("templateModifier",{type:"feature",description:"change the html template",params:[{id:"value",mandatory:!0,dynamic:!0}],impl:(e,t)=>({templateModifier:(a,i)=>t(e.setVars({cmp:i,vdom:a,...i.renderProps}))})}),jb.component("features",{type:"feature",description:"list of features, auto flattens",params:[{id:"features",type:"feature[]",as:"array",composite:!0}],impl:(e,t)=>t.flatMap(e=>Array.isArray(e)?e:[e])}),jb.component("watchRef",{type:"feature",category:"watch:100",description:"subscribes to data changes to refresh component",params:[{id:"ref",mandatory:!0,as:"ref",dynamic:!0,description:"reference to data"},{id:"includeChildren",as:"string",options:"yes,no,structure",defaultValue:"no",description:"watch childern change as well"},{id:"allowSelfRefresh",as:"boolean",description:"allow refresh originated from the components or its children"},{id:"strongRefresh",as:"boolean",description:"rebuild the component and reinit wait for data"},{id:"cssOnly",as:"boolean",description:"refresh only css features"},{id:"phase",as:"number",description:"controls the order of updates on the same event. default is 0"}],impl:e=>({watchRef:{refF:e.params.ref,...e.params}})}),jb.component("watchObservable",{type:"feature",category:"watch",description:"subscribes to a custom observable to refresh component",params:[{id:"toWatch",mandatory:!0},{id:"debounceTime",as:"number",description:"in mSec"}],impl:interactive((e,{cmp:t},{toWatch:a,debounceTime:i})=>jb.callbag.pipe(a,jb.callbag.takeUntil(t.destroyed),i&&jb.callbag.debounceTime(i),jb.callbag.subscribe(()=>t.refresh(null,{srcCtx:e}))))}),jb.component("feature.onDataChange",{type:"feature",category:"watch",description:"watch observable data reference, subscribe and run action",params:[{id:"ref",mandatory:!0,as:"ref",dynamic:!0,description:"reference to data"},{id:"includeChildren",as:"string",options:"yes,no,structure",defaultValue:"no",description:"watch childern change as well"},{id:"action",type:"action",dynamic:!0,description:"run on change"}],impl:interactive((e,{cmp:t},{ref:a,includeChildren:i,action:n})=>jb.subscribe(jb.ui.refObservable(a(),t,{includeChildren:i,srcCtx:e}),()=>n(e.setVar("cmp",t))))}),jb.component("group.data",{type:"feature",category:"general:100,watch:80",params:[{id:"data",mandatory:!0,dynamic:!0,as:"ref"},{id:"itemVariable",as:"string",description:"optional. define data as a local variable"},{id:"watch",as:"boolean",type:"boolean"},{id:"includeChildren",as:"string",options:"yes,no,structure",defaultValue:"no",description:"watch childern change as well"}],impl:(e,t,a,i,n)=>({...i?{watchRef:{refF:t,includeChildren:n}}:{},extendCtx:e=>{const i=t();return e.setData(i).setVar(a,i)}})}),jb.component("htmlAttribute",{type:"feature",description:"set attribute to html element and give it value",params:[{id:"attribute",mandatory:!0,as:"string"},{id:"value",mandatory:!0,as:"string",dynamic:!0}],impl:(e,t,a)=>({templateModifier:(e,i)=>(e.attributes=e.attributes||{},e.attributes[t]=a(i.ctx),e)})}),jb.component("id",{type:"feature",description:"adds id to html element",params:[{id:"id",mandatory:!0,as:"string",dynamic:!0}],impl:htmlAttribute("id",(e,{},{id:t})=>t(e))}),jb.component("feature.hoverTitle",{type:"feature",description:"set element title, usually shown by browser on hover",params:[{id:"title",as:"string",mandatory:!0}],impl:htmlAttribute("title","%$title%")}),jb.component("variable",{type:"feature",category:"general:90",description:"define a variable. watchable or passive, local or global",params:[{id:"name",as:"string",mandatory:!0},{id:"value",dynamic:!0,defaultValue:"",mandatory:!0},{id:"watchable",as:"boolean",type:"boolean",description:"E.g., selected item variable"}],impl:({},e,t,a)=>({destroy:t=>{if(!a)return;const i=e+":"+t.cmpId;t.ctx.run(writeValue(`%$${i}%`,null))},extendCtx:(i,n)=>{if(!a)return i.setVar(e,jb.val(t(i)));const r=e+":"+n.cmpId;jb.log("var",["new-watchable",i,r]);const o=jb.mainWatchableHandler.refOfPath([r]);return jb.writeValue(o,t(i),i),i.setVar(e,o)}})}),jb.component("calculatedVar",{type:"feature",category:"general:60",description:"defines a local variable that watches other variables with auto recalc",params:[{id:"name",as:"string",mandatory:!0},{id:"value",dynamic:!0,defaultValue:"",mandatory:!0},{id:"watchRefs",as:"array",dynamic:!0,mandatory:!0,defaultValue:[],description:"variable to watch. needs to be in array"}],impl:(e,t,a,i)=>({destroy:e=>{const a=t+":"+e.cmpId;e.ctx.run(writeValue(`%$${a}%`,null))},extendCtx:(i,n)=>{const r=t+":"+n.cmpId;jb.log("calculated var",["new-resource",e,r]),jb.resource(r,jb.val(a(i)));const o=i.exp(`%$${r}%`,"ref");return i.setVar(t,o)},afterViewInit:n=>{const r=t+":"+n.cmpId,o=n.ctx.exp(`%$${r}%`,"ref");(i(n.ctx)||[]).map(e=>jb.asRef(e)).filter(e=>e).forEach(t=>jb.subscribe(jb.ui.refObservable(t,n,{srcCtx:e}),t=>jb.writeValue(o,a(n.ctx),e)))}})}),jb.component("feature.if",{type:"feature",category:"feature:85",description:"adds/remove element to dom by condition. keywords: hidden/show",params:[{id:"showCondition",as:"boolean",mandatory:!0,dynamic:!0,type:"boolean"}],impl:(e,t)=>({templateModifier:(e,a)=>jb.toboolean(t(a.ctx))?e:jb.ui.h("span",{style:{display:"none"}})})}),jb.component("hidden",{type:"feature",category:"feature:85",description:"display:none on element. keywords: show",params:[{id:"showCondition",type:"boolean",mandatory:!0,dynamic:!0}],impl:(e,t)=>({templateModifier:(e,a)=>(jb.toboolean(t(a.ctx))||jb.path(e,["attributes","style","display"],"none"),e)})}),jb.component("conditionalClass",{type:"feature",description:"toggle class by condition",params:[{id:"cssClass",as:"string",mandatory:!0,dynamic:!0},{id:"condition",type:"boolean",mandatory:!0,dynamic:!0}],impl:(e,t,a)=>({templateModifier:(e,i)=>(jb.toboolean(a(i.ctx))&&e.addClass(t()),e)})}),jb.component("feature.keyboardShortcut",{type:"feature",category:"events",description:"listen to events at the document level even when the component is not active",params:[{id:"key",as:"string",description:"e.g. Alt+C"},{id:"action",type:"action",dynamic:!0}],impl:(e,t,a)=>({afterViewInit:e=>{jb.subscribe(jb.ui.fromEvent(e,"keydown",e.base.ownerDocument),e=>{const i=t.split("+").slice(1).join("+"),n=i.charCodeAt(0);"Delete"==t&&(n=46);const r=(t.match("([A-Za-z]*)+")||["",""])[1];("Ctrl"!=r||e.ctrlKey)&&("Alt"!=r||e.altKey)&&(e.keyCode==n||e.key&&e.key==i)&&a()})}})}),jb.component("feature.onEvent",{type:"feature",category:"events",params:[{id:"event",as:"string",mandatory:!0,options:"load,blur,change,focus,keydown,keypress,keyup,click,dblclick,mousedown,mousemove,mouseup,mouseout,mouseover,scroll"},{id:"action",type:"action[]",mandatory:!0,dynamic:!0},{id:"debounceTime",as:"number",defaultValue:0,description:"used for mouse events such as mousemove"}],impl:(e,t,a,i)=>({[`on${t}`]:!0,afterViewInit:e=>{"load"==t?jb.delay(1).then(()=>jb.ui.wrapWithLauchingElement(a,e.ctx,e.base)()):jb.subscribe(i?e[`on${t}`].debounceTime(i):e[`on${t}`],t=>jb.ui.wrapWithLauchingElement(a,e.ctx.setVars({event:t}),e.base)())}})}),jb.component("feature.onHover",{type:"feature",description:"on mouse enter",category:"events",params:[{id:"action",type:"action[]",mandatory:!0,dynamic:!0},{id:"onLeave",type:"action[]",mandatory:!0,dynamic:!0},{id:"debounceTime",as:"number",defaultValue:0}],impl:(e,t,a,i)=>({onmouseenter:!0,onmouseleave:!0,afterViewInit:e=>{const{pipe:n,debounceTime:r,subscribe:o}=jb.callbag;n(e.onmouseenter,r(i),o(()=>jb.ui.wrapWithLauchingElement(t,e.ctx,e.base)())),n(e.onmouseleave,r(i),o(()=>jb.ui.wrapWithLauchingElement(a,e.ctx,e.base)()))}})}),jb.component("feature.classOnHover",{type:"feature",description:"set css class on mouse enter",category:"events",params:[{id:"class",type:"string",defaultValue:"item-hover",description:"css class to add/remove on hover"}],impl:(e,t)=>({onmouseenter:!0,onmouseleave:!0,afterViewInit:e=>{jb.subscribe(e.onmouseenter,()=>jb.ui.addClass(e.base,t)),jb.subscribe(e.onmouseleave,()=>jb.ui.removeClass(e.base,t))}})}),jb.ui.checkKey=function(e,t){if(!t)return;const a=(t=t.replace(/-/,"+")).split("+").pop();let i={tab:9,delete:46,tab:9,esc:27,enter:13,right:39,left:37,up:38,down:40}[a.toLowerCase()];return+a&&(i=+a),1==a.length&&(i=a.charCodeAt(0)),t.match(/^[Cc]trl/)&&!e.ctrlKey||t.match(/^[Aa]lt/)&&!e.altKey?void 0:e.keyCode==i},jb.component("feature.onKey",{type:"feature",category:"events",macroByValue:!0,params:[{id:"key",as:"string",description:"E.g., a,27,Enter,Esc,Ctrl+C or Alt+V"},{id:"action",type:"action",mandatory:!0,dynamic:!0},{id:"doNotWrapWithLauchingElement",as:"boolean",type:"boolean"}],impl:(e,t,a)=>({onkeydown:!0,afterViewInit:i=>jb.subscribe(i.onkeydown,n=>{jb.ui.checkKey(n,t)&&(e.params.doNotWrapWithLauchingElement?a(i.ctx):jb.ui.wrapWithLauchingElement(a,i.ctx,i.base)())})})}),jb.component("feature.onEnter",{type:"feature",category:"events",params:[{id:"action",type:"action[]",mandatory:!0,dynamic:!0}],impl:feature.onKey("Enter",call("action"))}),jb.component("feature.onEsc",{type:"feature",category:"events",params:[{id:"action",type:"action[]",mandatory:!0,dynamic:!0}],impl:feature.onKey("Esc",call("action"))}),jb.component("refreshControlById",{type:"action",params:[{id:"id",as:"string",mandatory:!0},{id:"strongRefresh",as:"boolean",description:"rebuild the component and reinit wait for data"},{id:"cssOnly",as:"boolean",description:"refresh only css features"}],impl:(e,t)=>{const a=jb.ui.document(e).querySelector("#"+t);return a?jb.ui.refreshElem(a,null,{srcCtx:e,...e.params}):jb.logError("refreshControlById can not find elem for #"+t,e)}}),jb.component("group.autoFocusOnFirstInput",{type:"feature",impl:e=>({afterViewInit:t=>{const a=Array.from(t.base.querySelectorAll("input,textarea,select")).filter(e=>"checkbox"!=e.getAttribute("type"))[0];a&&jb.ui.focus(a,"group.auto-focus-on-first-input",e)}})}),jb.component("focusOnFirstElement",{type:"action",params:[{id:"selector",as:"string",defaultValue:"input"}],impl:(e,t)=>jb.delay(50).then(()=>{const a=document.querySelector(t);a&&jb.ui.focus(a,"focus-on-first-element",e)})}),jb.component("feature.byCondition",{type:"feature",description:"conditional feature, define feature if then else condition",macroByValue:!0,params:[{id:"condition",type:"boolean",as:"boolean",mandatory:!0},{id:"then",type:"feature",mandatory:!0,dynamic:!0,composite:!0},{id:"else",type:"feature",dynamic:!0}],impl:(e,t,a,i)=>t?a():i()}),function(){const e=jb.ui.withUnits,t=jb.ui.fixCssLine;jb.component("css",{description:"e.g. {color: red; width: 20px} or div>.myClas {color: red} ",type:"feature,dialog-feature",params:[{id:"css",mandatory:!0,as:"string"}],impl:(e,a)=>({css:t(a)})}),jb.component("css.class",{type:"feature,dialog-feature",params:[{id:"class",mandatory:!0,as:"string"}],impl:(e,t)=>({class:t})}),jb.component("css.width",{type:"feature,dialog-feature",params:[{id:"width",mandatory:!0,as:"string",description:"e.g. 200, 100%, calc(100% - 100px)"},{id:"overflow",as:"string",options:",auto,hidden,scroll"},{id:"minMax",as:"string",options:",min,max"},{id:"selector",as:"string"}],impl:(t,a,i,n)=>({css:`${t.params.selector} { ${n?n+"-":""}width: ${e(a)} ${i?"; overflow-x:"+i+";":""} }`})}),jb.component("css.height",{type:"feature,dialog-feature",params:[{id:"height",mandatory:!0,as:"string",description:"e.g. 200, 100%, calc(100% - 100px)"},{id:"overflow",as:"string",options:",auto,hidden,scroll"},{id:"minMax",as:"string",options:",min,max"},{id:"selector",as:"string"}],impl:(t,a,i,n)=>({css:`${t.params.selector} { ${n?n+"-":""}height: ${e(a)} ${i?"; overflow-y:"+i:""} }`})}),jb.component("css.opacity",{type:"feature",params:[{id:"opacity",mandatory:!0,as:"string",description:"0-1"},{id:"selector",as:"string"}],impl:(e,t)=>({css:`${e.params.selector} { opacity: ${t} }`})}),jb.component("css.padding",{type:"feature,dialog-feature",params:[{id:"top",as:"string",description:"e.g. 20, 20%, 0.4em"},{id:"left",as:"string"},{id:"right",as:"string"},{id:"bottom",as:"string"},{id:"selector",as:"string"}],impl:t=>{const a=["top","left","right","bottom"].filter(e=>""!=t.params[e]).map(a=>`padding-${a}: ${e(t.params[a])}`).join("; ");return{css:`${t.params.selector} {${a}}`}}}),jb.component("css.margin",{type:"feature,dialog-feature",params:[{id:"top",as:"string",description:"e.g. 20, 20%, 0.4em, -20"},{id:"left",as:"string"},{id:"bottom",as:"string"},{id:"right",as:"string"},{id:"selector",as:"string"}],impl:t=>{const a=["top","left","right","bottom"].filter(e=>null!=t.params[e]).map(a=>`margin-${a}: ${e(t.params[a])}`).join("; ");return{css:`${t.params.selector} {${a}}`}}}),jb.component("css.marginAllSides",{type:"feature,dialog-feature",params:[{id:"value",as:"string",mandatory:!0,description:"e.g. 20, 20%, 0.4em"},{id:"selector",as:"string"}],impl:(t,a,i)=>({css:`${i} margin: ${e(a)}`})}),jb.component("css.marginVerticalHorizontal",{type:"feature,dialog-feature",params:[{id:"vertical",as:"string",mandatory:!0},{id:"horizontal",as:"string",mandatory:!0},{id:"selector",as:"string"}],impl:(t,a,i,n)=>({css:`${n} margin: ${e(a)+" "+e(i)}`})}),jb.component("css.transformRotate",{type:"feature",params:[{id:"angle",as:"string",description:"0-360"},{id:"selector",as:"string"}],impl:(e,t,a)=>({css:`${a} {transform:rotate(${t}deg)}`})}),jb.component("css.color",{type:"feature",params:[{id:"color",as:"string"},{id:"background",as:"string"},{id:"selector",as:"string"}],impl:(e,t)=>{const a=["color","background"].filter(t=>e.params[t]).map(t=>`${t}: ${e.params[t]}`).join("; ");return a&&{css:`${e.params.selector} {${a}}`}}}),jb.component("css.transformScale",{type:"feature",params:[{id:"x",as:"string",description:"0-1"},{id:"y",as:"string",description:"0-1"},{id:"selector",as:"string"}],impl:e=>({css:`${e.params.selector} {transform:scale(${e.params.x},${e.params.y})}`})}),jb.component("css.transformTranslate",{type:"feature",description:"margin, move, shift, offset",params:[{id:"x",as:"string",description:"10px",defaultValue:"0"},{id:"y",as:"string",description:"20px",defaultValue:"0"},{id:"selector",as:"string"}],impl:t=>({css:`${t.params.selector} {transform:translate(${e(t.params.x)},${e(t.params.y)})}`})}),jb.component("css.bold",{type:"feature",impl:e=>({css:"{font-weight: bold}"})}),jb.component("css.underline",{type:"feature",impl:e=>({css:"{text-decoration: underline}"})}),jb.component("css.boxShadow",{type:"feature,dialog-feature",params:[{id:"blurRadius",as:"string",templateValue:"5"},{id:"spreadRadius",as:"string",templateValue:"0"},{id:"shadowColor",as:"string",templateValue:"#000000"},{id:"opacity",as:"string",templateValue:.5,description:"0-1"},{id:"horizontal",as:"string",templateValue:"10"},{id:"vertical",as:"string",templateValue:"10"},{id:"selector",as:"string"}],impl:(t,a,i,n,r,o,s,l)=>{const c=[parseInt(n.slice(1,3),16)||0,parseInt(n.slice(3,5),16)||0,parseInt(n.slice(5,7),16)||0].join(",");return{css:`${l} { box-shadow: ${e(o)} ${e(s)} ${e(a)} ${e(i)} rgba(${c},${r}) }`}}}),jb.component("css.border",{type:"feature,dialog-feature",params:[{id:"width",as:"string",defaultValue:"1"},{id:"side",as:"string",options:"top,left,bottom,right"},{id:"style",as:"string",options:"solid,dotted,dashed,double,groove,ridge,inset,outset",defaultValue:"solid"},{id:"color",as:"string",defaultValue:"black"},{id:"selector",as:"string"}],impl:(t,a,i,n,r,o)=>({css:`${o} { border${i?"-"+i:""}: ${e(a)} ${n} ${r} }`})}),jb.component("css.borderRadius",{type:"feature,dialog-feature",params:[{id:"radius",as:"string",defaultValue:"5"},{id:"selector",as:"string"}],impl:(t,a,i)=>({css:`${i} { border-radius: ${e(a)}}`})}),jb.component("css.lineClamp",{type:"feature",description:"ellipsis after X lines",params:[{id:"lines",mandatory:!0,as:"string",templateValue:3,description:"no of lines to clump"},{id:"selector",as:"string"}],impl:css("%$selector% { overflow: hidden; text-overflow: ellipsis; -webkit-box-orient: vertical; display: -webkit-box; -webkit-line-clamp: %$lines% }")}),["layout","typography","detailedBorder","detailedColor","gridArea"].forEach(e=>jb.component(`css.${e}`,{type:"feature:0",params:[{id:"css",mandatory:!0,as:"string"}],impl:(e,a)=>({css:t(a)})}))}(),jb.ns("text"),jb.component("text",{type:"control",category:"control:100,common:100",params:[{id:"text",as:"ref",mandatory:!0,templateValue:"my text",dynamic:!0},{id:"title",as:"ref",mandatory:!0,templateValue:"my title",dynamic:!0},{id:"style",type:"text.style",defaultValue:text.span(),dynamic:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e)}),jb.component("label",{...jb.comps.text,type:"depricated-control"}),jb.component("text.bindText",{type:"feature",category:"text:0",impl:features(watchAndCalcModelProp({prop:"text",transformValue:({data:e})=>jb.ui.toVdomOrStr(e)}),()=>({studioFeatures:{$:"feature.contentEditable",param:"text"}}))}),jb.component("text.allowAsynchValue",{type:"feature",impl:features(calcProp({id:"text",value:(e,{cmp:t})=>t.text||e.vars.$props.text}),interactive((e,{cmp:t})=>{if(t.text)return;const a=jb.ui.toVdomOrStr(e.vars.$model.text(t.ctx));a&&"function"==typeof a.then&&a.then(a=>t.refresh({text:jb.ui.toVdomOrStr(a)},{srcCtx:e.componentContext}))}))}),jb.component("text.htmlTag",{type:"text.style",params:[{id:"htmlTag",as:"string",defaultValue:"p",options:"span,p,h1,h2,h3,h4,h5,div,li,article,aside,details,figcaption,figure,footer,header,main,mark,nav,section,summary,label"},{id:"cssClass",as:"string"}],impl:customStyle({template:(e,{text:t,htmlTag:a,cssClass:i},n)=>n(a,{class:i},t),features:text.bindText()})}),jb.component("text.noWrappingTag",{type:"text.style",category:"text:0",impl:customStyle({template:(e,{text:t},a)=>t,features:text.bindText()})}),jb.component("text.span",{type:"text.style",impl:customStyle({template:(e,{text:t},a)=>a("span",{},t),features:text.bindText()})}),jb.component("text.chip",{type:"text.style",impl:customStyle({template:(e,{text:t},a)=>a("div#jb-chip",{},a("span",{},t)),features:text.bindText()})}),[1,2,3,4,5,6].map(e=>jb.component(`header.h${e}`,{type:"text.style",impl:customStyle({template:(t,{text:a},i)=>i(`h${e}`,{},a),features:text.bindText()})})),[1,2,3,4,5,6].map(e=>jb.component(`header.mdcHeadline${e}`,{type:"text.style",impl:customStyle({template:(t,{text:a},i)=>i("h2",{class:`mdc-typography mdc-typography--headline${e}`},a),features:text.bindText()})})),[1,2].map(e=>jb.component(`header.mdcSubtitle${e}`,{type:"text.style",impl:customStyle({template:(t,{text:a},i)=>i("h2",{class:`mdc-typography mdc-typography--subtitle${e}`},a),features:text.bindText()})})),jb.component("header.mdcHeaderWithIcon",{type:"text.style",params:[{id:"level",options:"1,2,3,4,5,6",as:"string",defaultValue:"1"}],impl:customStyle({template:(e,{text:t,level:a},i)=>i(`h${a}`,{class:"mdc-tab__content"},[...jb.ui.chooseIconWithRaised(e.icon).map(i),i("span",{class:"mdc-tab__text-label"},t),...(e.icon||[]).filter(e=>e&&"post"==e.ctx.vars.$model.position).map(i).map(e=>e.addClass("mdc-tab__icon"))]),css:"{justify-content: initial}",features:text.bindText()})}),[1,2].map(e=>jb.component(`text.mdcBody${e}`,{type:"text.style",impl:customStyle({template:(t,{text:a},i)=>i("h2",{class:`mdc-typography mdc-typography--body${e}`},a),features:text.bindText()})})),jb.component("text.highlight",{type:"data",macroByValue:!0,params:[{id:"base",as:"string",dynamic:!0},{id:"highlight",as:"string",dynamic:!0},{id:"cssClass",as:"string",defaultValue:"mdl-color-text--deep-purple-A700"}],impl:(e,t,a,i)=>{const n=a(),r=t();if(!n||!r)return r;const o=(r.match(new RegExp(n,"i"))||[])[0];return o?jb.ui.h("div",{},[r.split(o)[0],jb.ui.h("span",{class:i},o),r.split(o).slice(1).join(o)]):r}}),jb.ns("group,layout,tabs"),jb.component("group",{type:"control",category:"group:100,common:90",params:[{id:"title",as:"string",dynamic:!0},{id:"layout",type:"layout"},{id:"style",type:"group.style",defaultValue:group.div(),mandatory:!0,dynamic:!0},{id:"controls",type:"control[]",mandatory:!0,flattenArray:!0,dynamic:!0,composite:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e,e.params.layout)}),jb.component("group.initGroup",{type:"feature",category:"group:0",impl:calcProp({id:"ctrls",value:"%$$model.controls%"})}),jb.component("inlineControls",{type:"control",description:"controls without a wrapping group",params:[{id:"controls",type:"control[]",mandatory:!0,flattenArray:!0,dynamic:!0,composite:!0}],impl:e=>e.params.controls().filter(e=>e)}),jb.component("dynamicControls",{type:"control",description:"calculated controls by data items without a wrapping group",params:[{id:"controlItems",type:"data",as:"array",mandatory:!0,dynamic:!0},{id:"genericControl",type:"control",mandatory:!0,dynamic:!0},{id:"itemVariable",as:"string",defaultValue:"controlItem"},{id:"indexVariable",as:"string"}],impl:(e,t,a,i,n)=>(t()||[]).map((t,r)=>jb.tosingle(a(e.setVar(i,t).setVar(n,r).setData(t))))}),jb.component("group.firstSucceeding",{type:"feature",category:"group:70",description:"Used with controlWithCondition. Takes the fhe first succeeding control",impl:features(()=>({calcHash:e=>jb.asArray(e.vars.$model.controls.profile).reduce((t,a,i)=>{if(t)return t;return null==a.condition||e.vars.$model.ctx.setVars(e.vars).runInner(a.condition,{as:"boolean"},`controls.${i}.condition`)?i+1:void 0},null)}),calcProp({id:"ctrls",value:e=>{const t=e.vars.$props.cmpHash-1;if(isNaN(t))return[];const a=jb.asArray(e.vars.$model.controls.profile)[t];return[e.vars.$model.ctx.setVars(e.vars).runInner(a,{type:"control"},`controls.${t}`)]},priority:5}))}),jb.component("controlWithCondition",{type:"control",description:"Used with group.firstSucceeding",category:"group:10",macroByValue:!0,params:[{id:"condition",type:"boolean",dynamic:!0,mandatory:!0,as:"boolean"},{id:"control",type:"control",mandatory:!0,dynamic:!0},{id:"title",as:"string"}],impl:(e,t,a)=>t(e)&&a(e)}),jb.component("group.wait",{type:"feature",category:"group:70",description:"wait for asynch data before showing the control",params:[{id:"for",mandatory:!0,dynamic:!0},{id:"loadingControl",type:"control",defaultValue:text("loading ..."),dynamic:!0},{id:"error",type:"control",defaultValue:text("error: %$error%"),dynamic:!0},{id:"varName",as:"string"}],impl:features(calcProp({id:"ctrls",value:(e,{cmp:t},{loadingControl:a,error:i})=>{const n=t.state.error?i():a(e);return"itemlist"==t.ctx.profile.$?[[n]]:[n]},priority:e=>jb.path(e.vars.$state,"dataArrived")?0:10}),interactive((e,{cmp:t},{varName:a})=>!t.state.dataArrived&&!t.state.error&&Promise.resolve(e.componentContext.params.for()).then(i=>t.refresh({dataArrived:!0},{srcCtx:e.componentContext,extendCtx:e=>e.setVar(a,i).setData(i)})).catch(e=>t.refresh({error:JSON.stringify(e)}))))}),jb.ns("html"),jb.component("html",{type:"control",description:"rich text",category:"control:100,common:80",params:[{id:"title",as:"string",mandatory:!0,templateValue:"html",dynamic:!0},{id:"html",as:"ref",mandatory:!0,templateValue:"<p>html here</p>",dynamic:!0},{id:"style",type:"html.style",defaultValue:html.plain(),dynamic:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e)}),jb.component("html.plain",{type:"html.style",impl:customStyle({template:(e,{html:t},a)=>a("div",{$html:t,jb_external:!0}),features:[watchAndCalcModelProp("html"),()=>({studioFeatures:{$:"feature.contentEditable",param:"html"}})]})}),jb.component("html.inIframe",{type:"html.style",params:[{id:"width",as:"string",defaultValue:"100%"},{id:"height",as:"string",defaultValue:"100%"}],impl:customStyle({template:(e,{width:t,height:a},i)=>i("iframe",{sandbox:"allow-same-origin allow-forms allow-scripts",frameborder:0,width:t,height:a,src:"javascript: document.write(parent.contentForIframe)"}),features:[interactiveProp("html","%$$model/html%"),interactive(({},{cmp:e})=>window.contentForIframe=e.html)]})}),jb.ns("image,css"),jb.component("image",{type:"control,image",category:"control:50,common:70",params:[{id:"url",as:"string",mandatory:!0,templateValue:"https://freesvg.org/img/UN-CONSTRUCTION-2.png"},{id:"width",as:"string",mandatory:!0,templateValue:"100",description:"e.g: 100, 20%"},{id:"height",as:"string",mandatory:!0,description:"e.g: 100, 20%"},{id:"resize",type:"image.resize",description:"background-size, resize the image",defaultValue:image.fullyVisible()},{id:"position",type:"image.position",description:"move/shift image"},{id:"style",type:"image.style",dynamic:!0,defaultValue:image.background()},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e,{studioFeatures:{$:"feature.contentEditable"}})}),jb.component("image.widthHeight",{type:"image.resize",description:"fixed size or precentage of the original",params:[{id:"width",as:"string",description:"e.g: 100, 20%"},{id:"height",as:"string",description:"e.g: 100, 20%"}],impl:(e,t,a)=>[jb.ui.withUnits(t)||"auto",jb.ui.withUnits(a)||"auto"].join(" ")}),jb.component("image.cover",{description:"auto resize or crop to cover all area",type:"image.resize",impl:"cover"}),jb.component("image.fullyVisible",{description:"contain, auto resize to ensure the image is fully visible",type:"image.resize",impl:"contain"}),jb.component("image.position",{description:"offset move shift original image",type:"image.position",params:[{id:"x",as:"string",description:"e.g. 7, 50%, right"},{id:"y",as:"string",description:"e.g. 10, 50%, bottom"}],impl:(e,t,a)=>[t&&`x: ${jb.ui.withUnits(t)}`,a&&`y: ${jb.ui.withUnits(a)}`].filter(e=>e).map(e=>`background-position-${e}`).join(";")}),jb.component("image.background",{type:"image.style",impl:customStyle({template:(e,t,a)=>a("div"),css:pipeline(Var("url",(e,{$model:t})=>t.url.replace(/__WIDTH__/,t.width).replace(/__HEIGHT__/,t.height)),Var("width",(e,{$model:t})=>jb.ui.withUnits(t.width)),Var("height",(e,{$model:t})=>jb.ui.withUnits(t.height)),"\n      {\n          background-image: url('%$url%');\n          {? background-size: %$$model/resize%; ?}\n          {? %$$model/position%; ?}\n          background-repeat: no-repeat;\n          {?width: %$width%; ?}\n          {?height: %$height%; ?}\n      }")})}),jb.component("image.img",{type:"image.style",impl:customStyle({template:({},{url:e},t)=>t("img",{src:e}),css:pipeline(Var("width",(e,{$model:t})=>jb.ui.withUnits(t.width)),Var("height",(e,{$model:t})=>jb.ui.withUnits(t.height)),"\n      { \n          {?width: %$width%; ?}\n          {?height: %$height%; ?}\n      }"),features:calcProp("url")})}),jb.ns("icon,control"),jb.component("control.icon",{type:"control",category:"control:50",params:[{id:"icon",as:"string",mandatory:!0},{id:"title",as:"string",dynamic:!0},{id:"type",as:"string",options:"mdi,mdc",defaultValue:"mdc"},{id:"size",as:"number",defaultValue:24},{id:"style",type:"icon.style",dynamic:!0,defaultValue:icon.material()},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e,features(calcProp("icon"),calcProp("type"),calcProp("title"),calcProp("size")))}),jb.component("icon",{type:"icon",params:[{id:"icon",as:"string",mandatory:!0},{id:"title",as:"string",dynamic:!0},{id:"type",as:"string",options:"mdi,mdc",defaultValue:"mdc"},{id:"style",type:"icon.style",dynamic:!0,defaultValue:icon.material()},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>e.params}),jb.component("icon.material",{type:"icon.style",impl:customStyle({template:(e,{icon:t,type:a,title:i,size:n},r)=>"mdc"==a?r("i",{class:"material-icons",title:i(),onclick:!0,style:{"font-size":`${n}px`,width:`${n}px`,height:`${n}px`}},t):r("div",{title:i(),onclick:!0,$html:`<svg width="24" height="24" transform="scale(${n/24})"><path d="${jb.path(jb.frame,["MDIcons",t])}"/></svg>`})})}),jb.component("feature.icon",{type:"feature",category:"control:50",params:[{id:"icon",as:"string",mandatory:!0},{id:"title",as:"string",dynamic:!0},{id:"position",as:"string",options:",pre,post,raised",defaultValue:""},{id:"type",as:"string",options:"mdi,mdc",defaultValue:"mdc"},{id:"size",as:"number",defaultValue:24},{id:"style",type:"icon.style",dynamic:!0,defaultValue:icon.material()},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>({icon:jb.ui.ctrl(e,features(calcProp("icon"),calcProp("type"),calcProp("title"),calcProp("size"),calcProp("iconPosition","%$$model/position%")))})}),jb.ns("button"),jb.component("button",{type:"control,clickable",category:"control:100,common:100",params:[{id:"title",as:"ref",mandatory:!0,templateValue:"click me",dynamic:!0},{id:"action",type:"action",mandatory:!0,dynamic:!0},{id:"style",type:"button.style",defaultValue:button.mdc(),dynamic:!0},{id:"raised",as:"boolean",dynamic:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e,e.run(features(watchAndCalcModelProp("title"),watchAndCalcModelProp("raised"),defHandler("onclickHandler",(e,{cmp:t,ev:a})=>{a&&a.ctrlKey&&t.ctrlAction?t.ctrlAction(t.ctx.setVar("event",a)):a&&a.altKey&&t.altAction?t.altAction(t.ctx.setVar("event",a)):t.action&&t.action(t.ctx.setVar("event",a))}),interactive(({},{cmp:t})=>t.action=jb.ui.wrapWithLauchingElement(e.params.action,t.ctx,t.base)),e=>({studioFeatures:{$:"feature.contentEditable",param:"title"}}))))}),jb.component("ctrlAction",{type:"feature",category:"button:70",description:"action to perform on control+click",params:[{id:"action",type:"action",mandatory:!0,dynamic:!0}],impl:interactive((e,{cmp:t},{action:a})=>t.ctrlAction=jb.ui.wrapWithLauchingElement(a,e,t.base))}),jb.component("altAction",{type:"feature",category:"button:70",description:"action to perform on alt+click",params:[{id:"action",type:"action",mandatory:!0,dynamic:!0}],impl:interactive((e,{cmp:t},{action:a})=>t.altAction=jb.ui.wrapWithLauchingElement(a,e,t.base))}),jb.component("buttonDisabled",{type:"feature",category:"button:70",description:"define condition when button is enabled",params:[{id:"enabledCondition",type:"boolean",mandatory:!0,dynamic:!0}],impl:interactive((e,{cmp:t},{enabledCondition:a})=>t.isEnabled=t=>a(e.extendVars(t)))}),function(){function e(e,t,a,i){jb.val(e.vars.$model.databind(t.ctx))!=a&&(jb.writeValue(e.vars.$model.databind(t.ctx),a,e),jb.ui.checkValidationError(t,a,e),t.onValueChange&&t.onValueChange(a),!i&&jb.ui.refreshElem(t.base,null,{srcCtx:e.componentContext}))}jb.ui.field_id_counter=jb.ui.field_id_counter||0,jb.component("field.databind",{type:"feature",category:"field:0",params:[{id:"debounceTime",as:"number",defaultValue:0},{id:"oneWay",as:"boolean"}],impl:features(If("%$oneWay%",calcProp("databind","%$$model/databind%"),watchAndCalcModelProp({prop:"databind",allowSelfRefresh:!0})),calcProp("title"),calcProp({id:"fieldId",value:()=>jb.ui.field_id_counter++}),defHandler("onblurHandler",(t,{cmp:a,ev:i},{oneWay:n})=>e(t,a,i.target.value,n)),defHandler("onchangeHandler",(t,{$model:a,cmp:i,ev:n},{oneWay:r})=>!a.updateOnBlur&&e(t,i,n.target.value,r)),defHandler("onkeyupHandler",(t,{$model:a,cmp:i,ev:n},{oneWay:r})=>!a.updateOnBlur&&e(t,i,n.target.value,r)),defHandler("onkeydownHandler",(t,{$model:a,cmp:i,ev:n},{oneWay:r})=>!a.updateOnBlur&&e(t,i,n.target.value,r)),interactiveProp("jbModel",(t,{cmp:a})=>i=>null==i?t.exp("%$$model/databind%","number"):e(t,a,i,!0)))}),jb.ui.checkValidationError=(e,t,a)=>{const i=function(){if(!e.validations)return;const a=e.ctx.setData(t),i=(e.validations||[]).filter(e=>!e.validCondition(a)).map(e=>e.errorMessage(a))[0];a.exp("formContainer")&&a.run(writeValue("%$formContainer/err%",i));return i}();e.state.error!=i&&(jb.log("field",["setErrState",e,i]),e.refresh({valid:!i,error:i},{srcCtx:a.componentContext}))},jb.ui.fieldTitle=function(e,t,a){let i=t.field&&t.field()||t;if((i="function"==typeof i?i():i).titleCtrl){const t=e.ctx.setData(i).setVars({input:e.ctx.data}),n=i.titleCtrl(t);return n&&a(n,{"jb-ctx":jb.ui.preserveCtx(t)})}return i.title(e.ctx)},jb.ui.preserveFieldCtxWithItem=(e,t)=>{const a=jb.ctxDictionary[e.ctxId];return a&&jb.ui.preserveCtx(a.setData(t))},jb.component("field.onChange",{category:"field:100",description:"on picklist selection, text or boolean value change",type:"feature",params:[{id:"action",type:"action",dynamic:!0}],impl:feature.onDataChange({ref:"%$$model/databind%",action:call("action")})}),jb.component("field.databindText",{type:"feature",category:"field:0",params:[{id:"debounceTime",as:"number",defaultValue:0},{id:"oneWay",type:"boolean",as:"boolean",defaultValue:!0}],impl:field.databind("%$debounceTime%","%$oneWay%")}),jb.component("field.keyboardShortcut",{type:"feature",category:"events",description:"listen to events at the document level even when the component is not active",params:[{id:"key",as:"string",description:"e.g. Alt+C"},{id:"action",type:"action",dynamic:!0}],impl:interactive((e,{cmp:t},{key:a,action:i})=>{const n=t.base.querySelector("input")||t.base;void 0===n.tabIndex&&(n.tabIndex=-1),jb.subscribe(jb.ui.fromEvent(t,"keydown",n),e=>{const t=a.split("+").slice(1).join("+"),n=t.charCodeAt(0);"Delete"==a&&(n=46);const r=(a.match("([A-Za-z]*)+")||["",""])[1];("Ctrl"!=r||e.ctrlKey)&&("Alt"!=r||e.altKey)&&(e.keyCode==n||e.key&&e.key==t)&&i()})})}),jb.component("field.toolbar",{type:"feature",params:[{id:"toolbar",type:"control",mandatory:!0,dynamic:!0}],impl:(e,t)=>({toolbar:t()})}),jb.component("validation",{type:"feature",category:"validation:100",params:[{id:"validCondition",mandatory:!0,as:"boolean",dynamic:!0,type:"boolean"},{id:"errorMessage",mandatory:!0,as:"string",dynamic:!0}],impl:interactive((e,{cmp:t},{validCondition:a,errorMessage:i})=>{if(t.validations=(t.validations||[]).concat([{validCondition:a,errorMessage:i}]),jb.ui.inPreview()){const n=e.setData(t.state.model);a(n),i(n)}})}),jb.component("field.title",{description:"used to set table title in button and label",type:"feature",category:"table:80",params:[{id:"title",as:"string",dynamic:!0,mandatory:!0}],impl:(e,t)=>({enrichField:e=>e.title=e=>t(e)})}),jb.component("field.titleCtrl",{description:"title as control, buttons are usefull",type:"feature",category:"table:80",params:[{id:"titleCtrl",type:"control",mandatory:!0,dynamic:!0,templateValue:button({title:"%title%",style:button.href()})}],impl:(e,t)=>({enrichField:e=>e.titleCtrl=e=>t(e)})}),jb.component("field.columnWidth",{description:"used in itemlist fields",type:"feature",category:"table:80",params:[{id:"width",as:"number",mandatory:!0}],impl:(e,t)=>({enrichField:e=>e.width=t})})}(),jb.ns("editableText"),jb.ns("dialog"),jb.component("editableText",{type:"control",category:"input:100,common:80",params:[{id:"title",as:"string",dynamic:!0},{id:"databind",as:"ref",mandaroy:!0,dynamic:!0},{id:"updateOnBlur",as:"boolean",type:"boolean"},{id:"style",type:"editable-text.style",defaultValue:editableText.mdcInput(),dynamic:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e)}),jb.component("editableText.xButton",{type:"feature",impl:features(defHandler("cleanValue",writeValue("%$$model/databind%","")),templateModifier(({},{vdom:e,databind:t})=>jb.ui.h("div",{},[e,...t?[jb.ui.h("button",{class:"delete",onclick:"cleanValue"},"×")]:[]])),css(">.delete {\n          margin-left: -16px;\n          float: right;\n          cursor: pointer; font: 20px sans-serif;\n          border: none; background: transparent; color: #000;\n          text-shadow: 0 1px 0 #fff; opacity: .1;\n      }\n      { display : flex }\n      >.delete:hover { opacity: .5 }"))}),jb.component("editableText.helperPopup",{type:"feature",params:[{id:"control",type:"control",dynamic:!0,mandatory:!0},{id:"popupId",as:"string",mandatory:!0},{id:"popupStyle",type:"dialog.style",dynamic:!0,defaultValue:dialog.popup()},{id:"showHelper",as:"boolean",dynamic:!0,defaultValue:notEmpty("%value%"),description:"show/hide helper according to input content",type:"boolean"},{id:"autoOpen",as:"boolean",type:"boolean"},{id:"onEnter",type:"action",dynamic:!0},{id:"onEsc",type:"action",dynamic:!0}],impl:e=>({onkeyup:!0,afterViewInit:t=>{const a=jb.ui.findIncludeSelf(t.base,"input")[0];if(!a)return;const{pipe:i,filter:n,subscribe:r,delay:o}=jb.callbag;t.openPopup=jb.ui.wrapWithLauchingElement(t=>t.run(openDialog({id:e.params.popupId,style:t=>e.params.popupStyle(t),content:t=>e.params.control(t),features:[dialogFeature.maxZIndexOnClick(),dialogFeature.uniqueDialog(e.params.popupId)]})),t.ctx,t.base),t.popup=t=>jb.ui.dialogs.dialogs.filter(t=>t.id==e.params.popupId)[0],t.closePopup=e=>t.popup()&&t.popup().close(),t.refreshSuggestionPopupOpenClose=i=>{const n=e.params.showHelper(t.ctx.setData(a));jb.log("helper-popup",["refreshSuggestionPopupOpenClose",n,a.value,t.ctx,t,e]),n?t.popup()||(jb.log("helper-popup",["open popup",n,a.value,t.ctx,t,e]),t.openPopup(t.ctx)):(jb.log("helper-popup",["close popup",n,a.value,t.ctx,t,e]),t.closePopup())},t.selectionKeySource=!0,t.input=a;const s=t.keyup=i(t.onkeyup,o(1));t.onkeydown=jb.ui.upDownEnterEscObs(t),i(t.onkeydown,n(e=>13==e.keyCode),r(i=>{const n=e.params.showHelper(t.ctx.setData(a));jb.log("helper-popup",["onEnter",n,a.value,t.ctx,t,e]),n||e.params.onEnter(t.ctx)})),jb.subscribe(s,a=>27==a.keyCode&&e.params.onEsc(t.ctx)),jb.subscribe(s,e=>-1==[13,27,37,38,40].indexOf(e.keyCode)&&t.refreshSuggestionPopupOpenClose()),jb.subscribe(s,e=>27==e.keyCode&&t.closePopup()),e.params.autoOpen&&t.refreshSuggestionPopupOpenClose()},destroy:e=>e.closePopup()})}),jb.ns("editableBoolean"),jb.component("editableBoolean",{type:"control",category:"input:20",params:[{id:"databind",as:"ref",type:"boolean",mandaroy:!0,dynamic:!0,aa:5},{id:"style",type:"editable-boolean.style",defaultValue:editableBoolean.checkbox(),dynamic:!0},{id:"title",as:"string",dynamic:!0},{id:"textForTrue",as:"string",defaultValue:"yes",dynamic:!0},{id:"textForFalse",as:"string",defaultValue:"no",dynamic:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e,features(calcProp("text",data.if("%$$model/databind%","%$$model/textForTrue%","%$$model/textForFalse%")),watchRef({ref:"%$$model/databind%",allowSelfRefresh:!0}),defHandler("toggle",e=>e.run(writeValue("%$$model/databind%",not("%$$model/databind%")))),defHandler("toggleByKey",(e,{ev:t})=>27!=t.keyCode&&e.run(writeValue("%$$model/databind%",not("%$$model/databind%")))),defHandler("setChecked",writeValue("%$$model/databind%","true"))))}),jb.ns("editableNumber"),jb.component("editableNumber",{type:"control",category:"input:30",params:[{id:"databind",as:"ref",mandaroy:!0,dynamic:!0},{id:"title",as:"string",dynamic:!0},{id:"style",type:"editable-number.style",defaultValue:editableText.mdcInput(),dynamic:!0},{id:"symbol",as:"string",description:"leave empty to parse symbol from value"},{id:"min",as:"number",defaultValue:0},{id:"max",as:"number",defaultValue:10},{id:"displayString",as:"string",dynamic:!0,defaultValue:"%$Value%%$Symbol%"},{id:"dataString",as:"string",dynamic:!0,defaultValue:"%$Value%%$Symbol%"},{id:"autoScale",as:"boolean",defaultValue:!0,description:"adjust its scale if at edges",type:"boolean"},{id:"step",as:"number",defaultValue:1,description:"used by slider"},{id:"initialPixelsPerUnit",as:"number",description:"used by slider"},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>{return jb.ui.ctrl(e.setVars({editableNumber:new class{constructor(e){Object.assign(this,e),null==this.min&&(this.min=NaN),null==this.max&&(this.max=NaN)}numericPart(e){if("number"==typeof e)return e;if(""==e)return NaN;var t=(""+e).match(/([^0-9\.\-]*)([0-9\.\-]+)([^0-9\.\-]*)/);return t&&(this.symbol=t[1]||t[3]),+(t&&t[2])}calcDisplayString(e,t){return isNaN(e)?this.placeholder||"":this.displayString(t.setVars({Value:""+e,Symbol:this.symbol}))}calcDataString(e,t){return isNaN(e)?"":this.dataString(t.setVars({Value:""+e,Symbol:this.symbol}))}}(e.params)}))}}),jb.component("openDialog",{type:"action",params:[{id:"id",as:"string"},{id:"style",type:"dialog.style",dynamic:!0,defaultValue:dialog.default()},{id:"content",type:"control",dynamic:!0,templateValue:group({})},{id:"menu",type:"control",dynamic:!0},{id:"title",as:"renderable",dynamic:!0},{id:"onOK",type:"action",dynamic:!0},{id:"modal",type:"boolean",as:"boolean"},{id:"features",type:"dialog-feature[]",dynamic:!0}],impl:function(e,t){const a={id:t,modal:e.params.modal,em:jb.callbag.subject()},i=e.setVars({$dialog:a,dialogData:{},formContainer:{err:""}});return a.content=()=>jb.ui.dialogs.buildComp(i).renderVdom(),e.probe||jb.ui.dialogs.addDialog(a,i),a}}),jb.component("dialog.closeContainingPopup",{description:"close parent dialog",type:"action",params:[{id:"OK",type:"boolean",as:"boolean",defaultValue:!0}],impl:(e,t)=>e.vars.$dialog&&e.vars.$dialog.close({OK:t})}),jb.component("dialogFeature.uniqueDialog",{description:"automatic close dialogs of the same id",type:"dialog-feature",params:[{id:"id",as:"string"},{id:"remeberLastLocation",type:"boolean",as:"boolean"}],impl:function(e,t,a){if(!t)return;const i=e.vars.$dialog;i.id=t,jb.subscribe(i.em,e=>"new-dialog"==e.type&&e.dialog!=i&&e.dialog.id==t&&i.close())}}),jb.component("dialogFeature.dragTitle",{type:"dialog-feature",params:[{id:"id",as:"string"},{id:"selector",as:"string",defaultValue:".dialog-title"}],impl:function(e,t,a){const i=e.vars.$dialog,{pipe:n,fromEvent:r,takeUntil:o,merge:s,Do:l,map:c,flatMap:d,distinctUntilChanged:p,fromPromise:m,forEach:u}=jb.callbag;return{css:`${a} { cursor: pointer }`,afterViewInit:function(e){const p=e.base.querySelector(a),b=m(e.destroyed);if(e.mousedownEm=n(r(p,"mousedown"),o(b)),t&&sessionStorage.getItem(t)){const e=JSON.parse(sessionStorage.getItem(t));i.el.style.top=e.top+"px",i.el.style.left=e.left+"px"}let f=n(r(document,"mouseup"),o(b)),y=n(r(document,"mousemove"),o(b));jb.studio.previewWindow&&(f=s(f,n(r(jb.studio.previewWindow.document,"mouseup")),o(b)),y=s(y,n(r(jb.studio.previewWindow.document,"mousemove")),o(b))),n(e.mousedownEm,l(e=>e.preventDefault()),c(e=>({left:e.clientX-i.el.getBoundingClientRect().left,top:e.clientY-i.el.getBoundingClientRect().top})),d(e=>n(y,o(f),c(t=>({top:Math.max(0,t.clientY-e.top),left:Math.max(0,t.clientX-e.left)})))),u(e=>{i.el.style.top=e.top+"px",i.el.style.left=e.left+"px",t&&sessionStorage.setItem(t,JSON.stringify(e))}))}}}}),jb.component("dialog.default",{type:"dialog.style",impl:customStyle({template:(e,{title:t,contentComp:a},i)=>i("div#jb-dialog jb-default-dialog",{},[i("div#dialog-title",{},t),i("button#dialog-close",{onclick:"dialogClose"},"×"),i(a)]),features:dialogFeature.dragTitle()})}),jb.component("dialogFeature.nearLauncherPosition",{type:"dialog-feature",params:[{id:"offsetLeft",as:"number",dynamic:!0,defaultValue:0},{id:"offsetTop",as:"number",dynamic:!0,defaultValue:0},{id:"rightSide",as:"boolean",type:"boolean"}],impl:function(e,t,a,i){return{afterViewInit:function(n){let r=t()||0,o=a()||0;const s=jb.ui.findIncludeSelf(n.base,".jb-dialog")[0];if(!e.vars.$launchingElement)return"undefined"==typeof event?console.log("no launcher for dialog"):(s.style.left=r+event.clientX+"px",void(s.style.top=o+event.clientY+"px"));const l=e.vars.$launchingElement.el,c=e.vars.$launchingElement.launcherHeightFix||jb.ui.outerHeight(l),d=jb.ui.offset(l),p=function(e,t,a,i){let n,r;const o=jb.ui.offset(e),s=jb.ui.outerHeight(t),l=jb.ui.outerWidth(t);o.top>s&&o.top+s+2+(i||0)>window.innerHeight+window.pageYOffset&&(n=o.top-s);o.left>l&&o.left+l+2+(a||0)>window.innerWidth+window.pageXOffset&&(r=o.left-l);if(n||r)return{top:n||o.top,left:r||o.left}}(l,s,r+=i?jb.ui.outerWidth(l):0,o);s.style.display="block",s.style.left=(p?p.left:d.left+r)+"px",s.style.top=(p?p.top:d.top+c+o)+"px"}}}}),jb.component("dialogFeature.onClose",{type:"dialog-feature",params:[{id:"action",type:"action",dynamic:!0}],impl:interactive((e,{$dialog:t},{action:a})=>{const{pipe:i,filter:n,subscribe:r,take:o}=jb.callbag;i(t.em,n(e=>"close"==e.type),o(1),r(t=>a(e.setData(t.OK))))})}),jb.component("dialogFeature.closeWhenClickingOutside",{type:"dialog-feature",params:[{id:"delay",as:"number",defaultValue:100}],impl:function(e,t){const a=e.vars.$dialog;a.isPopup=!0,jb.delay(10).then(()=>{const{pipe:e,fromEvent:i,takeUntil:n,subscribe:r,merge:o,filter:s,take:l,delay:c}=jb.callbag;let d=i(document,"mousedown");jb.studio.previewWindow&&(d=o(d,i((jb.studio.previewWindow||{}).document,"mousedown"))),e(d,s(e=>null==jb.ui.closest(e.target,".jb-dialog")),n(e(a.em,s(e=>"close"==e.type))),l(1),c(t),r(()=>a.close()))})}}),jb.component("dialog.closeDialog",{type:"action",params:[{id:"id",as:"string"},{id:"delay",as:"number",defaultValue:200}],impl:(e,t,a)=>jb.ui.dialogs.closeDialogs(jb.ui.dialogs.dialogs.filter(e=>e.id==t))}),jb.component("dialog.closeAll",{type:"action",impl:e=>jb.ui.dialogs.closeAll()}),jb.component("dialogFeature.autoFocusOnFirstInput",{type:"dialog-feature",params:[{id:"selectText",as:"boolean",type:"boolean"}],impl:(e,t)=>({afterViewInit:a=>{jb.delay(1).then(a=>{const i=e.vars.$dialog.el.querySelector("input,textarea,select");i&&jb.ui.focus(i,"dialog-feature.auto-focus-on-first-input",e),t&&i.select()})}})}),jb.component("dialogFeature.cssClassOnLaunchingElement",{type:"dialog-feature",impl:e=>({afterViewInit:t=>{if(!e.vars.$launchingElement)return;const{pipe:a,filter:i,subscribe:n,take:r}=jb.callbag,o=e.vars.$dialog,s=e.vars.$launchingElement.el;jb.ui.addClass(s,"dialog-open"),a(o.em,i(e=>"close"==e.type),r(1),n(()=>jb.ui.removeClass(s,"dialog-open")))}})}),jb.component("dialogFeature.maxZIndexOnClick",{type:"dialog-feature",params:[{id:"minZIndex",as:"number"}],impl:function(e,t){const a=e.vars.$dialog;return{afterViewInit:e=>{i(),a.el.onmousedown=i}};function i(){const e=jb.ui.dialogs.dialogs.reduce((e,t)=>Math.max(e,t.el&&parseInt(t.el.style.zIndex||100)+1||100),t||100);a.el.style.zIndex=e}}}),jb.component("dialog.dialogOkCancel",{type:"dialog.style",params:[{id:"okLabel",as:"string",defaultValue:"OK"},{id:"cancelLabel",as:"string",defaultValue:"Cancel"}],impl:customStyle({template:(e,{title:t,contentComp:a,cancelLabel:i,okLabel:n},r)=>r("div",{class:"jb-dialog jb-default-dialog"},[r("div",{class:"dialog-title"},t),r("button",{class:"dialog-close",onclick:"dialogClose"},"×"),r(a),r("div",{class:"dialog-buttons"},[r("button",{class:"mdc-button",onclick:"dialogClose"},i),r("button",{class:"mdc-button",onclick:"dialogCloseOK"},n)])]),css:">.dialog-buttons { display: flex; justify-content: flex-end; margin: 5px }"})}),jb.component("dialogFeature.resizer",{type:"dialog-feature",params:[{id:"resizeInnerCodemirror",as:"boolean",description:"effective only for dialog with a single codemirror element",type:"boolean"}],impl:(e,t)=>({templateModifier:(e,t,a)=>e&&"div"!=e.tag?e:(e.children.push(jb.ui.h("img",{class:"jb-resizer"})),e),css:">.jb-resizer { cursor: pointer; position: absolute; right: 1px; bottom: 1px }",afterViewInit:function(e){const a=e.base.querySelector(".jb-resizer"),{pipe:i,map:n,flatMap:r,takeUntil:o,merge:s,subscribe:l,Do:c}=jb.callbag;e.mousedownEm=jb.ui.fromEvent(e,"mousedown",a);let d,p,m=jb.ui.fromEvent(e,"mouseup",document),u=jb.ui.fromEvent(e,"mousemove",document);jb.studio.previewWindow&&(m=s(m,jb.ui.fromEvent(e,"mouseup",jb.studio.previewWindow.document)),u=s(u,jb.ui.fromEvent(e,"mousemove",jb.studio.previewWindow.document))),i(e.mousedownEm,c(a=>{t&&(d=e.base.querySelector(".CodeMirror,.jb-textarea-alternative-for-codemirror"))&&(p=d.getBoundingClientRect().top-e.base.getBoundingClientRect().top+(e.base.getBoundingClientRect().bottom-d.getBoundingClientRect().bottom))}),n(t=>({left:e.base.getBoundingClientRect().left,top:e.base.getBoundingClientRect().top})),r(e=>i(u,o(m),n(t=>({top:t.clientY-e.top,left:t.clientX-e.left})))),l(t=>{e.base.style.height=t.top+"px",e.base.style.width=t.left+"px",d&&(d.style.height=t.top-p+"px")}))}})}),jb.component("dialog.popup",{type:"dialog.style",impl:customStyle({template:(e,t,a)=>a("div#jb-dialog jb-popup",{},a(t.contentComp)),css:"{ position: absolute; background: white; box-shadow: 2px 2px 3px #d5d5d5; padding: 3px 0; border: 1px solid rgb(213, 213, 213) }",features:[dialogFeature.maxZIndexOnClick(),dialogFeature.closeWhenClickingOutside(),dialogFeature.cssClassOnLaunchingElement(),dialogFeature.nearLauncherPosition({})]})}),jb.component("dialog.transparent-popup",{type:"dialog.style",impl:customStyle({template:(e,t,a)=>a("div#jb-dialog jb-popup",{},a(t.contentComp)),css:"{ position: absolute; padding: 3px 0; }",features:[dialogFeature.maxZIndexOnClick(),dialogFeature.closeWhenClickingOutside(),dialogFeature.cssClassOnLaunchingElement(),dialogFeature.nearLauncherPosition({})]})}),jb.component("dialog.div",{type:"dialog.style",impl:customStyle({template:(e,t,a)=>a("div",{class:"jb-dialog jb-popup"},a(t.contentComp)),css:"{ position: absolute }"})}),jb.ui.dialogs={dialogs:[],buildComp(e){const t=e.vars.$dialog;return jb.ui.ctrl(e,features(calcProp("title",e=>e.vars.$model.title(e)),calcProp("contentComp","%$$model.content%"),calcProp("hasMenu","%$$model/menu/profile%"),calcProp("menuComp","%$$model/menu%"),feature.init(({},{cmp:e})=>e.dialog=t),interactive(({},{cmp:a})=>{t.cmp=a,a.dialog=t,t.onOK=t=>e.params.onOK(a.ctx.extendVars(t)),a.dialogCloseOK=()=>t.close({OK:!0}),a.dialogClose=e=>t.close(e),t.el=a.base,a.base.style.zIndex||(a.base.style.zIndex=100)})))},addDialog(e,t){const a=this;jb.log("addDialog",[e]),this.dialogs.push(e),e.modal&&!document.querySelector(".modal-overlay")&&jb.ui.addHTML(document.body,'<div class="modal-overlay"></div>'),jb.ui.render(jb.ui.h(this.buildComp(t)),this.dialogsTopElem(t)),this.dialogs.forEach(t=>t.em.next({type:"new-dialog",dialog:e})),e.close=function(i){if(jb.log("closeDialog",[e]),!(t.vars.formContainer.err&&i&&i.OK))return Promise.resolve().then(a=>{if(!e.closing)return e.closing=!0,e.onOK&&i&&i.OK?e.onOK(t):void 0}).then(n=>{e.em.next({type:"close",OK:i&&i.OK}),e.em.complete();const r=a.dialogs.indexOf(e);-1!=r&&a.dialogs.splice(r,1),e.modal&&document.querySelector(".modal-overlay")&&document.body.removeChild(document.querySelector(".modal-overlay")),jb.ui.unmount(e.el),e.el.parentElement===a.dialogsTopElem(t)&&a.dialogsTopElem(t).removeChild(e.el)})},e.closed=()=>-1==a.dialogs.indexOf(e)},closeDialogs:e=>e.slice(0).reduce((e,t)=>e.then(()=>t.close()),Promise.resolve()),closeAll(){return this.closeDialogs(this.dialogs)},closePopups:()=>jb.ui.dialogs.closeDialogs(jb.ui.dialogs.dialogs.filter(e=>e.isPopup)),dialogsTopElem(e){return this._dialogsTopElem||(this._dialogsTopElem=(e.vars.elemToTest||document.body).ownerDocument.createElement("div"),this._dialogsTopElem.className="jb-dialogs",(e.vars.elemToTest||document.body).appendChild(this._dialogsTopElem)),this._dialogsTopElem},reRenderAll(e){this._dialogsTopElem&&Array.from(this._dialogsTopElem.children).filter(e=>e).forEach(t=>jb.ui.refreshElem(t,null,{srcCtx:e}))}},jb.ns("itemlist,itemlistContainer"),jb.component("itemlist",{description:"list, dynamic group, collection, repeat",type:"control",category:"group:80,common:80",params:[{id:"title",as:"string"},{id:"items",as:"array",dynamic:!0,mandatory:!0},{id:"controls",type:"control[]",mandatory:!0,dynamic:!0},{id:"style",type:"itemlist.style",dynamic:!0,defaultValue:itemlist.ulLi()},{id:"layout",type:"layout"},{id:"itemVariable",as:"string",defaultValue:"item"},{id:"visualSizeLimit",as:"number",defaultValue:100,description:"by default itemlist is limmited to 100 shown items"},{id:"features",type:"feature[]",dynamic:!0,flattenArray:!0}],impl:e=>jb.ui.ctrl(e,e.params.layout)}),jb.component("itemlist.noContainer",{type:"feature",category:"group:20",impl:e=>({extendCtx:(e,t)=>e.setVars({itemlistCntr:null})})}),jb.component("itemlist.initContainerWithItems",{type:"feature",category:"itemlist:20",impl:calcProp({id:"updateItemlistCntr",value:action.if("%$itemlistCntr%",writeValue("%$itemlistCntr.items%","%$$props.items%")),phase:100})}),jb.component("itemlist.init",{type:"feature",impl:features(calcProp("items",(e,{cmp:t})=>jb.ui.itemlistCalcItems(e,t)),calcProp({id:"ctrls",value:e=>{return e.vars.$props.items.map(t=>Object.assign((t=>e.vars.$model.controls(e.setVar(e.vars.$model.itemVariable,t).setData(t)).filter(e=>e))(t),{item:t})).filter(e=>e.length>0)}}),itemlist.initContainerWithItems())}),jb.component("itemlist.initTable",{type:"feature",impl:features(calcProp("items",(e,{cmp:t})=>jb.ui.itemlistCalcItems(e,t)),calcProp({id:"fields",value:"%$$model/controls/field%"}),itemlist.initContainerWithItems())}),jb.component("itemlist.infiniteScroll",{type:"feature",params:[{id:"pageSize",as:"number",defaultValue:2}],impl:features(defHandler("onscrollHandler",(e,{ev:t,$state:a},{pageSize:i})=>{const n=t.target;if(!a.visualLimit||!t.scrollPercentFromTop||t.scrollPercentFromTop<.9)return;const r=e.vars.$model.items();if(!(a.visualLimit.shownItems&&a.visualLimit.shownItems<r.length))return;const o=jb.ui.ctxOfElem(n);if(!o)return;const s=r.slice(a.visualLimit.shownItems,a.visualLimit.shownItems+i),l=o.ctx({profile:Object.assign({},o.profile,{items:()=>s}),path:""}).runItself().renderVdom(),c=jb.ui.findIncludeSelf(l,"tbody")[0]||jb.ui.findIncludeSelf(l,".jb-itemlist")[0],d=jb.ui.findIncludeSelf(n,"tbody")[0]||jb.ui.findIncludeSelf(n,".jb-itemlist")[0];c&&(console.log(s,t),jb.ui.appendItems(d,c,e),a.visualLimit.shownItems+=s.length)}),templateModifier(({},{vdom:e})=>e.setAttribute("onscroll",!0)))}),jb.component("itemlist.fastFilter",{type:"feature",description:"use display:hide to filter itemlist elements",params:[{id:"showCondition",mandatory:!0,dynamic:!0,defaultValue:itemlistContainer.conditionFilter()},{id:"filtersRef",mandatory:!0,as:"ref",dynamic:!0,defaultValue:"%$itemlistCntrData/search_pattern%"}],impl:interactive((e,{cmp:t},{showCondition:a,filtersRef:i})=>jb.subscribe(jb.ui.refObservable(i(t.ctx),t,{srcCtx:e}),()=>Array.from(t.base.querySelectorAll(".jb-item,*>.jb-item,*>*>.jb-item")).forEach(e=>e.style.display=a(jb.ctxDictionary[e.getAttribute("jb-ctx")])?"block":"none")))}),jb.component("itemlist.ulLi",{type:"itemlist.style",impl:customStyle({template:(e,{ctrls:t},a)=>a("ul#jb-itemlist",{},t.map(e=>a("li#jb-item",{"jb-ctx":jb.ui.preserveCtx(e[0]&&e[0].ctx)},e.map(e=>a(e))))),css:"{ list-style: none; padding: 0; margin: 0;}\n    >li { list-style: none; padding: 0; margin: 0;}",features:itemlist.init()})}),jb.component("itemlist.div",{type:"itemlist.style",params:[{id:"spacing",as:"number",defaultValue:0}],impl:customStyle({template:(e,{ctrls:t},a)=>a("div#jb-itemlist jb-drag-parent",{},t.map(e=>a("div#jb-item",{"jb-ctx":jb.ui.preserveCtx(e[0]&&e[0].ctx)},e.map(e=>a(e))))),features:itemlist.init()})}),jb.component("itemlist.horizontal",{type:"itemlist.style",params:[{id:"spacing",as:"number",defaultValue:0}],impl:customStyle({template:(e,{ctrls:t},a)=>a("div#jb-itemlist jb-drag-parent",{},t.map(e=>a("div#jb-item",{"jb-ctx":jb.ui.preserveCtx(e[0]&&e[0].ctx)},e.map(e=>a(e))))),css:"{display: flex}\n        >* { margin-right: %$spacing%px }\n        >*:last-child { margin-right:0 }",features:itemlist.init()})}),jb.ui.itemlistInitCalcItems=e=>e.calcItems=e.calcItems||(()=>Array.from(e.base.querySelectorAll(".jb-item,*>.jb-item,*>*>.jb-item")).map(e=>(jb.ctxDictionary[e.getAttribute("jb-ctx")]||{}).data).filter(e=>e).map(e=>jb.val(e))),jb.ui.itemlistCalcItems=function(e,t){const a=function(e,t,a){t.length>a&&(e.state.visualLimit={totalItems:t.length,shownItems:a});return a<t.length?t.slice(0,a):t}(t,e.vars.$model.items(),e.vars.$model.visualSizeLimit);return jb.isRef(jb.asRef(a))?Object.keys(a).map(e=>jb.objectProperty(a,e)):a},jb.component("itemlist.selection",{type:"feature",params:[{id:"databind",as:"ref",defaultValue:"%$itemlistCntrData/selected%",dynamic:!0},{id:"selectedToDatabind",dynamic:!0,defaultValue:"%%"},{id:"databindToSelected",dynamic:!0,defaultValue:"%%"},{id:"onSelection",type:"action",dynamic:!0},{id:"onDoubleClick",type:"action",dynamic:!0},{id:"autoSelectFirst",type:"boolean"},{id:"cssForSelected",as:"string",description:"e.g. background: #bbb",defaultValue:"background: #bbb !important; color: #fff !important"}],impl:(e,t)=>({onclick:!0,ondblclick:!0,afterViewInit:a=>{const{pipe:i,map:n,filter:r,subscribe:o,merge:s,subject:l,distinctUntilChanged:c,catchError:d}=jb.callbag;a.selectionEmitter=l(),a.clickEmitter=i(s(a.onclick,a.ondblclick),n(e=>u(e.target)),r(e=>e)),i(a.ondblclick,n(e=>u(e.target)),r(e=>e),o(t=>e.params.onDoubleClick(a.ctx.setData(t)))),jb.ui.itemlistInitCalcItems(a),a.items=a.calcItems(),a.setSelected=e=>{a.state.selected=e,a.base&&(Array.from(a.base.querySelectorAll(".jb-item.selected,*>.jb-item.selected,*>*>.jb-item.selected")).forEach(e=>e.classList.remove("selected")),Array.from(a.base.querySelectorAll(".jb-item,*>.jb-item,*>*>.jb-item")).filter(t=>jb.val((jb.ctxDictionary[t.getAttribute("jb-ctx")]||{}).data)===jb.val(e)).forEach(e=>{e.classList.add("selected"),e.scrollIntoViewIfNeeded()}))},a.doRefresh=()=>a.setSelected(a.state.selected),i(s(a.selectionEmitter,a.clickEmitter),c(),r(e=>e),o(t=>{!function(t){p&&jb.writeValue(p,e.params.selectedToDatabind(e.setData(t)),e)}(t),a.setSelected(t),e.params.onSelection(a.ctx.setData(t))}));const p=t();function m(){return p&&jb.val(e.params.databindToSelected(e.setVars({items:a.calcItems()}).setData(jb.val(p))))}function u(e){const t=jb.ui.closest(e,".jb-item"),a=t&&t.getAttribute("jb-ctx");return(a&&jb.ctxDictionary[a]||{}).data}jb.isWatchable(p)&&i(jb.ui.refObservable(p,a,{throw:!0,srcCtx:e}),d(()=>a.setSelected(null)||[]),o(()=>a.setSelected(m()))),a.state.selected&&-1==a.items.indexOf(a.state.selected)&&(a.state.selected=null),m()&&a.setSelected(m()),a.state.selected||e.params.autoSelectFirst&&a.items[0]&&!jb.val(p)&&jb.delay(1).then(()=>a.selectionEmitter.next(a.items[0]))},css:[">.selected",">*>.selected",">*>*>.selected"].map(t=>t+" "+jb.ui.fixCssLine(e.params.cssForSelected)).join("\n")})}),jb.component("itemlist.keyboardSelection",{type:"feature",macroByValue:!1,params:[{id:"autoFocus",type:"boolean"},{id:"onEnter",type:"action",dynamic:!0}],impl:e=>({templateModifier:e=>{e.attributes=e.attributes||{},e.attributes.tabIndex=0},afterViewInit:t=>{const{pipe:a,map:i,filter:n,subscribe:r,merge:o}=jb.callbag,s=jb.ui.parentCmps(t.base).find(e=>e.selectionKeySource);let l=jb.path(t.ctx.vars,"itemlistCntr.keydown")||jb.path(s,"onkeydown");l?l=o(l,jb.ui.fromEvent(t,"keydown")):(l=jb.ui.fromEvent(t,"keydown"),e.params.autoFocus&&jb.ui.focus(t.base,"itemlist.keyboard-selection init autoFocus",e)),t.onkeydown=l,jb.ui.itemlistInitCalcItems(t),a(t.onkeydown,n(e=>13==e.keyCode&&t.state.selected),r(()=>e.params.onEnter(t.ctx.setData(t.state.selected)))),a(t.onkeydown,n(e=>!e.ctrlKey&&(38==e.keyCode||40==e.keyCode)),i(e=>{e.stopPropagation();const a=40==e.keyCode?1:-1;t.items=t.calcItems();const i=t.items.indexOf(t.state.selected)+a;return t.items[Math.min(t.items.length-1,Math.max(0,i))]}),r(e=>t.selectionEmitter&&t.selectionEmitter.next(e)))}})}),jb.component("itemlist.dragAndDrop",{type:"feature",impl:e=>({afterViewInit:function(t){if(!jb.frame.dragula)return jb.logError("itemlist.dragAndDrop - the dragula lib is not loaded");jb.ui.itemlistInitCalcItems(t),t.itemsAsRef=()=>jb.asRef(jb.path(jb.ctxDictionary,`${t.base.getAttribute("jb-ctx")}.params.items`)());const a=dragula([t.base.querySelector(".jb-drag-parent")||t.base],{moves:(e,t,a)=>jb.ui.parents(a,{includeSelf:!0}).some(e=>jb.ui.hasClass(e,"drag-handle"))});a.on("drag",(function(e,a){t.items=t.calcItems();let i=jb.val(e.getAttribute("jb-ctx")&&jb.ctxDictionary[e.getAttribute("jb-ctx")].data);if(!i){const t=e._component||e.firstElementChild&&e.firstElementChild._component;i=t&&t.ctx.data}e.dragged={item:i,remove:e=>t.items.splice(t.items.indexOf(e),1)},t.selectionEmitter&&t.selectionEmitter.next(e.dragged.item)})),a.on("drop",(a,i,n,r)=>{const o=t.items.indexOf(a.dragged.item),s=r?jb.ui.index(r):t.items.length;jb.move(jb.asRef(t.items[o]),jb.asRef(t.items[s-1]),e),a.dragged=null,t.doRefresh&&t.doRefresh()}),t.dragAndDropActive=!0,jb.delay(1).then(a=>{t.onkeydown&&jb.subscribe(t.onkeydown,a=>{if(a.ctrlKey&&(38==a.keyCode||40==a.keyCode)){t.items=t.calcItems();const i=40==a.keyCode?1:-1,n=t.items.indexOf(jb.val(t.state.selected));if(-1==n)return;const r=(n+i+t.items.length)%t.items.length;jb.move(jb.asRef(t.state.selected),jb.asRef(t.items[r]),e),t.items=t.calcItems(),t.selectionEmitter&&t.selectionEmitter.next(t.items[r])}})})}})}),jb.component("itemlist.dragHandle",{description:"put on the control inside the item which is used to drag the whole line",type:"feature",impl:list(css.class("drag-handle"),css("{cursor: pointer}"))}),jb.component("itemlist.shownOnlyOnItemHover",{type:"feature",category:"itemlist:75",description:"put on the control inside the item which is shown when the mouse enters the line",impl:(e,t,a)=>({class:"jb-shown-on-item-hover"})}),jb.component("itemlist.divider",{type:"feature",params:[{id:"space",as:"number",defaultValue:5}],impl:(e,t)=>({css:`>.jb-item:not(:first-of-type) { border-top: 1px solid rgba(0,0,0,0.12); padding-top: ${t}px }`})}),function(){const e=(e,t)=>({id:t.id,defaultItem:t.defaultItem,filter_data:{},filters:[],selectedRef:e.exp("%$itemlistCntrData/selected%","ref"),selected:function(t){if(jb.isValid(this.selectedRef))return void 0!==t?jb.writeValue(this.selectedRef,t,e):jb.val(this.selectedRef)},reSelectAfterFilter:function(e){-1==e.indexOf(this.selected())&&this.selected(e[0])},changeSelectionBeforeDelete:function(){if(this.items&&this.selected){const e=this.items.indexOf(this.selected);-1==e?this.selected=null:0==e&&this.items.length>0?this.selected=this.items[1]:this.items.length>0?this.selected=this.items[e-1]:this.selected=null}}});jb.component("group.itemlistContainer",{description:"itemlist writable container to support addition, deletion and selection",type:"feature",category:"itemlist:80,group:70",params:[{id:"id",as:"string",mandatory:!0},{id:"defaultItem",as:"single"},{id:"initialSelection",as:"single"}],impl:features(variable({name:"itemlistCntrData",value:{$:"object",search_pattern:"",selected:"%$initialSelection%"},watchable:!0}),variable({name:"itemlistCntr",value:t=>e(t,t.componentContext.params)}))}),jb.component("itemlist.itemlistSelected",{type:"feature",category:"itemlist:20,group:0",impl:list(group.data("%$itemlistCntrData/selected%"),hidden(notEmpty("%$itemlistCntrData/selected%")))}),jb.component("itemlistContainer.filter",{type:"aggregator",category:"itemlist-filter:100",requires:e=>e.vars.itemlistCntr,params:[{id:"updateCounters",as:"boolean"}],impl:(e,t)=>{if(!e.vars.itemlistCntr)return;const a=e.vars.itemlistCntr.filters.reduce((e,t)=>t(e),e.data||[]);return e.vars.itemlistCntrData.countAfterFilter!=a.length&&jb.delay(1).then(t=>e.vars.itemlistCntr.reSelectAfterFilter(a)),t?jb.delay(1).then(t=>{jb.writeValue(e.exp("%$itemlistCntrData/countBeforeFilter%","ref"),(e.data||[]).length,e),jb.writeValue(e.exp("%$itemlistCntrData/countBeforeMaxFilter%","ref"),resBeforeMaxFilter.length,e),jb.writeValue(e.exp("%$itemlistCntrData/countAfterFilter%","ref"),a.length,e)}):e.vars.itemlistCntrData.countAfterFilter=a.length,a}}),jb.component("itemlistContainer.conditionFilter",{type:"boolean",category:"itemlist-filter:100",requires:e=>e.vars.itemlistCntr,impl:e=>e.vars.itemlistCntr&&e.vars.itemlistCntr.filters.reduce((t,a)=>t&&a([e.data]).length,!0)}),jb.component("itemlistContainer.search",{type:"control",category:"itemlist-filter:100",requires:e=>e.vars.itemlistCntr,params:[{id:"title",as:"string",dynamic:!0,defaultValue:"Search"},{id:"searchIn",type:"search-in",dynamic:!0,defaultValue:itemlistContainer.searchInAllProperties()},{id:"databind",as:"ref",dynamic:!0,defaultValue:"%$itemlistCntrData/search_pattern%"},{id:"style",type:"editable-text.style",defaultValue:editableText.mdcSearch(),dynamic:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:(e,t,a,i)=>jb.ui.ctrl(e,{afterViewInit:t=>{if(!e.vars.itemlistCntr)return;const n=i();e.vars.itemlistCntr.filters.push(t=>{const i=jb.val(n)||"";if(jb.frame.Fuse){const e=a(),n=jb.path(e,"fuseOptions")&&e||{};return i?new jb.frame.Fuse(t,n).search(i).map(e=>e.item):t}return"function"==typeof a.profile?t.filter(e=>""==i||-1!=a.profile(e).toLowerCase().indexOf(i.toLowerCase())):t.filter(t=>""==i||-1!=a(e.setData(t)).toLowerCase().indexOf(i.toLowerCase()))}),e.vars.itemlistCntr.keydown=jb.ui.upDownEnterEscObs(t)}})}),jb.component("itemlistContainer.moreItemsButton",{type:"control",category:"itemlist-filter:100",requires:e=>e.vars.itemlistCntr,params:[{id:"title",as:"string",dynamic:!0,defaultValue:"show %$delta% more ... (%$itemlistCntrData/countAfterFilter%/%$itemlistCntrData/countBeforeMaxFilter%)"},{id:"delta",as:"number",defaultValue:200},{id:"style",type:"button.style",defaultValue:button.href(),dynamic:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:controlWithFeatures(e=>jb.ui.ctrl(e),[watchRef("%$itemlistCntrData/maxItems%"),defHandler("onclickHandler",writeValue("%$itemlistCntrData/maxItems%",(e,{itemlistCntrData:t},{delta:a})=>a+t.maxItems)),calcProp({id:"title",value:(e,{},{title:t,delta:a})=>t(e.setVar("delta",a))}),e=>({templateModifier:(e,t,a)=>t.ctx.exp("%$itemlistCntrData/countBeforeMaxFilter%","number")==t.ctx.exp("%$itemlistCntrData/countAfterFilter%","number")?"":e})])}),jb.ui.extractPropFromExpression=e=>{if(e.match(/^%.*%$/)&&!e.match(/[./[]/))return e.match(/^%(.*)%$/)[1]},jb.component("itemlistContainer.filterField",{type:"feature",category:"itemlist:80",requires:e=>e.vars.itemlistCntr,params:[{id:"fieldData",dynamic:!0,mandatory:!0},{id:"filterType",type:"filter-type"}],impl:(e,t,a)=>({afterViewInit:i=>{const n=jb.ui.extractPropFromExpression(e.params.fieldData.profile);i.itemToFilterData=n?e=>e[n]:a=>t(e.setData(a)),e.vars.itemlistCntr&&e.vars.itemlistCntr.filters.push(t=>{const n=jb.val(e.vars.$model.databind());if(!n)return t;const r=t.filter(e=>a.filter(n,i.itemToFilterData(e)));return!a.sort||i.state.sortOptions&&0!=i.state.sortOptions.length||a.sort(r,i.itemToFilterData,n),r})}})}),jb.component("filterType.text",{type:"filter-type",params:[{id:"ignoreCase",as:"boolean",defaultValue:!0,type:"boolean"}],impl:(e,t)=>t?{filter:(e,t)=>-1!=(t||"").toLowerCase().indexOf((e||"").toLowerCase()),sort:(e,t,a)=>{const i=new RegExp("\\b"+a+"\\b","i"),n=e=>(i.test(e)?5:0)+(0==e.toLowerCase().indexOf(a.toLowerCase())?3:0);e.sort((e,a)=>n(t(e)||"")-n(t(a)||""))}}:{filter:(e,t)=>-1!=(t||"").indexOf(e||""),sort:(e,t,a)=>{const i=new RegExp("\\b"+a+"\\b"),n=e=>(i.test(e)?5:0)+(0==e.indexOf(a)?3:0);e.sort((e,a)=>n(t(e)||"")-n(t(a)||""))}}}),jb.component("filterType.exactMatch",{type:"filter-type",impl:e=>({filter:(e,t)=>{const a=(e||"").trim(),i=(t||"").trim();return 0==i.indexOf(a)&&i.length==a.length}})}),jb.component("filterType.numeric",{type:"filter-type",impl:e=>({filter:(e,t)=>Number(t)>=Number(e),sort:(e,t)=>e.sort((e,a)=>Number(t(e))-Number(t(a)))})}),jb.component("itemlistContainer.searchInAllProperties",{type:"search-in",impl:e=>"string"==typeof e.data?e.data:"object"!=typeof e.data?"":jb.entries(e.data).map(e=>e[1]).filter(e=>"string"==typeof e).join("#")}),jb.component("itemlistContainer.fuseOptions",{type:"search-in",params:[{id:"keys",as:"array",defaultValue:list("prop1")},{id:"findAllMatches",as:"boolean",defaultValue:!1},{id:"isCaseSensitive",as:"boolean",defaultValue:!1},{id:"includeScore",as:"boolean",defaultValue:!1},{id:"includeMatches",as:"boolean",defaultValue:!1},{id:"minMatchCharLength",as:"number",defaultValue:1},{id:"shouldSort",as:"boolean",defaultValue:!0}],impl:e=>({fuseOptions:!0,...e.params})})}(),jb.ns("menuStyle,menuSeparator,mdc,icon"),jb.component("menu.menu",{type:"menu.option",params:[{id:"title",as:"string",dynamic:!0,mandatory:!0},{id:"options",type:"menu.option[]",dynamic:!0,flattenArray:!0,mandatory:!0,defaultValue:[]},{id:"icon",type:"icon"},{id:"optionsFilter",type:"data",dynamic:!0,defaultValue:"%%"}],impl:e=>({options:t=>e.params.optionsFilter(e.setData(e.params.options(t))),title:e.params.title(),icon:e.params.icon,applyShortcut:function(e){return this.options().reduce((t,a)=>t||a.applyShortcut&&a.applyShortcut(e),!1)},ctx:e})}),jb.component("menu.optionsGroup",{type:"menu.option",params:[{id:"options",type:"menu.option[]",dynamic:!0,flattenArray:!0,mandatory:!0}],impl:(e,t)=>t()}),jb.component("menu.dynamicOptions",{type:"menu.option",params:[{id:"items",type:"data",as:"array",mandatory:!0,dynamic:!0},{id:"genericOption",type:"menu.option",mandatory:!0,dynamic:!0}],impl:(e,t,a)=>t().map(t=>a(e.setData(t)))}),jb.component("menu.endWithSeparator",{type:"menu.option",params:[{id:"options",type:"menu.option[]",dynamic:!0,flattenArray:!0,mandatory:!0},{id:"separator",type:"menu.option",as:"array",defaultValue:menu.separator()},{id:"title",as:"string"}],impl:e=>{const t=e.params.options();return t.length>0?t.concat(e.params.separator):[]}}),jb.component("menu.separator",{type:"menu.option",impl:e=>({separator:!0})}),jb.component("menu.action",{type:"menu.option",params:[{id:"title",as:"string",dynamic:!0,mandatory:!0},{id:"action",type:"action",dynamic:!0,mandatory:!0},{id:"icon",type:"icon"},{id:"shortcut",as:"string"},{id:"showCondition",type:"boolean",as:"boolean",defaultValue:!0}],impl:e=>e.params.showCondition&&{leaf:e.params,action:t=>e.params.action(e.setVars({topMenu:null})),title:e.params.title(e),applyShortcut:t=>{if(jb.ui.checkKey(t,e.params.shortcut))return t.stopPropagation(),e.params.action(),!0},ctx:e}}),jb.component("menu.control",{type:"control,clickable,menu",params:[{id:"menu",type:"menu.option",dynamic:!0,mandatory:!0},{id:"style",type:"menu.style",defaultValue:menuStyle.contextMenu(),dynamic:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>{const t=e.params.menu()||{options:[],ctx:e,title:""};return jb.ui.ctrl(e.setVars({topMenu:e.vars.topMenu||{popups:[]},menuModel:t}),features(()=>({ctxForPick:t.ctx}),calcProp("title","%$menuModel.title%")))}}),jb.component("menu.openContextMenu",{type:"action",params:[{id:"menu",type:"menu.option",dynamic:!0,mandatory:!0},{id:"popupStyle",type:"dialog.style",dynamic:!0,defaultValue:dialog.contextMenuPopup()},{id:"menuStyle",type:"menu.style",dynamic:!0,defaultValue:menuStyle.contextMenu()},{id:"features",type:"dialog-feature[]",dynamic:!0},{id:"id",as:"string"}],impl:openDialog({id:"%$id%",style:call("popupStyle"),content:menu.control({menu:call("menu"),style:call("menuStyle")}),features:call("features")})}),jb.component("menuStyle.pulldown",{type:"menu.style",params:[{id:"innerMenuStyle",type:"menu.style",dynamic:!0,defaultValue:menuStyle.popupAsOption()},{id:"leafOptionStyle",type:"menu-option.style",dynamic:!0,defaultValue:menuStyle.optionLine()},{id:"layout",type:"group.style",dynamic:!0,defaultValue:itemlist.horizontal()}],impl:styleByControl(Var("optionsParentId",e=>e.id),Var("innerMenuStyle",e=>e.componentContext.params.innerMenuStyle),Var("leafOptionStyle",e=>e.componentContext.params.leafOptionStyle),itemlist({vars:[Var("optionsParentId",e=>e.id),Var("innerMenuStyle",e=>e.componentContext.params.innerMenuStyle),Var("leafOptionStyle",e=>e.componentContext.params.leafOptionStyle)],items:e=>e.vars.menuModel.options&&e.vars.menuModel.options().filter(e=>e)||[],controls:menu.control({menu:"%$item%",style:menuStyle.popupThumb()}),style:call("layout"),features:menu.selection()}))}),jb.component("menuStyle.contextMenu",{type:"menu.style",params:[{id:"leafOptionStyle",type:"menu-option.style",dynamic:!0,defaultValue:menuStyle.optionLine()}],impl:styleByControl(Var("optionsParentId",e=>e.id),Var("leafOptionStyle",e=>e.componentContext.params.leafOptionStyle),itemlist({vars:[Var("optionsParentId",e=>e.id),Var("leafOptionStyle",e=>e.componentContext.params.leafOptionStyle)],items:e=>e.vars.menuModel.options&&e.vars.menuModel.options().filter(e=>e)||[],controls:menu.control({menu:"%$item%",style:menuStyle.applyMultiLevel({})}),features:menu.selection(!0)}))}),jb.component("menu.initPopupMenu",{type:"feature",params:[{id:"popupStyle",type:"dialog.style",dynamic:!0,defaultValue:dialog.contextMenuPopup()}],impl:features(()=>({destroy:e=>e.closePopup()}),calcProp({id:"title",value:"%$menuModel.title%"}),interactive((e,{cmp:t})=>{t.mouseEnter=a=>{jb.ui.find(e,".context-menu-popup")[0]&&t.openPopup()},t.openPopup=jb.ui.wrapWithLauchingElement(a=>{t.ctx.vars.topMenu.popups.push(e.vars.menuModel),a.run(menu.openContextMenu({popupStyle:t=>e.componentContext.params.popupStyle(t),menu:t=>t.vars.innerMenu?e.vars.innerMenu.menu():e.vars.$model.menu()}))},t.ctx,t.base),t.closePopup=()=>jb.ui.dialogs.closeDialogs(jb.ui.dialogs.dialogs.filter(t=>t.id==e.vars.optionsParentId)).then(()=>t.ctx.vars.topMenu.popups.pop()),jb.delay(1).then(a=>{if(e.vars.topMenu&&e.vars.topMenu.keydown){const{pipe:a,takeUntil:i}=jb.callbag,n=a(e.vars.topMenu.keydown,i(t.destroyed));jb.subscribe(n,a=>39==a.keyCode&&e.vars.topMenu.selected==e.vars.menuModel&&t.openPopup&&t.openPopup()),jb.subscribe(n,a=>{37==a.keyCode&&t.ctx.vars.topMenu.popups.slice(-1)[0]==e.vars.menuModel&&(e.vars.topMenu.selected=e.vars.menuModel,t.closePopup())})}})}))}),jb.component("menu.initMenuOption",{type:"feature",impl:features(calcProp({id:"title",value:"%$menuModel.leaf.title%"}),calcProp({id:"icon",value:"%$menuModel.leaf.icon%"}),calcProp({id:"shortcut",value:"%$menuModel.leaf.shortcut%"}),interactive((e,{cmp:t})=>{const{pipe:a,filter:i,subscribe:n,takeUntil:r}=jb.callbag;t.action=jb.ui.wrapWithLauchingElement(()=>jb.ui.dialogs.closePopups().then(()=>e.vars.menuModel.action()),e,t.base),jb.delay(1).then(o=>{e.vars.topMenu&&e.vars.topMenu.keydown&&a(e.vars.topMenu.keydown,r(t.destroyed),i(t=>13==t.keyCode&&e.vars.topMenu.selected==e.vars.menuModel),n(e=>t.action()))})}))}),jb.component("menuStyle.applyMultiLevel",{type:"menu.style",params:[{id:"menuStyle",type:"menu.style",dynamic:!0,defaultValue:menuStyle.popupAsOption()},{id:"leafStyle",type:"menu.style",dynamic:!0,defaultValue:menuStyle.optionLine()},{id:"separatorStyle",type:"menu.style",dynamic:!0,defaultValue:menuSeparator.line()}],impl:e=>e.vars.menuModel.leaf?e.vars.leafOptionStyle?e.vars.leafOptionStyle(e):e.params.leafStyle():e.vars.menuModel.separator?e.params.separatorStyle():e.vars.innerMenuStyle?e.vars.innerMenuStyle(e):e.params.menuStyle()}),jb.component("menu.selection",{type:"feature",params:[{id:"autoSelectFirst",type:"boolean"}],impl:e=>({onkeydown:!0,onmousemove:!0,templateModifier:e=>{e.attributes=e.attributes||{},e.attributes.tabIndex=0},afterViewInit:t=>{e.vars.topMenu.keydown||(e.vars.topMenu.keydown=t.onkeydown,jb.ui.focus(t.base,"menu.keyboard init autoFocus",e)),t.items=Array.from(t.base.querySelectorAll(".jb-item,*>.jb-item,*>*>.jb-item")).map(e=>(jb.ctxDictionary[e.getAttribute("jb-ctx")]||{}).data);const{pipe:a,map:i,filter:n,subscribe:r,takeUntil:o}=jb.callbag,s=a(e.vars.topMenu.keydown,o(t.destroyed));a(t.onmousemove,i(e=>(function(e){const t=e.find(e=>e.classList&&e.classList.contains("jb-item")),a=t&&t.getAttribute("jb-ctx");return(a&&jb.ctxDictionary[a]||{}).data})(e.target.ownerDocument.elementsFromPoint(e.pageX,e.pageY))),n(t=>t&&t!=e.vars.topMenu.selected),r(e=>t.select(e))),a(s,n(e=>38==e.keyCode||40==e.keyCode),i(a=>{a.stopPropagation();const i=40==a.keyCode?1:-1,n=t.items.filter(e=>!e.separator),r=e.vars.topMenu.selected.separator?0:n.indexOf(e.vars.topMenu.selected);if(-1!=r)return n[(r+i+n.length)%n.length]}),n(e=>e),r(e=>t.select(e))),a(s,n(e=>27==e.keyCode),r(e=>jb.ui.dialogs.closePopups().then(()=>{t.ctx.vars.topMenu.popups=[],t.ctx.run({$:"tree.regain-focus"})}))),t.select=a=>{e.vars.topMenu.selected=a,t.base&&(Array.from(t.base.querySelectorAll(".jb-item.selected, *>.jb-item.selected")).forEach(e=>e.classList.remove("selected")),Array.from(t.base.querySelectorAll(".jb-item, *>.jb-item")).filter(e=>(jb.ctxDictionary[e.getAttribute("jb-ctx")]||{}).data===a).forEach(e=>e.classList.add("selected")))},t.state.selected=e.vars.topMenu.selected,e.params.autoSelectFirst&&t.items[0]&&t.select(t.items[0])},css:">.selected { background: #bbb !important; color: #fff !important }"})}),jb.component("menuStyle.optionLine",{type:"menu-option.style",impl:customStyle({template:(e,{icon:t,title:a,shortcut:i},n)=>n("div#line noselect",{onmousedown:"action"},[n(e.ctx.run({$:"control.icon",...t,size:20})),n("span#title",{},a),n("span#shortcut",{},i),n("div#mdc-line-ripple")]),css:"{ display: flex; cursor: pointer; font: 13px Arial; height: 24px}\n\t\t\t\t.selected { background: #d8d8d8 }\n\t\t\t\t>i { padding: 3px 8px 0 3px }\n\t\t\t\t>span { padding-top: 3px }\n\t\t\t\t>.title { display: block; text-align: left; white-space: nowrap; }\n\t\t\t\t>.shortcut { margin-left: auto; text-align: right; padding-right: 15px }",features:[menu.initMenuOption(),mdc.rippleEffect()]})}),jb.component("menuStyle.popupAsOption",{type:"menu.style",impl:customStyle({template:(e,t,a)=>a("div#line noselect",{onmousedown:"action"},[a("span#title",{},t.title),a("i#material-icons",{onmouseenter:"openPopup"},"play_arrow")]),css:"{ display: flex; cursor: pointer; font: 13px Arial; height: 24px}\n\t\t\t\t>i { width: 100%; text-align: right; font-size:16px; padding-right: 3px; padding-top: 3px; }\n\t\t\t\t\t\t>.title { display: block; text-align: left; padding-top: 3px; padding-left: 32px; white-space: nowrap; }\n\t\t\t",features:menu.initPopupMenu(dialog.contextMenuPopup(-24,!0))})}),jb.component("menuStyle.popupThumb",{type:"menu.style",description:"used for pulldown",impl:customStyle({template:(e,t,a)=>a("div",{class:"pulldown-top-menu-item",onmouseenter:"mouseEnter",onclick:"openPopup"},t.title),features:[menu.initPopupMenu(),mdc.rippleEffect()]})}),jb.component("dialog.contextMenuPopup",{type:"dialog.style",params:[{id:"offsetTop",as:"number"},{id:"rightSide",as:"boolean",type:"boolean"},{id:"toolbar",as:"boolean",type:"boolean"}],impl:customStyle({template:(e,{contentComp:t,toolbar:a},i)=>i("div#jb-dialog jb-popup context-menu-popup",{class:a?"toolbar-popup":"pulldown-mainmenu-popup"},i(t)),features:[dialogFeature.uniqueDialog("%$optionsParentId%",!1),dialogFeature.maxZIndexOnClick(),dialogFeature.closeWhenClickingOutside(),dialogFeature.cssClassOnLaunchingElement(),dialogFeature.nearLauncherPosition({offsetTop:"%$offsetTop%",rightSide:"%$rightSide%"})]})}),jb.component("menuSeparator.line",{type:"menu-separator.style",impl:customStyle({template:(e,t,a)=>a("div"),css:"{ margin: 6px 0; border-bottom: 1px solid #EBEBEB;}"})}),jb.component("menuStyle.toolbar",{type:"menu.style",params:[{id:"leafOptionStyle",type:"menu-option.style",dynamic:!0,defaultValue:menuStyle.icon()},{id:"itemlistStyle",type:"itemlist.style",dynamic:!0,defaultValue:itemlist.horizontal(5)}],impl:styleByControl(Var("optionsParentId",e=>e.id),Var("leafOptionStyle",e=>e.componentContext.params.leafOptionStyle),itemlist({vars:[Var("optionsParentId",e=>e.id),Var("leafOptionStyle",e=>e.componentContext.params.leafOptionStyle)],style:call("itemlistStyle"),items:e=>e.vars.menuModel.options&&e.vars.menuModel.options().filter(e=>e)||[],controls:menu.control({menu:"%$item%",style:menuStyle.applyMultiLevel({menuStyle:menuStyle.iconMenu(),leafStyle:menuStyle.icon()})})}))}),jb.component("menuStyle.icon",{type:"menu-option.style",params:[{id:"buttonSize",as:"number",defaultValue:20}],impl:styleWithFeatures(button.mdcIcon("%$menuModel/leaf/icon%","%$buttonSize%"),[htmlAttribute("onclick",!0),defHandler("onclickHandler",e=>e.vars.menuModel.action())])}),jb.component("menuStyle.iconMenu",{type:"menu.style",impl:styleByControl(button({title:"%title%",action:(e,{cmp:t})=>t.openPopup(),style:button.mdcIcon(icon({icon:"%icon/icon%",type:"%icon/type%",features:css("transform: translate(7px,0px) !important")}),16),features:[feature.icon({icon:"more_vert",type:"mdc",features:css("transform: translate(-3px,0px) !important")}),menu.initPopupMenu(dialog.contextMenuPopup({toolbar:!0,rightSide:!0}))]}),"innerMenu")}),jb.ns("picklist"),jb.component("picklist",{type:"control",description:"select, choose, pick, choice",category:"input:80",params:[{id:"title",as:"string",dynamic:!0},{id:"databind",as:"ref",mandaroy:!0,dynamic:!0},{id:"options",type:"picklist.options",dynamic:!0,mandatory:!0,templateValue:picklist.optionsByComma()},{id:"promote",type:"picklist.promote",dynamic:!0},{id:"style",type:"picklist.style",defaultValue:picklist.native(),dynamic:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e)}),jb.component("picklist.init",{type:"feature",impl:features(calcProp("options","%$$model/options%"),calcProp("hasEmptyOption",(e,{$props:t})=>t.options.filter(e=>!e.text)[0]))}),jb.component("picklist.initGroups",{type:"feature",impl:calcProp({id:"groups",phase:20,value:(e,{$model:t,$props:a})=>{const i=a.options,n={},r=(t.promote()||{}).groups||[],o=[];return i.filter(e=>e.text).forEach(e=>{const t=function(e){return e.group||-1!=e.text.indexOf(".")?e.group||e.text.split(".").shift():"---"}(e),a=n[t]||{options:[],text:t};n[t]||(o.push(a),n[t]=a),a.options.push({text:(e.text||"").split(".").pop(),code:e.code})}),o.sort((e,t)=>r.indexOf(t.text)-r.indexOf(e.text)),o}})}),jb.component("picklist.dynamicOptions",{type:"feature",params:[{id:"recalcEm",as:"single"}],impl:interactive((e,{cmp:t},{recalcEm:a})=>{const{pipe:i,takeUntil:n,subscribe:r}=jb.callbag;a&&i(a,n(t.destroyed),r(()=>t.refresh(null,{srcCtx:e.componentContext})))})}),jb.component("picklist.onChange",{category:"picklist:100",description:"on picklist selection",type:"feature",description:"action on picklist selection",params:[{id:"action",type:"action",dynamic:!0}],impl:interactive((e,{cmp:t},{action:a})=>t.onValueChange=t=>a(e.setData(t)))}),jb.component("picklist.optionsByComma",{type:"picklist.options",params:[{id:"options",as:"string",mandatory:!0},{id:"allowEmptyValue",type:"boolean"}],impl:(e,t,a)=>{return(a?[{code:"",value:""}]:[]).concat((t||"").split(",").map(e=>({code:e,text:e})))}}),jb.component("picklist.options",{type:"picklist.options",params:[{id:"options",type:"data",as:"array",dynamic:!0,mandatory:!0},{id:"code",as:"string",dynamic:!0,defaultValue:"%%"},{id:"text",as:"string",dynamic:!0,defaultValue:"%%"},{id:"icon",type:"icon",dynamic:!0},{id:"allowEmptyValue",type:"boolean"}],impl:(e,t,a,i,n,r)=>{return(r?[{code:"",value:""}]:[]).concat(t().map(t=>({code:a(e.setData(t)),text:i(e.setData(t)),icon:n(e.setData(t))})))}}),jb.component("picklist.sortedOptions",{type:"picklist.options",params:[{id:"options",type:"picklist.options",dynamic:!0,mandatory:!0,composite:!0},{id:"marks",as:"array",description:"e.g input:80,group:90. 0 mark means hidden. no mark means 50"}],impl:(e,t,a)=>{let i=t()||[];return a.forEach(e=>{const t=i.filter(t=>t.code==e.code)[0];t&&(t.mark=Number(e.mark||50))}),(i=i.filter(e=>0!=e.mark)).sort((e,t)=>(t.mark||50)-(e.mark||50)),i}}),jb.component("picklist.promote",{type:"picklist.promote",params:[{id:"groups",as:"array"},{id:"options",as:"array"}],impl:e=>e.params}),jb.ns("multiSelect"),jb.component("multiSelect",{type:"control",description:"select list of options, check multiple",category:"input:80",params:[{id:"title",as:"string",dynamic:!0},{id:"databind",as:"ref",mandaroy:!0,dynamic:!0},{id:"options",type:"picklist.options",dynamic:!0,mandatory:!0},{id:"promote",type:"picklist.promote",dynamic:!0},{id:"style",type:"multiSelect.style",defaultValue:picklist.native(),dynamic:!0},{id:"features",type:"feature[]",dynamic:!0}],impl:e=>jb.ui.ctrl(e)}),jb.component("multiSelect.modelAsBooleanRef",{params:[{id:"multiSelectModel"},{id:"code"}],impl:(e,t,a)=>{const i=t.databind();return{$jb_val:t=>void 0===t?n():!0===t?void(n()||jb.push(i,a,e)):function(){const t=jb.val(i).indexOf(a);-1!=t&&jb.splice(i,[[t,1]],e)}()};function n(){return-1!=jb.val(i).indexOf(a)}}}),jb.component("multiSelect.choiceList",{type:"multiSelect.style",params:[{id:"choiceStyle",type:"editable-boolean.style",dynamic:!0,defaultValue:editableBoolean.checkboxWithTitle()},{id:"itemlistStyle",type:"itemlist.style",dynamic:!0,defaultValue:itemlist.ulLi()}],impl:styleByControl(itemlist({items:"%$multiSelectModel/options%",controls:editableBoolean({textForTrue:"%text%",textForFalse:"%text%",databind:multiSelect.modelAsBooleanRef("%$multiSelectModel%","%code%"),style:call("choiceStyle")}),style:call("itemlistStyle"),features:watchRef({ref:"%$multiSelectModel/databind%",includeChildren:"yes"})}),"multiSelectModel")}),jb.component("multiSelect.chips",{type:"multiSelect.style",params:[{id:"chipStyle",type:"text.style",dynamic:!0,defaultValue:text.chip()},{id:"itemlistStyle",type:"itemlist.style",dynamic:!0,defaultValue:itemlist.horizontal()}],type:"multiSelect.style",impl:styleByControl(group({layout:layout.horizontal(),controls:[itemlist({items:"%$multiSelectModel/databind%",style:call("itemlistStyle"),controls:group({layout:layout.flex({wrap:"wrap",spacing:"4"}),controls:[text({text:"%% ",style:call("chipStyle"),features:itemlist.dragHandle()}),button({title:"delete",style:button.x(),action:removeFromArray("%$multiSelectModel/databind%","%%"),features:[css("color: black; z-index: 1000;margin-left: -25px"),itemlist.shownOnlyOnItemHover()]})]}),features:itemlist.dragAndDrop()}),picklist({options:pipeline("%$multiSelectModel/options%",filter(not(inGroup("%$multiSelectModel/databind%","%code%")))),features:[picklist.onChange(addToArray("%$multiSelectModel/databind%","%%")),picklist.plusIcon()]})],features:watchRef({ref:"%$multiSelectModel/databind%",includeChildren:"yes",allowSelfRefresh:!0,strongRefresh:!1})}),"multiSelectModel")}),jb.type("theme"),jb.component("group.theme",{type:"feature",params:[{id:"theme",type:"theme"}],impl:(e,t)=>({extendCtx:(e,a)=>e.setVars(t)})}),jb.component("theme.materialDesign",{type:"theme",impl:()=>({"$theme.editable-text":"editable-text.mdc-input"})}),jb.ns("slider,mdcStyle"),jb.component("editableNumber.sliderNoText",{type:"editable-number.style",impl:features(e=>({template:(e,{min:t,max:a,step:i,databind:n},r)=>r("input",{type:"range",min:t,max:a,step:i,value:e.ctx.vars.editableNumber.numericPart(n),mouseup:"onblurHandler",tabindex:-1})}),field.databind(),slider.checkAutoScale(),slider.initJbModelWithUnits(),slider.init())}),jb.component("editableNumber.slider",{type:"editable-number.style",impl:styleByControl(group({title:"%$editableNumberModel/title%",controls:group({layout:layout.horizontal(20),controls:[editableText({databind:"%$editableNumberModel/databind%",style:editableText.input(),features:[slider.handleArrowKeys(),css("width: 30px; padding-left: 3px; border: 0; border-bottom: 1px solid black;"),css.class("text-input")]}),editableNumber({databind:"%$editableNumberModel/databind%",style:editableNumber.sliderNoText(),max:"%$editableNumberModel/max%",min:"%$editableNumberModel/min%",step:"%$editableNumberModel/step%",features:[css.width(80),css.class("slider-input")]})],features:[variable({name:"sliderCtx",value:{$:"object"}}),watchRef("%$editableNumberModel/databind%")]})}),"editableNumberModel")}),jb.component("editableNumber.mdcSlider",{type:"editable-number.style",impl:styleByControl(group({title:"%$editableNumberModel/title%",controls:group({layout:layout.horizontal(20),controls:[editableText({databind:"%$editableNumberModel/databind%",style:editableText.input(),features:[slider.handleArrowKeys(),css("width: 40px; height: 20px; padding-top: 14px; padding-left: 3px; border: 0; border-bottom: 1px solid black; background: transparent;"),css.class("text-input")]}),editableNumber({databind:"%$editableNumberModel/databind%",max:"%$editableNumberModel/max%",min:"%$editableNumberModel/min%",step:"%$editableNumberModel/step%",style:editableNumber.mdcSliderNoText({})})],features:[variable({name:"sliderCtx",value:{$:"object"}}),watchRef("%$editableNumberModel/databind%")]})}),"editableNumberModel")}),jb.component("editableNumber.mdcSliderNoText",{type:"editable-number.style",params:[{id:"thumbSize",as:"number",defaultValue:21},{id:"cx",as:"number",defaultValue:10.5},{id:"cy",as:"number",defaultValue:10.5},{id:"r",as:"number",defaultValue:7.875}],impl:customStyle({template:(e,{title:t,min:a,max:i,step:n,databind:r,thumbSize:o,cx:s,cy:l,r:c},d)=>d("div#mdc-slider mdc-slider--discrete",{tabIndex:-1,role:"slider",max:i,step:n,"aria-valuemin":a,"aria-valuemax":i,"aria-valuenow":e.ctx.vars.editableNumber.numericPart(r),"aria-label":t()},[d("div#mdc-slider__track-container",{},d("div#mdc-slider__track")),d("div#mdc-slider__thumb-container",{},[d("div#mdc-slider__pin",{},d("span#mdc-slider__pin-value-marker")),d("svg#mdc-slider__thumb",{width:o,height:o},d("circle",{cx:s,cy:l,r:c})),d("div#mdc-slider__focus-ring")])]),features:[field.databind(),slider.initJbModelWithUnits(),slider.checkAutoScale(),interactiveProp("rebuild mdc on external refresh",(e,{cmp:t})=>{t.mdcSlider&&t.mdcSlider.destroy(),t.mdcSlider=new jb.ui.material.MDCSlider(t.base),t.mdcSlider.listen("MDCSlider:change",()=>!t.checkAutoScale(t.mdcSlider.value)&&t.jbModelWithUnits(t.mdcSlider.value))}),feature.destroy((e,{cmp:t})=>t.mdcSlider&&t.mdcSlider.destroy())]})}),jb.component("slider.initJbModelWithUnits",{type:"feature",impl:interactive((e,{cmp:t})=>{t.jbModelWithUnits=a=>{const i=e.vars.editableNumber.numericPart(jb.val(t.jbModel()));if(void 0===a)return i;t.jbModel(e.vars.editableNumber.calcDataString(+a,e))}})}),jb.component("slider.init",{type:"feature",impl:e=>({onkeydown:!0,onmouseup:!0,onmousedown:!0,onmousemove:!0,afterViewInit:t=>{const a=+t.base.step||1;t.handleArrowKey=i=>{const n=jb.tonumber(t.jbModelWithUnits());if(null!=n&&(46==i.keyCode&&jb.writeValue(e.vars.$model.databind(),null,e),-1!=[37,39].indexOf(i.keyCode))){var r=i.shiftKey?9*a:a;null!=n&&39==i.keyCode&&t.jbModelWithUnits(Math.min(+t.base.max,n+r)),null!=n&&37==i.keyCode&&t.jbModelWithUnits(Math.max(+t.base.min,n-r)),t.checkAutoScale(t.base.value)}};const{pipe:i,subscribe:n,flatMap:r,takeUntil:o}=jb.callbag;i(t.onkeydown,n(e=>t.handleArrowKey(e))),i(t.onmousedown,r(e=>i(t.onmousemove,o(t.onmouseup))),n(e=>!t.checkAutoScale(t.base.value)&&t.jbModelWithUnits(t.base.value))),e.vars.sliderCtx&&(e.vars.sliderCtx.handleArrowKey=e=>t.handleArrowKey(e))}})}),jb.component("slider.checkAutoScale",{type:"feature",impl:features(calcProp("min"),calcProp("step"),calcProp({id:"max",value:e=>{const t=e.vars.editableNumber.numericPart(jb.val(e.vars.$model.databind()));return t>+e.vars.$model.max&&e.vars.$model.autoScale?t+100:+e.vars.$model.max}}),interactive((e,{cmp:t})=>{t.checkAutoScale=a=>{if(!e.vars.$model.autoScale)return;const i=+(t.base.max||t.base.getAttribute("max")),n=+(t.base.step||t.base.getAttribute("step"));return a==i?(t.jbModelWithUnits(+a+n),t.refresh(null,{strongRefresh:!0},{srcCtx:e.componentContext}),!0):i>e.vars.$model.max&&a<e.vars.$model.max?(t.jbModelWithUnits(+a),t.refresh(null,{strongRefresh:!0},{srcCtx:e.componentContext}),!0):void 0}}))}),jb.component("slider.handleArrowKeys",{type:"feature",impl:features(htmlAttribute("onkeydown",!0),defHandler("onkeydownHandler",(e,{ev:t})=>e.vars.sliderCtx&&sliderCtx.handleArrowKey(t)))}),jb.ns("table"),jb.component("table",{type:"control,table",category:"group:80,common:70",params:[{id:"title",as:"string"},{id:"items",as:"array",dynamic:!0,mandatory:!0},{id:"fields",type:"table-field[]",mandatory:!0,dynamic:!0},{id:"style",type:"table.style",dynamic:!0,defaultValue:table.plain()},{id:"visualSizeLimit",as:"number",defaultValue:100,description:"by default table is limmited to 100 shown items"},{id:"features",type:"feature[]",dynamic:!0,flattenArray:!0}],impl:e=>jb.ui.ctrl(e)}),jb.component("field",{type:"table-field",params:[{id:"title",as:"string",mandatory:!0},{id:"data",as:"string",mandatory:!0,dynamic:!0},{id:"hoverTitle",as:"string",dynamic:!0},{id:"width",as:"number"},{id:"numeric",as:"boolean",type:"boolean"},{id:"extendItems",as:"boolean",type:"boolean",description:"extend the items with the calculated field using the title as field name"},{id:"class",as:"string"}],impl:(e,t,a,i,n,r,o,s)=>({title:()=>t,fieldData:i=>o?i[t]:a(e.setData(i)),calcFieldData:t=>a(e.setData(t)),hoverTitle:i.profile?t=>i(e.setData(t)):null,class:s,width:n,numeric:r,extendItems:o,ctxId:jb.ui.preserveCtx(e)})}),jb.component("field.index",{type:"table-field",params:[{id:"title",as:"string",defaultValue:"index"},{id:"width",as:"number",defaultValue:10},{id:"class",as:"string"}],impl:(e,t)=>({title:()=>t,fieldData:(e,t)=>t,class:_class,width:width,numeric:!0,ctxId:jb.ui.preserveCtx(e)})}),jb.component("field.control",{type:"table-field",params:[{id:"title",as:"string",mandatory:!0},{id:"control",type:"control",dynamic:!0,mandatory:!0,defaultValue:text("")},{id:"width",as:"number"},{id:"dataForSort",dynamic:!0},{id:"numeric",as:"boolean",type:"boolean"}],impl:(e,t,a,i,n,r)=>({title:()=>t,control:t=>a(e.setData(t)),width:i,fieldData:t=>n(e.setData(t)),numeric:r,ctxId:jb.ui.preserveCtx(e)})}),jb.component("button.tableCellHref",{type:"button.style",impl:customStyle({template:(e,t,a)=>a("a",{href:"javascript:;",onclick:!0},t.title),css:"{color: grey}"})}),jb.component("table.initTableOrItemlist",{type:"feature",impl:e=>e.run(e.vars.$model.fields?table.init():itemlist.initTable())}),jb.component("table.init",{type:"feature",category:"table:10",impl:features(calcProp({id:"fields",value:"%$$model.fields%"}),calcProp("items",(e,{cmp:t})=>jb.ui.itemlistCalcItems(e,t)),itemlist.initContainerWithItems())}),jb.component("table.initSort",{type:"feature",impl:e=>({afterViewInit:t=>{t.toggleSort=a=>{const i=t.renderProps.fields[a.currentTarget.getAttribute("fieldIndex")],n=t.renderProps.sortOptions||[];var r=n.filter(e=>e.field==i)[0];r||(n=[{field:i,dir:"none"}].concat(n).slice(0,2));var o=["none","asc","des"];(r=n.filter(e=>e.field==i)[0]).dir=o[(o.indexOf(r.dir)+1)%o.length],"none"==r.dir&&n.splice(n.indexOf(r),1),t.refresh({sortOptions:n},{srcCtx:e})},t.sortItems=()=>{if(t.items&&t.renderProps.sortOptions&&0!=t.renderProps.sortOptions.length){t.items.forEach((e,a)=>t.renderProps.sortOptions.forEach(t=>e["$jb_$sort_"+t.field.title]=t.field.fieldData(e,a)));var e=t.renderProps.sortOptions[0],a=t.renderProps.sortOptions[1];if(a){var i=o(e),n=o(a),r="$jb_$sort_"+e.field.title;t.items.sort((e,t)=>e[r]==t[r]?n(e,t):i(e,t))}else t.items.sort(o(e))}function o(e){var t="$jb_$sort_"+e.field.title;if(e.field.numeric)var a=(e,a)=>e[t]-a[t];else a=(e,a)=>e[t]==a[t]?0:e[t]<a[t]?-1:1;return"asc"==e.dir?a:(e,t)=>a(t,e)}}}})}),jb.component("gotoUrl",{type:"action",description:"navigate/open a new web page, change href location",params:[{id:"url",as:"string",mandatory:!0},{id:"target",type:"enum",values:["new tab","self"],defaultValue:"new tab",as:"string"}],impl:(e,t,a)=>{var i="new tab"==a?"_blank":"_self";e.probe||window.open(t,i)}}),jb.ns("mdc,mdc-style"),jb.component("mdcStyle.initDynamic",{type:"feature",params:[{id:"query",as:"string"}],impl:e=>({afterViewInit:e=>{if(!jb.ui.material)return jb.logError("please load mdc library");e.mdc_comps=e.mdc_comps||[];const t=jb.ui.findIncludeSelf(e.base,".mdc-text-field")[0];t?(e.mdc_comps.push(new jb.ui.material.MDCTextField(t)),e.onValueChange=t=>(e.mdc_comps||[]).forEach(e=>e.label_&&e.label_.float(!!t))):e.base.classList.contains("mdc-button")||e.base.classList.contains("mdc-fab")?e.mdc_comps.push(new jb.ui.material.MDCRipple(e.base)):e.base.classList.contains("mdc-switch")?e.mdc_comps.push(new jb.ui.material.MDCSwitch(e.base)):e.base.classList.contains("mdc-chip-set")?e.mdc_comps.push(new jb.ui.material.MDCChipSet(e.base)):e.base.classList.contains("mdc-tab-bar")?e.mdc_comps.push(new jb.ui.material.MDCTabBar(e.base)):e.base.classList.contains("mdc-slider")?e.mdc_comps.push(new jb.ui.material.MDCSlider(e.base)):e.base.classList.contains("mdc-select")&&e.mdc_comps.push(new jb.ui.material.MDCSelect(e.base))},destroy:e=>(e.mdc_comps||[]).forEach(e=>e.destroy())})}),jb.component("mdc.rippleEffect",{type:"feature",description:"add ripple effect",impl:e=>({templateModifier:e=>("mdc-ripple-surface mdc-ripple-radius-bounded mdc-states mdc-states-base-color(red)".split(" ").forEach(t=>e.addClass(t)),e)})}),jb.component("label.mdcRippleEffect",{type:"text.style",impl:customStyle({template:(e,t,a)=>a("button",{class:"mdc-button"},[a("div",{class:"mdc-button__ripple"}),a("span",{class:"mdc-button__label"},t.text)]),css:">span { text-transform: none; }",features:[text.bindText(),mdcStyle.initDynamic()]})}),jb.ui.chooseIconWithRaised=(e,t)=>{if(!e)return[];const a=e.filter(e=>e&&"raised"==e.ctx.vars.$model.position)[0],i=(a&&e.filter(e=>e&&"raised"!=e.ctx.vars.$model.position)||e).filter(e=>e&&"post"!=e.ctx.vars.$model.position);return t&&a?[a]:i},jb.component("button.href",{type:"button.style",impl:customStyle({template:(e,{title:t,raised:a},i)=>i("a",{class:a?"raised":"",href:"javascript:;",onclick:!0},t),css:"{color: grey} .raised { font-weight: bold }"})}),jb.component("button.x",{type:"button.style",params:[{id:"size",as:"number",defaultValue:"21"}],impl:customStyle({template:(e,t,a)=>a("button",{title:t.title,onclick:!0},"×"),css:"{\n            padding: 0;\n            cursor: pointer;\n            font: %$size%px sans-serif;\n            border: none;\n            background: transparent;\n            color: rgba(0,0,0,0.2);\n            text-shadow: 0 1px 0 #fff;\n            font-weight: 700;\n        }\n        :hover { color: rgba(0,0,0,0.5) }"})}),jb.component("button.native",{type:"button.style",impl:customStyle({template:(e,{title:t,raised:a},i)=>i("button",{class:a?"raised":"",title:t,onclick:!0},t),css:".raised {font-weight: bold}"})}),jb.component("button.mdc",{type:"button.style",params:[{id:"noRipple",as:"boolean"},{id:"noTitle",as:"boolean"}],impl:customStyle({template:(e,{title:t,raised:a,noRipple:i,noTitle:n},r)=>r("button",{class:["mdc-button",a&&"raised mdc-button--raised"].filter(e=>e).join(" "),onclick:!0},[!i&&r("div",{class:"mdc-button__ripple"}),...jb.ui.chooseIconWithRaised(e.icon,a).map(r).map(e=>e.addClass("mdc-button__icon")),!n&&r("span",{class:"mdc-button__label"},t),...(e.icon||[]).filter(e=>e&&"post"==e.ctx.vars.$model.position).map(r).map(e=>e.addClass("mdc-button__icon"))]),features:mdcStyle.initDynamic()})}),jb.component("button.mdcChipAction",{type:"button.style",impl:customStyle({template:(e,{title:t,raised:a},i)=>i("div#mdc-chip-set mdc-chip-set--filter",{onclick:!0},i("div#mdc-chip",{class:[a&&"mdc-chip--selected raised"].filter(e=>e).join(" ")},[i("div#mdc-chip__ripple"),...jb.ui.chooseIconWithRaised(e.icon,a).map(i).map(e=>e.addClass("mdc-chip__icon mdc-chip__icon--leading")),i("span",{role:"gridcell"},i("span",{role:"button",tabindex:-1,class:"mdc-chip__text"},t)),...(e.icon||[]).filter(e=>e&&"post"==e.ctx.vars.$model.position).map(i).map(e=>e.addClass("mdc-chip__icon mdc-chip__icon--trailing"))])),features:mdcStyle.initDynamic()})}),jb.component("button.plainIcon",{type:"button.style",impl:customStyle({template:(e,{title:t,raised:a},i)=>jb.ui.chooseIconWithRaised(e.icon,a).map(i).map(e=>e.setAttribute("title",e.getAttribute("title")||t))[0]})}),jb.component("button.mdcIcon",{type:"button.style,icon.style",params:[{id:"icon",type:"icon"},{id:"buttonSize",as:"number",defaultValue:40,description:"button size is larger than the icon size, usually at the rate of 40/24"}],impl:styleWithFeatures(button.mdcFloatingAction({withTitle:!1,buttonSize:"%$buttonSize%"}),features((e,{},{icon:t})=>t&&e.run({$:"feature.icon",...t,title:"%$model.title%",size:({},{},{buttonSize:e})=>24*e/40}),css("background-color: grey")))}),jb.component("button.mdcFloatingAction",{type:"button.style,icon.style",description:"fab icon",params:[{id:"buttonSize",as:"number",defaultValue:60,description:"mini is 40"},{id:"withTitle",as:"boolean"}],impl:customStyle({template:(e,{title:t,withTitle:a,raised:i},n)=>n("button",{class:["mdc-fab",i&&"raised mdc-icon-button--on"].filter(e=>e).join(" "),title:t,tabIndex:-1,onclick:!0},[n("div",{class:"mdc-fab__ripple"}),...jb.ui.chooseIconWithRaised(e.icon,i).filter(e=>e).map(n).map(e=>e.addClass("mdc-fab__icon").setAttribute("title",e.getAttribute("title")||t)),...[a&&n("span",{class:"mdc-fab__label"},t)].filter(e=>e)]),css:"{width: %$buttonSize%px; height: %$buttonSize%px;}",features:mdcStyle.initDynamic()})}),jb.component("button.mdcTab",{type:"button.style",impl:customStyle({template:(e,{title:t,raised:a},i)=>i("button",{class:["mdc-tab",a&&"mdc-tab--active"].filter(e=>e).join(" "),tabIndex:-1,role:"tab",onclick:!0},[i("span#mdc-tab__content",{},[...jb.ui.chooseIconWithRaised(e.icon,a).map(i).map(e=>e.addClass("mdc-tab__icon")),i("span#mdc-tab__text-label",{},t),...(e.icon||[]).filter(e=>e&&"post"==e.ctx.vars.$model.position).map(i).map(e=>e.addClass("mdc-tab__icon"))]),i("span",{class:["mdc-tab-indicator",a&&"mdc-tab-indicator--active"].filter(e=>e).join(" ")},i("span",{class:"mdc-tab-indicator__content mdc-tab-indicator__content--underline"})),i("span#mdc-tab__ripple")]),features:mdcStyle.initDynamic()})}),jb.component("button.mdcHeader",{type:"button.style",params:[{id:"stretch",as:"boolean"}],impl:styleWithFeatures(button.mdcTab(),css(pipeline(Var("contentWidth",If("%$stretch%","width: 100%;","")),"\n    {width: 100%; border-bottom: 1px solid black; margin-bottom: 7px; padding: 0}\n    ~ .mdc-tab__content { %$contentWidth% display: flex; align-content: space-between;}\n    ~ .mdc-tab__text-label { width: 100% }\n  ")))}),jb.ns("mdc,mdc-style"),jb.component("editableText.input",{type:"editable-text.style",impl:customStyle({template:(e,{databind:t},a)=>a("input",{value:t,onchange:!0,onkeyup:!0,onblur:!0}),features:field.databindText()})}),jb.component("editableText.textarea",{type:"editable-text.style",params:[{id:"rows",as:"number",defaultValue:4},{id:"cols",as:"number",defaultValue:120},{id:"oneWay",type:"boolean",as:"boolean",defaultValue:!0}],impl:customStyle({template:(e,{databind:t,rows:a,cols:i},n)=>n("textarea",{rows:a,cols:i,value:t,onchange:!0,onkeyup:!0,onblur:!0}),features:field.databindText(0,"%$oneWay%")})}),jb.component("editableText.mdcInput",{type:"editable-text.style,editable-number.style",params:[{id:"width",as:"number"},{id:"noLabel",as:"boolean"},{id:"noRipple",as:"boolean"}],impl:customStyle({template:(e,{databind:t,fieldId:a,title:i,noLabel:n,noRipple:r,error:o},s)=>s("div",{},[s("div",{class:["mdc-text-field",(e.icon||[]).filter(e=>e&&"pre"==e.ctx.vars.$model.position)[0]&&"mdc-text-field--with-leading-icon",(e.icon||[]).filter(e=>e&&"post"==e.ctx.vars.$model.position)[0]&&"mdc-text-field--with-trailing-icon"].filter(e=>e).join(" ")},[...(e.icon||[]).filter(e=>e&&"pre"==e.ctx.vars.$model.position).map(s).map(e=>e.addClass("mdc-text-field__icon mdc-text-field__icon--leading")),s("input",{type:"text",class:"mdc-text-field__input",id:"input_"+a,value:t,onchange:!0,onkeyup:!0,onblur:!0}),...(e.icon||[]).filter(e=>e&&"post"==e.ctx.vars.$model.position).map(s).map(e=>e.addClass("mdc-text-field__icon mdc-text-field__icon--trailing")),...[!n&&s("label",{class:"mdc-floating-label",for:"input_"+a},i())].filter(e=>e),...[!r&&s("div",{class:"mdc-line-ripple"})].filter(e=>e)]),s("div",{class:"mdc-text-field-helper-line"},o||"")]),css:"{ {?width: %$width%px?} } ~ .mdc-text-field-helper-line { color: red }",features:[field.databindText(),mdcStyle.initDynamic()]})}),jb.component("editableText.mdcNoLabel",{type:"editable-text.style",params:[{id:"width",as:"number"}],impl:editableText.mdcInput({width:"%$width%",noLabel:!0})}),jb.component("editableText.mdcSearch",{description:"debounced and one way binding",type:"editable-text.style",impl:styleWithFeatures(editableText.mdcInput({width:"%$width%",noLabel:!0}),feature.icon({icon:"search",position:"post"}))}),jb.component("editableText.expandable",{description:"label that changes to editable class on double click",type:"editable-text.style",params:[{id:"buttonFeatures",type:"feature[]",flattenArray:!0,dynamic:!0},{id:"editableFeatures",type:"feature[]",flattenArray:!0,dynamic:!0},{id:"buttonStyle",type:"button.style",dynamic:!0,defaultValue:button.href()},{id:"editableStyle",type:"editable-text.style",dynamic:!0,defaultValue:editableText.input()},{id:"onToggle",type:"action",dynamic:!0}],impl:styleByControl(group({controls:[editableText({databind:"%$editableTextModel/databind%",updateOnBlur:!0,style:call("editableStyle"),features:[watchRef("%$editable%"),hidden("%$editable%"),(e,{expandableContext:t})=>({afterViewInit:a=>{const i=a.base.matches("input,textarea")?a.base:a.base.querySelector("input,textarea");i&&(i.onblur=()=>a.ctx.run(runActions(toggleBooleanValue("%$editable%"),(e,t,{onToggle:a})=>a(e)))),t.regainFocus=()=>jb.delay(1).then(()=>jb.ui.focus(i,"editable-text.expandable",e))}}),(e,t,{editableFeatures:a})=>a(e)]}),button({title:"%$editableTextModel/databind%",action:runActions(toggleBooleanValue("%$editable%"),(e,{expandableContext:t})=>t.regainFocus(),(e,t,{onToggle:a})=>a(e)),style:call("buttonStyle"),features:[watchRef("%$editable%"),hidden(not("%$editable%")),(e,t,{buttonFeatures:a})=>a(e)]})],features:[variable({name:"editable",watchable:!0}),variable({name:"expandableContext",value:obj()})]}),"editableTextModel")}),jb.component("layout.vertical",{type:"layout,feature",params:[{id:"spacing",as:"string",defaultValue:3}],impl:css(({},{},{spacing:e})=>`{display: flex; flex-direction: column}\n          >* { ${jb.ui.propWithUnits("margin-bottom",e)} }\n          >*:last-child { margin-bottom:0 }`)}),jb.component("layout.horizontal",{type:"layout,feature",params:[{id:"spacing",as:"string",defaultValue:3}],impl:css(({},{},{spacing:e})=>`{display: flex}\n        >* { ${jb.ui.propWithUnits("margin-right",e)} }\n        >*:last-child { margin-right:0 }`)}),jb.component("layout.horizontalFixedSplit",{type:"layout,feature",params:[{id:"leftWidth",as:"string",defaultValue:"200px",mandatory:!0},{id:"rightWidth",as:"string",defaultValue:"100%",mandatory:!0},{id:"spacing",as:"string",defaultValue:3}],impl:e=>({css:`{display: flex}\n        >*:first-child { ${jb.ui.propWithUnits("margin-right",e.params.spacing)}\n        ${jb.ui.propWithUnits("width",e.params.leftWidth)} }\n        >*:last-child { margin-right:0; ${jb.ui.propWithUnits("width",e.params.rightWidth)} }`})}),jb.component("layout.horizontalWrapped",{type:"layout,feature",params:[{id:"spacing",as:"string",defaultValue:3}],impl:e=>({css:`{display: flex}\n        >* {${jb.ui.propWithUnits("margin-right",e.params.spacing)} }\n        >*:last-child { margin-right:0 }`})}),jb.component("layout.flex",{type:"layout,feature",params:[{id:"direction",as:"string",options:",row,row-reverse,column,column-reverse"},{id:"justifyContent",as:"string",options:",flex-start,flex-end,center,space-between,space-around"},{id:"alignItems",as:"string",options:",normal,stretch,center,start,end,flex-start,flex-end,baseline,first baseline,last baseline,safe center,unsafe center"},{id:"wrap",as:"string",options:",wrap,wrap-reverse,nowrap"},{id:"spacing",as:"string"}],impl:e=>({css:e.setVars({spacingWithUnits:jb.ui.withUnits(e.params.spacing),...e.params}).exp(`{ display: flex; {?align-items:%$alignItems%;?} {?justify-content:%$justifyContent%;?} {?flex-direction:%$direction%;?} {?flex-wrap:%$wrap%;?} }\n      {?>* { margin-right: %$spacingWithUnits% }?}\n    ${e.params.spacing?">*:last-child { margin-right:0 }":""}`)})}),jb.component("layout.grid",{type:"layout,feature",params:[{id:"columnSizes",as:"array",templateValue:list("auto","auto"),description:"grid-template-columns, list of lengths"},{id:"rowSizes",as:"array",description:"grid-template-rows, list of lengths"},{id:"columnGap",as:"string",description:"grid-column-gap"},{id:"rowGap",as:"string",description:"grid-row-gap"}],impl:e=>({css:e.setVars({...e.params,colSizes:e.params.columnSizes.map(e=>jb.ui.withUnits(e)).join(" "),rowSizes:e.params.rowSizes.map(e=>jb.ui.withUnits(e)).join(" ")}).exp("{ display: grid; {?grid-template-columns:%$colSizes%;?} {?grid-template-rows:%$rowSizes%;?}\n            {?grid-column-gap:%$columnGap%;?} {?grid-row-gap:%$rowGap%;?} }")})}),jb.component("flexItem.grow",{type:"feature",category:"flex-item",params:[{id:"factor",as:"string",defaultValue:"1"}],impl:{$:"feature.css",$byValue:["flex-grow: %$factor%"]}}),jb.component("flexItem.basis",{type:"feature",category:"flex-item",params:[{id:"factor",as:"string",defaultValue:"1"}],impl:{$:"feature.css",$byValue:["flex-basis: %$factor%"]}}),jb.component("flexItem.alignSelf",{type:"feature",category:"flex-item",params:[{id:"align",as:"string",options:"auto,flex-start,flex-end,center,baseline,stretch",defaultValue:"auto"}],impl:{$:"feature.css",$byValue:["align-self: %$align%"]}}),jb.ns("css"),jb.component("group.htmlTag",{type:"group.style",params:[{id:"htmlTag",as:"string",defaultValue:"section",options:"div,ul,article,aside,details,figcaption,figure,footer,header,main,mark,nav,section,summary,label,form"},{id:"groupClass",as:"string"},{id:"itemClass",as:"string"}],impl:customStyle({template:(e,{htmlTag:t,groupClass:a,itemClass:i,ctrls:n},r)=>r(t,{class:a},n.map(e=>r(e,{class:i}))),features:group.initGroup()})}),jb.component("group.div",{type:"group.style",impl:group.htmlTag("div")}),jb.component("group.section",{type:"group.style",impl:group.htmlTag("section")}),jb.component("group.ulLi",{type:"group.style",impl:customStyle({template:(e,{ctrls:t},a)=>a("ul#jb-itemlist",{},t.map(e=>a("li",{class:"jb-item"},a(e)))),css:"{ list-style: none; padding: 0; margin: 0;}\n    >li { list-style: none; padding: 0; margin: 0;}",features:group.initGroup()})}),jb.component("group.card",{type:"feature",category:"card:100",params:[{id:"padding",as:"string",defaultValue:10},{id:"width",as:"string",defaultValue:320},{id:"outlined",as:"boolean",type:"boolean"}],impl:features(css.class(({},{},{outlined:e})=>["mdc-card",...e?["mdc-card--outlined"]:[]].join(" ")),css(({},{},{padding:e,width:t})=>[jb.ui.propWithUnits("padding",e),jb.ui.propWithUnits("width",t)].filter(e=>e).join(";")))}),jb.component("group.chipSet",{type:"feature",category:"chip:100",params:[{id:"spacing",as:"string",defaultValue:3}],impl:features(css.class("mdc-chip-set"),mdcStyle.initDynamic())}),jb.component("group.tabs",{type:"group.style",params:[{id:"tabStyle",type:"button.style",dynamic:!0,defaultValue:button.mdcTab()},{id:"barStyle",type:"group.style",dynamic:!0,defaultValue:group.mdcTabBar()},{id:"innerGroupStyle",type:"group.style",dynamic:!0,defaultValue:group.div()}],impl:styleByControl(group({controls:[group({style:call("barStyle"),controls:dynamicControls({controlItems:"%$tabsModel/controls%",genericControl:button({title:"%$tab/field/title%",action:writeValue("%$selectedTab%","%$tabIndex%"),style:call("tabStyle"),raised:"%$tabIndex% == %$selectedTab%",features:[e=>"group.mdcTabBar"!==e.componentContext.params.barStyle.profile.$&&watchRef("%$selectedTab%"),e=>e.run(features((e.vars.tab.icon||[]).map(e=>e.ctx.profile).filter(e=>e)))]}),itemVariable:"tab",indexVariable:"tabIndex"})}),group({style:call("innerGroupStyle"),controls:"%$tabsModel/controls[{%$selectedTab%}]%",features:watchRef("%$selectedTab%")})],features:variable({name:"selectedTab",value:0,watchable:!0})}),"tabsModel")}),jb.component("group.mdcTabBar",{type:"group.style",impl:customStyle({template:(e,{ctrls:t},a)=>a("div",{class:"mdc-tab-bar",role:"tablist"},a("div",{class:"mdc-tab-scroller"},a("div",{class:"mdc-tab-scroller__scroll-area mdc-tab-scroller__scroll-area--scroll"},a("div",{class:"mdc-tab-scroller__scroll-content"},t.map(e=>a(e)))))),features:[group.initGroup(),mdcStyle.initDynamic()]})}),jb.component("group.accordion",{type:"group.style",params:[{id:"titleStyle",type:"button.style",dynamic:!0,defaultValue:button.mdcHeader(!0)},{id:"sectionStyle",type:"group.style",dynamic:!0,defaultValue:group.section()},{id:"innerGroupStyle",type:"group.style",dynamic:!0,defaultValue:group.div()}],impl:styleByControl(group({controls:dynamicControls({controlItems:"%$sectionsModel/controls%",genericControl:group({style:call("sectionStyle"),controls:[button({title:"%$section/field/title%",action:writeValue("%$selectedTab%","%$sectionIndex%"),style:call("titleStyle"),raised:"%$sectionIndex% == %$selectedTab%",features:[css.width("%$width%"),css("{justify-content: left}"),watchRef("%$selectedTab%"),e=>e.run(features((e.vars.section.icon||[]).map(e=>e.ctx.profile).filter(e=>e)))]}),group({style:call("innerGroupStyle"),controls:"%$sectionsModel/controls[{%$sectionIndex%}]%",features:[feature.if("%$sectionIndex% == %$selectedTab%"),watchRef("%$selectedTab%")]})]}),itemVariable:"section",indexVariable:"sectionIndex"}),features:variable({name:"selectedTab",value:0,watchable:!0})}),"sectionsModel")}),jb.component("group.sections",{type:"group.style",params:[{id:"titleStyle",type:"text.style",dynamic:!0,defaultValue:header.mdcHeaderWithIcon()},{id:"sectionStyle",type:"group.style",dynamic:!0,defaultValue:group.div()},{id:"innerGroupStyle",type:"group.style",dynamic:!0,defaultValue:group.div()}],impl:styleByControl(group({controls:dynamicControls({controlItems:"%$sectionsModel/controls%",genericControl:group({style:call("sectionStyle"),controls:[text({text:"%$section/field/title%",style:call("titleStyle"),features:e=>e.run(features((e.vars.section.icon||[]).map(e=>e.ctx.profile).filter(e=>e)))}),group({style:call("innerGroupStyle"),controls:"%$section%"})]}),itemVariable:"section"})}),"sectionsModel")}),jb.ns("mdc.style"),jb.component("table.plain",{params:[{id:"hideHeaders",as:"boolean",type:"boolean"}],type:"table.style,itemlist.style",impl:customStyle({template:(e,{items:t,fields:a,hideHeaders:i},n)=>n("div#jb-itemlist",{},n("table",{},[...i?[]:[n("thead",{},n("tr",{},a.map(t=>n("th",{"jb-ctx":t.ctxId,style:{width:t.width?t.width+"px":""}},jb.ui.fieldTitle(e,t,n)))))],n("tbody#jb-drag-parent",{},t.map((t,i)=>jb.ui.item(e,n("tr#jb-item",{"jb-ctx":jb.ui.preserveCtx(e.ctx.setData(t))},a.map(e=>n("td",jb.filterEmpty({"jb-ctx":jb.ui.preserveFieldCtxWithItem(e,t),class:e.class,title:e.hoverTitle&&e.hoverTitle(t)}),e.control?n(e.control(t,i),{index:i,row:t}):e.fieldData(t,i)))),t))),0==t.length?"no items":""])),css:">table{border-spacing: 0; text-align: left; width: 100%}\n    >table>tbody>tr>td { padding-right: 5px }\n    ",features:table.initTableOrItemlist()})}),jb.component("table.mdc",{type:"table.style,itemlist.style",params:[{id:"hideHeaders",as:"boolean",type:"boolean"},{id:"classForTable",as:"string",defaultValue:"mdc-data-table__table mdc-data-table--selectable"}],impl:customStyle({template:(e,{items:t,fields:a,classForTable:i,classForTd:n,sortOptions:r,hideHeaders:o},s)=>s("div#jb-itemlist mdc-data-table",{},s("table",{class:i},[...o?[]:[s("thead",{},s("tr#mdc-data-table__header-row",{},a.map((t,a)=>s("th#mdc-data-table__header-cell",{"jb-ctx":t.ctxId,class:["asc"==(r&&r.filter(e=>e.field==t)[0]||{}).dir?"mdc-data-table__header--sorted-ascending":"","des"==(r&&r.filter(e=>e.field==t)[0]||{}).dir?"mdc-data-table__header--sorted-descending":""].filter(e=>e).join(" "),style:{width:t.width?t.width+"px":""},onclick:"toggleSort",fieldIndex:a},jb.ui.fieldTitle(e,t,s)))))],s("tbody#jb-drag-parent mdc-data-table__content",{},t.map((t,i)=>jb.ui.item(e,s("tr",{class:"jb-item mdc-data-table__row","jb-ctx":jb.ui.preserveCtx(e.ctx.setData(t))},a.map(e=>s("td",jb.filterEmpty({"jb-ctx":jb.ui.preserveFieldCtxWithItem(e,t),class:(e.class+" "+n+" mdc-data-table__cell").trim(),title:e.hoverTitle&&e.hoverTitle(t)}),e.control?s(e.control(t,i)):e.fieldData(t,i)))),t))),0==t.length?"no items":""])),css:"{width: 100%} \n    ~ .mdc-data-table__header-cell {font-weight: 700}",features:[table.initTableOrItemlist(),table.initSort(),mdcStyle.initDynamic()]})}),jb.component("picklist.native",{type:"picklist.style",impl:customStyle({template:(e,t,a)=>a("select",{value:t.databind,onchange:!0},t.options.map(e=>a("option",{value:e.code},e.text))),css:"\n{ display: block; width: 100%; height: 34px; padding: 6px 12px; font-size: 14px; line-height: 1.42857; color: #555555; background-color: #fff; background-image: none; border: 1px solid #ccc; border-radius: 4px; -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075); box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075); -webkit-transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s; -o-transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s; transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s; }\n:focus { border-color: #66afe9; outline: 0; -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(102, 175, 233, 0.6); box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(102, 175, 233, 0.6); }\n::-webkit-input-placeholder { color: #999; }",features:[field.databind(),picklist.init()]})}),jb.component("picklist.plusIcon",{type:"feature",categories:"feature:0,picklist:50",impl:features(css("-webkit-appearance: none; appearance: none; width: 6px; height: 23px; background-repeat: no-repeat; background-position-y: -1px;"),css("background-image: url(\"data:image/svg+xml;utf8,<svg fill='black' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M17,13 H13 V17 H11 V13 H7 V11 H11 V7 H13 V11 H17 V13 Z'/></svg>\");"))}),jb.component("picklist.radio",{type:"picklist.style",params:[{id:"radioCss",as:"string",defaultValue:"",description:"e.g. display: none"},{id:"text",defaultValue:"%text%",dynamic:!0}],impl:customStyle({template:(e,{databind:t,options:a,fieldId:i,text:n},r)=>r("div",{},a.flatMap((a,o)=>[r("input",{type:"radio",name:i,id:o,checked:t===a.code,value:a.code,onchange:!0}),r("label",{for:o},n(e.ctx.setData(a)))])),css:">input { %$radioCss% }",features:[field.databind(),picklist.init()]})}),jb.component("picklist.radioVertical",{type:"picklist.style",impl:styleWithFeatures(picklist.radio(),layout.grid({columnSizes:list("30px","auto")}))}),jb.component("picklist.mdcSelect",{type:"picklist.style",params:[{id:"width",as:"number",defaultValue:300},{id:"noLabel",as:"boolean"},{id:"noRipple",as:"boolean"}],impl:customStyle({template:(e,{databind:t,options:a,title:i,noLabel:n,noRipple:r},o)=>o("div#mdc-select",{},[o("div#mdc-select__anchor",{onclick:!0},[...(e.icon||[]).filter(e=>e&&"pre"==e.ctx.vars.$model.position).map(o).map(e=>e.addClass("mdc-text-field__icon mdc-text-field__icon--leading")),o("i#mdc-select__dropdown-icon",{}),o("div#mdc-select__selected-text",{},t),...[!n&&o("label",{class:"mdc-floating-label"},i())].filter(e=>e),...[!r&&o("div",{class:"mdc-line-ripple"})].filter(e=>e)]),o("div#mdc-select__menu mdc-menu mdc-menu-surface demo-width-class",{},[o("ul#mdc-list",{},[o("li#mdc-list-item mdc-list-item--selected",{"data-value":"","aria-selected":"true"}),...a.map(e=>o("li#mdc-list-item",{"data-value":e.code},o("span#mdc-list-item__text",{},e.text)))])])]),features:[field.databind(),picklist.init(),mdcStyle.initDynamic(),css(({},{},{width:e})=>`>* { ${jb.ui.propWithUnits("width",e)} }`),interactive((e,{cmp:t})=>t.mdc_comps.forEach(e=>e.listen("MDCSelect:change",()=>t.ctx.setData(e.value))))]})}),jb.component("picklist.nativeMdLookOpen",{type:"picklist.style",impl:customStyle({template:(e,t,a)=>a("div",{},[a("input",{type:"text",value:t.databind,list:"list_"+e.ctx.id,onchange:!0}),a("datalist",{id:"list_"+e.ctx.id},t.options.map(e=>a("option",{},e.text)))]),css:">input {  appearance: none; -webkit-appearance: none; font-family: inherit;\n  background-color: transparent;\n  padding: 6px 0;\n  font-size: 14px;\n  width: 100%;\n  color: rgba(0,0,0, 0.82);\n  border: none;\n  border-bottom: 1px solid rgba(0,0,0, 0.12); }\n\n  {\n    font-family: 'Roboto','Helvetica','Arial',sans-serif;\n    position: relative;\n  }\n  >input:focus { border-color: #3F51B5; border-width: 2px}\n\n  :after { position: absolute;\n        top: 0.75em;\n        right: 0.5em;\n        /* Styling the down arrow */\n        width: 0;\n        height: 0;\n        padding: 0;\n        content: '';\n        border-left: .25em solid transparent;\n        border-right: .25em solid transparent;\n        border-top: .375em solid rgba(0,0,0, 0.12);\n        pointer-events: none; }",features:[field.databind(),picklist.init()]})}),jb.component("picklist.nativeMdLook",{type:"picklist.style",impl:customStyle({template:(e,t,a)=>a("div",{},a("select",{value:t.databind,onchange:!0},t.options.map(e=>a("option",{value:e.code},e.text)))),css:">select {  appearance: none; -webkit-appearance: none; font-family: inherit;\n  background-color: transparent;\n  padding: 6px 0;\n  font-size: 14px;\n  width: 100%;\n  color: rgba(0,0,0, 0.82);\n  border: none;\n  border-bottom: 1px solid rgba(0,0,0, 0.12); }\n\n  {\n    font-family: 'Roboto','Helvetica','Arial',sans-serif;\n    position: relative;\n  }\n  >select:focus { border-color: #3F51B5; border-width: 2px}\n\n  :after { position: absolute;\n        top: 0.75em;\n        right: 0.5em;\n        /* Styling the down arrow */\n        width: 0;\n        height: 0;\n        padding: 0;\n        content: '';\n        border-left: .25em solid transparent;\n        border-right: .25em solid transparent;\n        border-top: .375em solid rgba(0,0,0, 0.12);\n        pointer-events: none; }",features:[field.databind(),picklist.init()]})}),jb.component("picklist.labelList",{type:"picklist.style",params:[{id:"labelStyle",type:"text.style",dynamic:!0,defaultValue:text.span()},{id:"itemlistStyle",type:"itemlist.style",dynamic:!0,defaultValue:itemlist.ulLi()},{id:"cssForSelected",as:"string",description:"e.g. background: red OR >a { color: red }",defaultValue:"background: #bbb; color: #fff"}],impl:styleByControl(itemlist({items:"%$picklistModel/options%",controls:text({text:"%text%",style:call("labelStyle")}),style:call("itemlistStyle"),features:itemlist.selection({databind:"%$picklistModel/databind%",selectedToDatabind:"%code%",databindToSelected:e=>e.vars.items.filter(t=>t.code==e.data)[0],cssForSelected:"%$cssForSelected%"})}),"picklistModel")}),jb.component("picklist.buttonList",{type:"picklist.style",params:[{id:"buttonStyle",type:"button.style",dynamic:!0,defaultValue:button.mdc()},{id:"itemlistStyle",type:"itemlist.style",dynamic:!0,defaultValue:itemlist.horizontal()},{id:"cssForSelected",as:"string",description:"e.g. background: red;color: blue;font-weight: bold;",defaultValue:"background: #bbb; color: #fff"}],impl:styleByControl(itemlist({items:"%$picklistModel/options%",controls:button({title:"%text%",style:call("buttonStyle")}),style:call("itemlistStyle"),features:itemlist.selection({databind:"%$picklistModel/databind%",selectedToDatabind:"%code%",databindToSelected:e=>e.vars.items.filter(t=>t.code==e.data)[0],cssForSelected:"%$cssForSelected%"})}),"picklistModel")}),jb.component("picklist.hyperlinks",{type:"picklist.style",impl:picklist.buttonList({buttonStyle:button.href(),itemlistStyle:itemlist.horizontal("10"),cssForSelected:">a { color: red }"})}),jb.component("picklist.groups",{type:"picklist.style",impl:customStyle({template:(e,{databind:t,hasEmptyOption:a,groups:i},n)=>n("select",{value:t,onchange:!0},(a?[n("option",{value:""},"")]:[]).concat(i.map(e=>n("optgroup",{label:e.text},e.options.map(e=>n("option",{value:e.code},e.text)))))),css:"\n { display: block; width: 100%; height: 34px; padding: 6px 12px; font-size: 14px; line-height: 1.42857; color: #555555; background-color: #fff; background-image: none; border: 1px solid #ccc; border-radius: 4px; -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075); box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075); -webkit-transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s; -o-transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s; transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s; }\nselect:focus { border-color: #66afe9; outline: 0; -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(102, 175, 233, 0.6); box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(102, 175, 233, 0.6); }\nselect::-webkit-input-placeholder { color: #999; }",features:[field.databind(),picklist.init(),picklist.initGroups()]})}),jb.component("propertySheet.titlesLeft",{type:"group.style",params:[{id:"titleStyle",type:"text.style",defaultValue:styleWithFeatures(text.span(),css.bold()),dynamic:!0},{id:"titleText",defaultValue:"%%:",dynamic:!0},{id:"spacing",as:"string",description:"grid-column-gap",defaultValue:"10px"}],impl:customStyle({template:(e,{ctrls:t,titleStyle:a,titleText:i},n)=>n("div",{},t.flatMap(t=>[n(e.ctx.run(text({text:e=>i(e.setData(t.field().title())),style:e=>a(e)}))),n(t)])),css:"{ display: grid; grid-template-columns: auto auto; grid-column-gap:%$spacing%}",features:group.initGroup()})}),jb.component("propertySheet.titlesAbove",{type:"group.style",params:[{id:"titleStyle",type:"text.style",defaultValue:styleWithFeatures(text.span(),css.bold()),dynamic:!0},{id:"titleText",defaultValue:"%%",dynamic:!0},{id:"spacing",as:"string",description:"grid-column-gap",defaultValue:"10px"}],impl:customStyle({template:(e,{ctrls:t,titleStyle:a,titleText:i},n)=>n("div",{style:{"grid-template-columns":t.map(()=>"auto").join(" ")}},[...t.map(t=>n(e.ctx.run(text({text:e=>i(e.setData(t.field().title())),style:e=>a(e)})))),...t.map(e=>n(e))]),css:"{ display: grid; grid-column-gap:%$spacing% }",features:group.initGroup()})}),jb.component("editableBoolean.checkbox",{type:"editable-boolean.style",impl:customStyle({template:(e,t,a)=>a("input",{type:"checkbox",checked:t.databind,onchange:"toggle",onkeyup:"toggleByKey"}),features:field.databind()})}),jb.component("editableBoolean.checkboxWithTitle",{type:"editable-boolean.style",impl:customStyle({template:(e,{text:t,databind:a},i)=>i("div",{},[i("input",{type:"checkbox",checked:a,onchange:"toggle",onkeyup:"toggleByKey"}),t]),features:field.databind()})}),jb.component("editableBoolean.checkboxWithLabel",{type:"editable-boolean.style",impl:customStyle({template:(e,{text:t,databind:a,fieldId:i},n)=>n("div",{},[n("input",{type:"checkbox",id:"switch_"+i,checked:a,onchange:"toggle",onkeyup:"toggleByKey"}),n("label",{for:"switch_"+i},t)]),features:field.databind()})}),jb.component("editableBoolean.expandCollapse",{type:"editable-boolean.style",impl:customStyle({template:(e,{databind:t},a)=>a("i",{class:"material-icons noselect",onclick:"toggle"},t?"keyboard_arrow_down":"keyboard_arrow_right"),css:"{ font-size:16px; cursor: pointer; }",features:field.databind()})}),jb.component("editableBoolean.mdcXV",{type:"editable-boolean.style",description:"two icons",params:[{id:"yesIcon",as:"string",mandatory:!0,defaultValue:"check"},{id:"noIcon",as:"string",mandatory:!0,defaultValue:"close"}],impl:customStyle({template:(e,{title:t,databind:a,yesIcon:i,noIcon:n},r)=>r("button",{class:["mdc-icon-button material-icons",a&&"raised mdc-icon-button--on"].filter(e=>e).join(" "),title:t,tabIndex:-1,onclick:"toggle",onkeyup:"toggleByKey"},[r("i",{class:"material-icons mdc-icon-button__icon mdc-icon-button__icon--on"},i),r("i",{class:"material-icons mdc-icon-button__icon "},n)]),css:"{ border-radius: 2px; padding: 0; width: 24px; height: 24px;}",features:[field.databind(),mdcStyle.initDynamic()]})}),jb.component("editableBoolean.buttonXV",{type:"editable-boolean.style",description:"two icons",params:[{id:"yesIcon",type:"icon",mandatory:!0,defaultValue:icon("check")},{id:"noIcon",type:"icon",mandatory:!0,defaultValue:icon("close")},{id:"buttonStyle",type:"button.style",mandatory:!0,defaultValue:button.mdcFloatingAction()}],impl:styleWithFeatures(call("buttonStyle"),features(htmlAttribute("onclick","toggle"),e=>e.run({...e.componentContext.params[jb.toboolean(e.vars.$model.databind())?"yesIcon":"noIcon"],title:e.exp("%$$model/title%"),$:"feature.icon"})))}),jb.component("editableBoolean.iconWithSlash",{type:"editable-boolean.style",params:[{id:"buttonSize",as:"number",defaultValue:40,description:"button size is larger than the icon size, usually at the rate of 40/24"}],impl:styleWithFeatures(button.mdcIcon({buttonSize:"%$buttonSize%"}),features(htmlAttribute("onclick","toggle"),htmlAttribute("title","%$$model/title%"),css(If("%$$model/databind%","","background-repeat: no-repeat; background-image: url(\"data:image/svg+xml;utf8,<svg fill='white' height='%$buttonSize%' viewBox='0 0 %$buttonSize% %$buttonSize%' width='%$buttonSize%' xmlns='http://www.w3.org/2000/svg'><line x1='0' y1='0' x2='%$buttonSize%' y2='%$buttonSize%' style='stroke:white;stroke-width:2' /></svg>\")"))))}),jb.component("editableBoolean.mdcSlideToggle",{type:"editable-boolean.style",params:[{id:"width",as:"string",defaultValue:80}],impl:customStyle({template:(e,t,a)=>a("div",{class:"mdc-switch"},[a("div",{class:"mdc-switch__track"}),a("div",{class:"mdc-switch__thumb-underlay"},[a("div",{class:"mdc-switch__thumb"},a("input",{type:"checkbox",role:"switch",class:"mdc-switch__native-control",id:"switch_"+t.fieldId,checked:t.databind,onchange:"toggle",onkeyup:"toggleByKey"}))]),a("label",{for:"switch_"+t.fieldId},t.text)]),css:e=>jb.ui.propWithUnits("width",e.params.width),features:[field.databind(),mdcStyle.initDynamic()]})}),jb.component("prettyPrint",{params:[{id:"profile",defaultValue:"%%"},{id:"forceFlat",as:"boolean",type:"boolean"}],impl:(e,t)=>jb.prettyPrint(jb.val(t),e.params)}),jb.prettyPrintComp=function(e,t,a={}){if(t){const i="";return("jb.component('"+e+"', "+jb.prettyPrint(t,a)+")").replace(/\n/,i+"\n")}},jb.prettyPrint=function(e,t={}){return jb.prettyPrintWithPositions(e,t).text},jb.prettyPrint.advanceLineCol=function({line:e,col:t},a){const i=(a.match(/\n/g)||"").length;return{line:e+i,col:i?a.match(/\n(.*)$/)[1].length:t+a.length}},jb.prettyPrint.spaces=Array.from(new Array(200)).map(e=>" ").join(""),jb.prettyPrintWithPositions=function(e,{colWidth:t=80,tabSize:a=2,initialPath:i="",noMacros:n,comps:r,forceFlat:o}={}){if(r=r||jb.comps,!e||"object"!=typeof e)return{text:null!=e&&e.toString?e.toString():JSON.stringify(e),map:{}};const s=jb.prettyPrint.advanceLineCol;return d({path:i,line:0,col:0},e);function l(e,t){const a=t.reduce((t,{prop:a,item:i})=>{const n="function"==typeof i?i(t):i,r=n.text||n,o=n.map||{},l=n.path||e.path,c=s(t,""),d=s(t,r),p={...t.map,...o,[[l,a].join("~")]:[c.line,c.col,d.line,d.col]};return{text:t.text+r,map:p,unflat:t.unflat||n.unflat,...d}},{text:"",map:{},...e});return{...e,...a}}function c({path:e,line:i,col:n},r,s,p,m,u){const b={path:e,line:i,col:n},f=l(b,[..."string"==typeof s?[{prop:"!open",item:s}]:s,{prop:"!open-newline",item:()=>x()}]),y=u?"array":"obj",h=r.reduce((t,{innerPath:a,val:i},n)=>l(t,[{prop:`!${y}-prefix-${n}`,item:u?"":v(a)+": "},{prop:"!value",item:t=>{const n={...t,path:[e,a].join("~")};return{...n,...d(n,i,m)}}},{prop:`!${y}-separator-${n}`,item:()=>n===r.length-1?"":","+(m?" ":x())}]),{...f,unflat:!1}),g=l(h,[{prop:"!close-newline",item:()=>x(-1)},..."string"==typeof p?[{prop:"!close",item:p}]:p]),j=function(a){const i=jb.studio.valOfPath(e);if(e.match(/~params~[0-9]+$/))return!1;const n=e.match(/~controls$/)&&Array.isArray(i),r=jb.studio.compNameOfPath&&"customStyle"===jb.studio.compNameOfPath(e),o=(e.match(/~/g)||"").length<2,s=a.text.replace(/\n\s*/g,"").length>t;return a.unflat||r||o||n||s}(g);return!o&&j||m?Object.assign(g,{unflat:j}):c(b,r,s,p,!0,u);function x(t=0){return m?"":"\n"+jb.prettyPrint.spaces.slice(0,((e.match(/~/g)||"").length+t+1)*a)}function v(e){return e.match(/^[a-zA-Z_][a-zA-Z0-9_]*$/)?e:`'${e}'`}}function d({path:e,line:t,col:a},i,o){const s={path:e,line:t,col:a};let d=function(){if(Array.isArray(i))return function({path:e,line:t,col:a},i,n){const r={path:e,line:t,col:a},o=i.map((e,t)=>({innerPath:t,val:e}));return c(r,o,[{prop:"!open-array",item:"["}],[{prop:"!close-array",item:"]"}],n,!0)}(s,i,o);if(null===i)return"null";if(void 0===i)return"undefined";if("object"==typeof i)return function({path:e,line:t,col:a},i,o){const s={path:e,line:t,col:a},l=[jb.compName(i)].map(e=>"var"==e?"variable":e)[0],d=r[l];if(d&&jb.fixByValue(i,d),n||!l||!d||-1!=",object,var,".indexOf(`,${l},`)){const e=Object.keys(i);return e.indexOf("$")>0&&(e.splice(e.indexOf("$"),1),e.unshift("$")),c(s,e.map(e=>({innerPath:e,val:i[e]})),"{","}",o,!1)}const p=jb.macroName(l),m=d.params||[],u=-1!=(m[0]&&m[0].type||"").indexOf("[]"),b=Object.keys(i.$vars||{}).map(e=>({innerPath:`$vars~${e}`,val:{$:"Var",name:e,val:i.$vars[e]}})),f=i.remark?[{innerPath:"remark",val:{$remark:i.remark}}]:[],y=b.concat(f),h=[{prop:"!profile",item:p},{prop:"!open-by-value",item:"("}],g=[{prop:"!close-by-value",item:")"}],j=[{prop:"!profile",item:p},{prop:"!open-sugar",item:"("}],x=[{prop:"!close-sugar",item:")"}],v=[{prop:"!profile",item:p},{prop:"!open-profile",item:"({"}];if(1==m.length&&u){return c(s,y.concat(jb.asArray(i["$"+l]||i[m[0].id]).map((e,t)=>({innerPath:m[0].id+"~"+t,val:e}))),j,x,o,!0)}const w=Object.keys(i).filter(e=>"$"!=e),$=1===w.length&&m[0]&&m[0].id==w[0]&&("object"!=typeof C(w[0])||Array.isArray(C(w[0])));if(m.length<3&&!1!==d.macroByValue||d.macroByValue||$){const e=y.concat(m.map(e=>({innerPath:e.id,val:C(e.id)})));for(let t=0;t<5;t++)!e.length||e[e.length-1]&&void 0!==e[e.length-1].val||e.pop();return c(s,e,h,g,o,!0)}return c(s,(i.remark?[{innerPath:"remark",val:i.remark}]:[]).concat(b.length?[{innerPath:"vars",val:b.map(e=>e.val)}]:[]).concat(m.filter(e=>void 0!==C(e.id)).map(e=>({innerPath:e.id,val:C(e.id)}))),v,[{prop:"!close-profile",item:"})"}],o,!1);function C(e){return m[0]&&m[0].id==e&&i["$"+l]||i[e]}}(s,i,o);if("function"==typeof i)return i.toString();return"string"==typeof i&&-1==i.indexOf("'")&&-1==i.indexOf("\n")?l(s,[{prop:"!value-text-start",item:"'"},{prop:"!value-text",item:JSON.stringify(i).slice(1,-1)},{prop:"!value-text-end",item:"'"}]):"string"==typeof i&&-1!=i.indexOf("\n")?l(s,[{prop:"!value-text-start",item:"`"},{prop:"!value-text",item:i.replace(/`/g,"\\`")},{prop:"!value-text-end",item:"`"}]):JSON.stringify(i)}();return"string"==typeof d&&(d={text:d,map:{}}),d}},function(){jb.ns("tree"),jb.component("tree",{type:"control",params:[{id:"nodeModel",type:"tree.node-model",dynamic:!0,mandatory:!0},{id:"style",type:"tree.style",defaultValue:tree.expandBox({}),dynamic:!0},{id:"features",type:"feature[]",dynamic:!0,as:"array"}],impl:e=>{const t={},a=e.setVars({$tree:t}),i=a.params.nodeModel();return i?jb.ui.ctrl(a,features(defHandler("flipExpandCollapse",(e,{cmp:t})=>{const a=t.elemToPath(event.target);t.state.expanded[a]=!t.state.expanded[a],t.refresh(null,{srcCtx:e.componentContext})}),interactiveProp("model","%$$model.nodeModel%"),interactive((e,{cmp:a})=>{a.state.expanded={[a.model.rootPath]:!0},t.cmp=a,a.selectionEmitter=jb.callbag.subject(),t.redraw=a.redraw=()=>a.refresh(null,{srcCtx:e.componentContext}),a.expandPath=e=>{const t=jb.ui.treeExpandPath(a.state.expanded,e);return t&&a.redraw(),t},a.elemToPath=e=>e&&(e.getAttribute("path")||jb.ui.closest(e,".treenode")&&jb.ui.closest(e,".treenode").getAttribute("path"))}),feature.init((e,{cmp:t})=>{t.model=i,t.state.expanded=t.state.expanded||{},jb.ui.treeExpandPath(t.state.expanded,i.rootPath)}),css("{user-select: none}"))):jb.logError("missing nodeModel in tree",a)}}),jb.ui.treeExpandPath=jb.ui.treeExpandPath||((e,t)=>{let a=!1;return t.split("~").reduce((t,i)=>{const n=t?t+"~"+i:i;return a=a||!e[n],e[n]=!0,n},""),a});class e{constructor(e){Object.assign(this,e),this.model=this.cmp.model}renderTree(){const{model:e,h:t}=this;return this.noHead?t("div",{},e.children(e.rootPath).map(e=>this.renderNode(e))):this.renderNode(e.rootPath)}renderNode(e){const{cmp:t,model:a,h:i}=this,n=a.disabled&&a.disabled(e)?"jb-disabled":"",r=["treenode",a.isArray(e)?"jb-array-node":"",n].filter(e=>e).join(" "),o=t.state.expanded[e]?[i("div",{class:"treenode-children"},a.children(e).map(e=>this.renderNode(e)))]:[];return i("div",{class:r,path:e},[this.renderLine(e),...o])}}jb.component("tree.plain",{type:"tree.style",params:[{id:"showIcon",as:"boolean",type:"boolean"},{id:"noHead",as:"boolean",type:"boolean"}],impl:(t,a,i)=>t.run(customStyle({template:(t,n,r)=>{return new e({cmp:t,h:r,showIcon:a,noHead:i,renderLine:function(e){const i=t.model,n=i.icon&&i.icon(e)||"radio_button_unchecked";return r("div",{class:"treenode-line"},[i.isArray(e)?r("i",{class:"material-icons noselect flip-icon",onclick:"flipExpandCollapse",path:e},t.state.expanded[e]?"keyboard_arrow_down":"keyboard_arrow_right"):r("span",{class:"no-children-holder"}),...a?[r("i",{class:"material-icons treenode-icon"},n)]:[],r("span",{class:"treenode-label"},i.title(e,!t.state.expanded[e]))])}}).renderTree(t.model.rootPath)},css:"|>.treenode-children { padding-left: 10px; min-height: 7px }\n\t|>.treenode-label { margin-top: -1px }\n\n\t|>.treenode-label .treenode-val { color: red; padding-left: 4px; }\n\t|>.treenode-line { display: flex; box-orient: horizontal; padding-bottom: 3px; align-items: center }\n\n\t|>.treenode { display: block }\n\t|>.flip-icon { font-size: 16px; margin-right: 2px;}\n\t|>.treenode-icon { font-size: 16px; margin-right: 2px; }\n\n\t|>.treenode.selected>*>.treenode-label,.treenode.selected>*>.treenode-label  { background: #D9E8FB;}\n\t"}))}),jb.component("tree.expandBox",{type:"tree.style",params:[{id:"showIcon",as:"boolean",type:"boolean"},{id:"noHead",as:"boolean",type:"boolean"},{id:"lineWidth",as:"string",defaultValue:"300px"}],impl:(t,a,i,n)=>t.run(customStyle({template:(t,n,r)=>{return new e({cmp:t,h:r,showIcon:a,noHead:i,renderLine:function(e){const i=t.model,n=i.icon&&i.icon(e)||"radio_button_unchecked",o=i.isArray(e)?"":" nochildren",s=t.state.expanded[e]?"":" collapsed";return r("div",{class:`treenode-line${s}`},[r("button",{class:`treenode-expandbox${o}${a?" showIcon":""}`,onclick:"flipExpandCollapse",path:e},[r("div",{class:"frame"}),r("div",{class:"line-lr"}),r("div",{class:"line-tb"})]),...a?[r("i",{class:"material-icons treenode-icon"},n)]:[],r("span",{class:"treenode-label"},i.title(e,!t.state.expanded[e]))])}}).renderTree(t.model.rootPath)},css:`|>.treenode-children { padding-left: 10px; min-height: 7px }\n\t|>.treenode-label { margin-top: -2px }\n\t|>.treenode-label .treenode-val { color: red; padding-left: 4px; }\n\t|>.treenode-line { display: flex; box-orient: horizontal; width: ${n}; padding-bottom: 3px;}\n\n\t|>.treenode { display: block }\n\t|>.treenode.selected>*>.treenode-label,.treenode.selected>*>.treenode-label  { background: #D9E8FB;}\n\n\t|>.treenode-icon { font-size: 16px; margin-right: 2px; }\n\t|>.treenode-expandbox { border: none; background: none; position: relative; width:9px; height:9px; padding: 0; vertical-align: top;\n\t\tmargin-top: 5px;  margin-right: 5px;  cursor: pointer;}\n\t|>.treenode-expandbox.showIcon { margin-top: 3px }\n\t|>.treenode-expandbox div { position: absolute; }\n\t|>.treenode-expandbox .frame { background: #F8FFF9; border-radius: 3px; border: 1px solid #91B193; top: 0; left: 0; right: 0; bottom: 0; }\n\t|>.treenode-expandbox .line-lr { background: #91B193; top: 4px; left: 2px; width: 5px; height: 1px; }\n\t|>.treenode-expandbox .line-tb { background: #91B193; left: 4px; top: 2px; height: 5px; width: 1px; display: none;}\n\t|>.treenode-line.collapsed .line-tb { display: block; }\n\t|>.treenode.collapsed .line-tb { display: block; }\n\t|>.treenode-expandbox.nochildren .frame { display: none; }\n\t|>.treenode-expandbox.nochildren .line-lr { display: none; }\n\t|>.treenode-expandbox.nochildren .line-tb { display: none;}`}))}),jb.component("tree.selection",{type:"feature",params:[{id:"databind",as:"ref",dynamic:!0},{id:"autoSelectFirst",as:"boolean",type:"boolean"},{id:"onSelection",type:"action",dynamic:!0},{id:"onRightClick",type:"action",dynamic:!0}],impl:features(e=>({onclick:!0,componentDidUpdate:e=>e.setSelected(e.state.selected)}),feature.init((e,{cmp:t},{databind:a})=>{t.state.expanded=t.state.expanded||{};const i=jb.val(a());i&&jb.ui.treeExpandPath(t.state.expanded,i.split("~").slice(0,-1).join("~"))},5),interactive((e,{cmp:t},{databind:a,autoSelectFirst:i,onSelection:n,onRightClick:r})=>{const o=a(),{pipe:s,map:l,filter:c,subscribe:d,merge:p,distinctUntilChanged:m}=jb.callbag,u=jb.isWatchable(o)&&s(jb.ui.refObservable(o,t,{srcCtx:e}),l(e=>jb.val(e.ref)));t.setSelected=e=>{t.state.selected=e,t.base&&(jb.ui.findIncludeSelf(t.base,".treenode.selected").forEach(e=>e.classList.remove("selected")),jb.ui.findIncludeSelf(t.base,".treenode").filter(t=>t.getAttribute("path")===e).forEach(e=>{e.classList.add("selected"),e.scrollIntoViewIfNeeded()}))},t.getSelected=()=>t.state.selected=t.elemToPath(jb.ui.findIncludeSelf(t.base,".treenode.selected")[0]),s(p(t.selectionEmitter,u,s(t.onclick,l(e=>t.elemToPath(e.target)))),m(),c(e=>e),l(e=>jb.val(e)),d(a=>{t.setSelected(a),o&&jb.writeValue(o,a,e),n(t.ctx.setData(a))})),jb.subscribe(t.onclick,()=>t.regainFocus&&t.regainFocus()),r.profile&&(t.base.oncontextmenu=a=>(jb.ui.wrapWithLauchingElement(r,e.setData(t.elemToPath(a.target)),a.target)(),!1));var b=jb.val(o);if(!b&&i){var f=jb.ui.find(t.base.parentNode,".treenode")[0];b=t.elemToPath(f)}b&&jb.delay(1).then(()=>t.selectionEmitter.next(b))}))}),jb.component("tree.keyboardSelection",{type:"feature",params:[{id:"onKeyboardSelection",type:"action",dynamic:!0},{id:"onEnter",type:"action",dynamic:!0},{id:"onRightClickOfExpanded",type:"action",dynamic:!0},{id:"autoFocus",type:"boolean"},{id:"applyMenuShortcuts",type:"menu.option",dynamic:!0}],impl:e=>({onkeydown:!0,templateModifier:e=>{e.attributes=e.attributes||{},e.attributes.tabIndex=-1},afterViewInit:t=>{const{pipe:a,map:i,filter:n,subscribe:r}=jb.callbag,o=a(t.onkeydown,n(e=>!e.ctrlKey&&!e.altKey));function s(a){console.log(t.getSelected()),jb.ui.wrapWithLauchingElement(a,e.setData(t.getSelected()),jb.ui.findIncludeSelf(t.base,".treenode.selected>.treenode-line")[0])()}e.vars.$tree.regainFocus=t.regainFocus=t.getKeyboardFocus=t.getKeyboardFocus||(a=>(jb.ui.focus(t.base,"tree.keyboard-selection regain focus",e),!1)),e.params.autoFocus&&jb.ui.focus(t.base,"tree.keyboard-selection init autofocus",e),a(o,n(e=>13==e.keyCode),r(t=>s(e.params.onEnter))),a(o,n(e=>38==e.keyCode||40==e.keyCode),i(e=>{const a=40==e.keyCode?1:-1,i=jb.ui.findIncludeSelf(t.base,".treenode"),n=jb.ui.findIncludeSelf(t.base,".treenode.selected")[0];return t.elemToPath(i[i.indexOf(n)+a])||t.getSelected()}),r(e=>t.selectionEmitter.next(e))),a(o,n(e=>37==e.keyCode||39==e.keyCode),r(a=>{const i=t.getSelected(),n=t.model.isArray(i);if(!n||t.state.expanded[i]&&39==a.keyCode)return s(e.params.onRightClickOfExpanded);n&&i&&(t.state.expanded[i]=39==a.keyCode,t.redraw())})),jb.delay(1).then(a=>t.base&&(t.base.onkeydown=a=>{if((a.ctrlKey||a.altKey||46==a.keyCode)&&17!=a.keyCode&&18!=a.keyCode){var i=e.params.applyMenuShortcuts(e.setData(t.getSelected()));if(i&&i.applyShortcut&&i.applyShortcut(a))return!1}return!1}))}})}),jb.component("tree.regainFocus",{type:"action",impl:e=>e.vars.$tree&&e.vars.$tree.regainFocus&&e.vars.$tree.regainFocus()}),jb.component("tree.redraw",{type:"action",params:[{id:"strong",type:"boolean",as:"boolean"}],impl:(e,t)=>(jb.log("tree",["redraw",e.path,...arguments]),e.vars.$tree&&e.vars.$tree.redraw&&e.vars.$tree.redraw(t))}),jb.component("tree.expandPath",{type:"action",params:[{id:"paths",as:"array",descrition:"array of paths to be expanded"}],impl:(e,t)=>e.vars.cmp&&t.forEach(t=>jb.ui.treeExpandPath(e.vars.cmp.state.expanded,t))}),jb.component("tree.pathOfInteractiveItem",{descrition:"path of the clicked/dragged item using event.target",type:"data",impl:e=>{const{cmp:t,ev:a}=e.vars;return t&&t.elemToPath&&a&&a.target&&t.elemToPath(a.target)}}),jb.component("tree.dragAndDrop",{type:"feature",impl:e=>({onkeydown:!0,componentDidUpdate:e=>e.drake&&(e.drake.containers=jb.ui.find(e.base,".jb-array-node>.treenode-children")),afterViewInit:t=>{const a=t.drake=dragula([],{moves:e=>jb.ui.matches(e,".jb-array-node>.treenode-children>div")});a.containers=jb.ui.find(t.base,".jb-array-node>.treenode-children"),a.on("drag",(function(e,a){const i=t.elemToPath(e.firstElementChild);e.dragged={path:i,expanded:t.state.expanded[i]},delete t.state.expanded[i]})),a.on("drop",(a,i,n,r)=>{if(!a.dragged)return;a.parentNode.removeChild(a),t.state.expanded[a.dragged.path]=a.dragged.expanded;const o=treeStateAsRefs(t),s=r;let l=s?t.elemToPath(s):i.lastElementChild?addToIndex(t.elemToPath(i.lastElementChild),1):t.elemToPath(i);const c=Number(a.dragged.path.split("~").pop()),d=Number(l.split("~").pop())||0;i===n&&d>c&&(l=addToIndex(l,-1)),t.model.move(a.dragged.path,l,e),restoreTreeStateFromRefs(t,o),t.selectionEmitter.next(l),a.dragged=null,t.redraw(!0)});const{pipe:i,filter:n,subscribe:r}=jb.callbag;i(t.onkeydown,n(e=>e.ctrlKey&&(38==e.keyCode||40==e.keyCode)),r(a=>{const i=t.getSelected(),n=Number(i.split("~").pop());if(isNaN(n))return;const r=Array.from(t.base.querySelector(".treenode.selected").parentNode.children).length,o=(n+(40==a.keyCode?1:-1)+r)%r,s=i.split("~").slice(0,-1).concat([o]).join("~");t.model.move(i,s,e),t.selectionEmitter&&t.selectionEmitter.next(s),jb.delay(10).then(()=>t.regainFocus&&t.regainFocus())}))}})}),treeStateAsRefs=e=>({selected:pathToRef(e.model,e.getSelected()),expanded:jb.entries(e.state.expanded).filter(e=>e[1]).map(t=>pathToRef(e.model,t[0]))}),restoreTreeStateFromRefs=(e,t)=>{e.model.refHandler&&(refToPath(t.selected)&&e.setSelected(refToPath(t.selected)),e.state.expanded={},t.expanded.forEach(t=>e.state.expanded[refToPath(t)]=!0))},pathToRef=(e,t)=>t&&e.refHandler&&e.refHandler.refOfPath(t.split("~")),refToPath=e=>e&&e.path?e.path().join("~"):"",addToIndex=(e,t)=>{if(isNaN(Number(e.slice(-1))))return e;const a=Number(e.slice(-1))+t;return e.split("~").slice(0,-1).concat([a]).join("~")}}(),jb.ns("table-tree,tree"),jb.ns("json"),jb.component("tableTree",{type:"control",params:[{id:"treeModel",type:"tree.node-model",dynamic:!0,mandatory:!0},{id:"leafFields",type:"control[]",dynamic:!0},{id:"commonFields",type:"control[]",dynamic:!0,as:"array"},{id:"chapterHeadline",type:"control",dynamic:!0,defaultValue:text(""),description:"$collapsed as parameter"},{id:"style",type:"table-tree.style",defaultValue:tableTree.plain({}),dynamic:!0},{id:"features",type:"feature[]",dynamic:!0,as:"array"}],impl:e=>jb.ui.ctrl(e)}),jb.component("tree.modelFilter",{type:"tree.node-model",description:"filters a model by path filter predicate",params:[{id:"model",type:"tree.node-model",mandatory:!0},{id:"pathFilter",type:"boolean",dynamic:!0,mandatory:!0,description:"input is path. e.g a~b~c"}],impl:(e,t,a)=>Object.assign(Object.create(t),{children:i=>t.children(i).filter(t=>a(e.setData(t)))})}),jb.component("tableTree.init",{type:"feature",params:[{id:"autoOpenFirstLevel",as:"boolean",type:"boolean"}],impl:features(calcProp({id:"expanded",value:(e,{cmp:t,$props:a},{autoOpenFirstLevel:i})=>{const n=t.treeModel;t.state=t.state||{};const r=!t.state.expanded;if(t.state.expanded=t.state.expanded||{},r){[n.rootPath,...i&&n.children(n.rootPath)||[],...a.pathsToExtend||[]].forEach(e=>(function(e){e.split("~").reduce((e,a)=>{const i=null!=e?e+"~"+a:a;return t.state.expanded[i]=!0,i},null)})(e))}return t.state.expanded}}),calcProp({id:"items",value:(e,{cmp:t})=>{const a=t.treeModel;return e.vars.$model.includeRoot?i(a.rootPath,0):i(a.rootPath,-1).filter(e=>e.depth>-1);function i(e,n){const r=[{path:e,depth:n,val:a.val(e),expanded:t.state.expanded[e]}];return t.state.expanded[e]?a.children(e).reduce((e,t)=>n>=a.maxDepth?e:e=e.concat(i(t,n+1)),r):r}}}),interactiveProp("treeModel","%$$model.treeModel%"),interactive((e,{cmp:t})=>{t.state.expanded=jb.objFromEntries(Array.from(t.base.querySelectorAll("[expanded=true]")).map(e=>e.getAttribute("path")).concat([t.treeModel.rootPath]).map(e=>[e,!0])),t.flip=a=>{const i=function(e){return e&&(e.getAttribute("path")||jb.ui.closest(e,".jb-item")&&jb.ui.closest(e,".jb-item").getAttribute("path"))}(a.target);i.split("~").slice(0,-1).reduce((e,a)=>{const i=null!=e?e+"~"+a:a;return t.state.expanded[i]=!0,i},null),t.state.expanded[i]=!t.state.expanded[i],t.refresh(null,{srcCtx:e.componentContext})}}),feature.init((e,{cmp:t},{autoOpenFirstLevel:a})=>{const i=t.treeModel=e.vars.$model.treeModel();function n(t){return e.vars.$model[t]().map(e=>e.field())}t.renderProps.maxDepth=i.maxDepth=i.maxDepth||5,t.leafFields=n("leafFields"),t.commonFields=n("commonFields"),t.fieldsForPath=e=>i.isArray(e)?t.commonFields:t.leafFields.concat(t.commonFields),t.headline=a=>(function(a){return e.vars.$model.chapterHeadline(e.setData({path:a.path,val:i.val(a.path)}).setVars({item:a,collapsed:e=>!t.state.expanded[a.path]}))})(a),t.expandingFieldsOfItem=e=>{const a=Array.from(new Array(i.maxDepth)),n=(e.path.match(/~/g)||[]).length-(i.rootPath.match(/~/g)||[]).length-1;return a.filter((e,t)=>t<n+2).map((a,r)=>r<n||r==n&&!i.isArray(e.path)?{empty:!0}:r==n?{expanded:t.state.expanded[e.path],toggle:!0}:r==n+1?{headline:!0,colSpan:i.maxDepth-r+1}:void 0)}}))}),jb.component("tableTree.plain",{type:"table-tree.style",params:[{id:"hideHeaders",as:"boolean",type:"boolean"},{id:"autoOpenFirstLevel",as:"boolean",type:"boolean"},{id:"gapWidth",as:"number",defaultValue:30},{id:"expColWidth",as:"number",defaultValue:16},{id:"noItemsCtrl",type:"control",dynamic:!0,defaultValue:text("no items")}],impl:customStyle({template:(e,{expanded:t,items:a,maxDepth:i,hideHeaders:n,gapWidth:r,expColWidth:o,noItemsCtrl:s},l)=>l("table",{},[...Array.from(new Array(i)).map(e=>l("col",{width:o+"px"})),l("col",{width:r+"px"}),...e.leafFields.concat(e.commonFields).map(e=>l("col",{width:e.width||"200px"})),...n?[]:[l("thead",{},l("tr",{},Array.from(new Array(i+1)).map(e=>l("th",{class:"th-expand-collapse"})).concat([...e.leafFields,...e.commonFields].map(t=>l("th",{"jb-ctx":t.ctxId},jb.ui.fieldTitle(e,t,l))))))],l("tbody",{class:"jb-drag-parent"},a.map((a,i)=>l("tr",{class:"jb-item",path:a.path,expanded:t[a.path]},[...e.expandingFieldsOfItem(a).map(t=>l("td",t.empty?{class:"empty-expand-collapse"}:t.toggle?{class:"expandbox"}:{class:"headline",colSpan:t.colSpan,onclick:"flip"},t.empty?"":t.toggle?l("span",{},l("i",{class:"material-icons noselect",onclick:"flip"},t.expanded?"keyboard_arrow_down":"keyboard_arrow_right")):l(e.headline(a)))),...e.fieldsForPath(a.path).map(e=>l("td",{"jb-ctx":jb.ui.preserveFieldCtxWithItem(e,a),class:"tree-field"},l(e.control(a,i),{index:i})))]))),0==a.length?l(s()):""]),css:"{border-spacing: 0; text-align: left;width: 100%; table-layout:fixed;}\n      >tbody>tr>td { vertical-align: bottom; height: 30px; }\n      >tbody>tr>td>span { font-size:16px; cursor: pointer; border: 1px solid transparent }\n      >tbody>tr>td>span>i { font-size: 16px; vertical-align: middle;}\n      ",features:tableTree.init("%$autoOpenFirstLevel%")})}),jb.component("json.pathSelector",{description:"select, query, goto path",params:[{id:"base",as:"single",description:"object to start with"},{id:"path",description:"string with ~ separator or array"}],impl:(e,t)=>{const a=jb.val(e.params.path);return("string"==typeof a?a.split("~").filter(e=>e):jb.asArray(a)).reduce((e,t)=>e&&e[t],t)}}),jb.component("tableTree.expandPath",{type:"table-tree.style",params:[{id:"path",as:"string"}],impl:calcProp({id:"pathsToExtend",value:({},{$props:e},{path:t})=>[...t.split(","),...e.pathsToExtend||[]],phase:5})}),function(){jb.component("tree.jsonReadOnly",{type:"tree.node-model",params:[{id:"object",as:"single"},{id:"rootPath",as:"string"}],impl:(t,a,i)=>new e(a,i)});class e{constructor(e,t){this.json=e,this.rootPath=t}children(e){var t=this.val(e);return("object"==typeof t?Object.keys(t||{}):[]).filter(e=>0!=e.indexOf("$jb_")).map(t=>e+"~"+t)}val(e){return-1==e.indexOf("~")?jb.val(this.json):jb.val(e.split("~").slice(1).reduce((e,t)=>e[t],this.json))}isArray(e){var t=this.val(e);return"object"==typeof t&&null!==t}icon(){return""}title(e,t){var a=this.val(e),i=e.split("~").pop(),n=jb.ui.h;return n("div",{},null==a?i+": null":t||"object"!=typeof a?"object"!=typeof a?[i+": ",n("span",{class:"treenode-val",title:""+a},jb.ui.limitStringLength(""+a,20))]:[n("span",{},i+": ")].concat(Object.keys(a).filter(e=>0!=e.indexOf("$jb_")).filter(e=>-1!=["string","boolean","number"].indexOf(typeof a[e])).map(e=>n("span",{class:"treenode-val",title:""+a[e]},jb.ui.limitStringLength(""+a[e],20)))):i)}}jb.component("tree.json",{type:"tree.node-model",params:[{id:"object",as:"ref"},{id:"rootPath",as:"string"}],impl:function(e,a,i){return new t(a,i)}});class t{constructor(e,t){this.json=e,this.rootPath=t,this.refHandler=jb.refHandler(e)}children(e){var t=this.val(e);return("object"==typeof t?Object.keys(t||{}):[]).filter(e=>0!=e.indexOf("$jb_")).map(t=>e+"~"+t)}val(e){return-1==e.indexOf("~")?jb.val(this.json):jb.val(e.split("~").slice(1).reduce((e,t)=>e[t],jb.val(this.json)))}isArray(e){var t=this.val(e);return"object"==typeof t&&null!==t}icon(){return""}title(e,t){var a=this.val(e),i=e.split("~").pop(),n=jb.ui.h;return null==a?i+": null":t||"object"!=typeof a?n("div",{},"object"!=typeof a?[i+": ",n("span",{class:"treenode-val",title:a},jb.ui.limitStringLength(a,20))]:[n("span",{},i+": ")].concat(Object.keys(a).filter(e=>"string"==typeof a[e]||"number"==typeof a[e]||"boolean"==typeof a[e]).map(e=>n("span",{class:"treenode-val",title:""+a[e]},jb.ui.limitStringLength(""+a[e],20))))):i}modify(e,t,a,i){e.call(this,t,a)}move(e,t,a){const i=this.val(e.split("~").slice(0,-1).join("~")),n=isNaN(Number(t.split("~").slice(-1)))?t+"~0":t,r=this.val(n.split("~").slice(0,-1).join("~"));Array.isArray(i)&&Array.isArray(r)&&jb.move(jb.asRef(this.val(e)),this.val(n)?jb.asRef(this.val(n)):this.extraArrayRef(n),a)}extraArrayRef(e){const t=this.val(e.split("~").slice(0,-1).join("~")),a=jb.asRef(t),i=a.handler;return i&&i.refOfPath(i.pathOfRef(a).concat(e.split("~").slice(-1)))}}}(),function(){const storeId=Symbol.for("storeId"),{pipe:pipe,map:map,filter:filter,subscribe:subscribe,take:take,toPromiseArray:toPromiseArray}=jb.callbag;jb.ui.serializeCtxOfVdom=function(e){const t={idCounter:1,ctx:{},data:{},strs:[]};return function e(t){return jb.unique([...[t["mount-ctx"]]||!1,...Object.keys(t).filter(e=>t[e]&&"object"==typeof t[e]).flatMap(a=>e(t[a]))]).filter(e=>e)}(e).forEach(e=>(function(e){if(null==e)return;t.ctx[e.id]=t.ctx[e.id]||{id:e.id,path:e.path};return{$ctx:e.id}})(jb.ctxDictionary[e])),JSON.stringify(t)},jb.ui.deserializeCtxStore=function(e){const t=JSON.parse(e),a={data:{},ctx:{}};return Object.keys(t.ctx).forEach(e=>(function e(i){if(i.$ctx)return e(i.$ctx);const n=t.ctx[i];if(a.ctx[i])return a.ctx[i];a.ctx[i]=new jb.jbCtx;Object.assign(a.ctx[i],{id:i,path:n.path,$inProcess:!0});Object.assign(a.ctx[i],{componentContext:n.componentContext&&e(n.componentContext),vars:r(n.vars)||{},data:r(n.data),profile:n.path.split("~").reduce((e,t)=>e&&e[t],jb.comps)});a.ctx[i].profile||n.path.split("~").reduce((e,t)=>e&&e[t],jb.comps);delete a.ctx[i].$inProcess;return a.ctx[i];function r(i){if(null!=i){if("string"==typeof i)return i.match(/^#[0-9]+$/)?+i.slice(1):i.match(/^##[0-9]+$/)?i.slice(1):i;if("object"==typeof i&&i.$ctx)return e(i.$ctx);if("object"==typeof i&&null!=i.$str)return t.strs[i.$str];if("object"==typeof i)return jb.objFromEntries(jb.entries(i).map(e=>[e[0],r(e[1])]));if("number"==typeof i){const e=i;return a.data[e]?a.data[e]:(a.data[e]={$inProcess:!0},Object.keys(t.data[e]).forEach(i=>a.data[e][i]=r(t.data[e][i])),delete a.data[e].$inProcess,a.data[e])}}}})(e)),a};let messageCounter=1;function createWorker(workerId){const workerReceive=({data:data})=>{const messageId=(data.match(/^([0-9]+)>/)||["",""])[1];messageId&&Promise.resolve(jb.exec(eval(data.slice(messageId.length+1)))).then(e=>postMessage(messageId+">"+JSON.stringify(e)))},workerCode=`\n    self.workerId = () => ${workerId}\n    importScripts('http://${location.host}/dist/jb-react-all.js')\n    self.onmessage= ${workerReceive.toString()}`,worker=new Worker(URL.createObjectURL(new Blob([workerCode],{type:"application/javascript"})));return Object.assign(worker,{response:jb.callbag.subject(),onmessage(e){const t=e.data,a=(t.match(/^([^>]+)>/)||["",""])[1];jb.log("from-remote",t),worker.response.next({id:a,data:t.slice(a.length+1)})},handleBrowserEvent(e,t,a){const i=jb.ui.parents(e,{includeSelf:!0}).filter(e=>e.getAttribute&&e.getAttribute("widgetTop")).map(e=>e.getAttribute("id"))[0];return this.exec(pipeline({$asIs:{specificHandler:a,cmpId:e.getAttribute("cmp-id"),event:{type:t.type,target:{value:t.target.value},scrollPercentFromTop:t.scrollPercentFromTop},widgetId:i}},e=>jb.ui.handleBrowserEvent(e.data)))},loadSource(e){if(!e)return worker;const t=pipeline(e,e=>importScripts(e.data));return worker.exec(t).then(()=>worker)},exec(e){const t=messageCounter++,a=t+">"+jb.prettyPrint(e);return jb.log("to-remote",a),console.log("to-remote: "+a),worker.postMessage(a),pipe(worker.response,filter(({id:e})=>e==t),take(1),map(({data:e})=>e),toPromiseArray)}}),worker}jb.frame.workerId&&jb.frame.workerId()&&Object.assign(jb.ui,{_stylesToAdd:[],widgets:{},activeElement(){},focus(){},updateRenderer(e,t,a,i){const n=this._stylesToAdd.join("\n");this._stylesToAdd=[];const r=jb.ui.serializeCtxOfVdom(e);postMessage(`delta-${i}>`+JSON.stringify({delta:e,elemId:t,cmpId:a,css:n,store:r}))},addStyleElem(e){this._stylesToAdd.push(e)},handleBrowserEvent({cmpId:e,event:t,specificHandler:a,widgetId:i}){const n=a||`on${t.type}Handler`,r=jb.ui.find(jb.ui.widgets[i].top,`[cmp-id="${e}"]`,{includeSelf:!0})[0];r&&null!=t.target.value&&(r.value=t.target.value),t.target=r,(r.attributes.handlers||"").split(",").filter(e=>0==e.indexOf(n+"-")).forEach(e=>{const a=jb.ctxDictionary[e.split("-")[1]];a&&a.setVars({ev:t,widgetId:i}).runInner(a.profile.action,"action","action")})}}),jb.ui.workers={},jb.component("worker.main",{type:"remote",impl:e=>({getWorker:()=>jb.ui.mainWorker?Promise.resolve(jb.ui.mainWorker):(jb.ui.workers[1]=jb.ui.mainWorker=createWorker(1),jb.ui.mainWorker.exec('"init"').then(()=>jb.ui.mainWorker)),createWidget(e,t,a){const i=pipeline({$asIs:{widgetId:a,main:t}},e=>{const{main:t,widgetId:a}=e.data,i=e.setData(null).setVar("widgetId",a).run({$:t}),n=jb.ui.h(i);n.attributes=Object.assign(n.attributes||{},{worker:1,id:a}),jb.ui.widgets[a]={top:n},jb.ui.updateRenderer(jb.ui.compareVdom({},n),a,null,a)});return this.getWorker().then(t=>(pipe(t.response,filter(({id:e})=>e==`delta-${a}`),subscribe(({data:t})=>{const a=JSON.parse(t.replace(/"__undefined"/g,"null"));console.log("delta-from-remote",a);const{delta:i,elemId:n,cmpId:r,css:o,store:s}=a;jb.ui.mainWorker.ctxDictionary=jb.ui.mainWorker.ctxDictionary||{},Object.assign(jb.ui.mainWorker.ctxDictionary,jb.ui.deserializeCtxStore(s).ctx);const l=jb.ui.document(e).querySelector("#"+n)||jb.ui.document(e).querySelector(`[cmp-id="${r}"]`);l&&jb.ui.applyDeltaToDom(l,i),o&&jb.ui.addStyleElem(o),jb.ui.findIncludeSelf(l,"[interactive]").forEach(e=>e._component?e._component.recalcPropsFromElem():jb.ui.mountInteractive(e))})),t.exec(i)))}})}),jb.component("remote.initMainWorker",{type:"control",params:[{id:"sourceUrl",as:"string"},{id:"remote",type:"remote",mandatory:!0,defaultValue:worker.main()}],impl:(e,t,a)=>a.getWorker().then(e=>e.loadSource(t))}),jb.component("remote.widget",{type:"control",params:[{id:"main",as:"string",description:"main profile to run"},{id:"id",as:"string"},{id:"remote",type:"remote",mandatory:!0,defaultValue:worker.main()}],impl:(e,t,a,i)=>{const n=a||"widget"+e.id;return i.createWidget(e,t,n),jb.ui.h("div",{id:n,widgetTop:"true"})}})}()}).call(this,__webpack_require__(1))},function(e,t){var a;a=function(){return this}();try{a=a||new Function("return this")()}catch(e){"object"==typeof window&&(a=window)}e.exports=a}]);